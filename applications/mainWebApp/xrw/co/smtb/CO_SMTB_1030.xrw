<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="../../../css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>세금계산서 관리(CO_SMTB_1030)</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<!-- 화면 로딩시의 초기 데이터를 담당 -->
						<session>
							<semuro_id/>
						</session>
						<!-- 서버의 세션 정보를 담당한다 -->
						<comboSet>
							<!-- 선택계열의 정보를 담당 -->
							<dataSet>
								<SMTB_STAT_CD_LIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</SMTB_STAT_CD_LIST>
								<ERPLACE_CD_LIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</ERPLACE_CD_LIST>
								<DLCO_CLSF_CD_LIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</DLCO_CLSF_CD_LIST>
								<SLIP_CLSF_LIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</SLIP_CLSF_LIST>
							</dataSet>
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo>
							<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
						</pageInfo>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
					</initData>
					<reqData>
						<searchData>
							<cmpy_cd/>
							<supbuy_type>AR</supbuy_type>
							<direction/>
							<dti_status/>
							<sup_bizplace_code/>
							<dti_wdate_fr/>
							<dti_wdate_to/>
							<com_regno/>
							<com_name/>
							<slip_clsf_cd/>
							<slip_occr_dt_fr/>
							<slip_occr_dt_to/>
							<dti_type>0</dti_type>
						</searchData>
						<reqForm>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<slip_seq/>
							<semuro_no/>
						</reqForm>
						<multiUpDate>
							<multiUpdateData/>
						</multiUpDate>
					</reqData>
					<resData>
						<!-- 전달 받은 데이터를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 formData를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 데이터를 가공할 임시저장소 ( submit의 결과가 담김) -->
						<resForm>
							<co_smtb_1021_u>
								<dataSet>
									<errcode/>
									<errmsg/>
									<batch_id/>
									<smart_id/>
									<smart_pw/>
								</dataSet>
							</co_smtb_1021_u>
						</resForm>
						<!-- 전달 받은 errorCode를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 errorMsg를 담당 ( submit의 결과가 담김) -->
						<gridData>
							<co_smtb_1031_l>
								<dataSet>
									<TAX_STMTLIST>
										<record>
											<conversation_id/>
											<supbuy_type/>
											<direction/>
											<dti_wdate/>
											<blank_cnt/>
											<dti_type/>
											<tax_demand/>
											<seq_id/>
											<sup_com_id/>
											<sup_com_regno/>
											<sup_rep_name/>
											<sup_com_name/>
											<sup_com_type/>
											<sup_com_classify/>
											<sup_com_addr/>
											<sup_bizplace_code/>
											<byr_com_regno/>
											<byr_rep_name/>
											<byr_com_name/>
											<byr_com_type/>
											<byr_com_classify/>
											<byr_com_addr/>
											<byr_tel_num/>
											<byr_email/>
											<sup_amount/>
											<tax_amount/>
											<total_amount/>
											<dtt_yn/>
											<remark/>
											<dti_status/>
											<dti_status_nm/>
											<return_code/>
											<return_description/>
											<sbdescription/>
											<created_by/>
											<creation_date/>
											<last_updated_by/>
											<last_update_date/>
										</record>
										<totalcnt/>
									</TAX_STMTLIST>
									<errcode/>
									<errmsg/>
								</dataSet>
							</co_smtb_1031_l>
							<co_smtb_1030_m>
								<dataSet>
									<SMTB_STAT_CD_LIST>
										<record>
											<cd/>
											<cdnm/>
											<cd_abrv_nm/>
											<cdnm_cd/>
											<cdabrvnm_cd/>
										</record>
									</SMTB_STAT_CD_LIST>
									<ERPLACE_CD_LIST>
										<record>
											<cd/>
											<cdnm/>
											<cd_abrv_nm/>
											<cdnm_cd/>
											<cdabrvnm_cd/>
										</record>
									</ERPLACE_CD_LIST>
									<DLCO_CLSF_CD_LIST>
										<record>
											<cd/>
											<cdnm/>
											<cd_abrv_nm/>
											<cdnm_cd/>
											<cdabrvnm_cd/>
										</record>
									</DLCO_CLSF_CD_LIST>
									<SLIP_CLSF_LIST>
										<record>
											<cd/>
											<cdnm/>
											<cd_abrv_nm/>
											<cdnm_cd/>
											<cdabrvnm_cd/>
										</record>
									</SLIP_CLSF_LIST>
								</dataSet>
							</co_smtb_1030_m>
						</gridData>
						<MsgData/>
					</resData>
					<tempData>
						<dt_clsf/>
					</tempData>
				</root>
			</instance>
			<script type="javascript" src="/js/CIISComm.js"/>
			<script type="javascript" src="/js/TFCommon.js"/>
			<script type="javascript" src="/js/fcmc_common.js"/>
			<script type="javascript" src="/js/se_comm.js"/>
			<submission id="co_smtb_1030_m" action="/co/smtb/1030" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/initData/comboSet/dataSet"/>
			<submission id="co_smtb_1031_l" action="/co/smtb/1031" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/co_smtb_1031_l/dataSet"/>
			<submission id="co_smtb_1021_u" action="/co/smtb/1021" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/multiUpDate" resultref="/root/resData/resForm/co_smtb_1021_u/dataSet"/>
			<submission id="co_smtb_1020_u" action="/co/smtb/1020" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/gridData/fc_acct_2175_a/dataSet" resultref="/root/tempData"/>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					model.send("co_smtb_1030_m");
//					model.copyNode("/root/initData/comboSet", "/root/resData");
					makeComboGubun("", "/root/initData/comboSet/dataSet/SMTB_STAT_CD_LIST", "record", "cdnm_cd", "cd");
					makeComboGubun("", "/root/initData/comboSet/dataSet/ERPLACE_CD_LIST", "record", "cd_abrv_nm", "cd");
					//makeComboGubun("", "/root/initData/comboSet/dataSet/CUR_SLIP_CLSF_LIST", "record", "cd_nm", "cd");

					set_refvalue("/root/reqData/searchData/dti_wdate_fr",commCurDate());
					set_refvalue("/root/reqData/searchData/dti_wdate_to",commCurDate());
					set_refvalue(combo2,"I");
					model.refresh();

				]]>
			</script>
			<script type="javascript" ev:event="xforms-model-construct-done">
				<![CDATA[
				init_controls();
				set_column_visibility();
				]]>
			</script>
		</model>
		<script type="javascript">
			<![CDATA[
			var	_oth_clsf = "1";

			function init_controls(){
				set_default(datagrid1);							//datagrid
			}	
			function set_column_visibility() {
				//모든 컬럼을 감춘다.
				hide_all_columns(datagrid1);
				//공통항목을 보여준다.
				show_all_columns(datagrid1);
			}			
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="765" guideline="2,34;2,39;2,40;2,50;2,70;2,78;2,80;2,104;2,105;2,112;2,113;2,117;2,118;2,132;2,133;2,157;2,158;2,366;2,377;2,376;2,393;2,408;2,409;1,936;1,927;1,926;1,459;1,449;2,755;">
		<group id="group_scr" class="gro_sel" style="left:10px; top:79px; width:926px; height:76px; ">
			<caption id="caption1" class="list_cap02" style="left:0px; top:0px; width:926px; height:76px; text-align:center; "/>
			<caption id="caption13" class="list_cap02" style="left:470px; top:25px; width:456px; height:26px; text-align:center; "/>
			<caption id="caption12" class="list_cap02" style="left:470px; top:50px; width:456px; height:26px; text-align:center; "/>
			<caption id="caption7" class="list_cap02" style="left:0px; top:50px; width:470px; height:26px; text-align:center; "/>
			<caption id="caption11" class="list_cap02" style="left:5px; top:25px; width:465px; height:26px; text-align:center; "/>
			<caption id="caption9" class="list_cap02" style="left:0px; top:0px; width:470px; height:26px; text-align:center; "/>
			<caption id="caption8" class="list_cap03" style="left:0px; top:0px; width:120px; height:27px; text-align:center; ">발생일자</caption>
			<caption id="caption10" class="list_cap03" style="left:0px; top:25px; width:120px; height:26px; text-align:center; ">발행구분</caption>
			<caption id="caption3" class="list_cap03" style="left:469px; top:25px; width:120px; height:26px; text-align:center; ">사업자등록번호</caption>
			<caption id="caption5" class="list_cap03" style="left:469px; top:50px; width:120px; height:26px; text-align:center; ">사   업   자   명</caption>
			<caption id="caption4" class="list_cap03" style="left:0px; top:50px; width:120px; height:26px; text-align:center; ">상      태</caption>
			<select1 id="combo1" ref="/root/reqData/searchData/direction" appearance="minimal" editmode="inputsearch" itemcount="10" style="left:123px; top:29px; width:220px; height:18px; ">
				<choices>
					<item>
						<label>전체</label>
						<value/>
					</item>
					<item>
						<label>정발행</label>
						<value>2</value>
					</item>
					<item>
						<label>역발행</label>
						<value>1</value>
					</item>
				</choices>
			</select1>
			<select1 id="combo2" ref="/root/reqData/searchData/dti_status" appearance="minimal" editmode="inputsearch" itemcount="10" style="left:123px; top:54px; width:220px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/SMTB_STAT_CD_LIST/record">
						<label ref="cdnm_cd"/>
						<value ref="cd"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						if(combo_data_contains(combo2, combo2.value) == -1){
							show_message("정확한 값을 선택해 주세요.");
							set_refvalue(combo2,"");
							return;
						}
					]]>
				</script>
			</select1>
			<caption id="caption6" style="left:226px; top:5px; width:15px; height:20px; ">~</caption>
			<input id="srch_dti_wdate_fr" ref="/root/reqData/searchData/dti_wdate_fr" class="req" inputtype="date" required="true" format="yyyy-mm-dd" style="left:123px; top:4px; width:100px; height:18px; "/>
			<input id="srch_dti_wdate_to" ref="/root/reqData/searchData/dti_wdate_to" class="req" inputtype="date" required="true" format="yyyy-mm-dd" style="left:242px; top:4px; width:100px; height:18px; "/>
			<input id="srch_com_regno" ref="/root/reqData/searchData/com_regno" navindex="-1" editable="true" appearance="input" style="left:592px; top:29px; width:218px; height:18px; text-align:right; border-style:none; "/>
			<input id="srch_com_name" ref="/root/reqData/searchData/com_name" navindex="-1" editable="true" appearance="input" style="left:592px; top:54px; width:218px; height:18px; text-align:right; border-style:none; "/>
			<caption id="caption14" class="list_cap02" style="left:470px; top:0px; width:456px; height:26px; text-align:center; "/>
			<caption id="caption15" class="list_cap03" style="left:469px; top:0px; width:120px; height:26px; text-align:center; ">사      업      장</caption>
			<select1 id="combo3" ref="/root/reqData/searchData/sup_bizplace_code" appearance="minimal" editmode="inputsearch" itemcount="10" style="left:592px; top:4px; width:220px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/ERPLACE_CD_LIST/record">
						<label ref="cd_abrv_nm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						if(combo_data_contains(combo3, combo3.value) == -1){
							show_message("정확한 값을 선택해 주세요.");
							set_refvalue(combo1,"");
							return;
						}
					]]>
				</script>
			</select1>
			<select1 id="cb_dt_clsf" ref="/root/tempData/dt_clsf" navindex="5" appearance="minimal" style="left:348px; top:4px; width:67px; height:18px; ">
				<choices>
					<item>
						<label>당일</label>
						<value>01</value>
					</item>
					<item>
						<label>당월</label>
						<value>02</value>
					</item>
					<item>
						<label>전월</label>
						<value>03</value>
					</item>
					<item>
						<label>년간</label>
						<value>04</value>
					</item>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						var currentdt = getCurrentDate();
						var currentmt = getCurrentMonth();				
									
						var dt_clsf = model.getValue("/root/tempData/dt_clsf"); //선택한 콤보박스 값..
										
						if(dt_clsf == "01"){  
							var frdt = dateAdd("d", 0, currentdt);	//당일
							var todt = dateAdd("d",0, currentdt);	//당일
							
							model.setValue("/root/reqData/searchData/dti_wdate_fr", frdt); 
							model.setValue("/root/reqData/searchData/dti_wdate_to", todt); 
						}else if(dt_clsf == "02"){
							var frdt = currentdt.substring(0,6)+"01"; //당월의 1일부터
							var todt = dateAdd("d",0, currentdt);	//당월의 현재일 
							
							model.setValue("/root/reqData/searchData/dti_wdate_fr", frdt); 
							model.setValue("/root/reqData/searchData/dti_wdate_to", todt); 
						}else if(dt_clsf == "03") {
							var frdt = dateAdd("m", -1, currentmt+"01");
							var pre_month = frdt.substring(0,6);
							var todt = pre_month+commLastDay(pre_month); 	//전월의 말일 
							
							model.setValue("/root/reqData/searchData/dti_wdate_fr", frdt); 
							model.setValue("/root/reqData/searchData/dti_wdate_to", todt);
						}else if(dt_clsf == "04") {
							var frdt =  currentmt.substring(0,4)+"0101";  //전월의 1일부터
							var todt =  currentdt;	//전월의 말일 
							
							model.setValue("/root/reqData/searchData/dti_wdate_fr", frdt); 
							model.setValue("/root/reqData/searchData/dti_wdate_to", todt);
						}	
					
						model.refresh();
						
					]]>
				</script>
			</select1>
		</group>
		<group id="group_line" class="gro_line" style="left:10px; top:160px; width:926px; height:5px; "/>
		<datagrid id="datagrid1" nodeset="/root/resData/gridData/co_smtb_1031_l/dataSet/TAX_STMTLIST/record" caption="^발행일자^사업자번호^거래처명^공급가액^부가세^합계^대표자^상태^E-Mail^세금계산서번호" colsep="#" colwidth="28, 74, 80, 145, 99, 104, 96, 78, 81, 122, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100" extendlastcol="scroll" frozencols="7" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:8px; top:205px; width:931px; height:518px; ">
			<col checkvalue="1,0" type="checkbox"/>
			<col ref="dti_wdate" format="yyyy-mm-dd"/>
			<col ref="byr_com_regno"/>
			<col ref="byr_com_name"/>
			<col ref="sup_amount" format="(-)#,###" style="text-align:right; "/>
			<col ref="tax_amount" format="(-)#,###" style="text-align:right; "/>
			<col ref="total_amount" format="(-)#,###" style="text-align:right; "/>
			<col ref="byr_rep_name"/>
			<col ref="dti_status_nm" style="text-align:left; "/>
			<col ref="byr_email"/>
			<col ref="seq_id" type="hidden" style="text-align:right; "/>
			<col ref="sbdescription"/>
			<col ref="dti_status" type="hidden"/>
			<col ref="direction" type="hidden"/>
			<col ref="conversation_id" type="hidden"/>
			<col ref="blank_cnt" type="hidden" style="text-align:left; "/>
			<col ref="dti_type" type="hidden" style="text-align:left; "/>
			<col ref="tax_demand" format="(-)#,###" style="text-align:right; "/>
			<col ref="sup_com_id" style="text-align:left; "/>
			<col ref="sup_com_regno" format="yyyy-mm-dd"/>
			<col ref="sup_rep_name" format="(-)#,###" style="text-align:right; "/>
			<col ref="sup_com_name"/>
			<col ref="sup_com_type"/>
			<col ref="sup_com_classify"/>
			<col ref="sup_com_addr"/>
			<col ref="sup_bizplace_code"/>
			<script type="javascript" ev:event="xforms-value-changed">
				<![CDATA[
					if (datagrid1.valueMatrix(datagrid1.row, 1) == "1") {
						datagrid1.rowStatus(datagrid1.row) = 1;
					}
					else {
						datagrid1.rowStatus(datagrid1.row) = 0;
					}				
				]]>
			</script>
		</datagrid>
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<group id="grp_buttons" class="gro_sel" style="left:10px; top:50px; width:926px; height:21px; ">
			<button id="btn_select" class="btn02" crud="R" style="left:800px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if (!check_reqItem(srch_dti_wdate_fr,"trim","focus","발생일자FR은 필수입력항목입니다.")) { return false; }
						if (!check_reqItem(srch_dti_wdate_to,"trim","focus","발생일자TO는 필수입력항목입니다.")) { return false; }

						var slip_occr_dt_diff;
						slip_occr_dt_diff = get_datediff(srch_dti_wdate_fr.value,srch_dti_wdate_fr.value);												
						
						if(slip_occr_dt_diff > 366){
							show_message("1년이 초과하는 자료는 조회할 수 없습니다.");
							return;
						}
											
						model.send("co_smtb_1031_l");	
						
						if(get_refvalue("/root/resData/gridData/co_smtb_1031_l/dataSet/TAX_STMTLIST/totalcnt") == 0)
						{
							show_message("검색결과가 없습니다.");
							//tot_suply_amt.value = "";
							//tot_vat_amt.value = "";
							//return;
						}else{						

							for(var i=1; i<datagrid1.rows; i++){
								datagrid1.valueMatrix(i,1) = 0;	
							}					
						}
						// 상태에따른 버튼 컨트롤 추가.
						//debugger;
						btn_retry.disabled = true; 			//매출발행
						btn_canc.disabled = true;			//발행취소
						btn_canc_req.disabled = true;		//발행취소요청
						btn_canc_acpt.disabled = true;		//발행취소승인
						btn_canc_ref.disabled = true;		//발행취소거부
						btn_email.disabled = true;			//이메일재발송
						//btn_tax_view.disabled = true;		//세금계산서보기
						btn_inv_req_acpt.disabled = true;	//역매출발행
						btn_inv_req_ref.disabled = true;		//역발행거부
												
						switch (get_refvalue("/root/reqData/searchData/dti_status")) {

						   case "S" : //매출저장
						      btn_retry.disabled = false; 			//매출발행
						      break;
						   case "I" : //수신미승인
						      btn_canc.disabled = false;			//발행취소
						      btn_email.disabled = false;			//이메일재발송
						      btn_tax_view.disabled = false;		//세금계산서보기						      
      						      break;
						   case "V" : //역발행요청
						      btn_inv_req_acpt.disabled = false;	//역매출발행
						      btn_inv_req_ref.disabled = false;		//역발행거부
      						      break;						      
						   case "C" : //수신승인
						      btn_canc_req.disabled = false;		//발행취소요청
						      btn_email.disabled = false;			//이메일재발송						      
						      btn_tax_view.disabled = false;		//세금계산서보기
      						      break;						      
						   case "M" : //발행취소요청(공급받는자)
						      btn_canc_acpt.disabled = false;		//발행취소승인
						      btn_canc_ref.disabled = false;		//발행취소거부						      
      						      break;						      
						   case "N" : //발행취소요청(공급자)
						      btn_email.disabled = false;			//이메일재발송
      						      break;	
/*      						      					      
						   case "R" : //수신거부
      						      break;	
						   case "O" :  //취소완료
      						      break;						   
						   case "T" :  //역발행거부
      						      break;						   
						   case "M" : //역발행요청취소
      						      break;						   
*/      						      
						   default :
						      btn_retry.disabled = true; 			//매출발행
						      btn_canc.disabled = true;			//발행취소
						      btn_canc_req.disabled = true;		//발행취소요청
						      btn_canc_acpt.disabled = true;		//발행취소승인
						      btn_canc_ref.disabled = true;		//발행취소거부
						      btn_email.disabled = true;			//이메일재발송
						      btn_tax_view.disabled = true;		//세금계산서보기
      						      break;						      
						} 							
			
						
						
						
						
						
						/*						
						var tot_suply_amt1 = 0;
						var tot_vat_amt1 = 0;
						for(var i=1; i<datagrid1.rows; i++){
							 tot_suply_amt1 =  Number(tot_suply_amt1) + Number(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/suply_amt"));
							 tot_vat_amt1 =  Number(tot_vat_amt1) + Number(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/vat_amt"));
						}
						tot_suply_amt.value = tot_suply_amt1;
						tot_vat_amt.value = tot_vat_amt1;
						datagrid1.refresh();	
						*/
						/*
						for(var i=1; i<datagrid1.rows; i++){
							if(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/ask_dept_cd") !="" &&
							  get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/slip_rcpm_dt").Trim()==""){
								datagrid1.cellstyle("background-color", i, 1, i, 16) = "#fefae2";
							}
							else{
								datagrid1.cellStyle("background-color", i, 1, i, 16) = "#ffffff";
							}
							
							if(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/tax_stmt_aprv_yn") !="승인"){
								datagrid1.isReadOnly(i,1) = true;
							}
							else{
								if(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/transmission_yn") =="Y"){
									datagrid1.isReadOnly(i,1) = true;
								}
								else{
									if(get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+i+"]/tax_stmt").substring(0,2) !="30"){
										
										datagrid1.isReadOnly(i,1) = true;
									}
									else{
										datagrid1.isReadOnly(i,1) = false;
									}
								}
							}
						}
						*/
					]]>
				</script>
			</button>
			<button id="btn_pop1" class="btn02" visibility="hidden" crud="R" style="left:145px; top:0px; width:52px; height:21px; ">
				<caption>수입결의</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						//var tax_stmt_aprv_yn = get_refvalue("/root/resData/gridData/dataSet/TAX_STMTLIST/record["+datagrid1.row+"]/tax_stmt_aprv_yn").Trim();
						var tax_stmt_no = get_refvalue("/root/resData/gridData/co_smtb_1031_l/dataSet/TAX_STMTLIST/record["+datagrid1.row+"]/seq_id");
						if(tax_stmt_no.substring(11,2) == "30"){
							//공통수입결의등록 호출
							model.property("FC_ACCT_2120_srch_tax_stmt_no")  = tax_stmt_no;
							model.property("FC_ACCT_2120_popup_flag") = "Y";
							
							// 화면호출
	//							viewer("mainFrame").window.javaScript.onLoadPopupPageEx("FC_ACCT_2120", "modal", "align:center; caption:hidden; width:946px; height:728px;");
							viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_ACCT_2120");	
						}
						else{
							show_message("수입결의건이 아닌 세금계산서는 조회할 수 없습니다.");
						}
					]]>
				</script>
			</button>
			<button id="btn_help" class="btn02" visibility="hidden" crud="R" style="left:90px; top:0px; width:52px; height:21px; ">
				<caption>엑셀</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var grid = null;
					
					if(_oth_clsf == "1"){			
						grid = datagrid1;
					}
					
					var filename = window.fileDialog("save", ",", false, "", "xls", "Excel File(*.xls)|*.xls");
					if(filename!=""){
						grid.saveExcel(filename, "sheetname: ");
					}
					]]>
				</script>
			</button>
			<button id="btnClose" class="btn02" style="left:861px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						formClose();			
					]]>
				</script>
			</button>
			<button id="button1" class="btn04" visibility="hidden" crud="R" style="left:5px; top:0px; width:82px; height:21px; ">
				<caption>세무로전송</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if(semuro_id.value == ""){
							show_message("전송할 수 있는 사용자가 아닙니다.");
							return false;
						}
						if(pwd.value ==""){
							show_message("비밀번호는 필수입력항목입니다.");
							return false;
						}

						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("전송할 자료가 없습니다.");
							return false;
						}						

						if(show_message("전송하시겠습니까?", "전송 확인", MB_YESNO) != IDYES) {
							return false;
						}
						set_refvalue("/root/reqData/multiUpDate/tmsg_type","1");		//전송구분 1:순발행, 2:역발행
						set_refvalue("/root/reqData/multiUpDate/stmt_clsf","1");		//증빙구분 1:과새, 2:영세, 3:면세 
						set_refvalue("/root/reqData/multiUpDate/pers_clsf","2");		//수신처구분 1:가입자, 2:비가입자, 3: 수기등록
						set_refvalue("/root/reqData/multiUpDate/semuro_id", semuro_id.value);		//세무로 ID
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("fc_acct_2172_a");
						
						if(submit_completed()){
						}
						else{
							return false;
						}

						var rtnString;
						var ret;
						var slip_occr_dt, slip_clsf_cd, slip_seq;
						var rows		= datagrid2.rows;
						var tmsg_type   = "1";
						var tax_stmt_clsf = "1";
						var rmsg_pers_clsf = "2";
						
//						if(rows = datagrid2.fixedRows){
						if(rows == 0){							
							show_message("전송할 자료가 없습니다.");
							return false;
						}

						for(var i=1; i < rows; i++){
							rtnString = datagrid2.valueMatrix(i,1);
							
							
							ret = object1.misSndDocRtnMsg(tmsg_type, tax_stmt_clsf, rmsg_pers_clsf, semuro_id.value, pwd.value, semuro_id.value, rtnString, "","");

							if(ret == ""){		
								return false;
							}
							else if(ret.length != 24 ){
								break;
							}
							 slip_occr_dt = datagrid2.valueMatrix(i,2);
							 slip_clsf_cd = datagrid2.valueMatrix(i,3);
							 slip_seq = datagrid2.valueMatrix(i,4);
							 
							 set_refvalue("/root/reqData/reqForm/slip_occr_dt", slip_occr_dt);
							 set_refvalue("/root/reqData/reqForm/slip_clsf_cd", slip_clsf_cd);
							 set_refvalue("/root/reqData/reqForm/slip_seq", slip_seq);
							 set_refvalue("/root/reqData/reqForm/semuro_no", ret);
							 model.send("fc_acct_2173_u");							 
						}

						if(submit_completed()){
							show_message("전송되었습니다.");
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
		</group>
		<group id="group1" class="gro_sel" style="left:10px; top:170px; width:926px; height:21px; ">
			<button id="btn_canc" class="btn03" crud="U" style="left:68px; top:0px; width:68px; height:21px; ">
				<caption>발행취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
						var sbdescription = "";
						
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "I"){
									show_message("상태가 수신미승인(I)인 경우에만 발행취소가 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}								
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}						

						showPromptBox("발행 취소 사유를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							var sbdescription = model.getValue("/root/tempData/result");
						}else{
							return false;							
						}	

						if(show_message("발행취소 하시겠습니까?", "취소 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");
							var status = "O";
							var signal = "CANCELALL";

							var url = CIISComm_SMTB_URL+"/callSB_V3/XXSB_DTI_STATUS_CHANGE.asp"
								  + "?BATCH_ID=" + batch_id
								  + "&STATUS=" + status
								  + "&SIGNAL=" + signal
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&SBDESCRIPTION=" + sbdescription;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_retry" class="btn03" crud="U" style="left:0px; top:0px; width:64px; height:21px; ">
				<caption>재발행</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						//var test = parent.htmlwindow.prompt("테스트","무엇이든 물어보세요.");
						
						//showConfirmBox("나나난");

						
						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "S"){
									show_message("상태가 매출저장인 경우에만 재발행이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}
								cnt = cnt+1;
							}
						}
						

						
						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}

						if(show_message("재발행 하시겠습니까?", "재발행 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");

							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_ARISSUE.asp?BATCH_ID=" + batch_id + "&ID=" + smart_id + "&PASS=" + smart_pw;
							
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");

							model.send("co_smtb_1020_u");

							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_email" class="btn05" crud="U" style="left:716px; top:0px; width:109px; height:21px; ">
				<caption>E-MAIL재발송</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
						var email = "";
						var conversation_id = "";
						var status = "";
						
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "I" && datagrid1.valueMatrix(datagrid1.row, 13) != "C" && datagrid1.valueMatrix(datagrid1.row, 13) != "V" & datagrid1.valueMatrix(datagrid1.row, 13) != "N"){
									show_message("상태가 미승인(I),수신승인(C),역발행요청(V),공급자발행취소요청(N)인 경우에만 재발송이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}
								status = datagrid1.valueMatrix(datagrid1.row, 13);
								email = datagrid1.valueMatrix(datagrid1.row, 10);
								conversation_id = datagrid1.valueMatrix(datagrid1.row, 15);
								cnt = cnt+1;
							}
						}
						
						if(cnt < 1){
							show_message("선택된 건이 없습니다.");
							return false;						
						}else if(cnt > 1){
							show_message("E-Mail 재전송은 한건씩만 가능합니다.");
							return false;
						}

						showPromptBox("E-Mail을 재전송할 주소를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							
							if (model.getValue("/root/tempData/result") != ""){
								email = model.getValue("/root/tempData/result");
							}
						}else{
							return false;							
						}

						if(show_message("E-Mail을 재발송 하시겠습니까?", "재발송 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");

							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_SEND_EMAIL.asp"
								  + "?CONVERSATION_ID=" + conversation_id
								  + "&EMAIL=" + email
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&STATUS=" + status
//							alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_canc_req" class="btn04" crud="U" style="left:137px; top:0px; width:90px; height:21px; ">
				<caption>발행취소요청</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "C"){
									show_message("상태가 수신승인(C)인 경우에만 발행취소요청이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}									
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}					

						showPromptBox("발행취소요청 사유를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							var sbdescription = model.getValue("/root/tempData/result");
						}else{
							return false;							
						}							

						if(show_message("발행취소를 요청 하시겠습니까?", "취소 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");
							var status = "N";
							var signal = "CANCELISSUE";
							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_STATUS_CHANGE.asp"
								  + "?BATCH_ID=" + batch_id
								  + "&STATUS=" + status
								  + "&SIGNAL=" + signal
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&SBDESCRIPTION=" + sbdescription;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_canc_acpt" class="btn04" crud="U" style="left:232px; top:0px; width:90px; height:21px; ">
				<caption>발행취소승인</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "M"){
									show_message("상태가 발행취소요청(M)인 경우에만 발행취소승인이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}									
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}						
						
						/*
						showPromptBox("거부 및 취소사유를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							var sbdescription = model.getValue("/root/tempData/result");
						}else{
							return false;							
						}							
						*/
						var sbdescription = "";
						
						if(show_message("발행취소요청를 승인 하시겠습니까?", "취소 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");
							var status = "O";
							var signal = "SRADAPPRR";
							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_STATUS_CHANGE.asp"
								  + "?BATCH_ID=" + batch_id
								  + "&STATUS=" + status
								  + "&SIGNAL=" + signal
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&SBDESCRIPTION=" + sbdescription;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_canc_ref" class="btn04" crud="U" style="left:327px; top:0px; width:90px; height:21px; ">
				<caption>발행취소거부</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "M"){
									show_message("상태가 발행취소요청(M)인 경우에만 발행취소거부가 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}										
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}						
						
						showPromptBox("발행취소요청 거부에 대한 사유를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							var sbdescription = model.getValue("/root/tempData/result");
						}else{
							return false;							
						}
						
						if(show_message("발행취소요청을 거부 하시겠습니까?", "취소 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");
							var status = "C";
							var signal = "REQREJECTR";
							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_STATUS_CHANGE.asp"
								  + "?BATCH_ID=" + batch_id
								  + "&STATUS=" + status
								  + "&SIGNAL=" + signal
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&SBDESCRIPTION=" + sbdescription;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_tax_view" class="btn04" crud="U" style="left:831px; top:0px; width:90px; height:21px; ">
				<caption>세금계산서보기</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
						
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								/*
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "I" && datagrid1.valueMatrix(datagrid1.row, 13) != "C"){
									show_message("상태가 수신미승인(I),수신승인(C)인 경우에만 세금계산서보기가 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}	
								*/									
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}						

						if(show_message("세금계산서보기을 실행 하시겠습니까?", "취소 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");

							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_PRINT.asp"
								  + "?BATCH_ID=" + batch_id;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:720px;height:700px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_inv_req_acpt" class="btn04" crud="U" style="left:422px; top:0px; width:85px; height:21px; ">
				<caption>역매출발행</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						//var test = parent.htmlwindow.prompt("테스트","무엇이든 물어보세요.");
						
						//showConfirmBox("나나난");

						
						var cnt = 0;
						var conversation_id = "";
						
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "V"){
									show_message("상태가 역발행요청인 경우에만 역매출발행이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}
								conversation_id = datagrid1.valueMatrix(datagrid1.row, 15);
								cnt = cnt+1;
							}
						}
						

						
						if(cnt < 1){
							show_message("선택된 건이 없습니다.");
							return false;						
						}else if(cnt > 1){
							show_message("역매출발행은 한건씩만 가능합니다.");
							return false;
						}

						if(show_message("역매출발행 하시겠습니까?", "역매출발행 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");

							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_RARISSUE.asp?CONVERSATION_ID=" + conversation_id + "&ID=" + smart_id + "&PASS=" + smart_pw;
							
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");

							model.send("co_smtb_1020_u");

							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_inv_req_ref" class="btn04" crud="U" style="left:512px; top:0px; width:85px; height:21px; ">
				<caption>역발행거부</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var cnt = 0;
	
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "V"){
									show_message("상태가 역발행요청인 경우에만 역발행거부가 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}										
								cnt = cnt+1;
							}
						}

						if(cnt == 0){
							show_message("선택한 자료가 없습니다.");
							return false;
						}						
						
						showPromptBox("역발행 거부에 대한 사유를 입력하세요!","");
						
						if (model.getValue("/root/tempData/confirm") == "Y"){
							//alert(model.getValue("/root/tempData/result"));
							var sbdescription = model.getValue("/root/tempData/result");
						}else{
							return false;							
						}
						
						if(show_message("역발행요청을 거부 하시겠습니까?", "역발행요청거부 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
						
						model.send("co_smtb_1021_u");
						
						if(submit_completed()){
							var batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
							var smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
							var smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");
							var status = "T";
							var signal = "RIREJECT";
							var url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_STATUS_CHANGE.asp"
								  + "?BATCH_ID=" + batch_id
								  + "&STATUS=" + status
								  + "&SIGNAL=" + signal
								  + "&ID=" + smart_id
								  + "&PASS=" + smart_pw
								  + "&SBDESCRIPTION=" + sbdescription;
							//alert(url);
							makeNodeValue("/root/tempData/url",url);

							window.load("/common/xrw/ie_pop.xrw"
								,"modal"
								,"ie_pop"
								,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
								,"/root/tempData"
								,"/root/tempData");
							/*
							window.load(url				
								,"new"				
								,"ie_pop"				
								,"sysmenu:hidden;min:hidden; resize:false;max:hidden;caption:hidden;width:400px;height:300px;top:100px;left:100px;align:center;"				
								,"/root/tempData"
								,"/root/tempData");								
							*/
							/*
							window.load(
							url, 
							"mdichild",
							"", 
							"left:30px; top:200px; width:100px; height:100; align:center; caption:hidden;"
							,""
							,""
							);
							*/							
							//show_message("전송되었습니다.");
							
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="button2" class="btn05" crud="U" style="left:602px; top:0px; width:110px; height:21px; ">
				<caption>E-MAIL일괄재발송</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
						var cnt = 0;
						var email = "";
						var conversation_id = "";
						var status = "";
						
						var batch_id = "";
						var smart_id = "";
						var smart_pw = "";						
						var url = "";
						
						if(show_message("일괄재발송은 기존 EMAIL과 동일한 주소로만 전송이 가능합니다. E-Mail을 일괄 재발송 하시겠습니까?", "재발송 확인", MB_YESNO) != IDYES) {
							return false;
						}
						
						for (var i=1; i<datagrid1.rows; i++){
							if(datagrid1.rowStatus(i) == "1"){
								
								if(datagrid1.valueMatrix(datagrid1.row, 13) != "I" && datagrid1.valueMatrix(datagrid1.row, 13) != "C" && datagrid1.valueMatrix(datagrid1.row, 13) != "V" & datagrid1.valueMatrix(datagrid1.row, 13) != "N"){
									show_message("상태가 미승인(I),수신승인(C),역발행요청(V),공급자발행취소요청(N)인 경우에만 재발송이 가능합니다."+datagrid1.valueMatrix(datagrid1.row, 13));
									return false;
								}
								status = datagrid1.valueMatrix(i, 13);
								email = datagrid1.valueMatrix(i, 10);
								conversation_id = datagrid1.valueMatrix(i, 15);
								
								set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
								
								model.send("co_smtb_1021_u");
								
								if(submit_completed()){
									batch_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/batch_id");
									smart_id = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_id");
									smart_pw = model1.getValue("/root/resData/resForm/co_smtb_1021_u/dataSet/smart_pw");

									url = CIISComm_SMTB_URL + "/callSB_V3/XXSB_DTI_SEND_EMAIL.asp"
										  + "?CONVERSATION_ID=" + conversation_id
										  + "&EMAIL=" + email
										  + "&ID=" + smart_id
										  + "&PASS=" + smart_pw
										  + "&STATUS=" + status
		//							alert(url);
									makeNodeValue("/root/tempData/url",url);

									window.load("/common/xrw/ie_pop.xrw"
										,"modal"
										,"ie_pop"
										,"resize:false;width:420px;height:330px;top:20px;left:100px;align:center;min:hidden;max:hidden;"
										,"/root/tempData"
										,"/root/tempData");
								}								
										
										
								cnt = cnt+1;
							}
						}
						
						//btn_select.dispatch("onclick");						
					]]>
				</script>
			</button>
		</group>
		<group id="group2" class="gro_line" style="left:10px; top:195px; width:926px; height:5px; "/>
	</xhtml:body>
</xhtml:html>
