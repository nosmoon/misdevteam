<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="../../../css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>Untitle</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<hd_cost_1506_m>
							<dataset>
								<xx_card_type_010/>
								<xx_card_type_020/>
								<xx_proc_stat_010/>
								<xx_proc_stat_020/>
								<xx_proc_stat_030/>
								<xx_proc_stat_040/>
								<xx_proc_stat_050/>
								<xx_card_type_030/>
								<xx_card_type_040/>
								<xx_card_nm_010/>
								<xx_card_nm_020/>
								<xx_card_nm_030/>
								<xx_card_nm_040/>
							</dataset>
						</hd_cost_1506_m>
						<!-- 화면 로딩시의 초기 데이터를 담당 -->
						<session/>
						<!-- 서버의 세션 정보를 담당한다 -->
						<comboSet>
							<!-- 선택계열의 정보를 담당 -->
							<hd_card_type>
								<item/>
							</hd_card_type>
							<hd_proc_stat>
								<item/>
							</hd_proc_stat>
							<hd_use_type>
								<item/>
							</hd_use_type>
							<hd_medi_cd>
								<item/>
							</hd_medi_cd>
							<hd_dtls_medi_cd>
								<item>
									<value/>
									<label/>
									<pcode/>
								</item>
							</hd_dtls_medi_cd>
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo>
							<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
						</pageInfo>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
					</initData>
					<reqData>
						<!-- 전달하고자 하는 데이터를 담당 ( submit 함수에서 처리) -->
						<searchData>
							<card_type/>
							<decid_yymm/>
							<dept_cd/>
							<dept_nm/>
							<emp_no/>
							<actu_slip_no/>
							<tmp_crdt_amt/>
							<titl/>
							<slip_seq/>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<incmg_pers/>
							<incmg_pers_ipadd/>
							<titl2/>
							<proc_clsf/>
						</searchData>
						<!-- 검색조건 처리 -->
						<reqForm>
							<send_ch/>
						</reqForm>
						<!-- formData 팝업,화면전환시 data이동시 -->
						<multiUpDate1/>
						<!-- MultiUpDate유형 사용시 처리 -->
						<fwdData>
							<func_nm/>
						</fwdData>
						<multiUpDate2/>
						<multiUpDate3/>
					</reqData>
					<resData>
						<!-- 전달 받은 데이터를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 formData를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 데이터를 가공할 임시저장소 ( submit의 결과가 담김) -->
						<msg/>
						<!-- 전달 받은 errorCode를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 errorMsg를 담당 ( submit의 결과가 담김) -->
						<gridData1>
							<!-- 전달 받은 grid데이터를 담당 ( submit의 결과가 담김) -->
							<record>
								<!-- datagrid1 -->
								<cmpy_cd/>
								<emp_no/>
								<nm_korn/>
								<dept_cd/>
								<dept_nm/>
								<dty_cd/>
								<dty_nm/>
								<posi_cd/>
								<posi_nm/>
								<deal_amt/>
								<remk_1/>
								<decid_yymm/>
								<slip_proc_seq/>
								<actu_slip_no/>
								<proc_stat_nm/>
								<proc_stat/>
								<slip_proc_mang_dt/>
								<slip_proc_mang_seq/>
								<save/>
							</record>
							<!-- datagrid2 -->
							<!-- datagrid3 -->
						</gridData1>
						<gridData2>
							<record>
								<cmpy_cd/>
								<deal_dt/>
								<use_plac/>
								<deal_amt/>
								<remk_2/>
								<card_no/>
								<occr_dt/>
								<seq/>
								<emp_no/>
								<use_type/>
								<medi_cd/>
								<dtls_medi_cd/>
							</record>
						</gridData2>
						<slipData>
							<record>
								<cmpy_cd/>
								<emp_no/>
								<dept_cd/>
								<flnm/>
								<tmp_dr_amt/>
								<tmp_crdt_amt/>
								<titl/>
								<slip_seq/>
								<slip_occr_dt/>
								<slip_clsf_cd/>
								<incmg_pres/>
								<incmg_pers_ipadd/>
								<proc_stat/>
								<card_mang_no/>
								<dept_nm/>
								<titl2/>
								<slip_proc_mang_dt/>
								<slip_proc_mang_seq/>
								<use_type/>
								<medi_cd/>
								<dtls_medi_cd/>
							</record>
						</slipData>
						<totcnt/>
						<totcnt2/>
					</resData>
					<tempData/>
					<oz_data/>
				</root>
			</instance>
			<script type="javascript">
				<![CDATA[
						function setDept_cd(iv_dept_cd, iv_dept_nm){
							model1.setValue("/root/reqData/searchData/dept_cd", iv_dept_cd);
							model1.setValue("/root/reqData/searchData/dept_nm", iv_dept_nm);
							model1.refresh();
						}
						
						function slip_submit_sum(){
							var row = datagrid1.row;	
							var sum_amt = 0;
							
							for(var i=1 ;i< datagrid3.rows;i++){
								if(datagrid3.rowStatus(i) == 1){
									var amt = model1.getValue("/root/resData/slipData/record["+i+"]/tmp_dr_amt");
									sum_amt = Number(sum_amt) + Number(amt);
								}
							}
							
							if (datagrid3.rows > 1){
								model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",sum_amt);
								model1.setValue("/root/reqData/searchData/tmp_crdt_amt",sum_amt);
								datagrid3.refresh();
							}
						} 
						//적요
						function slip_remark(){
							var emp_cnt = 0;
							var flnm = "";
							var dept_nm = "";
							var fstSel = "1";
							var cnt_flnm = "";
							var cnt_flnm1 = "";
							var card_nm = "";
							
			     				for(var k=1;k<datagrid3.rows;k++){
								if(datagrid3.rowStatus(k) == 1 || datagrid3.rowStatus(k) == 3){		     							
		     							if(fstSel == "1"){
		     								var remark_flnm = model1.getValue("/root/resData/slipData/record["+k+"]/flnm");
		     								var remark_dept_nm = model1.getValue("/root/resData/slipData/record["+k+"]/dept_nm");
		     								fstSel = "2";
		     							}
		     							
		     							cnt_flnm = model1.getValue("/root/resData/slipData/record["+k+"]/flnm");
		     							if(cnt_flnm != cnt_flnm1){
		     								emp_cnt++;
		     								cnt_flnm1 = model1.getValue("/root/resData/slipData/record["+k+"]/flnm");
		     							}
		     						}
		     					}
		     					
		     					var card_type = model1.getValue("/root/reqData/searchData/card_type");
		     					//if(card_type == "10"){ 120210
								
								/*
		     					if(card_type == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_010")){
		     						card_nm = "주유 ";
		     					//}else if(card_type == "20"){  120210
		     					}else if(card_type == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_020")){
		     						card_nm = "관리자 ";
		     					}else{
		     						card_nm = "취재 ";
		     					}
								*/ 
								// 2013.09.12   tv조선의 사용으로 인해서 환경변수를 이용하여 값을 설정하도록 변경 
								if(card_type == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_010")){
		     						card_nm = model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_nm_010") ;
		     					//}else if(card_type == "20"){  120210
		     					}else if(card_type == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_020")){
		     						card_nm = model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_nm_020") ;
								}else if(card_type == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_030")){
		     						card_nm = model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_nm_030") ;
		     					}else{
		     						card_nm = model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_nm_040") ;
		     					}
								
			     				//alert(card_nm);
		     					if (datagrid3.rows > 1){
								if(emp_cnt == 1){
									model1.setValue("/root/resData/slipData/record/titl", remark_dept_nm + " " + remark_flnm + " " + card_nm + " 법인카드");
									model1.setValue("/root/reqData/searchData/titl", remark_dept_nm + " " + remark_flnm + " " + card_nm + " 법인카드");							
								}else if(emp_cnt > 1) {
									emp_cnt = emp_cnt - 1;
									model1.setValue("/root/resData/slipData/record/titl", remark_dept_nm + " " + remark_flnm + " 외 "+ emp_cnt +"명 " + card_nm + "법인카드");		
									model1.setValue("/root/reqData/searchData/titl", remark_dept_nm + " " + remark_flnm + " 외 "+ emp_cnt +"명 " + card_nm + "법인카드");						
								}
								datagrid3.refresh();
		     					}
						}  
						
							var searchFlag = false;
							var cancleFlag = "N"; //전표취소 검증개선_20160419
					     //총금액 총인원 구하기
					     function setTotal_amt_pep(){
						     	var row1 = datagrid3.rows;
						     	var total_amt = 0;
						     	var cnt = datagrid1.rows - 1;
						     	if(row1 == 1 || row1 == -1){
						     		return;
						     	}
							if(row1 > 1 && datagrid3.valueMatrix(1, 1) != ""){					     	
								var decid_yymm  = '';
								var decid_yymm_tmp = input1.value;	
								var decid_yymm = decid_yymm_tmp.substring(4,6);
								var s_flnm = model1.getValue("/root/resData/slipData/record[1]/flnm");
								var s_emp_no = model1.getValue("/root/resData/slipData/record[1]/emp_no");
								var dept_nm = model1.getValue("/root/resData/slipData/record[1]/dept_nm");
								var titl2 = model1.getValue("/root/resData/slipData/record[1]/titl2");
								
								
							     	for(var i=1;i < row1;i++){
							     		var alon_amt = model1.getValue("/root/resData/slipData/record["+i+"]/tmp_dr_amt");
							     		total_amt =  Number(total_amt) + Number(alon_amt);
							     		//cnt++;
							     	}
							     	//cnt = cnt - 1;
							     	if(cnt == 1){
						     			model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",total_amt);
						     			model1.setValue("/root/resData/slipData/record[1]/dept_nm",dept_nm);
										model1.setValue("/root/resData/slipData/record[1]/titl",dept_nm+" "+s_flnm+" "+decid_yymm+"월 법인카드");								
										model1.setValue("/root/resData/slipData/record[1]/titl2",titl2);							
						     			model1.setValue("/root/reqData/searchData/tmp_crdt_amt",total_amt);
										model1.setValue("/root/reqData/searchData/titl",dept_nm+" "+s_flnm+" "+decid_yymm+"월 법인카드");								
										model1.setValue("/root/reqData/searchData/titl2",titl2);
							     	}else{
//										if ( s_emp_no == "170039" ){//사장님일경우
//											var s_emp_no = model1.getValue("/root/resData/slipData/record[2]/emp_no");
//											var s_flnm = model1.getValue("/root/resData/slipData/record[2]/flnm");
//										}
						     			model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",total_amt);
										model1.setValue("/root/resData/slipData/record[1]/titl",dept_nm+" "+s_flnm+" 외 "+cnt+"명 "+decid_yymm+"월 법인카드");								
										model1.setValue("/root/resData/slipData/record[1]/titl2",titl2);
						     			model1.setValue("/root/reqData/searchData/tmp_crdt_amt",total_amt);
										model1.setValue("/root/reqData/searchData/titl",dept_nm+" "+s_flnm+" 외 "+cnt+"명 "+decid_yymm+"월 법인카드");								
										model1.setValue("/root/reqData/searchData/titl2",titl2);
							     	}		
							}
							model1.refresh();
					     }			
					     //전표등록시 벨류
					     function setInsertSlipValue(){
					     	
					     	var row = datagrid3.rows;
					     	var total_amt = 0;
					     	var cnt = 0;
					     	
					     	if(row == 1){
					     		return;
					     	}
							else if(row > 1){					     	
								var tmp_crdt_amt = model1.getValue("/root/resData/slipData/record[1]/tmp_crdt_amt");
								var titl = model1.getValue("/root/resData/slipData/record[1]/titl");
								var titl2 = model1.getValue("/root/resData/slipData/record[1]/titl2");
					     		model1.setValue("/root/reqData/searchData/tmp_crdt_amt",tmp_crdt_amt);
					     		model1.setValue("/root/reqData/searchData/titl",titl);
					     		model1.setValue("/root/reqData/searchData/titl2",titl2);
					     		
							}
							model1.refresh();
					     }					     
					     
					     //전표 삭제시 벨류
					     function setDeleteSlipValue(){
					     	
					     	var row = datagrid3.rows;
					     	var total_amt = 0;
					     	var cnt = 0;
					     	
					     	if(row == 1){
					     		return;
					     	}
							else if(row > 1){					     	
								var slip_seq = model1.getValue("/root/resData/slipData/record[1]/slip_seq");
								var slip_occr_dt = model1.getValue("/root/resData/slipData/record[1]/slip_occr_dt");
								var slip_clsf_cd = model1.getValue("/root/resData/slipData/record[1]/slip_clsf_cd");
								var incmg_pers = model1.getValue("/root/resData/slipData/record[1]/incmg_pers");
								var incmg_pers_ipadd = model1.getValue("/root/resData/slipData/record[1]/incmg_pers_ipadd");
						     		model1.setValue("/root/reqData/searchData/slip_seq",slip_seq);
						     		model1.setValue("/root/reqData/searchData/slip_occr_dt",slip_occr_dt);
						     		model1.setValue("/root/reqData/searchData/slip_clsf_cd",slip_clsf_cd);
						     		model1.setValue("/root/reqData/searchData/incmg_pers",incmg_pers);
						     		model1.setValue("/root/reqData/searchData/incmg_pers_ipadd",incmg_pers_ipadd);
							}
							model1.refresh();
					     }			
					     
					     function gridSearchList(){
							/*
							if(model1.getValue("/root/reqData/searchData/card_type") == "" || model1.getValue("/root/reqData/searchData/decid_yymm") == "" || model1.getValue("/root/reqData/searchData/dept_cd") == ""){
								alert("카드종류, 결재년월, 부서는 필수 입력사항입니다.");
								return;
							}
							*/
							var card_type = model1.getValue("/root/reqData/searchData/card_type");
							var decid_yymm = model1.getValue("/root/reqData/searchData/decid_yymm");
							var dept_cd = model1.getValue("/root/reqData/searchData/dept_cd");
							var dept_nm = model1.getValue("/root/reqData/searchData/dept_nm");
							var proc_clsf = model1.getValue("/root/reqData/searchData/proc_clsf");
							var actu_slip_no = model1.getValue("/root/reqData/searchData/actu_slip_no");
							//model1.reset();
							datagrid1.clearStatus();
							datagrid3.clearStatus();
							datagrid1.fixedcellcheckbox(0, datagrid1.colRef("save"),false) = false;
							datagrid1.fixedcellcheckbox(0, datagrid1.colRef("save"),false) = true;
							
							for(var i=1 ;i< datagrid1.rows;i++){
								datagrid1.valueMatrix(i, datagrid1.colRef("save")) = 0;	
							}
							
							model1.setValue("/root/reqData/searchData/card_type", card_type);
							model1.setValue("/root/reqData/searchData/decid_yymm", decid_yymm);
							model1.setValue("/root/reqData/searchData/dept_cd", dept_cd);
							model1.setValue("/root/reqData/searchData/dept_nm", dept_nm);
							model1.setValue("/root/reqData/searchData/proc_clsf", proc_clsf);
							model1.setValue("/root/reqData/searchData/actu_slip_no", actu_slip_no);
							model1.send("hd_cost_1400");
							model1.copyNode("/root/resData/gridData1", "/root/dataSet/CURLIST");
							//model1.removenode("/root/dataSet");
							datagrid1.autoResize = true;
							if(model1.getValue("/root/resData/gridData1/record[1]/emp_no") == ""){
								datagrid1.isReadOnly(1, 1, 1, 1) = true;
								send_ch.disabled = true;
							}else{
								datagrid1.isReadOnly(1, 1, 1, 1) = false;
								send_ch.disabled = false;
							}
							if(submit_completed()) {
								model1.copyNode("/root/resData/slipData", "/root/dataSet/CURLIST1");				
								model1.removenode("/root/dataSet");							
								model1.refresh();				
								setTotal_amt_pep();
								setDeleteSlipValue();
								searchFlag = true;					 
								for(var i=1 ;i< datagrid1.rows;i++){
									var proc_stat = model1.getValue("/root/resData/gridData1/record["+i+"]/proc_stat");							
									//if(proc_stat == '29' || proc_stat == '36'){
									
									//if(proc_stat >= '29'){ 120210
									if(proc_stat >= model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010")){
										datagrid1.isReadOnly(i, 1, i, 11) = true;
									}else{
										datagrid1.isReadOnly(i, 1, i, 11) = false;
									}					
									
									datagrid1.valueMatrix(i, datagrid1.colRef("save")) = 0;	
								}						    	
								datagrid1.clearStatus();
								model1.refresh();						
							}
							var totcnt = datagrid1.rows;
							model1.setValue("/root/resData/totcnt", "총 " + Number(totcnt - 1) + " 건");
							model1.refresh();					     	
					     }    				 					
				]]>
			</script>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					datagrid2.colHidden(datagrid2.colRef("medi_cd")) = true;
					datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = true; 
	
					model.send("hd_cost_1506_m");
					model.refresh();
					
					/*
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_010"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_card_type_020"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_020"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_030"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_040"));
					alert(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_050"));
					*/
					
					// 2017.07.04 추가 tv조선일 아닐경우 매체 및 상세매체 항목을 안보이도록 함.
					var obj = htmldocument.SessionInfo;
					if(obj.cmpycd.value != "500") 
					{
						datagrid2.colHidden(datagrid2.colRef("medi_cd")) = true;
						datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = true;
						datagrid2.refresh();
					}
					
					datagrid1.fixedcellcheckbox(0, datagrid1.colRef("save"), false) = true;
					model1.send("hd_cost_1300");
					model1.copyNode("/root/initData/comboSet/hd_card_type", "/root/dataSet/hd_card_type");
					model1.copyNode("/root/initData/comboSet/hd_proc_stat", "/root/dataSet/hd_proc_stat");		
				    model1.copyNode("/root/initData/comboSet/hd_use_type", "/root/dataSet/hd_use_type");
				    model1.copyNode("/root/initData/comboSet/hd_medi_cd", "/root/dataSet/hd_medi_cd");
			    	model1.copyNode("/root/initData/comboSet/hd_dtls_medi_cd", "/root/dataSet/hd_dtls_medi_cd");
					model1.removenode("/root/dataSet");
					send_ch.disabled = true;
					datagrid1.isReadOnly(1, 1, 1, 1) = true;
					model1.refresh();
				]]>
			</script>
			<submission id="hd_cost_1300" action="/hd/cost/1300" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/tempData"/>
			<submission id="hd_cost_1400" action="/hd/cost/1400" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_cost_1401" action="/hd/cost/1401" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_cost_1402" action="/hd/cost/1402" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/multiUpDate" resultref="/root/tempData"/>
			<submission id="hd_cost_1500" action="/hd/cost/1500" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_cost_1501" action="/hd/cost/1501" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_cost_1502" action="/hd/cost/1502" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_cost_1503" action="/hd/cost/1503" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_com_1103" action="/hd/com/1103" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData/dept_cd" resultref="/root/tempData"/>
			<submission id="hd_cost_1506_m" action="/hd/cost/1506" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/initData/hd_cost_1506_m/dataSet"/>
		</model>
		<script type="javascript" src="/js/CIISComm.js"/>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="728" guideline="2,70;2,66;2,68;2,679;1,936;1,927;1,926;2,497;1,260;1,183;" style="font-family:굴림; background-image:../../images/bg_946.gif; ">
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<group id="group_btnA" class="gro_btn" style="left:10px; top:45px; width:926px; height:21px; ">
			<button id="button4" class="btn02" style="left:874px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
				 	viewer("mainFrame").window.javaScript.closeMDIWindow(model.getValue("/root/initData/pageInfo/pageID"));
					]]>
				</script>
			</button>
			<button id="button8" class="btn02" style="left:391px; top:0px; width:52px; height:21px; ">
				<caption>초기화</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					model1.reset();
					datagrid1.clearStatus();
					datagrid2.clearStatus();
					send_ch.disabled = true;
					datagrid1.isReadOnly(1, 1, 1, 11) = true;
					]]>
				</script>
			</button>
			<button id="button9" class="btn02" style="left:446px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var card_type = model1.getValue("/root/reqData/searchData/card_type");

						if (!commReqCheck(group1))
							return;
						
						cancleFlag = "N"; //전표취소 검증개선_20160419
						
						gridSearchList();
						
						if(searchFlag == true && actu_slip_no_in.value != ""){
							cancleFlag = "Y"; //전표취소 검증개선_20160419
						}
						
						// 카드종류 제작진행비로 조회할때만 법인카드 상세에 메체코드,상세코드 컬럼 보이게 수정 20170720 한현재
						if(card_type == "60"){ 
							datagrid2.colHidden(datagrid2.colRef("medi_cd")) = false;
							datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = false; 
						}else{
							datagrid2.colHidden(datagrid2.colRef("medi_cd")) = true;
							datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = true; 
						}
					]]>
				</script>
			</button>
			<button id="button3" class="btn02" style="left:501px; top:0px; width:52px; height:21px; ">
				<caption>저장</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var selectedIdx1 = datagrid1.row;
						
						var tmp1 = model1.getValue("/root/resData/gridData1/record[" + (selectedIdx1) + "]/proc_stat");
				
					//	if (tmp1 >= 25){
					//		alert("인사결제 이후는  수정(저장)이 안됩니다!");
					//		return;
					//	}
					  
					  //if (tmp1 >= 29){ 120210
					   if (tmp1 >= Number(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010")) ){
							alert("현업전표등록 이후는  수정(저장)이 안됩니다!");
							return;
					    }
						var obj = htmldocument.SessionInfo;
						
						for(var i=1; i<datagrid2.rows;i++){
								var use_type = model1.getValue("/root/resData/gridData2/record[" + i + "]/use_type");
								//사용구분 체크
								if(use_type == "" ){
									alert("사용구분이 입력되지 않았습니다.");
									return;								
								}
								
								// 2017.07.03 추가 tv조선일 경우 카드종류가 제작진행비일 경우 매체 및 상세매체를 입력하도록 한다 
								var card_type = model1.getValue("/root/reqData/searchData/card_type");
								
								if(obj.cmpycd.value == "500" && card_type == "60")
								{
									var medi_cd = model1.getValue("/root/resData/gridData2/record[" + i + "]/medi_cd");
									//매체구분 체크
									if(medi_cd == "" ){
										alert("카드종류가 제작진행비일 경우 매체를 입력해 주세요.");
										return;								
									}
									var dtls_medi_cd = model1.getValue("/root/resData/gridData2/record[" + i + "]/dtls_medi_cd");
									//상세매체구분 체크
									if(dtls_medi_cd == "" ){
										alert("카드종류가 제작진행비일 경우 상세매체를 입력해 주세요.");
										return;								
									}
								}
						}
						
						
						if (window.alert("저장 하시겠습니까?", "확인", 1) != 1) {
							return;
						};
					
						model1.setValue("/root/reqData/multiUpDate1", datagrid1.getUpdateData());
						model1.setValue("/root/reqData/multiUpDate2", datagrid2.getUpdateData());
						model1.send("hd_cost_1500");
						if(submit_completed()) {
							//model1.reset();
							model1.resetInstanceNode("/root/resData/gridData1/record");
							model1.resetInstanceNode("/root/resData/gridData2/record");
							model1.resetInstanceNode("/root/resData/slipData/record");
							datagrid1.clearStatus();
							datagrid2.clearStatus();
							send_ch.disabled = true;
							datagrid1.isReadOnly(1, 1, 1, 1) = true;
							button9.dispatch("onclick");
						}
						model1.refresh();
					]]>
				</script>
			</button>
			<button id="button1" class="btn04" style="left:715px; top:0px; width:85px; height:21px; ">
				<caption>장표재발행</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var actu_slip_no = model1.getValue("/root/reqData/searchData/actu_slip_no");
						var obj = htmldocument.SessionInfo;
    	 					setProperty("ss_emp_no"   , obj.emp_no.value);
    	 					setProperty("ss_dept_nm"   , obj.deptnm.value);
    	 					setProperty("ss_emp_nm"   , obj.emp_nm.value);
	    	 				var emp_no = obj.emp_no.value;
	    	 				var dept_nm = obj.deptnm.value;
	    	 				var nm_korn = obj.emp_nm.value;
	    	 			
						
						if(actu_slip_no == "") {
							alert("전표번호는 필수 입력 항목입니다.");
							return;
						}
							
						// 오즈관련 노드 초기화..					
					 	resetOznode();					
					 						
					 	// ozr경로 및 odi 파일명으로 사용될 노드 및 value셋팅 ( OZR파일경로 .ozr 제거)					
					 	makeNodeValue("/root/oz_data/ozrName","hd/HD_COST_1505");
						makeNodeValue("/root/oz_data/preview","preview"); 	//preview : 미리보기, print : 인쇄
						//makeNodeValue("/root/oz_data/printsize"); 			//페이지용지설정(기본 A4)	
						makeNodeValue("/root/oz_data/printsize","B5 (JIS)");   //페이지용지설정(기본 A4)
												
					 	// odi 파라미터 설정.					
					 	makeNodeValue("/root/oz_data/odiParam/iv_cmpy_cd",getProperty("ss_cmpycd"));					
					 	makeNodeValue("/root/oz_data/odiParam/iv_actu_slip_no",actu_slip_no);		
					 	makeNodeValue("/root/oz_data/odiParam/iv_nm_korn",nm_korn);
						makeNodeValue("/root/oz_data/odiParam/iv_dept_nm",dept_nm);			
											
					 	// 레포트뷰어 호출.					
					 	openOzwin("/root/oz_data");	
					]]>
				</script>
			</button>
			<button id="button2" class="btn03" crud="C" style="left:645px; top:0px; width:65px; height:21px; ">
				<caption>전표취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						//전표취소 검증개선_체크로직1_20160419
						if(searchFlag == false || actu_slip_no_in.value == ""){
							alert("취소하고자 하는 전표번호를 검색창에 입력 후 다시 조회를 해주세요.\n\n그리고 나서 전표취소를 해주시기 바랍니다.");	
							return;
						}
						//전표취소 검증개선_체크로직2_20160419
						if(cancleFlag != "Y"){
							alert("취소하고자 하는 전표번호를 검색창 전표번호에 입력 후 조회를 눌러주세요.");
							return;
						}
						
						if (datagrid3.rows < 2) {
							alert("취소할 전표가 존재하지 않습니다.");
							return;
						}
						/*
						if(datagrid3.rows == -1){
							alert("취소할 전표가 없습니다.");
							return;
						}					
						if(datagrid3.rows == 1){
							alert("취소할 전표번호를 조회해 주세요.");	
							return;
						}	
						*/				
						for(var i=1; i<datagrid3.rows;i++){
							var proc_stat = model1.getValue("/root/resData/slipData/record["+i+"]/proc_stat");
							var actu_slip_no = model1.getValue("/root/resData/slipData/record["+i+"]/actu_slip_no");
							//전표 등록 체크
							
							//if(proc_stat == 29 || proc_stat == 36){ 120210
							if(proc_stat == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010") 
							|| proc_stat == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_020")){
							}else{
								alert("취소할 전표가 존재하지 않습니다.");
								return;								
							}
						}
						if (window.alert("전표를 취소하시겠습니까?", "확인", 1) != 1) {
							return;
						}							
						for(var i=0;i<datagrid1.rows;i++){ 
							datagrid1.addStatus(i, "update");							
						}
						model1.setValue("/root/reqData/multiUpDate1", datagrid1.getUpdateData());
						//model1.setValue("/root/reqData/multiUpDate3", datagrid3.getUpdateData());
						model1.send("hd_cost_1503");
						//datagrid3.clearStatus();
						datagrid1.clearStatus();
						if(submit_completed()) {
							//alert('전표취소 되었습니다.');
							actu_slip_no_in.value = "";
							gridSearchList();	
							cancleFlag = "N"; //전표취소 검증개선_20160419
						}						
					]]>
				</script>
			</button>
			<button id="button5" class="btn04" crud="C" style="left:555px; top:0px; width:86px; height:21px; ">
				<caption>전표생성</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var flag = true;
						
						if (datagrid3.rows < 2) {
							alert("전표를 생성할 데이터가 없습니다.");	
							return;
						}
						
						for(var i=1; i<datagrid1.rows;i++){
							var proc_stat = model1.getValue("/root/resData/gridData1/record["+i+"]/proc_stat");
							//전표 등록 체크
							//if(proc_stat == 10 || proc_stat == 28){ 120210
							if(proc_stat == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_030") 
							|| proc_stat == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_040")){
								flag = false;
							}
						}
						if(flag){
							alert("전표를 생성할 데이터가 없습니다.");
							return;								
						}
						
						var obj = htmldocument.SessionInfo;

						var rows = datagrid3.rows;
						
						for(var i=2; i<rows; i++){
							
							if(datagrid3.rowStatus(i) == "1"){
								
							       var use_type = model1.getValue("/root/resData/slipData/record[" + i + "]/use_type"); //datagrid3.valueMatrix(i, datagrid3.colRef("use_type"));
							 //   var use_type = model1.getValue("/root/resData/slipData/record["+ i +"]/use_type");
								if(use_type == "")
								{
									alert("사용구분을 모두 입력하여 주십시오.");
									 return;								
								}
								
									// 2017.07.03 추가 tv조선일 경우 카드종류가 제작진행비일 경우 매체 및 상세매체를 입력하도록 한다 
								var card_type = model1.getValue("/root/reqData/searchData/card_type");
								
								if(obj.cmpycd.value == "500" && card_type == "60")
								{
									var medi_cd = model1.getValue("/root/resData/slipData/record[" + i + "]/medi_cd");
									//매체구분 체크
									if(medi_cd == "" ){
										alert("카드종류가 제작진행비일 경우 매체를 입력해 주세요.");
										return;								
									}
									var dtls_medi_cd = model1.getValue("/root/resData/slipData/record[" + i + "]/dtls_medi_cd");
									//상세매체구분 체크
									if(dtls_medi_cd == "" ){
										alert("카드종류가 제작진행비일 경우 상세매체를 입력해 주세요.");
										return;								
									}
								}
							}
						}
						
						
						if (window.alert("전표를 생성하시겠습니까?", "확인", 1) != 1) {
							return;
						}
						
					
						
						/*
						setInsertSlipValue();
						
	 					for(var i=0;i<datagrid3.rows;i++){
							datagrid3.addStatus(i, "insert");							
						}
						
						for(var i=0;i<datagrid1.rows;i++){ 
							var proc_stat = model1.getValue("/root/resData/gridData1/record["+i+"]/proc_stat");						
							if(proc_stat == 10  || proc_stat == 28){
								datagrid1.addStatus(i, "insert");							
							}
						}
						*/
						
						model1.setValue("/root/reqData/multiUpDate2", datagrid2.getUpdateData());
						model1.setValue("/root/reqData/multiUpDate1", datagrid1.getUpdateData());
						model1.setValue("/root/reqData/multiUpDate3", datagrid3.getUpdateData());
						datagrid3.clearStatus();
						datagrid2.clearStatus();
						datagrid1.clearStatus();
						model1.send("hd_cost_1502");
						//전표번호
						var actu_slip_no = model1.getValue("/root/dataSet/CURLIST/record/actu_slip_no");
						model1.removenode("/root/slipNoData/slip_no");
						model1.makeValue("/root/slipNoData/slip_no",actu_slip_no);
						model1.removenode("/root/dataSet");
						
						if(submit_completed()) {			
							gridSearchList();								
							
							var obj = htmldocument.SessionInfo;
		    	 				var emp_no = obj.emp_no.value;
		    	 				var dept_nm = obj.deptnm.value;
		    	 				var nm_korn = obj.emp_nm.value;
		    	 					
							// 오즈관련 노드 초기화..					
						 	resetOznode();					
						 						
						 	// ozr경로 및 odi 파일명으로 사용될 노드 및 value셋팅 ( OZR파일경로 .ozr 제거)					
						 	makeNodeValue("/root/oz_data/ozrName","hd/HD_COST_1505");
							makeNodeValue("/root/oz_data/preview","preview"); 	//preview : 미리보기, print : 인쇄
							//makeNodeValue("/root/oz_data/printsize"); 			//페이지용지설정(기본 A4)	
							makeNodeValue("/root/oz_data/printsize","B5 (JIS)");   //페이지용지설정(기본 A4)
													
						 	// odi 파라미터 설정.					
						 	makeNodeValue("/root/oz_data/odiParam/iv_cmpy_cd",getProperty("ss_cmpycd"));					
						 	makeNodeValue("/root/oz_data/odiParam/iv_actu_slip_no",actu_slip_no);					
						 	makeNodeValue("/root/oz_data/odiParam/iv_nm_korn",nm_korn);
						 	makeNodeValue("/root/oz_data/odiParam/iv_dept_nm",dept_nm);
												
						 	// 레포트뷰어 호출.					
						 	openOzwin("/root/oz_data");	
						}					
					]]>
				</script>
			</button>
			<button id="button6" class="btn03" crud="C" style="left:805px; top:0px; width:65px; height:21px; ">
				<caption>재발행</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[resetOznode();					
					 			
								
					var flag = true;
						
						for(var i=1; i<= datagrid2.rows;i++){
							var proc_stat = model1.getValue("/root/resData/gridData1/record["+i+"]/proc_stat");
							//전표 등록 체크
							//if(proc_stat > 13){  120210
							if(proc_stat >  Number(model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_050")) ){
								flag = false;	
							}
							//전표 등록 취소 체크
							//if(proc_stat == 28 ){ 120210
							if(proc_stat == model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_040") ){
								flag =true;	
							}
						}
						
						if(flag == false){
						 	alert("현업결제이상 이기 때문에 더 이상 진행 할 수 없습니다");
							return;	
						}
						
					 	// ozr경로 및 odi 파일명으로 사용될 노드 및 value셋팅 ( OZR파일경로 .ozr 제거)					
					 	makeNodeValue("/root/oz_data/ozrName","hd/SP_HD_COST_1501_P")
						makeNodeValue("/root/oz_data/preview","preview"); 	//preview : 미리보기, print : 인쇄
						//makeNodeValue("/root/oz_data/printsize"); 			//페이지용지설정(기본 A4)	
						makeNodeValue("/root/oz_data/printsize","B5 (JIS)");   //페이지용지설정(기본 A4)
												
					 	// odi 파라미터 설정.					
					 	makeNodeValue("/root/oz_data/odiParam/iv_cmpy_cd" , getProperty("ss_cmpycd") );
					 	makeNodeValue("/root/oz_data/odiParam/iv_emp_no" , getProperty("ss_emp_no") );
					 	makeNodeValue("/root/oz_data/odiParam/iv_ss_deptcd" , getProperty("ss_deptcd") );
					 	makeNodeValue("/root/oz_data/odiParam/iv_card_type" , model1.getValue("/root/reqData/searchData/card_type") );
					 	makeNodeValue("/root/oz_data/odiParam/iv_decid_yymm" , model1.getValue("/root/reqData/searchData/decid_yymm") );
					 	makeNodeValue("/root/oz_data/odiParam/iv_dept_cd" , model1.getValue("/root/reqData/searchData/dept_cd") );
					 						
						// 프린터로 직접출력할 경우에만 사용.. ( preview:미리보기,print:직접출력, export:파일 )					
						//makeNodeValue("/root/oz_data/preview","print"); 					
											
					 	// 레포트뷰어 호출.					
					 	openOzwin("/root/oz_data");]]>
				</script>
			</button>
		</group>
		<group id="group1" style="left:10px; top:70px; width:926px; height:55px; ">
			<caption id="caption2" class="list_cap01" style="left:0px; top:0px; width:90px; height:26px; text-align:center; ">카드종류</caption>
			<caption id="caption10" class="list_cap02" style="left:89px; top:0px; width:837px; height:26px; text-align:center; "/>
			<caption id="caption5" class="list_cap01" style="left:195px; top:0px; width:90px; height:26px; text-align:center; ">결재년월</caption>
			<caption id="caption3" class="list_cap01" style="left:391px; top:0px; width:90px; height:26px; text-align:center; ">부서</caption>
			<select1 id="combo1" ref="/root/reqData/searchData/card_type" class="req" appearance="minimal" caption="카드종류" style="left:93px; top:4px; width:100px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/hd_card_type/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
			</select1>
			<input id="input1" ref="/root/reqData/searchData/decid_yymm" class="req" inputtype="date" format="yyyy-mm" caption="결재년월" style="left:288px; top:4px; width:100px; height:18px; "/>
			<caption id="caption1" class="list_cap02" style="left:89px; top:25px; width:837px; height:26px; text-align:center; "/>
			<caption id="caption4" class="list_cap01" style="left:0px; top:25px; width:90px; height:26px; text-align:center; ">결재상태</caption>
			<select1 id="combo99" ref="/root/reqData/searchData/proc_clsf" appearance="minimal" style="left:93px; top:29px; width:100px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/hd_proc_stat/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
			</select1>
			<input id="input2" ref="/root/reqData/searchData/dept_cd" inputtype="button" maxlength="6" caption="부서" style="left:484px; top:4px; width:100px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");
						model.setValue("/root/reqData/fwdData/func_nm", "setDept_cd");
						window.load("/xrw/hd/com/HD_COM_1100.xrw","mdichild", "hd_com_1100", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
				</script>
				<script type="javascript" ev:event="onmaxlength">
					<![CDATA[
						model1.setValue("/root/reqData/searchData/dept_cd", input2.currentText);
						model1.send("hd_com_1103");
						if(model1.getValue("/root/dataSet/CURLIST/record/cnt") != "1"){
							alert("없는 부서이거나 사용중이 아닌 부서 입니다.");
							model1.setValue("/root/reqData/searchData/dept_cd", "");
							model1.setValue("/root/reqData/searchData/dept_nm", "");
							model1.removenode("/root/dataSet");
							model1.refresh();
							return;
						}
						model1.setValue("/root/reqData/searchData/dept_cd", model1.getValue("/root/dataSet/CURLIST/record/dept_cd"));
						model1.setValue("/root/reqData/searchData/dept_nm", model1.getValue("/root/dataSet/CURLIST/record/abrv_nm"));
						model1.removenode("/root/dataSet");
						model1.refresh();		
					]]>
				</script>
			</input>
			<output id="output1" ref="/root/reqData/searchData/dept_nm" style="left:586px; top:4px; width:125px; height:18px; "/>
			<caption id="caption8" class="list_cap01" style="left:391px; top:25px; width:90px; height:26px; text-align:center; ">전표번호</caption>
			<input id="actu_slip_no_in" ref="/root/reqData/searchData/actu_slip_no" format="99999999-99-999" style="left:483px; top:29px; width:102px; height:18px; "/>
		</group>
		<group id="group2" style="left:10px; top:130px; width:926px; height:350px; ">
			<caption id="caption9" class="tit02" style="left:0px; top:0px; width:205px; height:20px; font-weight:bold; ">법인카드 사용대상자</caption>
			<datagrid id="datagrid1" nodeset="/root/resData/gridData1/record" caption="선택^부서^사번^성명^직책^직급^거래금액^관리번호^전표번호^진행상태^비고" colsep="#" colwidth="50, 130, 80, 90, 90, 90, 90, 100, 100, 100, 300, 100, 100, 100, 100, 100, 100, 100, 100" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="free" style="left:0px; top:20px; width:926px; height:310px; ">
				<col checkvalue="1,0" ref="save" type="checkbox">
					<script type="javascript" ev:event="xforms-select">
						<![CDATA[
						var row = datagrid1.row;
						var slip_proc_seq = model1.getValue("/root/resData/gridData1/record["+row+"]/slip_proc_seq");
						var card_type = model1.getValue("/root/reqData/searchData/card_type");
						var tmp_slip_proc_seq = "";
						for (i = 1; i < datagrid1.rows; i++) {
							tmp_slip_proc_seq = model1.getValue("/root/resData/gridData1/record["+i+"]/slip_proc_seq");
							if (slip_proc_seq == tmp_slip_proc_seq) {
								datagrid1.valueMatrix(i, 1) = "1";
								if(datagrid1.rowstatus(i) == 1 || datagrid1.rowstatus(i) == 3){
									datagrid1.rowstatus(i) = 1;
								}else{
									datagrid1.rowstatus(i) = 2;
								}
							}
						}
						var tmp_proc_mang_dt = "";
						var tmp_proc_mang_seq = "";
						for (j = 1; j < datagrid3.rows; j++) {
							tmp_proc_mang_dt = model1.getValue("/root/resData/slipData/record["+j+"]/slip_proc_mang_dt");
							tmp_proc_mang_seq = model1.getValue("/root/resData/slipData/record["+j+"]/slip_proc_mang_seq");
							if (slip_proc_seq == tmp_proc_mang_dt + tmp_proc_mang_seq) {
								if(datagrid3.rowstatus(j) == 0){
									datagrid3.rowstatus(j) = 1;
								}
							}
						}
						
						if (datagrid1.rows > 1){
							slip_submit_sum();	
							slip_remark();						
						}
						if(card_type == "60"){ 
							datagrid2.colHidden(datagrid2.colRef("medi_cd")) = false;
							datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = false; 
						}else{
							datagrid2.colHidden(datagrid2.colRef("medi_cd")) = true;
							datagrid2.colHidden(datagrid2.colRef("dtls_medi_cd")) = true; 
						}
					]]>
					</script>
					<script type="javascript" ev:event="xforms-deselect">
						<![CDATA[
						var row = datagrid1.row;
						var slip_proc_seq = model1.getValue("/root/resData/gridData1/record["+row+"]/slip_proc_seq");
						
						var tmp_slip_proc_seq = "";
						for (i = 1; i < datagrid1.rows; i++) {
							tmp_slip_proc_seq = model1.getValue("/root/resData/gridData1/record["+i+"]/slip_proc_seq");
							if (slip_proc_seq == tmp_slip_proc_seq) {
								datagrid1.valueMatrix(i, 1) = "0";
								if(datagrid1.rowstatus(i) == 1 || datagrid1.rowstatus(i) == 3){
									datagrid1.rowstatus(i) = 1;
								}else{
									datagrid1.rowstatus(i) = 0;
								}
							}
						}
						var tmp_proc_mang_dt = "";
						var tmp_proc_mang_seq = "";
						for (j = 1; j < datagrid3.rows; j++) {
							tmp_proc_mang_dt = model1.getValue("/root/resData/slipData/record["+j+"]/slip_proc_mang_dt");
							tmp_proc_mang_seq = model1.getValue("/root/resData/slipData/record["+j+"]/slip_proc_mang_seq");
							
							if (slip_proc_seq == tmp_proc_mang_dt + tmp_proc_mang_seq) {
								if(datagrid3.rowstatus(j) == 1){
									datagrid3.rowstatus(j) = 0;
								}
							}
						}
						
						if (datagrid1.rows > 1){
							slip_submit_sum();	
							slip_remark();						
						}
					]]>
					</script>
					<script type="javascript" ev:event="xforms-value-changed">
						<![CDATA[
						var row = datagrid1.row;
						if (datagrid1.valueMatrix(row, 1) == "0" && datagrid1.rowStatus(row) == 2)
							datagrid1.rowStatus(row) = 0;
					]]>
					</script>
				</col>
				<col class="req" ref="dept_nm" style="text-align:left; "/>
				<col class="req" ref="emp_no"/>
				<col class="req" ref="nm_korn"/>
				<col class="req" ref="dty_nm"/>
				<col class="req" ref="posi_nm"/>
				<col class="req" ref="deal_amt" format="#,###" style="text-align:right; "/>
				<col class="req" ref="slip_proc_seq" format="99999999-99999"/>
				<col class="req" ref="actu_slip_no" format="99999999-99-999"/>
				<col class="req" ref="proc_stat_nm"/>
				<col class="req" ref="remk_1" type="input" style="text-align:left; "/>
				<col class="req" ref="decid_yymm" visibility="hidden"/>
				<col class="req" ref="cmpy_cd" visibility="hidden"/>
				<col class="req" ref="dept_cd" visibility="hidden"/>
				<col class="req" ref="dty_cd" visibility="hidden"/>
				<col class="req" ref="posi_cd" visibility="hidden"/>
				<col class="req" ref="proc_stat" visibility="hidden"/>
				<col class="req" ref="slip_proc_mang_dt" visibility="hidden"/>
				<col class="req" ref="slip_proc_mang_seq" visibility="hidden"/>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var row = datagrid1.row;	
					//alert(row)		
					var proc_stat = model1.getValue("/root/resData/gridData1/record["+row+"]/proc_stat");	
					//if(proc_stat == '29' || proc_stat == '36'){
					
					//if (proc_stat >= '29'){ 120210
					if (proc_stat >= model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010")){
						return;
					}						
					if(model1.getValue("/root/resData/gridData1/record[1]/emp_no") == ""){
						alert("조회할 데이터가 없습니다.");
						return;
					}else if(model1.getValue("/root/resData/gridData1/record[1]/emp_no") != ""){
						var nodeList = root.selectNodes("/root/resData/gridData1/record");
						var rowIdx = nodeList.length;
						if(datagrid1.row == 0) return;		
						
						var selectedIdx1 = datagrid1.row;
						var col = datagrid1.col;
						if(col != 1){
							var emp_no = model1.getValue("/root/resData/gridData1/record[" + (selectedIdx1) + "]/emp_no");
							model1.setValue("/root/reqData/searchData/emp_no", emp_no);
							model1.send("hd_cost_1401");
							
							model1.copyNode("/root/initData/comboSet/hd_use_type", "/root/dataSet/hd_use_type");
							model1.copyNode("/root/resData/gridData2", "/root/dataSet/CURLIST");
							model1.removenode("/root/dataSet");
						
							model1.refresh();
							var totcnt2 = datagrid2.rows;
							model1.setValue("/root/resData/totcnt2", "총 " + Number(totcnt2 - 1) + " 건");
							model1.refresh();	
						}else if(col == 1){
							/*
							var row = datagrid1.row;
							datagrid1.rowStatus(row) = 2;
							var send = model1.getValue("/root/resData/gridData1/record[" + (row) + "]/save");
							//if(send == "false"){
							//	datagrid1.rowStatus(row) = 0;
							//}
							
							var totalcnt2 = model1.getValue("/root/resData/gridData1/totalcnt");
							var seq = model1.getValue("/root/resData/gridData1/record[" + (row) + "]/seq");
							var occr_dt = model1.getValue("/root/resData/gridData1/record[" + (row) + "]/occr_dt");
							if(send == "1"){
								model1.setValue("/root/resData/gridData1/record[" + (row) + "]/save", "1");
								datagrid1.rowStatus(row) = "2";
							}
							/*for(var i = 1; i < totalcnt2 + 1; i++){
								var seq_tm = model1.getValue("/root/resData/gridData1/record[" + (i) + "]/seq");
								var occr_dt_tm = model1.getValue("/root/resData/gridData1/record[" + (i) + "]/occr_dt");
								if(seq == seq_tm && occr_dt == occr_dt_tm){
									model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "1");
									datagrid1.rowStatus(i) = "2";
								}
							}*/
							//if(send == "false"){
							/*
							if(send == "0"){
								model1.setValue("/root/resData/gridData1/record[" + (row) + "]/save", "0");
								datagrid1.rowStatus(row) = 0;
								/*for(var i = 1; i < totalcnt2 + 1; i++){
									var seq_tm = model1.getValue("/root/resData/gridData1/record[" + (i) + "]/seq");
									var occr_dt_tm = model1.getValue("/root/resData/gridData1/record[" + (i) + "]/occr_dt");
									if(seq == seq_tm && occr_dt == occr_dt_tm){
										//model1.setValue("/root/resData/gridData/record[" + (i) + "]/send", "false");
										model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "0");
										datagrid1.rowStatus(i) = 0;
									}
								}*/
							//}
						}
					}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-select">
					<![CDATA[
					if(event.target == "datagrid1") {
						for(var i=1 ;i<datagrid1.rows;i++){
							if (datagrid1.rowStatus(i) == 0 && datagrid1.valueMatrix(i, datagrid1.colRef("actu_slip_no")) == "") 
								datagrid1.rowStatus(i) = 2;
						}		
						for (j = 1; j < datagrid3.rows; j++) {
							datagrid3.rowstatus(j) = 1;
						}
						
						if (datagrid1.rows > 1){
							slip_submit_sum();	
							slip_remark();						
						}
					}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-deselect">
					<![CDATA[
					if (event.target == "datagrid1") {
						for(var i = 1; i < datagrid1.rows; i++){
							if (datagrid1.rowStatus(i) == 2) 
								datagrid1.rowStatus(i) = 0;
						}	
						for (j = 1; j < datagrid3.rows; j++) {
							datagrid3.rowstatus(j) = 0;
						}
						
						if (datagrid1.rows > 1){
							slip_submit_sum();	
							slip_remark();						
						}
					}
					]]>
				</script>
			</datagrid>
			<select id="send_ch" ref="/root/reqData/reqForm/send_ch" visibility="hidden" overflow="visible" appearance="full" style="left:1px; top:23px; width:15px; height:15px; border-style:none; ">
				<choices>
					<item>
						<label/>
						<value>send_ch</value>
					</item>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						var temp_ch = model1.getValue("/root/reqData/reqForm/send_ch");
						var rows = datagrid1.rows;
						if(temp_ch == "send_ch"){
							/*
							for(var i=1 ;i<datagrid1.rows;i++){
								if (datagrid1.rowStatus(i) == 0 && datagrid1.valueMatrix(i, datagrid1.colRef("actu_slip_no")) == "") {
									datagrid1.rowStatus(i) = 2;
									model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "1");
								} else {
									datagrid1.rowStatus(i) = 0;
									model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "0");
								}
							}		
							*/
							for(var i = 1; i < rows; i++){
								//if(model1.getValue("/root/resData/gridData1/record[" + (i) + "]/proc_stat") != "29"){ 120210
								if(model1.getValue("/root/resData/gridData1/record[" + (i) + "]/proc_stat") 
								!= model.getValue("/root/initData/hd_cost_1506_m/dataSet/xx_proc_stat_010")){
									datagrid1.rowStatus(i) = 2;
									model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "1");
								}
							}
							
						}else{
							for(var i = 1; i < rows; i++){
								datagrid1.rowStatus(i) = 0;
								model1.setValue("/root/resData/gridData1/record[" + (i) + "]/save", "0");
							}
						}
					]]>
				</script>
			</select>
		</group>
		<group id="group3" style="left:10px; top:485px; width:926px; height:230px; ">
			<caption id="caption6" class="tit02" style="left:0px; top:0px; width:205px; height:20px; font-weight:bold; ">법인카드 사용대상자 상세</caption>
			<datagrid id="datagrid2" nodeset="/root/resData/gridData2/record" caption="거래일자^사용처^거래금액^사용구분^매체코드^상세매체^비고" colsep="#" colwidth="80, 200, 100, 100, 100, 100, 376, 100, 100, 100, 100, 100" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:0px; top:27px; width:926px; height:183px; ">
				<col class="req" ref="deal_dt" format="yyyy-mm-dd"/>
				<col class="req" ref="use_plac" style="text-align:left; "/>
				<col class="req" ref="deal_amt" format="(-)#,###"/>
				<col class="req" ref="use_type" type="combo" style="text-align:left; ">
					<choices>
						<itemset nodeset="/root/initData/comboSet/hd_use_type/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="medi_cd" type="combo" style="text-align:left; ">
					<choices>
						<itemset nodeset="/root/initData/comboSet/hd_medi_cd/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="dtls_medi_cd" type="combo" style="text-align:left; ">
					<choices>
						<itemset nodeset="/root/initData/comboSet/hd_dtls_medi_cd/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col class="req" ref="remk_2" type="input" style="text-align:left; "/>
				<col class="req" ref="cmpy_cd" visibility="hidden"/>
				<col class="req" ref="card_no" visibility="hidden"/>
				<col class="req" ref="occr_dt" visibility="hidden"/>
				<col class="req" ref="seq" visibility="hidden"/>
				<col class="req" ref="emp_no" visibility="hidden"/>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					]]>
				</script>
				<script type="javascript" ev:event="xforms-select">
					<![CDATA[
						var row = datagrid2.row;
						var col = datagrid2.col;
											
						var medi_cd = Number(datagrid2.valueMatrix(row,datagrid2.colRef("medi_cd")));
						
						if(col == datagrid2.colRef("medi_cd") ){
							if(medi_cd != ""){
				
							    datagrid2.cellComboNodeset(row, col+1) = "/root/initData/comboSet/hd_dtls_medi_cd/item[pcode='"+medi_cd+"']";
							}
						//	datagrid2.refresh();
						}
					]]>
				</script>
			</datagrid>
			<caption id="caption7" ref="/root/resData/totcnt2" style="left:839px; top:210px; width:87px; height:20px; font-weight:bold; text-align:right; "/>
		</group>
		<datagrid id="datagrid3" nodeset="/root/resData/slipData/record" visibility="hidden" caption="회사코드^사번^부서^이름^차변금액(개인)^대변금액(총합계)^적요1^전표관리번호^전표일련번호^전표발생일자^전표구분코드^입력자^입력자IP^진행상태^카드관리번호^사용부서이름^적요2^SLIP_PROC_MANG_DT^SLIP_PROC_MANG_SEQ^사용구분^매체코드^상세매체" colsep="#" colwidth="63, 79, 100, 100, 100, 114, 191, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 150, 170, 100, 100, 100" extendlastcol="scroll" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:0px; top:230px; width:840px; height:248px; ">
			<col ref="cmpy_cd"/>
			<col ref="emp_no"/>
			<col ref="dept_cd"/>
			<col ref="flnm"/>
			<col ref="tmp_dr_amt"/>
			<col ref="tmp_crdt_amt"/>
			<col ref="titl"/>
			<col ref="actu_slip_no"/>
			<col ref="slip_seq"/>
			<col ref="slip_occr_dt"/>
			<col ref="slip_clsf_cd"/>
			<col ref="incmg_pers"/>
			<col ref="incmg_pers_ipadd"/>
			<col ref="proc_stat"/>
			<col ref="card_mang_no"/>
			<col ref="dept_nm"/>
			<col ref="titl2"/>
			<col ref="slip_proc_mang_dt"/>
			<col ref="slip_proc_mang_seq"/>
			<col ref="use_type"/>
			<col ref="medi_cd"/>
			<col ref="dtls_medi_cd"/>
		</datagrid>
		<caption id="caption14" ref="/root/resData/totcnt" style="left:849px; top:460px; width:87px; height:20px; font-weight:bold; text-align:right; "/>
	</xhtml:body>
</xhtml:html>
