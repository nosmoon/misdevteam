<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet ype="text/css" href="../../../css/style_sheet.css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:my="http://www.comsquare.co.kr/example" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>Untitle</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<hd_affr_1418_m>
							<dataSet>
								<xx_proc_stat_010/>
								<xx_proc_stat_020/>
								<xx_proc_stat_030/>
								<xx_proc_stat_040/>
								<xx_proc_stat_050/>
								<xx_proc_stat_060/>
							</dataSet>
						</hd_affr_1418_m>
						<session/>
						<pageInfo/>
						<comboSet>
						</comboSet>
					</initData>
					<tempData/>
					<reqData>
						<searchData>
							<fr_occr_dt/>
							<to_occr_dt/>
							<pay_plac_clsf>20</pay_plac_clsf>
							<emp_no/>
							<flnm/>
							<faml_flnm/>
							<treat_edu_todt/>
							<actu_slip_no_in/>
							<actu_slip_no/>
							<tmp_crdt_amt/>
							<titl/>
							<slip_seq/>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<incmg_pers/>
							<incmg_pers_ipadd/>
						</searchData>
						<multiUpData/>
						<fwdData>
							<func_nm/>
							<call_clsf/>
						</fwdData>
						<reqForm>
						</reqForm>
						<multiUpData1/>
					</reqData>
					<resData>
						<gridData>
							<record>
								<chkbox/>
								<emp_no/>
								<flnm/>
								<dept_nm/>
								<dty_nm/>
								<posi_nm/>
								<child_flnm/>
								<faml_rshp_nm/>
								<treat_edu_frdt/>
								<treat_edu_todt/>
								<treat_edu_cont/>
								<treat_edu_instt/>
								<treat_edu_instt_tel_no/>
								<clam_amt/>
								<cmpy_sply_amt/>
								<proc_stat/>
								<slip_proc_mang_dt/>
								<slip_proc_mang_seq/>
								<faml_rshp_cd/>
								<dept_cd/>
								<dty_cd/>
								<posi_cd/>
								<pay_plac_clsf/>
								<faml_seq/>
								<occr_dt/>
								<seq/>
								<rv_pay_plac_clsf/>
								<proc_stat_nm/>
								<slip_proc_seq/>
								<actu_slip_no/>
								<sum_amt/>
								<max_amt/>
							</record>
						</gridData>
						<slipData>
							<record>
								<cmpy_cd/>
								<emp_no/>
								<dept_cd/>
								<flnm/>
								<tmp_dr_amt/>
								<tmp_crdt_amt/>
								<titl/>
								<slip_seq/>
								<slip_occr_dt/>
								<slip_clsf_cd/>
								<incmg_pres/>
								<incmg_pers_ipadd/>
								<proc_stat/>
								<slip_proc_mang_dt/>
								<slip_proc_mang_seq/>
								<cmpy_welf_fund_clsf/>
								<occr_dt/>
								<seq/>
							</record>
						</slipData>
						<resForm>
							<record/>
						</resForm>
					</resData>
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					model.send("hd_affr_1418_m");
					model.refresh();
					/* 
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010"));
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_020"));
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_030"));
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_040"));
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_050"));
					alert(model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_060"));
					*/
					datagrid2.addStatus(1, "insert");
					datagrid2.isReadOnly(1, 1, 1, 1) = true;
					datagrid2.fixedcellcheckbox(0, datagrid2.colRef("chkbox"), false) = true;
					var to_day = monthdate(-1);
					var mon_date = monthdate(1);
					to_day = to_day.replaceAll("-","");
					mon_date = mon_date.replaceAll("-","");
					model1.setValue("/root/reqData/searchData/fr_occr_dt",to_day);
					model1.setValue("/root/reqData/searchData/to_occr_dt",mon_date);
					model1.refresh();
				]]>
			</script>
			<script type="javascript">
				<![CDATA[
					String.prototype.trim = function()
					 {
					   return this.replace(/(^\s*)|(\s*$)/gi, "");
					 }
					 String.prototype.replaceAll = function(str1, str2)
					 {
					   var temp_str = "";
					   if (this.trim() != "" && str1 != str2)
					   {
					     temp_str = this.trim();
					     while (temp_str.indexOf(str1) > -1)
					     {
					       temp_str = temp_str.replace(str1, str2);
					     }
					   }
					   return temp_str;
					  }
 
					
						//오늘 날짜
						function todaydate(val){
							var e_date = new Date();
							var year = e_date.getFullYear(); 
							var month = e_date.getMonth() + 1;
							var day = e_date.getDate();
							if (("" + month).length==1){month = "0"+month;}
							if (("" + day).length==1){day = "0"+day;}
							if(val == '-'){
								e_date = year+""+month+""+day;
							}
							else{
								e_date = year+"-"+month+"-"+day;
							}
							return e_date;
						}			
						//한달후 날짜	
						function monthdate(val){
						 m = 1+parseInt(val);
						 var f_date = "";
						 var cDate=new Date();
						 var year=cDate.getYear();
						 var month=(cDate.getMonth()+ (parseInt(m))).toString();
						
						 month = month.length==1?"0"+month:month;
						 if (month=="00"){
						  month="12";
						  year--;
						 }
						 if (month=="13"){
						  month="01";
						  year++;
						 } 
						 var day=cDate.getDate().toString();
						 day = day.length==1?"0"+day:day;
						 f_date = year+month+day;
						 return f_date;  
						}	
	
					     	
						function setEmp_no(emp_no, flnm){
							var rowIdx =datagrid2.row;					
							//model1.setValue("/root/reqData/searchData/flnm",flnm );
							model1.setValue("/root/reqData/searchData/emp_no",emp_no );
							model1.send("hd_affr_1411");				
							model1.copyNode("/root/resData/resForm/record","/root/tempData/record");
							model1.removenode("/root/tempData");
							var totalcnt = model1.getValue("/root/resData/resForm/record/totalcnt");
							var emp_no = model1.getValue("/root/resData/resForm/record/emp_no");
							var flnm = model1.getValue("/root/resData/resForm/record/flnm");
							var dept_cd = model1.getValue("/root/resData/resForm/record/dept_cd");
							var dept_nm = model1.getValue("/root/resData/resForm/record/dept_nm");
							var dty_cd = model1.getValue("/root/resData/resForm/record/dty_cd");
							var dty_nm = model1.getValue("/root/resData/resForm/record/dty_nm");
							var posi_cd = model1.getValue("/root/resData/resForm/record/posi_cd");
							var posi_nm = model1.getValue("/root/resData/resForm/record/posi_nm");
							var pay_plac_clsf = model1.getValue("/root/resData/resForm/record/emp_clsf");
							var sum_amt = model1.getValue("/root/resData/resForm/record/sum_amt");
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/emp_no", emp_no);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/flnm", flnm);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_cd", dept_cd);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_nm", dept_nm);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_cd", dty_cd);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_nm", dty_nm);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_cd", posi_cd);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_nm", posi_nm);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/pay_plac_clsf", pay_plac_clsf);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/sum_amt", sum_amt);
							model1.refresh();							
						}
					
					function searchEmpno(){
						var rowIdx =datagrid2.row;			
						var emp = datagrid2.valueMatrix(rowIdx,3);
						if(emp  == ""){
							alert("사번을 넣어주세요");
							model1.setValue("/root/reqData/searchData/emp_no","" );
							return;
							
							}
						model1.setValue("/root/reqData/searchData/emp_no",emp );
						model1.setValue("/root/reqData/searchData/flnm","" );
						model1.send("hd_affr_1411");		
						model1.copyNode("/root/resData/resForm/record","/root/tempData/record");
						var totalcnt = model1.getValue("/root/tempData/totalcnt");
						model1.removenode("/root/tempData");
						if(totalcnt == ""){
							alert("검색결과가 없습니다");
							model1.setValue("/root/reqData/searchData/emp_no","" );
							model1.setValue("/root/reqData/searchData/flnm","" );
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/emp_no", emp_no);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/flnm", flnm);
							model1.refresh();
							return;
						}
						var emp_no = model1.getValue("/root/resData/resForm/record/emp_no");
						var flnm = model1.getValue("/root/resData/resForm/record/flnm");
						var dept_cd = model1.getValue("/root/resData/resForm/record/dept_cd");
						var dept_nm = model1.getValue("/root/resData/resForm/record/dept_nm");
						var dty_cd = model1.getValue("/root/resData/resForm/record/dty_cd");
						var dty_nm = model1.getValue("/root/resData/resForm/record/dty_nm");
						var posi_cd = model1.getValue("/root/resData/resForm/record/posi_cd");
						var posi_nm = model1.getValue("/root/resData/resForm/record/posi_nm");
						var pay_plac_clsf = model1.getValue("/root/resData/resForm/record/emp_clsf");
						var sum_amt = model1.getValue("/root/resData/resForm/record/sum_amt");
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/emp_no", emp_no);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/flnm", flnm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_cd", dept_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_nm", dept_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_cd", dty_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_nm", dty_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_cd", posi_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_nm", posi_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/pay_plac_clsf", pay_plac_clsf);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/sum_amt", sum_amt);
						model1.refresh();						
					}		
										
					function searchFlnm(){
						var rowIdx =datagrid2.row;					
						var flnm = datagrid2.valueMatrix(rowIdx,4);
						var tmp_flnm = flnm.trim();
						if(tmp_flnm == "") flnm = "xxx";
						model1.setValue("/root/reqData/searchData/flnm",flnm );
						model1.setValue("/root/reqData/searchData/emp_no","" );
						model1.send("hd_affr_1411");				
						model1.copyNode("/root/resData/resForm/record","/root/tempData/record");
						var totalcnt = model1.getValue("/root/tempData/totalcnt");
						model1.removenode("/root/tempData");
						if(totalcnt == ""){
							alert("검색결과가 없습니다");
							model1.setValue("/root/reqData/searchData/emp_no","" );
							model1.setValue("/root/reqData/searchData/flnm","" );
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/emp_no", emp_no);
							model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/flnm", flnm);
							model1.refresh();
							return;
						}					
						if(totalcnt > 1){
							model.removeNodeset("/root/reqData/fwdData");  
							model.makeNode("/root/reqData/fwdData/func_nm");
							model.setValue("/root/reqData/fwdData/func_nm", "setEmp_no");
							model.makeNode("/root/reqData/fwdData/nm_korn");
							model.setValue("/root/reqData/fwdData/nm_korn", flnm);
							window.load("/xrw/hd/com/HD_COM_1200.xrw","mdichild", "hd_com_1200", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
							return;
						}
						var emp_no = model1.getValue("/root/resData/resForm/record/emp_no");
						var flnm = model1.getValue("/root/resData/resForm/record/flnm");
						var dept_cd = model1.getValue("/root/resData/resForm/record/dept_cd");
						var dept_nm = model1.getValue("/root/resData/resForm/record/dept_nm");
						var dty_cd = model1.getValue("/root/resData/resForm/record/dty_cd");
						var dty_nm = model1.getValue("/root/resData/resForm/record/dty_nm");
						var posi_cd = model1.getValue("/root/resData/resForm/record/posi_cd");
						var posi_nm = model1.getValue("/root/resData/resForm/record/posi_nm");
						var pay_plac_clsf = model1.getValue("/root/resData/resForm/record/emp_clsf");
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/emp_no", emp_no);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/flnm", flnm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_cd", dept_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dept_nm", dept_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_cd", dty_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/dty_nm", dty_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_cd", posi_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/posi_nm", posi_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/pay_plac_clsf", pay_plac_clsf);
						model1.refresh();						
					}		
					function searchChildflnm(){
						var rowIdx =datagrid2.row;					
						var emp_no = datagrid2.valueMatrix(rowIdx,3);
						var faml_flnm = datagrid2.valueMatrix(rowIdx,7);
						model1.setValue("/root/reqData/searchData/faml_flnm",faml_flnm );
						model1.setValue("/root/reqData/searchData/emp_no",emp_no );
						model1.send("hd_affr_1412");
						var faml_seq = model1.getValue("/root/tempData/record/faml_seq");	
						var faml_rshp_cd = model1.getValue("/root/tempData/record/faml_rshp_cd");
						var faml_rshp_nm = model1.getValue("/root/tempData/record/faml_rshp_nm");
						var faml_flnm = model1.getValue("/root/tempData/record/faml_flnm");
						model1.removenode("/root/tempData");

						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/child_flnm",faml_flnm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/faml_rshp_nm",faml_rshp_nm);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/faml_rshp_cd",faml_rshp_cd);
						model1.setValue("/root/resData/gridData/record[" + (rowIdx) + "]/faml_seq",faml_seq);						
					}
				
					function chkamt(){
						var treat_edu_todt = datagrid2.valueMatrix(datagrid2.row,10);
						/*
						var treat_edu_todt =datagrid2.valueMatrix(datagrid2.row,10);
						if(treat_edu_todt.length != 8 || treat_edu_todt == ""){
							alert("종료날짜를 넣어주세요");
							model1.setValue("/root/resData/gridData/record["+datagrid2.row+"]/cmpy_sply_amt","");	
							return;						
						}
						*/
						//var amt = datagrid2.valueMatrix(datagrid2.row,15);
						model1.setValue("/root/reqData/searchData/treat_edu_todt",treat_edu_todt);
						model1.send("hd_affr_1414");
						var max_amt = model1.getValue("/root/tempData/record/obcl_child_sply_amt");
						model1.setValue("/root/resData/gridData/record["+datagrid2.row+"]/max_amt",max_amt);	
						var maxamt = model1.getValue("/root/tempData/record/obcl_child_sply_amt");
						model1.removenode("/root/tempData");
						if(maxamt == ""){
							model1.setValue("/root/resData/gridData/record["+datagrid2.row+"]/treat_edu_todt","");	
							alert("기준표등록이 되지 않았습니다");return;		
						}
					}	
					
					function sumamtchk(){
						var max_amt = model1.getValue("/root/resData/gridData/record["+datagrid2.row+"]/max_amt");
						var sum_amt = model1.getValue("/root/resData/gridData/record["+datagrid2.row+"]/sum_amt");
						var cmpy_sply_amt = model1.getValue("/root/resData/gridData/record["+datagrid2.row+"]/cmpy_sply_amt");
						if(max_amt < ( Number(sum_amt) + Number(cmpy_sply_amt) )){
							var confirm = window.alert("기준금액을 초과 하였습니다.등록하시겠습니까?", "확인", 1) ;
							if(confirm == 1){
								return;	
							}else{
								model1.setValue("/root/resData/gridData/record["+datagrid2.row+"]/cmpy_sply_amt","");	
							}
						}						
					}
					
						var searchFlag = false;
					     //총금액 총인원 구하기
					     function setTotal_amt_pep(){
					     	var emp_no_tmp = "xxxxxx";	
					     	var row1 = datagrid1.rows;
					     	var total_amt = 0;
					     	var cnt = 0;
					     	if(row1 == 1 || row1 == -1){
					     		return;
					     	}
							if(row1 > 1 && datagrid1.valueMatrix(1, 1) != ""){					     	

								var s_flnm = model1.getValue("/root/resData/slipData/record[1]/flnm");
						     	for(var i=1;i < row1;i++){
						     		var alon_amt = model1.getValue("/root/resData/slipData/record["+i+"]/tmp_dr_amt");
						     		var emp_no = model1.getValue("/root/resData/slipData/record["+i+"]/emp_no");
						     		total_amt =  Number(total_amt) + Number(alon_amt);
						     		if(emp_no_tmp != emp_no){
						     			cnt++;
						     			emp_no_tmp = emp_no;
						     		}
						     	}
						     	cnt = cnt - 1;
						     	if(cnt == 0){
						     		model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",total_amt);
									model1.setValue("/root/resData/slipData/record[1]/titl",s_flnm+" 장애자녀지원금");								
						     		model1.setValue("/root/reqData/searchData/tmp_crdt_amt",total_amt);
									model1.setValue("/root/reqData/searchData/titl",s_flnm+" 장애자녀지원금");								
						     	}else{
						     		model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",total_amt);
									model1.setValue("/root/resData/slipData/record[1]/titl",s_flnm+" 외 "+cnt+"명 장애자녀지원금");								
						     		model1.setValue("/root/reqData/searchData/tmp_crdt_amt",total_amt);
									model1.setValue("/root/reqData/searchData/titl",s_flnm+" 외 "+cnt+"명 장애자녀지원금");								
						     	}						     	

							}
							model1.refresh();
					     }			
					     //전표등록시 벨류
					     function setInsertSlipValue(){
					     	
					     	var row = datagrid1.rows;
					     	var total_amt = 0;
					     	var cnt = 0;
					     	
					     	if(row == 1){
					     		return;
					     	}
							else if(row > 1){					     	
								var tmp_crdt_amt = model1.getValue("/root/resData/slipData/record[1]/tmp_crdt_amt");
								var titl = model1.getValue("/root/resData/slipData/record[1]/titl");
					     		model1.setValue("/root/reqData/searchData/tmp_crdt_amt",tmp_crdt_amt);
					     		model1.setValue("/root/reqData/searchData/titl",titl);
							}
							model1.refresh();
					     }					     
					     
					     
					     //전표 삭제시 벨류
					     function setDeleteSlipValue(){
					     	
					     	var row = datagrid1.rows;
					     	var total_amt = 0;
					     	var cnt = 0;
					     	
					     	if(row == 1){
					     		return;
					     	}
							else if(row > 1){					     	
								var slip_seq = model1.getValue("/root/resData/slipData/record[1]/slip_seq");
								var slip_occr_dt = model1.getValue("/root/resData/slipData/record[1]/slip_occr_dt");
								var slip_clsf_cd = model1.getValue("/root/resData/slipData/record[1]/slip_clsf_cd");
								var incmg_pers = model1.getValue("/root/resData/slipData/record[1]/incmg_pers");
								var incmg_pers_ipadd = model1.getValue("/root/resData/slipData/record[1]/incmg_pers_ipadd");
					     		model1.setValue("/root/reqData/searchData/slip_seq",slip_seq);
					     		model1.setValue("/root/reqData/searchData/slip_occr_dt",slip_occr_dt);
					     		model1.setValue("/root/reqData/searchData/slip_clsf_cd",slip_clsf_cd);
					     		model1.setValue("/root/reqData/searchData/incmg_pers",incmg_pers);
					     		model1.setValue("/root/reqData/searchData/incmg_pers_ipadd",incmg_pers_ipadd);
							}
							model1.refresh();
					     }					
					     
					     function gridSearchList(){
							model1.send("hd_affr_1410");
							var totalcnt = model1.getValue("/root/tempData/CURLIST/totalcnt");
							if(totalcnt == 0 && datagrid2.isReadOnly(1,1) == 1 && datagrid2.valueMatrix(1,2) == "" ){return;}
							if(totalcnt >= 1 ){
								datagrid2.isReadOnly(1, 1, 1, 17) = false;
							}					
							model1.copyNode("/root/resData/gridData", "/root/tempData/CURLIST");
							model1.copyNode("/root/resData/slipData", "/root/tempData/CURLIST1");		
							model1.removenode("/root/tempData");		
							datagrid2.isReadOnly(1, 1, 1, 17)  = false;		
							model1.refresh();				
							//setTotal_amt_pep();
							setDeleteSlipValue();
							searchFlag = true;								
							model1.refresh();
							for(var i=1 ;i< datagrid2.rows;i++){
								//tmp_emp[i] = "";
								datagrid2.valueMatrix(i,datagrid2.colRef("chkbox")) = false;
								var proc_stat = model1.getValue("/root/resData/gridData/record["+i+"]/proc_stat");							
								//if(proc_stat == "29" || proc_stat == "33" || proc_stat == "36"){ 120216
								if(proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010")
								|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_020")
								|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_030") ){
									datagrid2.isReadOnly(i, 1, i, 17) = true;
								}else if(proc_stat == ""){
									datagrid2.isReadOnly(i, 1, i, 17) = true;
								}else{
									datagrid2.isReadOnly(i, 1, i, 17) = false;
								}		
								datagrid2.fixedcellischeck(i, datagrid2.colRef("chkbox")) = false;		
							}						
							datagrid2.fixedcellischeck(0, datagrid2.colRef("chkbox")) = false;
							gridrowcnt.value = "총 "+ (parseInt(datagrid2.rows)- 1) + "건";
							datagrid2.clearStatus();												
							model1.refresh();	
							
					     }		
					var tmp_emp =  new Array();
					var emp_cnt = 0;
					//개별선택
				     function setTitl(val){
				     	var flnm = "";
				     	var cnt = 0;
				     	var tmp_cnt = 0;
				     	var flag = true;
				     	var emp_no = model1.getValue("/root/resData/gridData/record["+datagrid2.row+"]/emp_no");
				     	//등록자 이름
			     	     for(var i=1;i<datagrid1.rows;i++){
							if(datagrid1.rowStatus(i) == 1){
								if(flnm == ""){
									flnm = model1.getValue("/root/resData/slipData/record["+i+"]/flnm");
								}
							}
				     	}
				     	//등록자 카운터 (중복제거)
				     	if(val == 1){
				     		for(var i=1;i<tmp_emp.length;i++){
				     			if(tmp_emp[i] == emp_no ){
				     				tmp_cnt++;
				     			}
				     		}
				     		if(tmp_cnt == 0){
				     			emp_cnt++;
				     		}
				     		tmp_emp[datagrid2.row] = emp_no;
				     	}else{
				     		//alert(tmp_emp+"-"+emp_no+"--"+datagrid2.row)
				     		for(var i=1;i<tmp_emp.length;i++){
				     			if(tmp_emp[i] == emp_no ){
				     				tmp_cnt++;
				     			}
				     		}
				     		if(tmp_cnt == 1){
				     			emp_cnt--;
				     		}
				     		tmp_emp[datagrid2.row] = "";
				     	} 
						if(emp_cnt == 1){
							model1.setValue("/root/resData/slipData/record/titl",flnm+" 장애자녀지원비");
						}else if(emp_cnt > 1) {
							cnt = emp_cnt - 1;
							model1.setValue("/root/resData/slipData/record/titl",flnm+" 외 "+cnt+"명 장애자녀지원비");								
						}
						datagrid1.refresh();
				     }		
    				     //전체선택
				     function setTitl_all(val){
				     	var flnm = "";
				     	var cnt = 0;
				     	var flag = true;
				     	var row = datagrid1.rows;
						if(row > 1 && datagrid1.valueMatrix(1, 1) != ""){					     					     	
				     	     for(var i=1;i<datagrid1.rows;i++){
					     		var emp_no = model1.getValue("/root/resData/slipData/record["+i+"]/emp_no");
				     			tmp_emp[i] = emp_no;						     		
								if(datagrid1.rowStatus(i) == 1){
									if(flnm == ""){
										flnm = model1.getValue("/root/resData/slipData/record["+i+"]/flnm");
									}
								}
					     	}
						}
						if(val == 1){
							// 배열내에 중복된 요소 제거함수
							for(var i=0; i<tmp_emp.length; i++) {
   						         var checkDobl = 0;
							    for(var j=0; j<tmp_emp.length; j++) {
							        if(tmp_emp[i] != tmp_emp[j]) {
							            continue;
							        }else {      
							            checkDobl++;
							            if(checkDobl>1){
							               spliced = tmp_emp.splice(j,1);
							               emp_cnt++;
							            }
							        }
						         }
							}
							cnt = tmp_emp.length-1;
							emp_cnt = cnt;
				     	     for(var i=1;i<datagrid2.rows;i++){
					     		var emp_no = model1.getValue("/root/resData/gridData/record["+i+"]/emp_no");
				     			tmp_emp[i] = emp_no;						     		
					     	}
							if(cnt == 1){
								model1.setValue("/root/resData/slipData/record/titl",flnm+" 장애자녀지원비");
								model1.setValue("/root/reqData/searchData/titl",flnm+" 장애자녀지원비");
							}else{
								cnt = cnt - 1
								model1.setValue("/root/resData/slipData/record/titl",flnm+" 외 "+cnt+"명 장애자녀지원비");								
								model1.setValue("/root/reqData/searchData/titl",flnm+" 외 "+cnt+"명 장애자녀지원비");
							}
						}else {
				     	     for(var i=1;i<datagrid1.rows;i++){
				     			spliced = tmp_emp.splice(i,1);
				     			emp_cnt = 0;
					     	}							
							model1.setValue("/root/resData/slipData/record/titl","");								
							model1.setValue("/root/reqData/searchData/titl","");
						}
						datagrid1.refresh();
				     }	
				     //대변금액합계	
					function slip_submit_sum(){
						var row = datagrid1.row;	
						var sum_amt = 0;
						for(var i=1 ;i< datagrid1.rows;i++){
							if(datagrid1.rowStatus(i) == 1){
								var amt = model1.getValue("/root/resData/slipData/record["+i+"]/tmp_dr_amt");
								sum_amt = Number(sum_amt) + Number(amt);
							}
						}
						model1.setValue("/root/resData/slipData/record[1]/tmp_crdt_amt",sum_amt);
						model1.setValue("/root/reqData/searchData/tmp_crdt_amt",sum_amt);
						datagrid1.refresh();
					}   															     
				]]>
			</script>
			<submission id="hd_affr_1410" action="/hd/affr/1410/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_affr_1411" action="/hd/affr/1411/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_affr_1412" action="/hd/affr/1412/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_affr_1413" action="/hd/affr/1413/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/multiUpData" resultref="/root/tempData"/>
			<submission id="hd_affr_1414" action="/hd/affr/1414/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_affr_1415" action="/hd/affr/1415/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="hd_affr_1416" action="/hd/affr/1416/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_affr_1417" action="/hd/affr/1417/" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/tempData"/>
			<submission id="hd_affr_1418_m" action="/hd/affr/1418" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/initData/hd_affr_1418_m/dataSet"/>
		</model>
		<script type="javascript" src="/js/CIISComm.js"/>
	</xhtml:head>
	<xhtml:body pagewidth="946" pageheight="728">
		<caption id="caption19" class="list_cap02" style="left:74px; top:40px; width:841px; height:26px; "/>
		<caption id="caption1" class="list_cap01" style="left:10px; top:40px; width:76px; height:26px; ">청구기간</caption>
		<input id="input2" ref="/root/reqData/searchData/fr_occr_dt" inputtype="date" style="left:90px; top:44px; width:85px; height:18px; ">
			<script type="javascript" ev:event="DOMFocusOut">
				<![CDATA[ 
					
				]]>
			</script>
		</input>
		<input id="input3" ref="/root/reqData/searchData/to_occr_dt" inputtype="date" style="left:196px; top:44px; width:85px; height:18px; ">
			<script type="javascript" ev:event="DOMFocusOut">
				<![CDATA[
					
				]]>
			</script>
		</input>
		<caption id="caption6" class="list_cap01" style="left:304px; top:40px; width:86px; height:26px; ">발행대상구분</caption>
		<caption id="caption7" class="list_cap01" style="left:499px; top:40px; width:86px; height:26px; ">전표번호</caption>
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:0px; top:5px; width:0px; height:0px; "/>
		<caption id="caption14" style="left:180px; top:47px; width:15px; height:15px; ">~</caption>
		<group id="group1" class="gro_btn" style="left:10px; top:75px; width:905px; height:17px; ">
			<button id="button2" class="btn_grid03" style="left:852px; top:0px; width:53px; height:17px; ">
				<caption>행추가</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						//datagrid2.addRow(true, true);
						
						if(datagrid2.isReadOnly(1,1) == 1  && datagrid2.valueMatrix(1,2) == "") {
							datagrid2.isReadOnly(1, 1, 1, 18) = false;							
							datagrid2.addStatus(1, "insert");							
						}else{
							datagrid2.addRow(true, true);
						}
						var row = datagrid2.rows -1;
						datagrid2.isReadOnly(row, 1, row, 1) = true;
					]]>
				</script>
			</button>
		</group>
		<caption id="caption43" class="tit02" style="left:10px; top:74px; width:230px; height:20px; font-weight:bold; ">장애자녀 지원비 지급 대상 등록</caption>
		<select1 id="radio2" ref="/root/reqData/searchData/pay_plac_clsf" appearance="full" cols="2" overflow="visible" style="left:395px; top:44px; width:92px; height:20px; border-style:none; ">
			<choices>
				<item>
					<label>사원</label>
					<value>20</value>
				</item>
				<item>
					<label>임원</label>
					<value>10</value>
				</item>
			</choices>
			<script type="javascript" ev:event="xforms-value-changed">
				<![CDATA[
				]]>
			</script>
		</select1>
		<datagrid id="datagrid2" nodeset="/root/resData/gridData/record" caption="선택^부서^사번^성명^직책^직급^자녀명^관계^치료및교육시작일자^치료및교육 종료일자^치료및교육비 지출내용^치료및교육기관^치료및교육기관 전화번호^신청금액^지원금액^진행상태^관리번호^전표번호" colsep="#" colwidth="60, 100, 80, 70, 60, 60, 70, 60, 120, 120, 150, 128, 145, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100" extendlastcol="scroll" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="free" style="left:10px; top:95px; width:905px; height:520px; ">
			<col ref="chkbox" type="checkbox">
				<script type="javascript" ev:event="xforms-select">
					<![CDATA[
						var row = datagrid2.row;
						//datagrid2.rowstatus(row) = 2;
						var slip_proc_seq = model1.getValue("/root/resData/gridData/record["+row+"]/slip_proc_seq");
						var tmp_slip_proc_seq = "";
						for (i = 1; i < datagrid2.rows; i++) {
							tmp_slip_proc_seq = model1.getValue("/root/resData/gridData/record["+i+"]/slip_proc_seq");
							var proc_stat = model1.getValue("/root/resData/gridData/record["+i+"]/proc_stat");
							if (slip_proc_seq == tmp_slip_proc_seq) {					
								//if(proc_stat != "29" || proc_stat != "33" || proc_stat != "36" || proc_stat != ""){ 120216
								if(proc_stat != model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010")  
								|| proc_stat != model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_020")  
								|| proc_stat != model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_030")  
								|| proc_stat != ""){
									datagrid2.valueMatrix(i, 1) = "true";
									if(datagrid2.rowstatus(i) == 1 || datagrid2.rowstatus(i) == 3){
										datagrid2.rowstatus(i) = 1;
									}else{
										datagrid2.rowstatus(i) = 2;
									}
								}
							}
						}

						for(var i=1 ;i<datagrid1.rows;i++){
							var slip_proc_mang_dt = model1.getValue("/root/resData/slipData/record["+i+"]/slip_proc_mang_dt");
							var slip_proc_mang_seq = model1.getValue("/root/resData/slipData/record["+i+"]/slip_proc_mang_seq");
							var tmp_seq = slip_proc_mang_dt+""+slip_proc_mang_seq;
							if(slip_proc_seq == tmp_seq){
								datagrid1.rowStatus(i) = 1;
							}
						}
						slip_submit_sum();
						setTitl(1);						
						//model1.refresh();						
					]]>
				</script>
				<script type="javascript" ev:event="xforms-deselect">
					<![CDATA[
						var row = datagrid2.row;
						var slip_proc_seq = model1.getValue("/root/resData/gridData/record["+row+"]/slip_proc_seq");
						var tmp_slip_proc_seq = "";
						for (i = 1; i < datagrid2.rows; i++) {
							tmp_slip_proc_seq = model1.getValue("/root/resData/gridData/record["+i+"]/slip_proc_seq");
							if (slip_proc_seq == tmp_slip_proc_seq) {
								datagrid2.valueMatrix(i, 1) = "false";
								if(datagrid2.rowstatus(i) == 1 || datagrid2.rowstatus(i) == 3){
									datagrid2.rowstatus(i) = 1;
								}else{
									datagrid2.rowstatus(i) = 0;
								}
							}
						}

						for(var i=1 ;i<datagrid1.rows;i++){
							var slip_proc_mang_dt = model1.getValue("/root/resData/slipData/record["+i+"]/slip_proc_mang_dt");
							var slip_proc_mang_seq = model1.getValue("/root/resData/slipData/record["+i+"]/slip_proc_mang_seq");
							var tmp_seq = slip_proc_mang_dt+""+slip_proc_mang_seq;
							if(slip_proc_seq == tmp_seq){
								datagrid1.rowStatus(i) = 0;
							}
						}
						slip_submit_sum();		
						setTitl(2);		
//						model1.refresh();
						
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						var row = datagrid2.row;
						if (datagrid2.valueMatrix(row, 1) == "false" && datagrid2.rowStatus(row) == 2)
							datagrid2.rowStatus(row) = 0;
					]]>
				</script>
			</col>
			<col ref="dept_nm" style="text-align:left; "/>
			<col class="req" ref="emp_no" type="inputbutton" maxlength="6" caption="사번" style="text-align:center; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						searchEmpno();												
					]]>
				</script>
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");					
						model.setValue("/root/reqData/fwdData/func_nm", "setEmp_no");
						window.load("/xrw/hd/com/HD_COM_1000.xrw","mdichild", "hd_com_1000", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
				</script>
			</col>
			<col class="req" ref="flnm" type="input" caption="성명" style="text-align:center; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						searchFlnm();				
					]]>
				</script>
			</col>
			<col ref="dty_nm"/>
			<col ref="posi_nm"/>
			<col class="req" ref="child_flnm" type="input" caption="자녀명" style="text-align:left; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						searchChildflnm();
					]]>
				</script>
			</col>
			<col ref="faml_rshp_nm"/>
			<col class="req" ref="treat_edu_frdt" type="inputdate" caption="시작일자" style="text-align:center; "/>
			<col class="req" ref="treat_edu_todt" type="inputdate" caption="종료일자" style="text-align:center; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						chkamt();
					]]>
				</script>
			</col>
			<col ref="treat_edu_cont" type="input" style="text-align:left; "/>
			<col ref="treat_edu_instt" type="input" style="text-align:left; "/>
			<col ref="treat_edu_instt_tel_no" type="input" style="text-align:left; "/>
			<col ref="clam_amt" type="input" format="#,###" style="text-align:right; "/>
			<col ref="cmpy_sply_amt" type="input" format="#,###" style="text-align:right; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						sumamtchk();
					]]>
				</script>
			</col>
			<col ref="proc_stat_nm"/>
			<col ref="slip_proc_seq" format="99999999-99999"/>
			<col ref="actu_slip_no" format="99999999-99-999"/>
			<col ref="faml_rshp_cd" visibility="hidden"/>
			<col ref="dept_cd" visibility="hidden"/>
			<col ref="dty_cd" visibility="hidden"/>
			<col ref="posi_cd" visibility="hidden"/>
			<col ref="pay_plac_clsf" visibility="hidden"/>
			<col ref="faml_seq" visibility="hidden"/>
			<col ref="occr_dt" visibility="hidden"/>
			<col ref="seq" visibility="hidden"/>
			<col ref="proc_stat" visibility="hidden"/>
			<col ref="slip_proc_mang_dt" visibility="hidden"/>
			<col ref="slip_proc_mang_seq" visibility="hidden"/>
			<col ref="sum_amt" visibility="hidden"/>
			<col ref="max_amt" visibility="hidden"/>
			<script type="javascript" ev:event="onendedit">
				<![CDATA[
					if(datagrid2.col == 15){
						//chkamt();
					}
				]]>
			</script>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
				if(event.target == "datagrid2")
				{
					if(datagrid2.isReadOnly(1,1) == 1 && datagrid2.valueMatrix(1,2) == "" ) {return;}
					for(var i=1;i<datagrid2.rows;i++)	{
						var proc_stat = model1.getValue("/root/resData/gridData/record["+ i +"]/proc_stat");
						var status = datagrid2.rowstatus(i);				
						//if(proc_stat == "29" || proc_stat == "33" || proc_stat == "36"){ 120216
						if(proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010")  
						|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_020") 
						|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_030") ){
							datagrid2.isReadOnly(i, 1, i, 17) = true;
							datagrid2.valueMatrix(i, 1) = "false";
						}else if(proc_stat == ""){
							datagrid2.isReadOnly(i, 1, i, 17) = true;
							datagrid2.valueMatrix(i, 1) = "false";
						}else{
							datagrid2.addStatus(i, "update");
						}
					}
					for(var i=1 ;i<datagrid1.rows;i++){
						datagrid1.rowStatus(i) = 1;
					}		
					if(datagrid1.rows > 1 ){
						slip_submit_sum();
						setTitl_all(1);
					}
				}
				]]>
			</script>
			<script type="javascript" ev:event="xforms-deselect">
				<![CDATA[
					if(event.target == "datagrid2") {
						var row = datagrid2.row;	
						for(var i=1;i<datagrid2.rows;i++)	{
							if (datagrid2.isReadOnly(i, 1, i, 1) == false)
								datagrid2.rowstatus(i) = 0;
						}					
						for(var i=1 ;i<datagrid1.rows;i++){
							datagrid1.rowStatus(i) = 0;
						}	
						if(datagrid1.rows > 1 ){
							slip_submit_sum();
							setTitl_all(2);
						}
					}
				]]>
			</script>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var row = datagrid2.row;
					var col = datagrid2.col;
					var proc_stat = model1.getValue("/root/resData/gridData/record["+row+"]/proc_stat");
					if(col == 0 ){
						//if (proc_stat < '29'){ 120216
						if (proc_stat < model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010") ){
							rowStatus(datagrid2);
						}
					}
				]]>
			</script>
		</datagrid>
		<group id="group_btnA" class="gro_btn" style="left:10px; top:10px; width:905px; height:21px; ">
			<button id="button5" class="btn02" style="left:675px; top:0px; width:52px; height:21px; ">
				<caption>발행취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if(searchFlag == false && actu_slip_no_in.value == ""){
							alert("취소할 전표번호를 입력하여 조회 후 진행하십시오.");	
							return;	
						}								
						if(datagrid1.rows < 2){
							alert("취소할 전표가 존재하지 않습니다.");
							return;
						}	
						/*				
						if(datagrid1.rows == 1){
							alert("취소할 전표번호를 입력하여 조회 후 진행하십시오.");	
							return;
						}	
						*/				
						for(var i=1; i<datagrid1.rows;i++){
							var proc_stat = model1.getValue("/root/resData/slipData/record["+i+"]/proc_stat");
							var actu_slip_no = model1.getValue("/root/resData/slipData/record["+i+"]/actu_slip_no");
							//if(proc_stat == 29 || proc_stat == 36){ 120216
							if(proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010")  
							|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_030")){
							}else{
								alert("취소할 전표가 존재하지 않습니다.");
								return;								
							}
						}
						if (window.alert("전표를 취소하시겠습니까?", "확인", 1) != 1) {
							return;
						}							
						for(var i=0;i<datagrid1.rows;i++){ 
							datagrid1.addStatus(i, "insert");							
						}
						model1.setValue("/root/reqData/multiUpData1", datagrid1.getUpdateData());
						model1.send("hd_affr_1417");
						datagrid1.clearStatus();
						datagrid2.clearStatus();
						if(submit_completed()) {
							actu_slip_no_in.value = "";
							gridSearchList();	
						}	
				]]>
				</script>
			</button>
			<button id="button3" class="btn04" style="left:729px; top:0px; width:87px; height:21px; ">
				<caption>엑셀다운로드</caption>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
					//excel 파일로 저장한다
					    var filePath = window.fileDialog("save", "", false, "", "xls", "Excel Files(*.xls)|*.xls");
					       
					    if(filePath != "") {
					     datagrid2.saveExcel(filePath);
					     window.exec(filePath);
					    }
				]]>
				</script>
			</button>
			<button id="button8" class="btn02" style="left:423px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
 						gridSearchList();					
					]]>
				</script>
			</button>
			<button id="button9" class="btn02" style="left:531px; top:0px; width:52px; height:21px; ">
				<caption>저장</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						for (var i=1;i<datagrid2.rows;i++) {
							var proc_stat = model1.getValue("/root/resData/gridData/record["+i+"]/proc_stat");
							//if(proc_stat >= '29' ){ 120216
							if(proc_stat >= model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_010") ){
								alert("전표등록이후 상태의 데이터가 있습니다.\n\n전표등록이전의 데이터만 처리 하십시오. ");
								return;
							}
						}
						
						if (!rowInSubmit(datagrid2)) {
							return;
						}
						
						var flag = false;
						if(!commGridReqCheck("datagrid2")) return;					
						if(datagrid2.isReadOnly(1,1) == 1 && datagrid2.valueMatrix(1,2) == "") {return;}
						//if(datagrid2.rows == 1){alert("저장할 데이터가 없습니다.");return;}
						for(var i=1;i<datagrid2.rows;i++){
							if(datagrid2.rowStatus(i) != 0){
								flag = true;
							}
						}
						//if(!flag){alert("저장할 데이터가 없습니다");return;}
						if (window.alert("저장 하시겠습니까?", "확인", 1) != 1) {
							return;
						}							
	 					model1.setValue("/root/reqData/multiUpData", datagrid2.getUpdateData());
						model1.send("hd_affr_1413");
						if(submit_completed()) {
							model1.resetInstanceNode("/root/reqData/reqForm");
							gridSearchList();		
							//alert("저장되었습니다.");
							model1.refresh();							
						}
					]]>
				</script>
			</button>
			<button id="button11" class="btn04" style="left:585px; top:0px; width:87px; height:21px; ">
				<caption>발행(전표등록)</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						var flag = true;
						/*
						if(datagrid1.rows == -1){
							alert("생성할 전표가 없습니다.");
							return;
						}					
						if(datagrid1.valueMatrix(1,2) == ""){
							alert("생성할 전표가 없습니다.");	
							return;
						}	
						*/		
						var flag1 = false;
						for(var i=1;i<datagrid2.rows;i++){
							var chk = datagrid2.valueMatrix(i,datagrid2.colRef("chkbox"));
							if(chk == "true"){
								flag1 = true;
							}
						}
						if(!flag1){
							alert("전표를 생성할 대상을 선택하십시오.");	
							return;
						}								
						for(var i=1; i<datagrid2.rows;i++){
							var proc_stat = model1.getValue("/root/resData/gridData/record["+i+"]/proc_stat");
							//var actu_slip_no = model1.getValue("/root/resData/gridData/record["+i+"]/actu_slip_no");
							//var pay_dt = model1.getValue("/root/resData/gridData/record["+i+"]/pay_dt");
							//전표 등록 체크
							var chk = datagrid2.valueMatrix(i,datagrid2.colRef("chkbox"));
							if(chk == "true"){
								//if(proc_stat == 25 || proc_stat == 28){ 120216
								if(proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_040") 
								|| proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_050")){
									flag = false;
								}
								//if(proc_stat == '01'){ 120216
								if(proc_stat == model.getValue("/root/initData/hd_affr_1418_m/dataSet/xx_proc_stat_060")){
									alert("인사결재를 진행하지 않은 행이 있습니다.\n인사결재를 먼저 진행하십시오.");
									return;
								}							
							}
						}
						if(flag){
							alert("전표를 생성할 대상이 존재하지 않습니다.");
							return;								
						}
						if (window.alert("전표를 생성하시겠습니까?", "확인", 1) != 1) {
							return;
						}							
						setInsertSlipValue();
						model1.setValue("/root/reqData/multiUpData1", datagrid1.getUpdateData());
						//model1.setValue("/root/reqData/multiUpData", datagrid2.getUpdateData());
						datagrid1.clearStatus();
						datagrid2.clearStatus();							
						model1.send("hd_affr_1416");
						var actu_slip_no = model1.getValue("/root/tempData/CURLIST/record/actu_slip_no");
						model1.removenode("/root/slipNoData/slip_no");
						model1.makeValue("/root/slipNoData/slip_no",actu_slip_no);
						model1.removenode("/root/tempData");
						
						if(submit_completed()) {			
							gridSearchList();								
							
							// odi 파라미터 설정.					
						 	var ss_cmpy_cd = getProperty("ss_cmpycd");						 						
						 	var ss_emp_no = getProperty("ss_emp_no");
						 	var slip_no = model1.getValue("/root/slipNoData/slip_no");
						 	var emp_clsf = model1.getValue("/root/reqData/searchData/pay_plac_clsf");		
							
							// 오즈관련 노드 초기화..
						 	resetOznode();					
						 	// ozr경로 및 odi 파일명으로 사용될 노드 및 value셋팅 ( OZR파일경로 .ozr 제거)					
						 	makeNodeValue("/root/oz_data/ozrName","hd/HD_AFFR_1418");					
						 	// 프린터로 직접출력할 경우에만 사용.. ( preview:미리보기,print:직접출력, export:파일 )					
							makeNodeValue("/root/oz_data/preview","preview");
							//model.makeNode("/root/oz_data/printsize");
							makeNodeValue("/root/oz_data/printsize","B5 (JIS)"); 		//페이지용지설정(기본 A4)

						 	makeNodeValue("/root/oz_data/odiParam/iv_cmpy_cd",ss_cmpy_cd);					
						 	makeNodeValue("/root/oz_data/odiParam/iv_actu_slip_no",slip_no);					
						 	makeNodeValue("/root/oz_data/odiParam/iv_incmg_pers",ss_emp_no);					 
						 	makeNodeValue("/root/oz_data/odiParam/iv_pay_plac_clsf",emp_clsf);					
							
							
							// 2012.02.01  수정 됨  사원도 송금의뢰서 및  송금확인서 출력 가능 하도록 수정  
							 // if(emp_clsf == "10"){
								//은행송금 확인서
						 		makeNodeValue("/root/oz_data/childCount","2");
						
								makeNodeValue("/root/oz_data/child1/ozrName","hd/HD_COM_3000_P");
								makeNodeValue("/root/oz_data/child1/odiParam/iv_cmpy_cd"     ,getProperty("ss_cmpycd") );	
								//makeNodeValue("/root/oz_data/child1/odiParam/iv_cmpy_cd"     ,"332" );	
								makeNodeValue("/root/oz_data/child1/odiParam/iv_pay_plac_clsf",emp_clsf);	
								makeNodeValue("/root/oz_data/child1/odiParam/iv_actu_slip_no",actu_slip_no);
								makeNodeValue("/root/oz_data/child1/printsize","B5 (JIS)"); 		//페이지용지설정(기본 A4)
								
								//은행송금 의뢰서
								makeNodeValue("/root/oz_data/child2/ozrName","hd/HD_COM_3001_P");
								makeNodeValue("/root/oz_data/child2/odiParam/iv_cmpy_cd"     ,getProperty("ss_cmpycd") );	
								//makeNodeValue("/root/oz_data/child1/odiParam/iv_cmpy_cd"     ,"332" );	
								makeNodeValue("/root/oz_data/child2/odiParam/iv_pay_plac_clsf",emp_clsf);	
								makeNodeValue("/root/oz_data/child2/odiParam/iv_actu_slip_no",actu_slip_no);
								makeNodeValue("/root/oz_data/child2/printsize","B5 (JIS)"); 		//페이지용지설정(기본 A4)
						//	}

						 	// 레포트뷰어 호출.
						 	openOzwin("/root/oz_data");							
						}
					]]>
				</script>
			</button>
			<button id="button1" class="btn04" style="left:819px; top:0px; width:86px; height:21px; ">
				<caption>기준표팝업</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						model1.setValue("/root/reqData/fwdData/func_nm", "setGridSend");
						model1.setValue("/root/reqData/fwdData/call_clsf", "POPUP");
						//window.load("/xrw/hd/affr/HD_AFFR_3100.xrw","modal", "hd_affr_3100", "width:500px;height:360px;left:300px;top:200px", "/root/reqData/fwdData", "/root/reqData/fwdData");
						window.load("/xrw/hd/affr/HD_AFFR_3100.xrw","modal", "hd_affr_3100", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
				</script>
			</button>
			<button id="button4" class="btn02" style="left:477px; top:0px; width:52px; height:21px; ">
				<caption>삭제</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if (!rowDelSubmit(datagrid2)) {
							return;
						}
						
						for (i = 1; i < datagrid2.rows; i++) {
							if (datagrid2.rowStatus(i) == 4) {
								if (datagrid2.valueMatrix(i, datagrid2.colRef("actu_slip_no")) != "") {
									alert("전표번호가 발행된 건이 존재하므로 삭제할 수 없습니다.\n전표발행취소를 수행한 후 다시 진행하십시오.");
									return;
								}
							}
						}
						
						if (window.alert("삭제 하시겠습니까?", "확인", 1) != 1) {
							return;
						}							
	 					model1.setValue("/root/reqData/multiUpData", datagrid2.getUpdateData());
						model1.send("hd_affr_1413");
						if(submit_completed()) {
							model1.resetInstanceNode("/root/reqData/reqForm");
							gridSearchList();		
							//alert("저장되었습니다.");
							model1.refresh();							
						}
						
					]]>
				</script>
			</button>
		</group>
		<input id="actu_slip_no_in" ref="/root/reqData/searchData/actu_slip_no" format="99999999-99-999" style="left:589px; top:44px; width:100px; height:18px; "/>
		<datagrid id="datagrid1" nodeset="/root/resData/slipData/record" visibility="hidden" caption="회사코드^사번^부서^이름^차변금액(개인)^대변금액(총합계)^적요1^전표관리번호^전표일련번호^전표발생일자^전표구분코드^입력자^입력자IP^진행상태^관리일자^관리번호^사원구분^occr_dt^seq" colsep="#" colwidth="63, 79, 100, 100, 100, 114, 170, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100" extendlastcol="scroll" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:10px; top:330px; width:905px; height:175px; ">
			<col ref="cmpy_cd"/>
			<col ref="emp_no"/>
			<col ref="dept_cd"/>
			<col ref="flnm"/>
			<col ref="tmp_dr_amt"/>
			<col ref="tmp_crdt_amt"/>
			<col ref="titl"/>
			<col ref="actu_slip_no"/>
			<col ref="slip_seq"/>
			<col ref="slip_occr_dt"/>
			<col ref="slip_clsf_cd"/>
			<col ref="incmg_pers"/>
			<col ref="incmg_pers_ipadd"/>
			<col ref="proc_stat"/>
			<col ref="slip_proc_mang_dt"/>
			<col ref="slip_proc_mang_seq"/>
			<col ref="cmpy_welf_fund_clsf"/>
			<col ref="occr_dt"/>
			<col ref="seq"/>
		</datagrid>
		<caption id="gridrowcnt" style="left:810px; top:615px; width:100px; height:20px; font-weight:bold; text-align:right; "/>
	</xhtml:body>
</xhtml:html>
