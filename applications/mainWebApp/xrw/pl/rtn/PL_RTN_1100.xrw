<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="/css/style_sheet.css" type="text/css" ?>
<!--*************************************************************************************************
* 파일명 : PL_RTN_1100.xrw
* 기능 : 반품관리-정간물매체별반품
* 작성일자 :2009-03-31
* 작성자 : 김상옥
**************************************************************************************************-->
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>정간물매체별반품(PL_RTN_1100)</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<session/>
						<comboSet>
							<medi_cd>
								<item>
									<cd/>
									<cdnm/>
								</item>
							</medi_cd>
							<wh_cd>
								<item>
									<cd/>
									<cdnm/>
								</item>
							</wh_cd>
						</comboSet>
						<pageInfo/>
					</initData>
					<reqData>
						<fwdData>
							<callgb/>
						</fwdData>
						<searchData>
							<searchTop>
								<basi_dt_fr/>
								<basi_dt_to/>
								<medi_cd/>
								<medi_ser_no/>
								<medi_nm/>
								<medi_clsf/>
							</searchTop>
							<searchDtl>
								<deal_dt/>
								<deal_grp_seq/>
							</searchDtl>
							<searchDealEtc>
								<flag/>
								<deal_clsf/>
								<dlco_cd/>
								<dlco_seq/>
								<medi_cd/>
								<medi_ser_no/>
							</searchDealEtc>
						</searchData>
						<reqForm>
						</reqForm>
						<multiUpdate>
							<acc_flag/>
							<updateData/>
							<dtlinfo/>
						</multiUpdate>
					</reqData>
					<resData>
						<comboSet/>
						<resform>
							<DEAL_HEADER>
								<basi_yymm/>
								<basi_dt/>
								<medi_cd/>
								<medi_ser_no/>
								<medi_nm/>
								<qty_chk>Y</qty_chk>
								<deal_dt/>
								<deal_grp_seq/>
								<medi_clsf/>
								<absence_clsf/>
							</DEAL_HEADER>
							<DEAL_PTCRCUR>
								<record>
									<dlco_cd/>
									<dlco_seq/>
									<dlco_nm/>
									<deal_qty/>
									<deal_uprc/>
									<dcrate/>
									<deal_amt/>
									<wh_cd/>
									<prv_deli_qty/>
									<prv_widr_qty/>
									<prv_retn_qty/>
									<remk/>
									<deal_dt/>
									<deal_grp_seq/>
									<deal_seq/>
								</record>
							</DEAL_PTCRCUR>
						</resform>
						<gridData>
							<DEAL_PTCRLIST>
								<record>
									<basi_dt/>
									<basi_yymm/>
									<medi_cd/>
									<medi_ser_no/>
									<medi_nm/>
									<deal_qty/>
									<deal_amt/>
									<clos_yn/>
									<deal_dt/>
									<deal_grp_seq/>
								</record>
							</DEAL_PTCRLIST>
						</gridData>
						<resultData/>
						<MsgData/>
					</resData>
					<tempData>
						<keyData/>
						<btState/>
						<total>
							<deal_qty_sum/>
							<deal_amt_sum/>
						</total>
						<basi_yymm/>
						<basi_dt/>
					</tempData>
				</root>
			</instance>
			<submission id="pl_rtn_1100_m" action="/pl/rtn/1100" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/resData/comboSet"/>
			<submission id="pl_rtn_1110_l" action="/pl/rtn/1110" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData/searchTop" resultref="/root/resData/gridData"/>
			<submission id="pl_rtn_1120_l" action="/pl/rtn/1120" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData/searchDtl" resultref="/root/resData/resform/DEAL_PTCRCUR"/>
			<submission id="pl_rtn_1130_a" action="/pl/rtn/1130" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/multiUpdate" resultref="/root/resData/resultData"/>
			<submission id="pl_com_1510_s" action="/pl/com/1510" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData/searchDealEtc" resultref="/root/resData/resultData"/>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					setReady();
				]]>
			</script>
			<bind id="deal_qty_sum" ref="/root/tempData/total/deal_qty_sum" calculate="sum(/root/resData/resform/DEAL_PTCRCUR/record/deal_qty)"/>
			<bind id="deal_amt_sum" ref="/root/tempData/total/deal_amt_sum" calculate="sum(/root/resData/resform/DEAL_PTCRCUR/record/deal_amt)"/>
			<!--
	//script로 자동계산처리 변경
			<bind id="deal_amt" ref="/root/resData/resform/DEAL_PTCRCUR/record/deal_amt" calculate="(../deal_qty * ../deal_uprc * ../dcrate) div 100"/>
-->
		</model>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript" src="/js/CIISComm.js"/>
		<script type="javascript" src="/js/pl_comm.js"/>
		<script type="javascript">
			<![CDATA[
				//초기화 Set
				function setReady(){
					model.send("pl_rtn_1100_m");						//Submission

					model.copyNode("/root/initData/comboSet/medi_cd","/root/resData/comboSet/medi_cd");				//매체코드 copy
					model.copyNode("/root/initData/comboSet/wh_cd","/root/resData/comboSet/wh_cd");					//창고코드 copy

					model.copyNode("/root/resData/resform/DEAL_PTCRCUR","/root/resData/comboSet/DEAL_PTCRCUR");		//배본내역 copy

					model.setValue("/root/tempData/btState","RE");			//버튼제어상태 (RE:초기화)

					var basi_fr = addDate("d",-7,commCurDate("ymd"),"");
					var basi_to = commCurDate("ymd");
					
					model.setValue("/root/reqData/searchData/searchTop/basi_dt_fr",basi_fr);
					model.setValue("/root/reqData/searchData/searchTop/basi_dt_to",basi_to);

					model.refresh();
				}

				//조회
				function srcRetrieve(){
					//필수체크
					if(!commReqCheck(group1)) {
						return;
					}
					
					model.send("pl_rtn_1110_l");						//Submission

					//상세내역 초기화
					model.resetInstanceNode( "/root/resData/resform" );
					datagrid2.clearStatus();

					model.setValue("/root/resData/resform/DEAL_HEADER/qty_chk","Y");	//부수체크 체크(Y)로 셋팅
					model.setValue("/root/tempData/btState","RT");			//버튼제어상태 (RT:조회)

					model.refresh();
				}

				//상세조회
				function dtlRetrieve(){
					var deal_dt = datagrid1.valueMatrix(datagrid1.row, 9);					//선택한 레코드의 거래일자
					var deal_grp_seq = datagrid1.valueMatrix(datagrid1.row, 10);				//선택한 레코드의 거래그룹순번

					//REQUEST 노드에 키값 SET
					model.setValue("/root/reqData/searchData/searchDtl/deal_dt",deal_dt);				//거래일자
					model.setValue("/root/reqData/searchData/searchDtl/deal_grp_seq",deal_grp_seq);		//거래그룹순번

					model.send("pl_rtn_1120_l");						//Submission

					//에러체크
					if(submit_completed()){
						//선택 ROW 데이터 상세조회 노드로 Set
						model.setValue("/root/resData/resform/DEAL_HEADER/basi_yymm",datagrid1.valueMatrix(datagrid1.row, 2));		//기준년월
						model.setValue("/root/resData/resform/DEAL_HEADER/basi_dt",datagrid1.valueMatrix(datagrid1.row, 1));			//기준일자
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_cd",datagrid1.valueMatrix(datagrid1.row, 3));			//매체코드
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_ser_no",datagrid1.valueMatrix(datagrid1.row, 4));		//매체호수
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_nm",datagrid1.valueMatrix(datagrid1.row, 5));			//매체명
						model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt",datagrid1.valueMatrix(datagrid1.row, 9));			//거래일자
						model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq",datagrid1.valueMatrix(datagrid1.row, 10));		//거래그룹순번
					}

					model.setValue("/root/resData/resform/DEAL_HEADER/qty_chk","Y");	//부수체크 체크(Y)로 셋팅
					model.setValue("/root/tempData/btState","DT");			//버튼제어상태 (DT:상세조회)

					model.refresh();
				}

				//저장처리
				function saveProcess(){
					var btnctl = model.getValue("/root/tempData/btState");	//버튼제어상태 Get
					
					//Confirm체크
					if(!commConfirmBox("저장 하시겠습니까?", "저장")){
						return;
					}

					//필수체크
					if(!commReqCheck(group3)) {
						return;
					}
					
					model.setValue("/root/reqData/multiUpdate/acc_flag","S");								//저장 플래그 Set
					model.copyNode("/root/reqData/multiUpdate/dtlinfo","/root/resData/resform/DEAL_HEADER");		//Request 노드카피
					model.setValue("/root/reqData/multiUpdate/updateData",datagrid2.getUpdateData());				//상세내역 그리드 Set
					
					model.send("pl_rtn_1130_a");						//Submission

					//에러체크
					if(submit_completed()){
						model.send("pl_rtn_1110_l");					//Submission(조회)

						var basi_yymm = model.getValue("/root/resData/resform/DEAL_HEADER/basi_yymm");
						var basi_dt = model.getValue("/root/resData/resform/DEAL_HEADER/basi_dt");

						model.resetInstanceNode( "/root/resData/resform" );
						datagrid2.clearStatus();

						model.setValue("/root/tempData/basi_yymm",basi_yymm);
						model.setValue("/root/tempData/basi_dt",basi_dt);

						model.setValue("/root/resData/resform/DEAL_HEADER/basi_yymm",model.getValue("/root/tempData/basi_yymm"));
						model.setValue("/root/resData/resform/DEAL_HEADER/basi_dt",model.getValue("/root/tempData/basi_dt"));

						model.refresh();

						model.setValue("/root/resData/resform/DEAL_HEADER/qty_chk","Y");	//부수체크 체크(Y)로 셋팅
						model.setValue("/root/tempData/btState","SA");		//버튼제어상태 (SA:저장)
					}
				}

				//삭제처리
				function deleteProcess(){
					var btnctl = model.getValue("/root/tempData/btState");	//버튼제어상태 Get
					
					//Confirm체크
					if(!commConfirmBox("삭제 하시겠습니까?", "삭제")){
						return;
					}

					//버튼체크
					if(btnctl != "DT"){
						commAlert("상세조회 후 삭제할 수 있습니다.");
						return;
					}

					//필수체크
					if(!commReqCheck(group3)) {
						return;
					}
					
					//선택 row 상태변경
					pl_grid_select_del("datagrid2");

					model.setValue("/root/reqData/multiUpdate/acc_flag","D");								//작업FLAG Set(D:삭제)
					model.copyNode("/root/reqData/multiUpdate/dtlinfo","/root/resData/resform/DEAL_HEADER");		//Request 노드카피
					model.setValue("/root/reqData/multiUpdate/updateData",datagrid2.getUpdateData());				//상세내역 그리드 Set
					
					model.send("pl_rtn_1130_a");						//Submission

					//에러체크
					if(submit_completed()){
						model.send("pl_rtn_1110_l");					//Submission(조회)

						model.resetInstanceNode( "/root/resData/resform" );
						datagrid2.clearStatus();
						model.refresh();

						model.setValue("/root/resData/resform/DEAL_HEADER/qty_chk","Y");	//부수체크 체크(Y)로 셋팅
						model.setValue("/root/tempData/btState","DE");		//버튼제어상태 (DE:삭제)
					}
				}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="765" guideline="1,10;2,65;2,70;1,936;2,725;" style="font-family:굴림; vertical-align:top; ">
		<import id="iv_Title" src="/common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<button id="btnReset" class="btn03" style="left:584px; top:45px; width:63px; height:21px; ">
			<caption>초기화</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					model.reset();

					var basi_fr = addDate("d",-7,commCurDate("ymd"),"");
					var basi_to = commCurDate("ymd");
					
					model.setValue("/root/reqData/searchData/searchTop/basi_dt_fr",basi_fr);
					model.setValue("/root/reqData/searchData/searchTop/basi_dt_to",basi_to);

					datagrid2.clearStatus();
				]]>
			</script>
		</button>
		<button id="btnRetrive" class="btn03" crud="R" style="left:653px; top:45px; width:63px; height:21px; ">
			<caption>조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					srcRetrieve();
				]]>
			</script>
		</button>
		<button id="btnSave" class="btn03" crud="C" style="left:722px; top:45px; width:63px; height:21px; ">
			<caption>저장</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					saveProcess();
				]]>
			</script>
		</button>
		<button id="btnDelete" class="btn03" crud="D" style="left:791px; top:45px; width:63px; height:21px; ">
			<caption>삭제</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					deleteProcess();
				]]>
			</script>
		</button>
		<button id="btnClose" class="btn03" style="left:860px; top:45px; width:63px; height:21px; ">
			<caption>종료</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					viewer("mainFrame").window.javaScript.closeMDIWindow(model.getValue("/root/initData/pageInfo/pageID"));
				]]>
			</script>
		</button>
		<group id="group1" style="left:10px; top:70px; width:926px; height:34px; ">
			<caption id="caption11" class="list_cap02" style="left:0px; top:0px; width:926px; height:26px; "/>
			<caption id="caption5" class="list_cap03" style="left:0px; top:0px; width:70px; height:26px; ">반품기간</caption>
			<caption id="caption13" class="list_cap03" style="left:390px; top:0px; width:70px; height:26px; ">매체</caption>
			<input id="input8" ref="/root/reqData/searchData/searchTop/basi_dt_fr" class="req" inputtype="date" format="yyyy-mm-dd" caption="반품기간FROM" style="left:73px; top:4px; width:100px; height:18px; text-align:left; "/>
			<caption id="caption10" style="left:173px; top:5px; width:20px; height:18px; font-weight:bold; text-align:center; ">~</caption>
			<input id="input10" ref="/root/reqData/searchData/searchTop/basi_dt_to" class="req" inputtype="date" format="yyyy-mm-dd" caption="반품기간TO" style="left:193px; top:4px; width:100px; height:18px; text-align:left; "/>
			<output id="output1" ref="/root/reqData/searchData/searchTop/medi_clsf" visibility="hidden" disabled="true" appearance="output" style="left:790px; top:4px; width:50px; height:18px; text-align:center; "/>
			<input id="medi_cd_s" ref="/root/reqData/searchData/searchTop/medi_cd" disabled="true" appearance="input" style="left:463px; top:4px; width:30px; height:18px; text-align:center; "/>
			<input id="medi_ser_no_s" ref="/root/reqData/searchData/searchTop/medi_ser_no" disabled="true" appearance="input" style="left:496px; top:4px; width:50px; height:18px; text-align:center; "/>
			<input id="medi_nm_s" ref="/root/reqData/searchData/searchTop/medi_nm" inputtype="button" style="left:549px; top:4px; width:190px; height:18px; text-align:left; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						var medi_nm_bef = medi_nm_s.currentText;							//매체명
						if(medi_nm_bef == ""){
							model.setValue("/root/reqData/searchData/searchTop/medi_cd","");		//매체코드 초기화
							model.setValue("/root/reqData/searchData/searchTop/medi_ser_no","");	//매체호수 초기화
						}

						//매체구분 Set(정간물:10)
						model.setValue("/root/reqData/searchData/searchTop/medi_clsf","10");

						//매체검색 Call
						pl_getMediInfo_p("B",
									 "N",
									 "/root/reqData/searchData/searchTop",
									 "",
									 "S",
									 "medi_cd",
									 "medi_ser_no",
									 "medi_nm",
									 "",
									 "medi_clsf",
									 "",
									 "",
									 "",
									 "",
									 "",
									 "");
						/**
						 * 매체명으로 구성된 1건검색 또는 팝업 뛰우기 
						 * parameter 
						 * - btnChk(버튼체크) : B-버튼클릭, P-버튼클릭외(INPUT BOX OR ENTER)
						 * - flag(형태구분)   : N-일반 컴포넌트, G-그리드 컴퍼넌트
						 * - rootPath         : 상위노드 xpath  
						 * - grid             : grid 호출일경우 grid id명(String)
						 * - dynmstat         : 매체구분 동적,정적 체크(D:동적   S:정적)
						 * - medi_cdReq     : 매체코드 Element명
						 * - medi_ser_noReq       : 매체호수 Element명
						 * - medi_nmReq       : 매체명 Element명
						 * - issu_cmpyReq     : 발행사 Element명
						 * - medi_clsfReq     : 매체구분 Element명
						 * - absence_clsfReq  : 절판구분 Element명
						 * - uprcReq 		  : 단가 Element명
						 * - dcrateReq        : 할제 Element명
						 * - ser_no_basiReq   : 호수기준 Element명
						 * - issu_clsfReq     : 발행구분 Element명
						 * - end_ser_noReq    : 마감최종호수 Element명
						 */

						//refresh
						group1.refresh();
					]]>
				</script>
				<script type="javascript" ev:event="onkeydown">
					<![CDATA[
						//엔터키 체크
						if(event.keyCode == 13) {
							var medi_nm = medi_nm_s.currentText;										//매체명
							if(medi_nm == ""){
								model.setValue("/root/reqData/searchData/searchTop/medi_cd","");				//매체코드 초기화
								model.setValue("/root/reqData/searchData/searchTop/medi_ser_no","");			//매체호수 초기화
								return;
							}else{
								model.setValue("/root/reqData/searchData/searchTop/medi_nm",medi_nm);		//매체명 초기화
							}
							
							//매체구분 Set(정간물:10)
							model.setValue("/root/reqData/searchData/searchTop/medi_clsf","10");

							//매체검색 Call
							pl_getMediInfo_p("P",
										 "N",
										 "/root/reqData/searchData/searchTop",
										 "",
										 "S",
										 "medi_cd",
										 "medi_ser_no",
										 "medi_nm",
										 "",
										 "medi_clsf",
										 "",
										 "",
										 "",
										 "",
										 "",
										 "");
							
							//refresh
							group1.refresh();
						}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						var medi_nm = model.getValue("/root/reqData/searchData/searchTop/medi_nm");	//매체명
					
						//매체명 null인 경우 코드 초기화
						if(medi_nm == ""){
							model.setValue("/root/reqData/searchData/searchTop/medi_cd","");			//매체코드 초기화
							model.setValue("/root/reqData/searchData/searchTop/medi_ser_no","");		//매체호수 초기화
							return;
						}

						//refresh
						group1.refresh();
					]]>
				</script>
			</input>
		</group>
		<group id="group_line" class="gro_line" style="left:10px; top:101px; width:926px; height:5px; "/>
		<datagrid id="datagrid1" nodeset="/root/resData/gridData/DEAL_PTCRLIST/record" caption="반품일자^기준년월^매체코드^매체호수^매체명^거래부수^거래금액^마감여부^거래일자^거래그룹순번" colsep="^" colwidth="100, 80, 85, 85, 264, 100, 130, 60, 100, 100" explorerbar="sortshow" mergecellsfixedrows="bycolrec" rowheader="seq" rowsep="|" style="left:10px; top:111px; width:926px; height:184px; ">
			<col ref="basi_dt" format="yyyy-mm-dd"/>
			<col ref="basi_yymm" format="yyyy-mm"/>
			<col ref="medi_cd"/>
			<col ref="medi_ser_no"/>
			<col ref="medi_nm" style="text-align:left; "/>
			<col ref="deal_qty" format="###,###,###" style="text-align:right; "/>
			<col ref="deal_amt" format="###,###,###,###" style="text-align:right; "/>
			<col ref="clos_yn"/>
			<col ref="deal_dt" visibility="hidden"/>
			<col ref="deal_grp_seq" visibility="hidden"/>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					dtlRetrieve();
				]]>
			</script>
		</datagrid>
		<caption id="caption1" class="tit02" style="left:10px; top:310px; width:257px; height:20px; ">매체별  반품  상세  내역</caption>
		<group id="group3" style="left:10px; top:335px; width:926px; height:30px; ">
			<caption id="caption12" class="list_cap02" style="left:0px; top:0px; width:926px; height:26px; "/>
			<caption id="caption20" class="list_cap03" style="left:0px; top:0px; width:70px; height:26px; ">기준년월</caption>
			<caption id="caption4" class="list_cap03" style="left:185px; top:0px; width:70px; height:26px; ">반품일자</caption>
			<caption id="caption15" class="list_cap03" style="left:390px; top:0px; width:70px; height:26px; ">매체</caption>
			<input id="input4" ref="/root/resData/resform/DEAL_HEADER/basi_yymm" class="req" inputtype="date" format="yyyy-mm" caption="기준년월" style="left:73px; top:4px; width:80px; height:18px; text-align:left; "/>
			<input id="input3" ref="/root/resData/resform/DEAL_HEADER/basi_dt" class="req" inputtype="date" format="yyyy-mm-dd" caption="반품일자" style="left:258px; top:4px; width:100px; height:18px; text-align:left; "/>
			<input id="medi_cd_s2" ref="/root/resData/resform/DEAL_HEADER/medi_cd" class="req" disabled="true" caption="매체코드" appearance="input" style="left:463px; top:4px; width:30px; height:18px; text-align:center; "/>
			<input id="medi_ser_no_s2" ref="/root/resData/resform/DEAL_HEADER/medi_ser_no" class="req" disabled="true" caption="매체호수" appearance="input" style="left:496px; top:4px; width:50px; height:18px; text-align:center; "/>
			<input id="medi_nm_s2" ref="/root/resData/resform/DEAL_HEADER/medi_nm" class="req" inputtype="button" caption="매체명" style="left:549px; top:4px; width:190px; height:18px; text-align:left; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						var medi_cd_bef = medi_cd_s2.currentText;	
						var medi_ser_no_bef = medi_ser_no_s2.currentText;	
						var medi_nm_bef = medi_nm_s2.currentText;	

						//매체명 체크
						if(medi_nm_bef == ""){
							model.resetInstanceNode( "/root/resData/resform/DEAL_PTCRCUR" );
							datagrid2.clearStatus();
							datagrid2.refresh();
							model.setValue("/root/resData/resform/DEAL_HEADER/medi_cd","");				//매체코드 초기화
							model.setValue("/root/resData/resform/DEAL_HEADER/medi_ser_no","");				//매체호수 초기화
							model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt","");
							model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq","");
						}

						//매체구분 Set(정간물:10)
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_clsf","10");
						model.setValue("/root/resData/resform/DEAL_HEADER/absence_clsf","10");			//절판구분 Set(미절판)

						//매체검색 Call
						pl_getMediInfo_p("B",
									 "N",
									 "/root/resData/resform/DEAL_HEADER",
									 "",
									 "S",
									 "medi_cd",
									 "medi_ser_no",
									 "medi_nm",
									 "",
									 "medi_clsf",
									 "absence_clsf",
									 "",
									 "",
									 "",
									 "",
									 "");
						/**
						 * 매체명으로 구성된 1건검색 또는 팝업 뛰우기 
						 * parameter 
						 * - btnChk(버튼체크) : B-버튼클릭, P-버튼클릭외(INPUT BOX OR ENTER)
						 * - flag(형태구분)   : N-일반 컴포넌트, G-그리드 컴퍼넌트
						 * - rootPath         : 상위노드 xpath  
						 * - grid             : grid 호출일경우 grid id명(String)
						 * - dynmstat         : 매체구분 동적,정적 체크(D:동적   S:정적)
						 * - medi_cdReq     : 매체코드 Element명
						 * - medi_ser_noReq       : 매체호수 Element명
						 * - medi_nmReq       : 매체명 Element명
						 * - issu_cmpyReq     : 발행사 Element명
						 * - medi_clsfReq     : 매체구분 Element명
						 * - absence_clsfReq  : 절판구분 Element명
						 * - uprcReq 		  : 단가 Element명
						 * - dcrateReq        : 할제 Element명
						 * - ser_no_basiReq   : 호수기준 Element명
						 * - issu_clsfReq     : 발행구분 Element명
						 * - end_ser_noReq    : 마감최종호수 Element명
						 */

						//set node값 get
						var medi_cd = model.getValue("/root/resData/resform/DEAL_HEADER/medi_cd");
						var medi_ser_no = model.getValue("/root/resData/resform/DEAL_HEADER/medi_ser_no");

						//변경체크
						if(medi_cd != medi_cd_bef || medi_ser_no != medi_ser_no_bef){
							model.resetInstanceNode( "/root/resData/resform/DEAL_PTCRCUR" );
							model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt","");
							model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq","");
							datagrid2.clearStatus();
							datagrid2.refresh();
						}
						
						//refresh
						group3.refresh();
						
						//FOCUST SET
						model.setFocus("datagrid2");
						datagrid2.row = datagrid2.fixedRows;
						datagrid2.col = 3;
						datagrid2.editCell();
					]]>
				</script>
				<script type="javascript" ev:event="onkeydown">
					<![CDATA[
						//엔터키 체크
						if(event.keyCode == 13) {
							var medi_cd_bef = medi_cd_s2.currentText;	
							var medi_ser_no_bef = medi_ser_no_s2.currentText;	
							var medi_nm_bef = medi_nm_s2.currentText;										//매체명
							if(medi_nm_bef == ""){
								model.resetInstanceNode( "/root/resData/resform/DEAL_PTCRCUR" );
								datagrid2.clearStatus();
								datagrid2.refresh();
								model.setValue("/root/resData/resform/DEAL_HEADER/medi_cd","");				//매체코드 초기화
								model.setValue("/root/resData/resform/DEAL_HEADER/medi_ser_no","");				//매체호수 초기화
								model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt","");
								model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq","");
								return;
							}else{
								model.setValue("/root/resData/resform/DEAL_HEADER/medi_nm",medi_nm_bef);		//매체명 초기화
							}
							
							//매체구분 Set(정간물:10)
							model.setValue("/root/resData/resform/DEAL_HEADER/medi_clsf","10");
							model.setValue("/root/resData/resform/DEAL_HEADER/absence_clsf","10");			//절판구분 Set(미절판)
	
							//매체검색 Call
							pl_getMediInfo_p("P",
										 "N",
										 "/root/resData/resform/DEAL_HEADER",
										 "",
										 "S",
										 "medi_cd",
										 "medi_ser_no",
										 "medi_nm",
										 "",
										 "medi_clsf",
										 "absence_clsf",
										 "",
										 "",
										 "",
										 "",
										 "");
							//set node값 get
							var medi_cd = model.getValue("/root/resData/resform/DEAL_HEADER/medi_cd");
							var medi_ser_no = model.getValue("/root/resData/resform/DEAL_HEADER/medi_ser_no");
	
							//변경체크
							if(medi_cd != medi_cd_bef || medi_ser_no != medi_ser_no_bef){
								model.resetInstanceNode( "/root/resData/resform/DEAL_PTCRCUR" );
								model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt","");
								model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq","");
								datagrid2.refresh();
								datagrid2.clearStatus();
							}
							
							group3.refresh();
						
							//FOCUST SET
							model.setFocus("datagrid2");
							datagrid2.row = datagrid2.fixedRows;
							datagrid2.col = 3;
							datagrid2.editCell();
						}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						//초기화
						model.resetInstanceNode( "/root/resData/resform/DEAL_PTCRCUR" );
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_cd","");				//매체코드 초기화
						model.setValue("/root/resData/resform/DEAL_HEADER/medi_ser_no","");				//매체호수 초기화
						model.setValue("/root/resData/resform/DEAL_HEADER/deal_dt","");
						model.setValue("/root/resData/resform/DEAL_HEADER/deal_grp_seq","");
						model.setValue("/root/tempData/btState","RE");		//버튼제어상태 초기화
						
						model.refresh();

						//FOCUST SET
						model.setFocus("datagrid2");
						datagrid2.row = datagrid2.fixedRows;
						datagrid2.col = 3;
						datagrid2.editCell();
					]]>
				</script>
			</input>
			<caption id="caption2" class="list_cap03" style="left:770px; top:0px; width:70px; height:26px; ">체크</caption>
			<select1 id="combo1" ref="/root/resData/resform/DEAL_HEADER/qty_chk" appearance="minimal" style="left:843px; top:4px; width:66px; height:18px; text-align:left; ">
				<choices>
					<item>
						<label>반품부수체크</label>
						<value>Y</value>
					</item>
					<item>
						<label>반품부수체크안함</label>
						<value>N</value>
					</item>
				</choices>
			</select1>
			<output id="output3" ref="/root/resData/resform/DEAL_HEADER/deal_dt" visibility="hidden" disabled="true" appearance="output" style="left:360px; top:4px; width:15px; height:18px; text-align:center; "/>
			<output id="output6" ref="/root/resData/resform/DEAL_HEADER/deal_grp_seq" visibility="hidden" disabled="true" appearance="output" style="left:375px; top:4px; width:15px; height:18px; text-align:center; "/>
			<output id="output2" ref="/root/resData/resform/DEAL_HEADER/medi_clsf" visibility="hidden" disabled="true" appearance="output" style="left:745px; top:4px; width:15px; height:18px; text-align:center; "/>
			<output id="output7" ref="/root/resData/resform/DEAL_HEADER/absence_clsf" visibility="hidden" disabled="true" appearance="output" style="left:155px; top:4px; width:25px; height:18px; text-align:center; "/>
		</group>
		<datagrid id="datagrid2" nodeset="/root/resData/resform/DEAL_PTCRCUR/record" caption="거래처코드^거래처순번^거래처명^반품부수^단가^할제^반품금액^창고^기배본부수^기회수부수^기반품부수^비고^거래일자^거래그룹순번^거래순번" colsep="#" colwidth="75, 70, 180, 65, 65, 60, 90, 74, 70, 70, 70, 150, 100, 100, 100" frozencols="3" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="byrow" arrowkey="Y" style="left:10px; top:366px; width:926px; height:314px; ">
			<col disabled="true" ref="dlco_cd" style="text-align:center; "/>
			<col disabled="true" ref="dlco_seq" style="text-align:center; "/>
			<col ref="dlco_nm" type="inputbutton" style="text-align:left; "/>
			<col ref="deal_qty" type="input" format="###,###,###" style="text-align:right; "/>
			<col ref="deal_uprc" type="input" format="###,###,###" style="text-align:right; "/>
			<col ref="dcrate" type="input" format="###.##" style="text-align:right; "/>
			<col ref="deal_amt" type="input" format="###,###,###,###" style="text-align:right; "/>
			<col ref="wh_cd" type="combo" style="text-align:left; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/wh_cd/item">
						<label ref="cdnm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</col>
			<col ref="prv_deli_qty" format="###,###,###" style="text-align:right; "/>
			<col ref="prv_widr_qty" format="###,###,###" style="text-align:right; "/>
			<col ref="prv_retn_qty" format="###,###,###" style="text-align:right; "/>
			<col ref="remk" type="input" style="text-align:left; "/>
			<col ref="deal_dt" visibility="hidden"/>
			<col ref="deal_grp_seq" visibility="hidden"/>
			<col ref="deal_seq" visibility="hidden"/>
			<script type="javascript" ev:event="onbuttonclick">
				<![CDATA[
					//current 값 set
					datagrid2.endeditCell();

					//필수체크
					if(!commReqCheck(group3)) {
						return;
					}

					var nowrow = datagrid2.row - datagrid2.fixedRows + 1;
					var rowinx = "";
					rowinx = "["+ (nowrow) + "]";

					var dlco_cd_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd");			//거래처코드
					var dlco_seq_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq");		//거래처순번
					var dlco_nm_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_nm");			//거래처명

					if(dlco_nm_bef == ""){
						model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd","");		//거래처코드 초기화
						model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq","");		//거래처순번 초기화
						model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_deli_qty","");	//기배본부수 초기화
						model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_widr_qty","");	//기회수부수 초기화
						model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_retn_qty","");	//기반품부수 초기화
					}
					
					//거래처검색 Call
					pl_getDlcoInfo_p("B",
								"G",
								"/root/resData/resform/DEAL_PTCRCUR/record",
								"datagrid2",
								"dlco_cd",
								"dlco_seq",
								"dlco_nm",
								"",
								"",
								"")
					 /*
					 * - btnChk(버튼체크) : B-버튼클릭, P-버튼클릭외(INPUT BOX OR ENTER)
					 * - flag(형태구분)   : N-일반 컴포넌트, G-그리드 컴퍼넌트
					 * - rootPath         : 상위노드 xpath  
					 * - grid             : grid 호출일경우 grid id명(String)
					 * - dlco_cdReq       : 거래처코드 Element명
					 * - dlco_seqReq      : 거래처순번 Element명
					 * - dlco_nmReq       : 거래처명 Element명
					 * - dlco_clsfReq     : 거래처구분 Element명
					 * - areaReq          : 지역 Element명
					 * - prv_curr_clsfReq : 전현임구분 Element명
					*/

					//거래처 체크
					var dlco_cd = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd");		//거래처코드
					var dlco_seq = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq");	//거래처순번

					if(dlco_cd != dlco_cd_bef || dlco_seq != dlco_seq_bef){
						model.setValue("/root/reqData/searchData/searchDealEtc/flag","AA");
						model.setValue("/root/reqData/searchData/searchDealEtc/deal_clsf","R");
						model.setValue("/root/reqData/searchData/searchDealEtc/medi_cd",model.getValue("/root/resData/resform/DEAL_HEADER/medi_cd"));
						model.setValue("/root/reqData/searchData/searchDealEtc/medi_ser_no",model.getValue("/root/resData/resform/DEAL_HEADER/medi_ser_no"));
						model.setValue("/root/reqData/searchData/searchDealEtc/dlco_cd",model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd"));
						model.setValue("/root/reqData/searchData/searchDealEtc/dlco_seq",model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq"));
						
						model.send("pl_com_1510_s");

						//에러체크 후 기초데이터 Set
						if(submit_completed()){
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/deal_uprc",model.getValue("/root/resData/resultData/DEAL_ETCINFO/deal_uprc"));
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dcrate",model.getValue("/root/resData/resultData/DEAL_ETCINFO/dcrate"));
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/wh_cd",model.getValue("/root/resData/resultData/DEAL_ETCINFO/wh_cd"));
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_deli_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_deli_qty"));
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_widr_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_widr_qty"));
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_retn_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_retn_qty"));
						}
					}

					datagrid2.refresh();
					
					//FOCUST SET
					model.setFocus("datagrid2");
					datagrid2.row = datagrid2.row;
					datagrid2.col = 4;
					datagrid2.editCell();
				]]>
			</script>
			<script type="javascript" ev:event="onkeydown">
				<![CDATA[
					//엔터키 체크
					if(event.keyCode == 13) {
						var col = datagrid2.col;

						if(col == 3){
							model.setFocus("datagrid2",true);
							//current 값 set
							datagrid2.endeditCell();

							//필수체크
							if(!commReqCheck(group3)) {
								return;
							}
							
							//datagrid2.gridToInstance();

							var nowrow = datagrid2.row - datagrid2.fixedRows + 1;
							var rowinx = "";
							rowinx = "["+ (nowrow) + "]";
		
							var dlco_cd_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd");			//거래처코드
							var dlco_seq_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq");		//거래처순번
							var dlco_nm_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_nm");			//거래처명

							if(dlco_nm_bef == ""){
								model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd","");		//거래처코드 초기화
								model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq","");		//거래처순번 초기화
								model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_deli_qty","");	//기배본부수 초기화
								model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_widr_qty","");	//기회수부수 초기화
								model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_retn_qty","");	//기반품부수 초기화
							}
	
							//거래처검색 Call
							pl_getDlcoInfo_p("P",
										"G",
										"/root/resData/resform/DEAL_PTCRCUR/record",
										"datagrid2",
										"dlco_cd",
										"dlco_seq",
										"dlco_nm",
										"",
										"",
										"")
	
							//거래처 체크
							var dlco_cd = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd");		//거래처코드
							var dlco_seq = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq");	//거래처순번
		
							if(dlco_cd != dlco_cd_bef || dlco_seq != dlco_seq_bef){
								model.setValue("/root/reqData/searchData/searchDealEtc/flag","AA");
								model.setValue("/root/reqData/searchData/searchDealEtc/deal_clsf","R");
								model.setValue("/root/reqData/searchData/searchDealEtc/medi_cd",model.getValue("/root/resData/resform/DEAL_HEADER/medi_cd"));
								model.setValue("/root/reqData/searchData/searchDealEtc/medi_ser_no",model.getValue("/root/resData/resform/DEAL_HEADER/medi_ser_no"));
								model.setValue("/root/reqData/searchData/searchDealEtc/dlco_cd",model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd"));
								model.setValue("/root/reqData/searchData/searchDealEtc/dlco_seq",model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq"));
								
								model.send("pl_com_1510_s");
		
								//에러체크 후 기초데이터 Set
								if(submit_completed()){
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/deal_uprc",model.getValue("/root/resData/resultData/DEAL_ETCINFO/deal_uprc"));
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dcrate",model.getValue("/root/resData/resultData/DEAL_ETCINFO/dcrate"));
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/wh_cd",model.getValue("/root/resData/resultData/DEAL_ETCINFO/wh_cd"));
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_deli_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_deli_qty"));
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_widr_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_widr_qty"));
									model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_retn_qty",model.getValue("/root/resData/resultData/DEAL_ETCINFO/prv_retn_qty"));
								}
							}
	
							datagrid2.refresh();
					
							//FOCUST SET
							model.setFocus("datagrid2");
							datagrid2.row = datagrid2.row;
							datagrid2.col = 4;
							datagrid2.editCell();
						}
					}
				]]>
			</script>
			<script type="javascript" ev:event="xforms-value-changed">
				<![CDATA[
					var nowrow = datagrid2.row - datagrid2.fixedRows + 1;
					var rowinx = "";
					rowinx = "["+ (nowrow) + "]";

					if(nowrow > 0){
						datagrid2.endeditCell();
	
						var dlco_cd_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd");			//거래처코드
						var dlco_seq_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq");		//거래처순번
						var dlco_nm_bef = model.getValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_nm");			//거래처명
						if(dlco_nm_bef == ""){
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_cd","");		//거래처코드 초기화
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/dlco_seq","");		//거래처순번 초기화
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_deli_qty","");	//기배본부수 초기화
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_widr_qty","");	//기회수부수 초기화
							model.setValue("/root/resData/resform/DEAL_PTCRCUR/record"+rowinx+"/prv_retn_qty","");	//기반품부수 초기화
						}
	
						//금액 자동계산
						var col = datagrid2.col;
						var deal_amt = 0;
	
						if(col == 4 || col == 5 || col == 6){
							deal_qty = Number(datagrid2.valueMatrix(nowrow,datagrid2.colRef("deal_qty")));		//거래부수
							deal_uprc = Number(datagrid2.valueMatrix(nowrow,datagrid2.colRef("deal_uprc")));		//거래단가
							dcrate = Number(datagrid2.valueMatrix(nowrow,datagrid2.colRef("dcrate")));			//할제
							
							deal_amt = (deal_qty * deal_uprc * dcrate) / 100;
							
							datagrid2.valueMatrix(nowrow,datagrid2.colRef("deal_amt")) = deal_amt;
						}

						datagrid2.refresh();

						if(col == 3){
							//FOCUST SET
							model.setFocus("datagrid2");
							datagrid2.row = datagrid2.row;
							datagrid2.col = 4;
							datagrid2.editCell();
						}
					}
				]]>
			</script>
		</datagrid>
		<caption id="caption6" class="list_cap03" style="left:711px; top:689px; width:65px; height:20px; font-weight:bold; text-align:center; ">반품부수</caption>
		<caption id="caption7" class="list_cap03" style="left:775px; top:689px; width:100px; height:20px; font-weight:bold; text-align:center; ">반품금액</caption>
		<caption id="caption8" class="list_cap03" style="left:662px; top:689px; width:50px; height:37px; font-weight:bold; text-align:center; vertical-align:middle; ">합계</caption>
		<output id="output4" ref="/root/tempData/total/deal_amt_sum" format="###,###,###,##0" style="left:775px; top:708px; width:100px; height:18px; font-weight:bold; color:#0000ff; text-align:right; background-color:#ff9900; border-color:#0000ff; border-style:solid; "/>
		<output id="output5" ref="/root/tempData/total/deal_qty_sum" format="###,###,###,##0" style="left:711px; top:708px; width:65px; height:18px; font-weight:bold; color:#0000ff; text-align:right; background-color:#ff9900; border-color:#0000ff; border-style:solid; "/>
	</xhtml:body>
</xhtml:html>
