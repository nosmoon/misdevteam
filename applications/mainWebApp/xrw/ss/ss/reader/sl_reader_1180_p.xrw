<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="/css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>구독계약 추가/변경</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<session/>
						<comboSet>
							<medicdCombo/>
							<freeclsfCombo/>
							<rdrExtntypecdCombo/>
						</comboSet>
						<pageInfo/>
						<postData>
							<subsAccessForm>
								<!--rdr_no/>
								<medicd/-->
							</subsAccessForm>
						</postData>
						<defaultData>
						</defaultData>
					</initData>
					<reqData>
						<fwdData/>
						<searchData>
						</searchData>
						<reqform>
							<subsCntrDetailForm>
								<accflag/>
								<bocd/>
								<rdr_no/>
								<cntrno/>
								<mangno/>
								<extnid/>
								<aplcpathcd/>
								<medicd/>
								<rdr_extndt/>
								<valmm/>
								<subsfr_dt/>
								<freeyn/>
								<subsqty>1</subsqty>
								<subsuprc/>
								<dscnamt/>
								<post_dlvfee/>
								<freeclsf/>
								<rdr_extntypecd_2/>
								<!--확장자-->
								<extnnm/>
								<rdr_extntypecd/>
								<extnblngcd/>
								<stafclsfcd/>
								<stafno/>
								<rdr_extnbocd/>
								<boemp_no/>
								<bodutycd/>
								<bodutynm/>
								<extnprn/>
								<extnflnm/>
								<extntel1/>
								<extntel2/>
								<extntel3/>
								<extnptph_no1/>
								<extnptph_no2/>
								<extnptph_no3/>
								<extnemail/>
								<rdr_extncost/>
								<!--판촉물-->
								<bns_itemnm/>
								<bns_itemcd/>
								<incmgdt/>
								<remk/>
								<new_medicd/>
							</subsCntrDetailForm>
							<nwspsubscntrListSearchForm>
								<rdr_no/>
								<medicd/>
								<bocd/>
								<flag/>
							</nwspsubscntrListSearchForm>
							<nwspsubscntrDetailSearchForm>
								<rdr_no/>
								<medicd/>
								<cntrno/>
								<mangno/>
								<bocd/>
							</nwspsubscntrDetailSearchForm>
							<rdrExtnSearchForm>
								<bocd/>
								<extnblngcd/>
								<extntypecd/>
								<stafno/>
								<name/>
								<prn/>
								<pageno/>
								<pagesize/>
								<result_html/>
							</rdrExtnSearchForm>
							<bnsItemcdSearchForm>
								<bns_itemnm/>
								<bns_itemcd/>
								<pageno/>
								<pagesize/>
								<result_html/>
							</bnsItemcdSearchForm>
							<rdrExtnClearForm>
								<extnnm/>
								<extnblngcd/>
								<stafclsfcd/>
								<stafno/>
								<rdr_extnbocd/>
								<boemp_no/>
								<bodutycd/>
								<bodutynm/>
								<extnprn/>
								<extnflnm/>
								<extntel1/>
								<extntel2/>
								<extntel3/>
								<extnptph_no1/>
								<extnptph_no2/>
								<extnptph_no3/>
								<extnemail/>
							</rdrExtnClearForm>
							<rdrExtnPopupForm>
								<job_flg/>
								<bocd/>
								<extntypecd/>
								<extnblngcd/>
								<stafno/>
								<name/>
								<prn/>
								<pageno/>
								<pagesize/>
							</rdrExtnPopupForm>
						</reqform>
						<multiUpDate/>
					</reqData>
					<resData>
						<resform/>
						<gridData>
							<listGrid>
								<record>
									<rdr_no/>
									<medicd/>
									<cntrno/>
									<mangno/>
									<medinm/>
									<rdr_extndt/>
									<valmm/>
									<rdr_extnno/>
									<rdr_extntypecd/>
									<rdr_extntype/>
									<extnnm/>
									<subsuprc/>
									<subsqty/>
									<dscnamt/>
									<post_dlvfee/>
									<rdr_extncost/>
									<freeyn/>
									<freeclsf/>
									<bns_itemnm/>
									<!--추가-->
									<key/>
									<freeyn_f/>
								</record>
							</listGrid>
						</gridData>
						<MsgData/>
					</resData>
					<tempData>
						<keyData/>
						<resTemp/>
					</tempData>
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-model-construct-done">
				<![CDATA[
					init();
				]]>
			</script>
			<script type="javascript" ev:event="xforms-model-destruct">
				<![CDATA[
				//종료시에 셋팅.
				setRdrNo();
				]]>
			</script>
			<submission id="PID1180subInit" action="/ss/slreader/1180" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/tempData/resTemp"/>
			<submission id="PID1180subSearch" action="/ss/slreader/1185" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqform/nwspsubscntrListSearchForm" resultref="/root/tempData/resTemp"/>
			<submission id="PID1180subDetailSearch" action="/ss/slreader/1210" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqform/nwspsubscntrDetailSearchForm" resultref="/root/tempData/resTemp"/>
			<submission id="PID1180subInsert" action="/ss/slreader/1190" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqform/subsCntrDetailForm" resultref="/root/tempData/resTemp"/>
			<submission id="PID1180subUpdate" action="/ss/slreader/1200" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqform/subsCntrDetailForm" resultref="/root/tempData/resTemp"/>
		</model>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript" src="/js/CIISComm.js"/>
		<script type="javascript" src="/js/common.js"/>
		<script type="javascript" src="/js/CRMComm.js"/>
		<script type="javascript">
			<![CDATA[
			function init()
			{
				model.send("PID1180subInit", false);
				if(model.getValue("/root/tempData/resTemp/bomedicdReg") == "false")
				{
					model.alert("sl_reader_1180_p.jsp(1) 지국취급매체 코드가 등록되어 있지 않습니다.");
					close();
				}
				if(!submit_completed())
					return;
				//기타 설정 데이터.
				model.copyNode("/root/initData/defaultData", "/root/tempData/resTemp/defaultData");
				setDefault();
				model.removenode("/root/tempData/resTemp");
				
				if(instance1.selectNodes("/root/initData/postData/subsAccessForm/rdr_no").length == 0)
				{
					model.alert("유효하지 않은 arguments 입니다.");
					close();
				}
				if(model.getValue("/root/initData/postData/subsAccessForm/rdr_no")=="" || model.getValue("/root/initData/postData/subsAccessForm/medicd")=="")
				{
					model.alert("독자번호나 매체코드가 셋팅되지 않았습니다.");
					close();
				}
				search(model.getValue("/root/initData/postData/subsAccessForm/rdr_no"), model.getValue("/root/initData/postData/subsAccessForm/medicd"), "");
			}
			
			function search(rdr_no, medicd, flag)
			{					
				model.setValue("/root/reqData/reqform/nwspsubscntrListSearchForm/rdr_no", rdr_no);
				model.setValue("/root/reqData/reqform/nwspsubscntrListSearchForm/medicd", medicd);
				model.setValue("/root/reqData/reqform/nwspsubscntrListSearchForm/flag", flag);
				
				remakeNode("/root/tempData/resTemp");
				model.send("PID1180subSearch", false);
				if(!submit_completed())
					return;
					
				model.copyNode("/root/resData/gridData/listGrid", "/root/tempData/resTemp/listGrid");
				datagrid1.refresh();
				
				//기존 매체 그룹버튼 삭제
				removeAllGroupButton(PID1180group_btnT, "tab");
				
				//매체 그룹버튼 생성.
				var selIdx = 0;
				var medicd = model.getValue("/root/tempData/resTemp/medicd");
				var tabRdrno = model.getValue("/root/tempData/resTemp/rdr_no");
				var medis = instance1.selectNodes("/root/tempData/resTemp/medicurData/record");
				if(medis != null)
				{
					for(var i=0; i<medis.length; i++)
					{
						//group button 생성.
						var tabMedicd = medis.item(i).selectSingleNode("medicd").nodeValue;
						var tabAbrv = medis.item(i).selectSingleNode("abrv").nodeValue;
						var tabDlvqty = medis.item(i).selectSingleNode("dlvqty").nodeValue;
						var tabCaption = tabAbrv + "-" + tabDlvqty;
						var prop = "class=tab05; left:" + (92*i+1) + "px; top:0px; width:92px; height:23px; text-align:center; "; 
						addGroupButton(PID1180group_btnT, "mediBtn"+i, "tab", tabCaption, "search('" + tabRdrno + "','" + tabMedicd + "','')", prop);
						
						//button 속성 추가.
						var btn = document.controls("mediBtn"+i);
						btn.attribute("medicd") = tabMedicd;
						btn.attribute("abrv") = tabAbrv;
						btn.attribute("dlvqty") = tabDlvqty;
						//btn.hint = medis.item(i).selectSingleNode("medinm").nodeValue + ", 배달부수("+ tabDlvqty + "), 구독중인 계약건수("+ medis.item(i).selectSingleNode("cntrcnt").nodeValue + ")";
						
						if((medicd == "" && i == 0) || medicd == tabMedicd)
							btn.selected = true;
					}
				}
				
				if(model.getValue("/root/tempData/resTemp/flag") != "s")
					setDefault();
				else
					setListRow();
				
				if(instance1.selectNodes("/root/resData/gridData/listGrid/record/rdr_no").length == 0)
					model.alert("구독중인 계약이 없습니다.");
			}
			
			function detailSearch()
			{
				gridRowValueCopy("/root/reqData/reqform/nwspsubscntrDetailSearchForm", datagrid1, datagrid1.row);
				
				remakeNode("/root/tempData/resTemp");
				model.send("PID1180subDetailSearch", false);
				
				childValueCopy("/root/reqData/reqform/subsCntrDetailForm", "/root/tempData/resTemp/detailInfo");		//상세정보
				childValueCopy("/root/reqData/reqform/subsCntrDetailForm", "/root/tempData/resTemp/detailInfoEx");	//상세정보 조정.
				
				//매체명
				model.copyNode("/root/initData/comboSet/medicdCombo", "/root/tempData/resTemp/medicdCombo");
				//무료구분
				model.copyNode("/root/initData/comboSet/freeclsfCombo", "/root/tempData/resTemp/freeclsfCombo");
				//확장유형
				model.copyNode("/root/initData/comboSet/rdrExtntypecdCombo", "/root/tempData/resTemp/rdrExtntypecdCombo");
				
				group3.refresh();
				model.removenode("/root/tempData/resTemp");
				
				//화면조정.
				combo3.disabled = false;
				if(model.getValue("/root/reqData/reqform/subsCntrDetailForm/freeyn") == "Y")
				{
					input7.disabled = true;
					input11.disabled = true;
					combo3.disabled = true;
				}
				
				setListRow();
				rdrExtnModify("U");
				setDscnamt();
			}
			
			function insert()
			{
				if(!commValidate(group3))
					return;
				if(!validateDetail())
					return;
				
				var extntypecd = model.getValue("/root/reqData/reqform/subsCntrDetailForm/rdr_extntypecd");
				if(extntypecd != "30" && extntypecd != "40" && extntypecd != "80")
				{
					model.alert("확장유형은 지국자체확장,자진신청,캠페확장만 선택가능합니다.");
					if(!combo2.disabled)		//rdr_extntypecd_2
						model.setFocus("combo2");
					return;
				}
				
				model.setValue("/root/reqData/reqform/subsCntrDetailForm/accflag", "I");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/medicd", "/root/reqData/reqform/subsCntrDetailForm/new_medicd");	//상세조회후 등록처리시 신규매체코드 => 기존매체코드에 할당.
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_no", "/root/initData/postData/subsAccessForm/rdr_no");
				model.setValue("/root/reqData/reqform/subsCntrDetailForm/aplcpathcd", "20");		//신청경로코드(20:지국)
				
				//실제 저장은 되지 않으므로 일단 form을 그대로 전송.
				//저장 기능 정상 처리시에는 makeNodesetToArrayForm 을 이용하여 disabled된 컨트롤을 제외하여 전송할 것.
				model.send("PID1180subInsert", false);
			}
			
			function update()
			{
				if(trim(model.getValue("/root/reqData/reqform/subsCntrDetailForm/cntrno")) == "")
				{
					model.alert("수정 하시려면 특정 목록을 선택하세요");
					return;
				}
				
				if(!commValidate(group3))
					return;
				if(!validateDetail())
					return;
					
				model.setValue("/root/reqData/reqform/subsCntrDetailForm/accflag", "U");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_no", "/root/initData/postData/subsAccessForm/rdr_no");
				
				//실제 저장은 되지 않으므로 일단 form을 그대로 전송.
				//저장 기능 정상 처리시에는 makeNodesetToArrayForm 을 이용하여 disabled된 컨트롤을 제외하여 전송할 것.
				model.send("PID1180subUpdate", false);
			}
			
			function validateDetail()
			{
				//등록. 수정이 모두 servlet에 막혀 있으므로 검증 구현 하지 않음.
				//필요시 기존 sl_reader_1180_p.jsp validate_etc 참조
				return true;
			}
			
			function setSubsuprc()
			{
				input3.value = model.getValue("/root/initData/comboSet/medicdCombo/item[" + (combo1.focusIndex+1) + "]/subsuprc");
				if(input3.value == "0")
				{
					radio1.select(1);		//freeyn
					combo2.value = "40";		//rdr_extntypecd_2
					input6.disabled = true;	//valmm
					input4.disabled = true;	//extnnm
					combo3.select(2);		//freeclsf
					setDscnamt("S");
				}
				else
				{
					radio1.select(0);
					combo2.value = "30";
					input6.disabled = false;
					input4.disabled = false;
					combo3.select(0);
					setDscnamt("S");
				}
				rdrExtnModify("I");
			}
			
			function setDscnamt(flag)
			{
				if(radio1.value == "Y")
				{
					input6.disabled = true;	//valmm
					input3.disabled = true;	//subsuprc
					input7.disabled = true;	//dscnamt
					input11.disabled = true;	//post_dlvfee
					combo3.disabled = true;	//freeclsf
					input4.disabled = true;	//extnnm
				}
				else
				{
					input6.disabled = false;	//valmm
					input3.disabled = false;	//subsuprc
					input7.disabled = false;	//dscnamt
					input11.disabled = false;	//post_dlvfee
					combo3.disabled = false;	//freeclsf
					input4.disabled = false;	//extnnm
					if(flag != "S")
						input3.value = model.getValue("/root/initData/comboSet/medicdCombo/item[" + (combo1.focusIndex+1) + "]/subsuprc");
				}
			}
			
			function controlRdrExtn(disable)
			{
				button6.disabled = disable;
				input4.disabled = disable;
				for(var i=1; i<=16; i++)
					eval("PID1180inputExtnHidden" + (i<10 ? "0" : "") + i + ".disabled=" + disable);
			}
		
			// 확장자명 변경에 따른 ""초기화
			function clearRdrExtnInfo()
			{
				if(trim(input4.value) == "")	//extnnm
				{
					//빈 node를 이용하여 rdrDetailForm의 확장자 영역만 clear 함.
					clearChildNodes("/root/reqData/reqform/rdrExtnClearForm");
					childValueCopy("/root/reqData/reqform/subsCntrDetailForm", "/root/reqData/reqform/rdrExtnClearForm");
				}
			}
			
			// 확장유형의 변화에 따른 확장자 정보 항목과 검색 버튼 disabled 상태 조정
			function rdrExtnModify(flag)
			{
				if(flag == "I")
				{
					if(combo2.value != "30" && combo2.value != "40" && combo2.value != "80")		//rdr_extntypecd_2
					{
						model.alert("확장유형은 지국자체확장,자진신청,캠페확장만 선택가능합니다.");
						combo2.value = "30";
						if(!combo2.disabled)
							model.setFocus("combo2");
					}
				}
				
				if(flag == "U" && combo2.value != "30" && combo2.value != "40" && combo2.value != "80")
				{
					controlRdrExtn(true);
				}
				else if(combo2.value == "40" || combo2.value == "80")	//자진신청일 경우
				{
					//확장영역 데이터 clear 부분 주석 처리됨.
					controlRdrExtn(true);
				}
				else
				{
					controlRdrExtn(false);
				}
				
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_extntypecd", "/root/reqData/reqform/subsCntrDetailForm/rdr_extntypecd_2");
			}
			
			// 확장자 검색(enter key에 의한). modal pup
			function rdrExtnEnterSearch()
			{
				var extnnm = input4.value;
				//확장자 고유번호 패턴이 아니라면
				if(!validate_stafno(extnnm))
				{
					model.setValue("/root/reqData/reqform/rdrExtnSearchForm/stafno", "");
					model.setValue("/root/reqData/reqform/rdrExtnSearchForm/name", extnnm);
				}
				else
				{
					model.setValue("/root/reqData/reqform/rdrExtnSearchForm/stafno", extnnm);
					model.setValue("/root/reqData/reqform/rdrExtnSearchForm/name", "");
				}
				modelCopyValue("/root/reqData/reqform/rdrExtnSearchForm/bocd", "/root/initData/defaultData/bocd");
				model.setValue("/root/reqData/reqform/rdrExtnSearchForm/extntypecd", "30");		//확장유형(품앗이확장 : 20, 지국자체확장 : 30 ..)
				model.setValue("/root/reqData/reqform/rdrExtnSearchForm/extnblngcd", "");
				model.setValue("/root/reqData/reqform/rdrExtnSearchForm/prn", "");
				model.setValue("/root/reqData/reqform/rdrExtnSearchForm/pageno", "1");
				model.setValue("/root/reqData/reqform/rdrExtnSearchForm/pagesize", "5000");		//10 -> 5000
				
				searchRdrExtn("/root/reqData/reqform/rdrExtnSearchForm", "/root/tempData/resTemp/extnData");
				
				if(instance1.selectNodes("/root/tempData/resTemp/extnData/record/stafno").length == 1)
					rdrExtnEnterSearchResult();
				else
					rdrExtnSearch();
			}
			
			// 확장자 검색(엔터키에 의한 검색 후 ) hidden iframe의 form에 세팅된 값을 부모화면에 셋팅
			function rdrExtnEnterSearchResult()
			{
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_extntypecd", 	"/root/tempData/resTemp/extnData/record/extntypecd");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnblngcd", 	"/root/tempData/resTemp/extnData/record/extnblngcd");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/stafclsfcd", 		"/root/tempData/resTemp/extnData/record/stafclsfcd");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/stafno", 		"/root/tempData/resTemp/extnData/record/stafno");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_extnbocd", 	"/root/tempData/resTemp/extnData/record/bocd");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/boemp_no", 		"/root/tempData/resTemp/extnData/record/boemp_no");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/bodutycd", 		"/root/tempData/resTemp/extnData/record/dutycd");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/bodutynm", 		"/root/tempData/resTemp/extnData/record/dutynm");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnprn", 		"/root/tempData/resTemp/extnData/record/prn");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnflnm", 		"/root/tempData/resTemp/extnData/record/nm");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnnm", 		"/root/tempData/resTemp/extnData/record/nm");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extntel1", 		"/root/tempData/resTemp/extnData/record/tel_no1");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extntel2", 		"/root/tempData/resTemp/extnData/record/tel_no2");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extntel3", 		"/root/tempData/resTemp/extnData/record/tel_no3");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnptph_no1", 	"/root/tempData/resTemp/extnData/record/ptph_no1");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnptph_no2", 	"/root/tempData/resTemp/extnData/record/ptph_no2");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnptph_no3", 	"/root/tempData/resTemp/extnData/record/ptph_no3");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/extnemail", 		"/root/tempData/resTemp/extnData/record/email");
				
				model.removenode("/root/tempData/resTemp");
				group3.refresh();
			}
			
			// 확장자 검색(팝업)
			function rdrExtnSearch()
			{
				var extnnm = input4.value;	//extnnm
				if(!validate_stafno(extnnm))
				{
					model.setValue("/root/reqData/reqform/rdrExtnPopupForm/stafno", "");
					model.setValue("/root/reqData/reqform/rdrExtnPopupForm/name", extnnm);
				}
				else
				{
					model.setValue("/root/reqData/reqform/rdrExtnPopupForm/stafno", extnnm);
					model.setValue("/root/reqData/reqform/rdrExtnPopupForm/name", "");
				}
				model.setValue("/root/reqData/reqform/rdrExtnPopupForm/extntypecd", "30");
				model.setValue("/root/reqData/reqform/rdrExtnPopupForm/extnblngcd", "");
				
				var ref = "/root/reqData/reqform/rdrExtnPopupForm";
				var res = "/root/tempData/resTemp/extnData/record";
				
				openRdrExtn(ref, res);
				
				if(instance1.selectNodes("/root/tempData/resTemp/extnData/record/stafno").length != 0)
					rdrExtnEnterSearchResult();
			}
			
			// 판촉물 코드명 변경에 의한 초기화
			function clearBnsItem()
			{
				if(trim(input5.value)=="")	//bns_itemnm
					model.setValue("/root/reqData/reqform/subsCntrDetailForm/bns_itemcd", "");
			}
			
			// 판촉물 코드 검색(엔터키에 의한 검색)
			function bnsItemcdEnterSearch(pageno)
			{
				if(event.keyCode != 13)
					return;
				if(trim(input5.value) == "")
				{
					if(model.getValue("/root/reqData/reqform/subsCntrDetailForm/accflag") == "U")
						model.setFocus("button2");	//수정
					else
						model.setFocus("button1");	//등록
					return;
				}
				
				var bnsItemnmVal = input5.value;
				//판촉물 코드 패턴이면 코드로 검색 , 그렇지 않으면 판촉물명으로 검색
				if(!validate_bns_itemcd(bnsItemnmVal))
				{
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemcd", "");
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemnm", bnsItemnmVal);
				}
				else
				{
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemcd", bnsItemnmVal);
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemnm", "");
				}
				model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/pageno", pageno);
				model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/pagesize", "5000");	//10->5000
				
				searchBnsItem("/root/reqData/reqform/bnsItemcdSearchForm", "/root/tempData/resTemp/bnsitemData");
				
				if(instance1.selectNodes("/root/tempData/resTemp/bnsitemData/record/bns_itemcd").length == 1)
					bnsItemcdEnterSearchResult();
				else
					bnsItemcdSearch();
			}
			
			// 판촉물 검색(엔터키에 의한 검색) 후 hidden iframe에 셋팅된 결과값을 부모화면에 셋팅
			function bnsItemcdEnterSearchResult()
			{
				model.setValue("/root/reqData/reqform/subsCntrDetailForm/bns_itemcd", "/root/tempData/resTemp/bnsitemData/record/bns_itemcd");
				model.setValue("/root/reqData/reqform/subsCntrDetailForm/bns_itemnm", "/root/tempData/resTemp/bnsitemData/record/bns_itemnm");
				
				model.removenode("/root/tempData/resTemp");
				input5.refresh();
			}
			
			// 판촉물 코드 검색(팝업)
			function bnsItemcdSearch()
			{
				var bnsItemnmVal = input5.value;
				//판촉물 코드 패턴이면 코드로 검색 , 그렇지 않으면 판촉물명으로 검색
				if(!validate_bns_itemcd(bnsItemnmVal))
				{
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemcd", "");
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemnm", bnsItemnmVal);
				}
				else
				{
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemcd", bnsItemnmVal);
					model.setValue("/root/reqData/reqform/bnsItemcdSearchForm/bns_itemnm", "");
				}
				
				var ref = "/root/reqData/reqform/bnsItemcdSearchForm";
				var res = "/root/tempData/resTemp/bnsitemData/record";
				
				openBnsItem(ref, res);
				
				if(instance1.selectNodes("/root/tempData/resTemp/bnsitemData/record/bns_itemcd").length != 0)
					bnsItemcdEnterSearchResult();
			}
			
			function bnsItemPayHis()
			{
				//사용하는 곳 없음.
			}
			
			//상세영역에 해당하는 항목을 list에서 select함.
			function setListRow()
			{
				var key = model.getValue("/root/reqData/reqform/subsCntrDetailForm/cntrno") + model.getValue("/root/reqData/reqform/subsCntrDetailForm/mangno");
				for(var i=datagrid1.fixedRows; i<datagrid1.rows; i++)
					if(gridRefColValue(datagrid1, i, "key") == key)
						datagrid1.row = i;
			}
			
			//상세영역 초기화
			function setDefault()
			{
				clearChildNodes("/root/reqData/reqform/subsCntrDetailForm");
				
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/rdr_extndt", "/root/initData/defaultData/today");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/subsfr_dt", "/root/initData/defaultData/today");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/valmm", "/root/initData/defaultData/valmm");
				modelCopyValue("/root/reqData/reqform/subsCntrDetailForm/subsuprc", "/root/initData/defaultData/subsuprc");
				//매체명
				model.copyNode("/root/initData/comboSet/medicdCombo", "/root/initData/defaultData/medicdCombo");
				//무료구분
				model.copyNode("/root/initData/comboSet/freeclsfCombo", "/root/initData/defaultData/freeclsfCombo");
				//확장유형
				model.copyNode("/root/initData/comboSet/rdrExtntypecdCombo", "/root/initData/defaultData/rdrExtntypecdCombo");
				//화면조정.
				setSelectDefault("combo1", null, 0);
				setSelectDefault("combo3", "", 0);
				setSelectDefault("combo2", "30", 0);
				group3.refresh();
				
				disableChildControl(group3, false, true);
				combo3.disabled = true;
			}
			
			//return value setting.		
			function setRdrNo()
			{
				var resPath = model.property("SUBSACCESS_RES_XPATH");

				opener.model.removenode(resPath);
				opener.model.makeNode(resPath + "/rdr_no");
				opener.model.setValue(resPath + "/rdr_no", model.getValue("/root/initData/postData/subsAccessForm/rdr_no"));	//받은 rdr_no를 그대로 돌려줌.
			}
			
			function close()
			{
				window.close();
			}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body pagewidth="800" pageheight="500" idprefix="PID1180" style="font-family:굴림; ">
		<group id="group1" style="left:10px; top:15px; width:780px; height:25px; ">
			<caption id="caption4" class="list_cap03" style="left:0px; top:0px; width:780px; height:25px; text-align:center; ">구독계약 추가/변경</caption>
		</group>
		<group id="group2" style="left:10px; top:465px; width:780px; height:25px; ">
			<caption id="caption1" class="list_cap03" style="left:0px; top:0px; width:780px; height:25px; text-align:center; "/>
			<button id="button1" class="btn_grid02" style="left:315px; top:4px; width:42px; height:17px; ">
				<caption>등록</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					insert();
					]]>
				</script>
			</button>
			<button id="button2" class="btn_grid02" style="left:359px; top:4px; width:42px; height:17px; ">
				<caption>수정</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					update();
					]]>
				</script>
			</button>
			<button id="button3" class="btn_grid02" style="left:403px; top:4px; width:42px; height:17px; ">
				<caption>닫기</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					close();		
					]]>
				</script>
			</button>
			<button id="button4" class="btn_grid03" style="left:447px; top:4px; width:53px; height:17px; ">
				<caption>초기화</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					setDefault();		
					]]>
				</script>
			</button>
		</group>
		<datagrid id="datagrid1" nodeset="/root/resData/gridData/listGrid/record" caption="매체명^확장일자^유가월^확장유형^확장자^부수^구독단가^할인금액^구독구분^무료구분^확장비용^판촉물" colsep="^" colwidth="75, 65, 50, 65, 65, 45, 60, 60, 60, 60, 60, 113" mergecellsfixedrows="bycolrec" rowsep="|" style="left:10px; top:70px; width:780px; height:215px; ">
			<col ref="medinm" style="text-align:left; "/>
			<col ref="rdr_extndt" format="yyyy/mm/dd" style="text-align:left; "/>
			<col ref="valmm" format="yyyy/mm" style="text-align:left; "/>
			<col ref="rdr_extntype" style="text-align:left; "/>
			<col ref="extnnm" style="text-align:left; "/>
			<col ref="subsqty" style="text-align:right; "/>
			<col ref="subsuprc" format="#,###" style="text-align:right; "/>
			<col ref="dscnamt" format="#,###" style="text-align:right; "/>
			<col ref="freeyn_f"/>
			<col ref="freeclsf" style="text-align:left; "/>
			<col ref="rdr_extncost" format="#,###" style="text-align:right; "/>
			<col ref="bns_itemnm" style="text-align:left; "/>
			<col ref="rdr_no" visibility="hidden"/>
			<col ref="medicd" visibility="hidden"/>
			<col ref="cntrno" visibility="hidden"/>
			<col ref="mangno" visibility="hidden"/>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
				if(checkNotFixedCell(datagrid1))
					detailSearch()
				]]>
			</script>
		</datagrid>
		<group id="group3" style="left:10px; top:290px; width:780px; height:167px; ">
			<!-- 확장자 영역의 disabled 조정을 유효하게 만들기 위해 hidden input control을 설정하여 확장자 정보를 매핑해 놓는다. -->
			<input id="PID1180inputExtnHidden01" ref="/root/reqData/reqform/subsCntrDetailForm/extnblngcd" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden02" ref="/root/reqData/reqform/subsCntrDetailForm/stafclsfcd" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden03" ref="/root/reqData/reqform/subsCntrDetailForm/stafno" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden04" ref="/root/reqData/reqform/subsCntrDetailForm/rdr_extnbocd" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden05" ref="/root/reqData/reqform/subsCntrDetailForm/boemp_no" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden06" ref="/root/reqData/reqform/subsCntrDetailForm/bodutycd" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden07" ref="/root/reqData/reqform/subsCntrDetailForm/bodutynm" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden08" ref="/root/reqData/reqform/subsCntrDetailForm/extnprn" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden09" ref="/root/reqData/reqform/subsCntrDetailForm/extnflnm" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden10" ref="/root/reqData/reqform/subsCntrDetailForm/extntel1" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden11" ref="/root/reqData/reqform/subsCntrDetailForm/extntel2" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden12" ref="/root/reqData/reqform/subsCntrDetailForm/extntel3" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden13" ref="/root/reqData/reqform/subsCntrDetailForm/extnptph_no1" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden14" ref="/root/reqData/reqform/subsCntrDetailForm/extnptph_no2" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden15" ref="/root/reqData/reqform/subsCntrDetailForm/extnptph_no3" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<input id="PID1180inputExtnHidden16" ref="/root/reqData/reqform/subsCntrDetailForm/extnemail" visibility="hidden" style="left:0px; top:0px; width:70px; height:18px; "/>
			<!-- 확장자 영역 끝 -->
			<caption id="caption2" class="list_cap03" style="left:0px; top:0px; width:60px; height:25px; text-align:left; ">매체명</caption>
			<caption id="caption5" class="list_cap02" style="left:59px; top:0px; width:100px; height:25px; text-align:left; "/>
			<caption id="caption6" class="list_cap03" style="left:158px; top:0px; width:60px; height:25px; text-align:left; ">확장일자</caption>
			<caption id="caption7" class="list_cap02" style="left:217px; top:0px; width:100px; height:25px; text-align:left; "/>
			<caption id="caption8" class="list_cap03" style="left:316px; top:0px; width:60px; height:25px; text-align:left; ">유가년월</caption>
			<caption id="caption9" class="list_cap02" style="left:375px; top:0px; width:90px; height:25px; text-align:left; "/>
			<caption id="caption10" class="list_cap03" style="left:464px; top:0px; width:60px; height:25px; text-align:left; ">구독일자</caption>
			<caption id="caption11" class="list_cap02" style="left:523px; top:0px; width:90px; height:25px; text-align:left; "/>
			<caption id="caption12" class="list_cap03" style="left:612px; top:0px; width:60px; height:25px; text-align:left; ">구독구분</caption>
			<caption id="caption13" class="list_cap02" style="left:671px; top:0px; width:109px; height:25px; text-align:left; "/>
			<caption id="caption14" class="list_cap03" style="left:464px; top:24px; width:60px; height:25px; text-align:left; ">우송료</caption>
			<caption id="caption15" class="list_cap02" style="left:523px; top:24px; width:90px; height:25px; text-align:left; "/>
			<caption id="caption16" class="list_cap03" style="left:0px; top:24px; width:60px; height:25px; text-align:left; ">부수</caption>
			<caption id="caption17" class="list_cap03" style="left:612px; top:24px; width:60px; height:25px; text-align:left; ">무료구분</caption>
			<caption id="caption18" class="list_cap02" style="left:671px; top:24px; width:109px; height:25px; text-align:left; "/>
			<caption id="caption19" class="list_cap02" style="left:59px; top:24px; width:100px; height:25px; text-align:left; "/>
			<caption id="caption20" class="list_cap03" style="left:158px; top:24px; width:60px; height:25px; text-align:left; ">구독단가</caption>
			<caption id="caption21" class="list_cap02" style="left:217px; top:24px; width:100px; height:25px; text-align:left; "/>
			<caption id="caption22" class="list_cap03" style="left:316px; top:24px; width:60px; height:25px; text-align:left; ">할인금액</caption>
			<caption id="caption23" class="list_cap02" style="left:375px; top:24px; width:90px; height:25px; text-align:left; "/>
			<caption id="caption24" class="list_cap03" style="left:158px; top:48px; width:60px; height:50px; text-align:left; ">확장자</caption>
			<caption id="caption25" class="list_cap02" style="left:217px; top:48px; width:100px; height:50px; text-align:left; "/>
			<caption id="caption26" class="list_cap03" style="left:316px; top:48px; width:60px; height:50px; text-align:left; ">확장비용</caption>
			<caption id="caption27" class="list_cap02" style="left:375px; top:48px; width:90px; height:50px; text-align:left; "/>
			<caption id="caption28" class="list_cap03" style="left:464px; top:48px; width:60px; height:50px; text-align:left; ">판촉물</caption>
			<caption id="caption29" class="list_cap02" style="left:523px; top:48px; width:90px; height:50px; text-align:left; "/>
			<caption id="caption30" class="list_cap03" style="left:0px; top:48px; width:60px; height:50px; text-align:left; ">확장유형</caption>
			<caption id="caption31" class="list_cap03" style="left:612px; top:48px; width:60px; height:50px; text-align:left; ">입력일자</caption>
			<caption id="caption32" class="list_cap02" style="left:671px; top:48px; width:109px; height:50px; text-align:left; "/>
			<caption id="caption33" class="list_cap02" style="left:59px; top:48px; width:100px; height:50px; text-align:left; "/>
			<caption id="caption34" class="list_cap03" style="left:0px; top:97px; width:60px; height:70px; text-align:left; ">비고</caption>
			<caption id="caption35" class="list_cap02" style="left:59px; top:97px; width:721px; height:70px; text-align:left; "/>
			<select1 id="combo1" ref="/root/reqData/reqform/subsCntrDetailForm/new_medicd" class="req" appearance="minimal" caption="매체명" style="left:63px; top:4px; width:90px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/medicdCombo/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					setSubsuprc();
					]]>
				</script>
			</select1>
			<select1 id="combo2" ref="/root/reqData/reqform/subsCntrDetailForm/rdr_extntypecd_2" appearance="minimal" caption="확장유형" style="left:64px; top:64px; width:90px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/rdrExtntypecdCombo/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					rdrExtnModify("I");
					]]>
				</script>
			</select1>
			<input id="input1" ref="/root/reqData/reqform/subsCntrDetailForm/subsqty" class="req" maxlength="3" dataType="number" caption="부수" minValue="1" style="left:63px; top:28px; width:90px; height:18px; text-align:right; "/>
			<textarea id="textarea1" ref="/root/reqData/reqform/subsCntrDetailForm/remk" imemode="hangul" caption="비고" style="left:63px; top:101px; width:712px; height:60px; text-align:left; vertical-align:top; "/>
			<input id="input2" ref="/root/reqData/reqform/subsCntrDetailForm/rdr_extndt" class="req" maxlength="8" format="yyyy/mm/dd" dataType="date" caption="확장일자" style="left:221px; top:4px; width:90px; height:18px; ">
				<hint>
					<![CDATA[확장일자를 수정은 지국에서 등록한 계약건에 한해서 마감전 까지만 가능합니다.]]>
				</hint>
			</input>
			<input id="input3" ref="/root/reqData/reqform/subsCntrDetailForm/subsuprc" class="req" editable="false" maxlength="12" format="#,###" dataType="number" caption="구독단가" style="left:221px; top:28px; width:90px; height:18px; text-align:right; "/>
			<input id="input4" ref="/root/reqData/reqform/subsCntrDetailForm/extnnm" caption="확장자" style="left:221px; top:52px; width:90px; height:18px; ">
				<script type="javascript" ev:event="onkeydown">
					<![CDATA[
					if(event.keyCode == 13)
					{
						model.setFocus("button6");
						rdrExtnEnterSearch();
					}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					clearRdrExtnInfo();
					]]>
				</script>
			</input>
			<button id="button6" class="btn_grid02" style="left:221px; top:74px; width:42px; height:17px; ">
				<caption>검색</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					rdrExtnSearch();
					]]>
				</script>
			</button>
			<button id="button7" class="btn_grid02" style="left:528px; top:74px; width:42px; height:17px; ">
				<caption>검색</caption>
			</button>
			<input id="input5" ref="/root/reqData/reqform/subsCntrDetailForm/bns_itemnm" autonext="false" caption="판촉물명" style="left:528px; top:52px; width:80px; height:18px; ">
				<script type="javascript" ev:event="onkeydown">
					<![CDATA[
					if(event.keyCode == 13)
					{
						model.setFocus("PID1700button8");
						bnsItemcdEnterSearch(1);
					}
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					clearBnsItem();
					]]>
				</script>
			</input>
			<input id="input6" ref="/root/reqData/reqform/subsCntrDetailForm/valmm" class="req" maxlength="6" format="yyyy/mm" dataType="month" caption="유가년월" style="left:379px; top:4px; width:80px; height:18px; "/>
			<input id="input7" ref="/root/reqData/reqform/subsCntrDetailForm/dscnamt" maxlength="7" format="#,###" dataType="number" caption="할인금액" style="left:379px; top:28px; width:80px; height:18px; text-align:right; "/>
			<input id="input8" ref="/root/reqData/reqform/subsCntrDetailForm/rdr_extncost" maxlength="7" format="#,###" dataType="number" caption="확장비용" style="left:379px; top:65px; width:80px; height:18px; text-align:right; "/>
			<select1 id="combo3" ref="/root/reqData/reqform/subsCntrDetailForm/freeclsf" disabled="true" appearance="minimal" caption="무료구분" style="left:675px; top:28px; width:90px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/freeclsfCombo/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
			</select1>
			<input id="input9" ref="/root/reqData/reqform/subsCntrDetailForm/incmgdt" editable="false" imemode="disabled" format="yyyy/mm/dd" caption="입력일자" style="left:675px; top:64px; width:100px; height:18px; "/>
			<input id="input10" ref="/root/reqData/reqform/subsCntrDetailForm/subsfr_dt" class="req" maxlength="8" format="yyyy/mm/dd" dataType="date" caption="구독일자" style="left:528px; top:4px; width:80px; height:18px; "/>
			<input id="input11" ref="/root/reqData/reqform/subsCntrDetailForm/post_dlvfee" maxlength="6" format="#,###" dataType="number" caption="우송료" style="left:528px; top:28px; width:60px; height:18px; text-align:right; "/>
			<select1 id="radio1" ref="/root/reqData/reqform/subsCntrDetailForm/freeyn" appearance="full" cols="2" overflow="visible" style="left:677px; top:5px; width:90px; height:18px; border-style:none; ">
				<choices>
					<item>
						<label>유료</label>
						<value>N</value>
					</item>
					<item>
						<label>무료</label>
						<value>Y</value>
					</item>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					setDscnamt("S");
					]]>
				</script>
			</select1>
		</group>
		<group id="PID1180group_btnT" class="gro_tab" style="left:10px; top:45px; width:780px; height:25px; ">
			<caption id="PID1700caption37" class="tabline" style="left:0px; top:22px; width:780px; height:1px; "/>
			<!--button id="PID1700btnT1" class="tab05" group="tab" selected="true" style="left:1px; top:0px; width:92px; height:23px; ">
				<caption>case1</caption>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
						model.toggle("case1");
						model.refresh();
					]]>
				</script>
			</button-->
		</group>
	</xhtml:body>
</xhtml:html>
