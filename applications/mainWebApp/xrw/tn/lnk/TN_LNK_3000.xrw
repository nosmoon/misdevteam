<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet type="text/css" href="../../../css/style_sheet.css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:my="http://www.comsquare.co.kr/example" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>Untitle</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<session/>
						<comboSet>
							<!-- 선택계열(콤보박스,체크박스,리스트박스,라디오버튼)의 정보 -->
							<dataSet>
								<pymtmmlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</pymtmmlist>
								<supportlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</supportlist>
								<resultlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</resultlist>
							</dataSet>
						</comboSet>
						<pageInfo/>
						<hndl_nm/>
						<makefiledt/>
					</initData>
					<reqData>
						<fwdData/>
						<searchData>
							<cmpy_cd/>
							<pymt_yymm>201606</pymt_yymm>
							<pymt_day/>
							<frdt/>
							<todt/>
							<dt_clsf>00</dt_clsf>
							<proc_clsf/>
						</searchData>
						<reqForm>
						</reqForm>
						<searchDetail>
							<cmpy_cd/>
							<cmsidx/>
							<deptidx/>
							<pymtmm/>
							<pymtdd/>
							<supp_clsf/>
							<result_stat>00</result_stat>
							<search_clsf/>
							<search_nm/>
							<flag/>
							<status/>
						</searchDetail>
						<fileData>
							<cmpy_cd/>
							<file_clsf/>
							<pymtdd/>
							<multiUpdateData/>
						</fileData>
						<cancelForm>
							<cmpy_cd/>
							<cmsidx/>
						</cancelForm>
						<sendCompleteData>
							<cmpy_cd/>
							<multiUpdateData/>
						</sendCompleteData>
						<resultData>
							<cmpy_cd/>
							<filenm/>
							<multiUpdateData/>
						</resultData>
						<configForm/>
						<confirmForm>
							<cmsidx/>
						</confirmForm>
						<eb22File>
							<record>
								<filedata/>
								<tmp_info/>
							</record>
						</eb22File>
					</reqData>
					<resData>
						<resForm>
							<tot_cnt/>
						</resForm>
						<gridHeader>
							<record>
								<pymtmm/>
								<pymtdd/>
								<requestdate/>
								<paydate/>
								<request_file/>
								<result_file/>
								<okcount/>
								<errorcount/>
								<okprice/>
								<errorprice/>
								<fee/>
								<stat1/>
								<stat2/>
								<stat3/>
								<stat4/>
								<cmsidx/>
								<deptidx/>
							</record>
						</gridHeader>
						<gridDetail>
							<record>
								<chk/>
								<pymtmm/>
								<pymtdd/>
								<support/>
								<memb_cd/>
								<memb_nm/>
								<pymt_cd/>
								<bankaccountowner/>
								<banknm/>
								<bankaccount/>
								<reqprice/>
								<payprice/>
								<result_stat/>
								<paymentcode/>
								<isdelete/>
								<memberidx/>
								<promiseidx/>
								<cmspaymentidx/>
								<cmsidx/>
							</record>
						</gridDetail>
						<totData>
							<totcount/>
							<totprice/>
							<okcount/>
							<okprice/>
							<errorcount/>
							<errorprice/>
							<fee/>
						</totData>
						<makefile_data>
							<record>
								<file_data/>
							</record>
							<cmsidx/>
							<totalcnt/>
						</makefile_data>
						<send_filelist_data>
							<record>
								<cmsidx/>
								<deptidx/>
								<filename/>
								<filepath/>
							</record>
							<totalcnt/>
						</send_filelist_data>
						<result_data>
							<record>
								<record_clsf/>
								<seq/>
								<organcode/>
								<bankcode/>
								<bankaccount/>
								<payprice/>
								<bankaccountidentity/>
								<ret_clsf/>
								<ret_cd/>
								<desc/>
								<priceclsf/>
								<pymt_cd/>
								<usespace/>
								<paytype/>
								<telno/>
								<infodata/>
							</record>
							<totalcnt/>
						</result_data>
						<receive_filelist_data>
							<record>
								<filename/>
							</record>
							<totalcnt/>
						</receive_filelist_data>
					</resData>
					<tempData>
						<keyData/>
						<tempHeader>
							<record>
								<pymtmm/>
								<pymtdd/>
								<requestdate/>
								<paydate/>
								<request_file/>
								<result_file/>
								<okcount/>
								<errorcount/>
								<okprice/>
								<errorprice/>
								<fee/>
								<stat1/>
								<stat2/>
								<stat3/>
								<stat4/>
								<cmsidx/>
								<deptidx/>
							</record>
						</tempHeader>
						<tempDetail>
							<record>
								<chk/>
								<pymtmm/>
								<pymtdd/>
								<support/>
								<memb_cd/>
								<memb_nm/>
								<pymt_cd/>
								<bankaccountowner/>
								<banknm/>
								<bankaccount/>
								<reqprice/>
								<payprice/>
								<result_stat/>
								<paymentcode/>
								<isdelete/>
								<memberidx/>
								<promiseidx/>
								<cmspaymentidx/>
								<cmsidx/>
							</record>
						</tempDetail>
						<tmpfile_data>
							<record>
								<file_data/>
							</record>
							<totalcnt/>
						</tmpfile_data>
						<tempResult>
							<record>
								<record_clsf/>
								<seq/>
								<organcode/>
								<bankcode/>
								<bankaccount/>
								<payprice/>
								<bankaccountidentity/>
								<ret_clsf/>
								<ret_cd/>
								<desc/>
								<priceclsf/>
								<pymt_cd/>
								<usespace/>
								<paytype/>
								<telno/>
								<infodata/>
							</record>
							<totalcnt/>
						</tempResult>
						<tempTotData>
							<totcount/>
							<totprice/>
							<okcount/>
							<okprice/>
							<errorcount/>
							<errorprice/>
							<fee/>
						</tempTotData>
					</tempData>
					<msgData/>
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
				
				var currentdt = getCurrentDate();	
				var dt = currentdt ;	//현재일자 
		
				model.setValue("/root/reqData/searchData/frdt", dt.substring(0,6)+"01"); //등록fr일자
				model.setValue("/root/reqData/searchData/todt", dt); //등록to일자
				model.setValue("/root/initData/makefiledt", dt);	//파일지정일자

				//model.removenode("/root/configData/reqForm");
				set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
				model.send("tn_lnk_3000_m");

				combo1.select(0);	//지원단위
				combo2.select(1);	//출금월
				combo3.select(0);	//처리결과
				input2.disabled 	= true;	//출금의뢰일 기간검색 from
				input21.disabled 	= true; //출금의뢰일 기간검색 to
				datagrid2.fixedcellcheckbox(0, datagrid2.colRef("chk"), false) = true;
				datagrid2.colHidden(1) = true;
				datagrid2.clearStatus();

				searchConfig();

				model.refresh();

				]]>
			</script>
			<submission id="tn_lnk_2100_l" action="/tn/lnk/2100" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/configData"/>
			<submission id="tn_lnk_3000_m" action="/tn/lnk/3000" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/initData/comboSet"/>
			<submission id="tn_lnk_3010_l" action="/tn/lnk/3010" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridHeader"/>
			<submission id="tn_lnk_3020_l" action="/tn/lnk/3020" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/gridDetail"/>
			<submission id="tn_lnk_3030_l" action="/tn/lnk/3030" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/gridDetail"/>
			<submission id="tn_lnk_3035_a" action="/tn/lnk/3035" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/fileData" resultref="/root/resData/makefile_data"/>
			<submission id="tn_lnk_3040_a" action="/tn/lnk/3040" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/cancelForm" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_3051_l" action="/tn/lnk/3051" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/"/>
			<submission id="tn_lnk_3052_a" action="/tn/lnk/3052" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/sendCompleteData" resultref="/root/resData/"/>
			<submission id="tn_lnk_3065_a" action="/tn/lnk/3065" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/resultData" resultref="/root/resData/"/>
			<submission id="tn_lnk_3070_a" action="/tn/lnk/3070" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/confirmForm" resultref="/root/resData/"/>
			<submission id="tn_lnk_2071_a" action="/tn/lnk/2071" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/confirmForm" resultref="/root/resData/"/>
		</model>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript" src="/js/CIISComm.js"/>
		<script type="javascript" src="/js/fcmc_common.js"/>
		<script type="javascript">
			<![CDATA[
				
				//execute CMSPro
				function runCMSPro() {
					window.exec( "CLOGIN_PRG.exe", "", "C:\\Program Files\\CMSProV2" );
					window.exec( "CLOGIN_PRG.exe", "", "C:\\Program Files (x86)\\CMSProV2" );
					return;
				}
				

				function makeFile(){

					if (show_message("출금의뢰 파일을 생성하시겠습니까?"," 파일 생성", MB_YESNO) != IDYES) {
						return false;
					}					

					if( combo5.value == "" ) {
						alert("생성할 대상의 출금일자를 선택해 주세요");
						return;
					}
					
					model.copyNode("/root/resData/makefile_data/record","/root/tempData/tmpfile_data/record");
					model.copyNode("/root/resData/makefile_data/totalcnt","/root/tempData/tmpfile_data/totalcnt");
					model.refresh();

					progressBarStart();
					set_refvalue("/root/reqData/fileData/cmpy_cd", getProperty("ss_cmpycd"));
					model.setValue("/root/reqData/fileData/file_clsf", "1");
					model.setValue("/root/reqData/fileData/pymtdd", model.getValue("/root/initData/makefiledt") + combo5.value);
					model.setValue("/root/reqData/fileData/multiUpdateData", datagrid2.getUpdateData("update"));
					model.send("tn_lnk_3035_a");
					progressBarEnd();
					
					var totalcnt  = get_refvalue("/root/resData/makefile_data/totalcnt");
					if(totalcnt == 0){
						show_message("파일생성 대상이 존재하지 않습니다.");
						return false;
					}

					var fso = new ActiveXObject("Scripting.FileSystemObject");
					var organcode  = get_refvalue("/root/reqData/configForm/organcode");
					var filePath   = get_refvalue("/root/reqData/configForm/payfile_path");
					if( filePath == "" ) {
						filePath = "C:\\CMS\\" + organcode + "\\EB21\\";
					} else {
						if( filePath.substring( filePath.length-1 , filePath.length) != "\\" ) {
							filePath += "\\";
						}

						if( filePath.indexOf("EB21") < 0 ) {
							filePath += "EB21\\";
						}
					}

					if( !fso.FolderExists(filePath) ) {
						fso.CreateFolder(filePath);
					}
				
					var fileName = filePath + get_refvalue("/root/resData/makefile_data/record[1]/file_data").substring( 19, 27  );
					var files = window.fileDialog("save","",false, fileName, "", "All Files (*.*)|*.*");
					sFile_Name = files.TrimRight();

					if(sFile_Name == "" ) {
						//취소처리
						progressBarStart();
						set_refvalue("/root/reqData/cancelForm/cmpy_cd", getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/cancelForm/cmsidx",  model.getValue("/root/resData/makefile_data/cmsidx") );
						model.send("tn_lnk_3040_a");
						alert("취소되었습니다");
						model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
						model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
						model.refresh();
						button4.dispatch("onclick"); 						
						progressBarEnd();
						return;
					}


					sFile_Name = fileName;	
					//alert(sFile_Name);
					//return;
					if (sFile_Name != "") {						
						//var fso = new ActiveXObject("Scripting.FileSystemObject");
						BUFF = fso.CreateTextFile(sFile_Name, true);
					} else {
						return;
					}
					
					progressBarStart();
					
					try{
						var tmpbuf = "";
						
						//파일 쓰기작업 수행
						for(var i=1; i<=totalcnt; i++) {
							tmpbuf = get_refvalue("/root/resData/makefile_data/record["+i+"]/file_data");
							tmpbuf = tmpbuf.replace("]","");
							if( tmpbuf != "" ) {
								BUFF.Write( tmpbuf );
							}
						}
					}
					catch (ex) {
						show_message(ex + "\r파일 생성시 오류가 발생했습니다.");
					}
					finally {
						if(sFile_Name != ""){
							BUFF.Close();													
							progressBarEnd();
							show_message("파일 생성이 완료되었습니다.\n파일송신 후 반드시 [송신완료처리]를 진행해 주시기 바랍니다.");
							model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
							model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
							model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
							model.refresh();							
							button4.dispatch("onclick");
						}
					}	

				}
				
				function searchConfig() {
					model.removenode("/root/configData/reqForm");
					progressBarStart();
					set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
					model.send("tn_lnk_2100_l");
					model.copyNode("/root/reqData/configForm", "/root/configData/reqForm");	
					model.refresh();
					
					var fso = new ActiveXObject("Scripting.FileSystemObject");
					var cmspath = get_refvalue("/root/reqData/configForm/aplcfile_path");
					var strpath = cmspath.split("\\");
					var objpath = strpath[0];
					
					for(var i=1; i<strpath.length; i++) {
						objpath += "\\" + strpath[i];						
						if( !fso.FolderExists(objpath) ) {
							fso.CreateFolder(objpath);
						}						
					}
					
					if( !fso.FolderExists(objpath + "\\EB21") ) {
						fso.CreateFolder(objpath + "\\EB21");
					}
					if( !fso.FolderExists(objpath + "\\EB22") ) {
						fso.CreateFolder(objpath + "\\EB22");
					}
					
					progressBarEnd();
				}

				function fn_strlen(str) { 
				  var len = 0;
				  for(var i=0;i<str.length;i++) {
					len += (str.charCodeAt(i) > 128) ? 2 : 1;
				  }
				  return len;
				}

				function fn_subString(str,start,size) {
				  var lim = 0;
				  var pos = 0;
				  var beg = 0;
				  var minus = 0;
				  var len = fn_strlen(str);
				  
				// 시작위치까지 skip하는 로직 
				  for(var i=0;pos<start;i++) {
					pos += (str.charCodeAt(i) > 128) ? 2 : 1;
				  }
				  
				  beg = i;
				  
				  // 시작위치에서 길이만큼 잘라내는 로직
				  for (var i=beg; i<len; i++) {
					lim += (str.charCodeAt(i) > 128) ? 2 : 1;
					
					if (lim > size) { 
					  alert(str.substring(beg,i));
					  return str.substring(beg,i);  
					}
				  }
				}
				
				function changeGrid(){
					//진행상태 삭제가능할 시 파란색으로 
					//삭제버튼 만들기
					for(var i = datagrid1.fixedRows; i < datagrid1.rows; i++){
						var tmp1 = datagrid1.valueMatrix(i, datagrid1.colRef("stat4"));
						if( tmp1 == "완료처리" || tmp1 == "송신완료처리"  ){
							//datagrid1.rowStyle(i,"all","color")="#0000FF";	
							datagrid1.cellstyle("background-image", i, datagrid1.colRef("stat3")) = "../../../images/btn7_off.gif";
							datagrid1.cellstyle("cursor", i, datagrid1.colRef("stat3")) = "pointer";
							datagrid1.valueMatrix(i, datagrid1.colRef("stat3")) = tmp1;	//"완료처리";
						} else {
							//datagrid1.rowStyle(i,"all","color")="#000000";	
							datagrid1.cellstyle("background-image", i, datagrid1.colRef("stat3")) = "";
							datagrid1.cellstyle("cursor", i, datagrid1.colRef("stat3")) = "arrow";
							//datagrid1.valueMatrix(i, datagrid1.colRef("stat2")) = "완료";
						}
					}
				}

			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="1600" pageheight="900" guideline="1,10;1,1577;2,58;2,69;1,1560;" style="font-family:굴림; ">
		<caption id="caption12" class="list_cap02" style="left:10px; top:70px; width:1550px; height:28px; "/>
		<caption id="caption6" tyle="left:15px; top:180px; width:940px; height:0px;" style="left:0px; top:10px; width:0px; height:0px; ">caption6</caption>
		<import id="iv_Title" src="/common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:1550px; height:29px; "/>
		<button id="button4" class="btn02" crud="R" style="left:881px; top:40px; width:50px; height:21px; ">
			<caption>조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				if(validateReq()){
					progressBarStart();
					combo1.select(0);	//지원단위
					combo3.select(0);	//처리결과
					combo3.disabled = false;	//처리결과조건 해제
					caption29.value = "합계자료";
					set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
					model.send("tn_lnk_3010_l");
					model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
					model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
					model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
					model.refresh();
					progressBarEnd();
				
					changeGrid();

					if( check_submit_completed("조회가 완료 되었습니다.","") == true ) {						
					}
				}
				]]>
			</script>
		</button>
		<datagrid id="datagrid2" nodeset="/root/resData/gridDetail/record" caption="선택^청구월^출금일자^지원단위^회원번호^회원명^납부자번호^예금주^은행명^계좌번호^청구금액^출금금액^처리결과^납입번호^제외여부^memberidx^promiseidx^cmspaymentidx^cmsidx" colsep="##" colwidth="92, 73, 69, 133, 104, 125, 113, 141, 140, 150, 100, 100, 213, 130, 17, 14, 14, 16, 12" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" style="left:10px; top:347px; width:1600px; height:301px; ">
			<col checkvalue="Y,N" ref="chk" type="checkbox" visibility="hidden"/>
			<col ref="pymtmm" format="yyyy-mm"/>
			<col ref="pymtdd"/>
			<col ref="support"/>
			<col ref="memb_cd"/>
			<col ref="memb_nm" style="text-align:center; word-wrap:none; "/>
			<col ref="pymt_cd" style="text-align:center; word-wrap:none; "/>
			<col ref="bankaccountowner"/>
			<col ref="banknm"/>
			<col ref="bankaccount"/>
			<col ref="reqprice" format="#,###" style="text-align:right; "/>
			<col ref="payprice" format="#,###" style="text-align:right; "/>
			<col ref="result_stat" style="text-align:left; padding-left:2px; "/>
			<col ref="paymentcode"/>
			<col ref="isdelete" visibility="hidden"/>
			<col ref="memberidx" visibility="hidden"/>
			<col ref="promiseidx" visibility="hidden"/>
			<col ref="cmspaymentidx" visibility="hidden"/>
			<col ref="cmsidx" visibility="hidden"/>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					if( datagrid2.row < datagrid2.fixedRows )
					{
						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							datagrid2.addStatus(i, "update");
						}
					}
					else
					{
						datagrid2.addStatus(datagrid2.row, "update");
					}
				]]>
			</script>
			<script type="javascript" ev:event="xforms-deselect">
				<![CDATA[
					if( datagrid2.row < datagrid2.fixedRows )
					{
						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							datagrid2.removeStatus(i, "update");
						}
					}
					else
					{
						datagrid2.removeStatus(datagrid2.row, "update");		
					}
				]]>
			</script>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					var row = datagrid2.row;
					var col = datagrid2.col;
					
					if(row > 0){

						if(datagrid2.valueMatrix( row, datagrid2.colRef("memberidx")) != "" && datagrid2.valueMatrix( row, datagrid2.colRef("memb_nm") ) != "" ){
							var memb_idx  = datagrid2.valueMatrix(datagrid2.row,datagrid2.colRef("memberidx"));
							var memb_name = datagrid2.valueMatrix(datagrid2.row,datagrid2.colRef("memb_nm"));

				
							if(memb_idx != "" || memb_name != "" ) {
									model.property("TN_DNS_1000_memberidx")   = memb_idx;
									model.property("TN_DNS_1000_name")        = memb_name;
									model.property("TN_DNS_1000_popup_flag")  = "Y";
									viewer("mainFrame").window.javaScript.onLoadPopupPage("TN_DNS_1000");
							}else{
								alert("요청번호가 존재하지 않습니다.");
								return;
							}
						}					
					}
				]]>
			</script>
		</datagrid>
		<button id="btnClose" class="btn02" style="left:1000px; top:40px; width:50px; height:21px; ">
			<caption>종료</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				viewer("mainFrame").window.javaScript.closeMDIWindow(model.getValue("/root/initData/pageInfo/pageID"));
				
				]]>
			</script>
		</button>
		<button id="btn_exceldown" class="btn02" crud="R" style="left:941px; top:40px; width:50px; height:21px; ">
			<caption>EXCEL</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					if(datagrid2.rows <= 1 ) {
						alert("처리할 내역이 없습니다.");
						return;
					}

					if(datagrid2.valueMatrix( 2, 2 ) == "" ) {
						alert("처리할 내역이 없습니다.");
						return;
					}
					
					var filename = window.fileDialog("save", ",", false, "CMS출금내역상세", "xls", "Excel File(*.xls)|*.xls");
					if(filename!=""){						
						datagrid2.saveExcel(filename, "sheetname: CMS출금내역상세");						
					}
				]]>
			</script>
		</button>
		<datagrid id="datagrid1" nodeset="/root/resData/gridHeader/record" caption="출금월^출금일자(일)^출금의뢰일^결과처리일^EB21(출금의뢰)^EB22(청구결과)^출금건수^오류건수^출금금액^오류금액^수수료^처리진행상태^처리진행상태^처리진행상태^처리진행상태^c^d^s" colsep="^" colwidth="90, 90, 90, 90, 110, 110, 110, 110, 120, 120, 100, 130, 130, 130, 100, 56, 56, 100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" subtotalposition="below" style="left:10px; top:137px; width:1545px; height:133px; ">
			<col ref="pymtmm" format="yyyy-mm"/>
			<col ref="pymtdd"/>
			<col ref="requestdate"/>
			<col ref="paydate"/>
			<col ref="request_file"/>
			<col ref="result_file"/>
			<col ref="okcount" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="errorcount" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="okprice" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="errorprice" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="fee" format="#,###" style="color:#339966; text-align:right; "/>
			<col ref="stat1"/>
			<col ref="stat2"/>
			<col ref="stat3"/>
			<col ref="stat4" visibility="hidden"/>
			<col ref="cmsidx" visibility="hidden"/>
			<col ref="deptidx" visibility="hidden"/>
			<col ref="status" visibility="hidden"/>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					var row = datagrid1.row

					if(row > 0 && datagrid1.valueMatrix( row, 16 ) != ""){
						//alert( datagrid1.valueMatrix( row, 16 ) + " : " + datagrid1.valueMatrix( row, 1 ) + " : " + datagrid1.valueMatrix( row, 2 ) );
						//return;
						progressBarStart();
						model.setValue("/root/reqData/searchDetail/flag",  "0");	//상세조회 구분(0:일반, 1:출금의뢰대상)
						set_refvalue("/root/reqData/searchDetail/cmpy_cd",		getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/searchDetail/cmsidx",     	datagrid1.valueMatrix( row, 16 ));	//cmsidx
						model.setValue("/root/reqData/searchDetail/pymtmm", 	datagrid1.valueMatrix( row, 1 ));	//출금월
						model.setValue("/root/reqData/searchDetail/pymtdd",    	datagrid1.valueMatrix( row, 2 ));	//출금일자
						model.setValue("/root/reqData/searchDetail/supp_clsf",    "");  		//지원단위
						model.setValue("/root/reqData/searchDetail/result_stat",    "");		//처리결과
						model.setValue("/root/reqData/searchDetail/search_clsf",  "");		//상세검색조건
						model.setValue("/root/reqData/searchDetail/search_nm",  "");		//상세검색어
						model.setValue("/root/reqData/searchDetail/status", 	datagrid1.valueMatrix( row,18 ) );	//상태
						
						combo1.select(0);	//지원단위
						combo3.select(0);	//처리결과
						combo3.disabled = false;	//처리결과조건 해제
						model.removenode("/root/resData/totData");
						datagrid2.clearStatus();
						datagrid2.colHidden(1) = true;
						model.send("tn_lnk_3020_l");
						
						for(var i=1; i<datagrid2.rows; i++) {
							if( datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ).indexOf("불능") >= 0 ) {
								datagrid2.cellStyle( "color", i, datagrid2.colRef("result_stat"), i, datagrid2.colRef("result_stat") ) = "#ff0000";
							} else {
								datagrid2.cellStyle( "color", i, datagrid2.colRef("result_stat"), i, datagrid2.colRef("result_stat")  ) = "#000000";
							}
						}

						model.setValue("/root/reqData/cancelForm/cmsidx", datagrid1.valueMatrix( row, 16));	//취소용 cmsidx 초기화
						var pymtdt = datagrid1.valueMatrix( row, datagrid1.colRef("pymtmm") ) + datagrid1.valueMatrix( row, datagrid1.colRef("pymtdd") );
						caption29.value = pymtdt.substring(0,4) + "." + pymtdt.substring(4,6) + "." + pymtdt.substring(6,8) + "\n합계자료";
						progressBarEnd();
						
					} else {
						model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
						caption29.value = "합계자료";
					}
				]]>
			</script>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var row = datagrid1.row;
					var col = datagrid1.col;

					if(col == 14) {
						if(datagrid1.valueMatrix(row, col) == "완료처리") {
							
							if( commConfirmBox("출금결과(EB22)파일 업로드 없이 완료처리를 진행 하시겠습니까?") ) {
								progressBarStart();
								model.setValue("/root/reqData/confirmForm/cmsidx", datagrid1.valueMatrix( row, 16 ) );
								model.send("tn_lnk_3070_a");								

								if( check_submit_completed("정상처리 되었습니다.","") == true ) {
									model.refresh();
									progressBarEnd();
									button4.dispatch("onclick");									
								}
							}

						} else if(datagrid1.valueMatrix(row, col) == "송신완료처리") {
							
							if( commConfirmBox("송신완료처리를 진행하시겠습니까?\n송신완료처리 후에는 EB21생성취소를 할 수 없습니다.") ) {

								progressBarStart();								
								model.setValue("/root/reqData/confirmForm/cmsidx", datagrid1.valueMatrix( row, 16 ) );
								model.send("tn_lnk_2071_a");
								
								if( check_submit_completed("정상처리 되었습니다.","") == true ) {
									model.refresh();
									progressBarEnd();
									button4.dispatch("onclick");								
								}

							}
						
						}
						
					}
				]]>
			</script>
		</datagrid>
		<group id="group1" style="left:10px; top:300px; width:1550px; height:35px; ">
			<caption id="caption14" class="list_cap02" style="left:0px; top:0px; width:1550px; height:28px; "/>
			<button id="button2" class="btn03" crud="R" style="left:795px; top:5px; width:65px; height:21px; ">
				<caption>상세조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var row = datagrid2.rows;

					if( model.getValue("/root/reqData/searchDetail/cmsidx") == "" && model.getValue("/root/reqData/searchDetail/flag") == ""  ) return;

					progressBarStart();
					//if(row > 1 && datagrid2.valueMatrix( row-1, 2 ) != "" ){
						//model.setValue("/root/reqData/searchDetail/flag",  "0");	//상세조회 구분(0:일반, 1:출금의뢰대상)
						set_refvalue("/root/reqData/searchDetail/cmpy_cd",		getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/searchDetail/supp_clsf",    	combo1.value);  	//지원단위
						model.setValue("/root/reqData/searchDetail/result_stat",   	combo3.value);		//처리결과
						model.setValue("/root/reqData/searchDetail/search_clsf",	 	combo4.value);		//상세검색조건
						model.setValue("/root/reqData/searchDetail/search_nm",		 input5.value);		//세검색어
						model.removenode("/root/resData/totData");
						//datagrid2.clearStatus();
						//datagrid2.colHidden(1) = true;
						//model.send("tn_lnk_3020_l");	
						//model.removenode("/root/resData/totData");
						
						//상세조회 구분(0:일반, 1:승인의뢰대상)
						if( model.getValue("/root/reqData/searchDetail/flag") == "0" ) {
							model.send("tn_lnk_3020_l");	//일반 상세조회
						} else {
							model.send("tn_lnk_3030_l");	//승인의뢰대상 상세조회
						}
					//}
					
					
					for(var i=1; i<datagrid2.rows; i++) {
						if( datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ).indexOf("불능") >= 0 ) {
							datagrid2.cellStyle( "color", i, datagrid2.colRef("result_stat") , i, datagrid2.colRef("result_stat")  ) = "#ff0000";
						} else {
							datagrid2.cellStyle( "color", i, datagrid2.colRef("result_stat") , i, datagrid2.colRef("result_stat")  ) = "#000000";
						}
					}
					
					progressBarEnd();

				]]>
				</script>
			</button>
			<button id="button3" class="btn02" visibility="hidden" crud="R" style="left:869px; top:5px; width:50px; height:21px; ">
				<caption>UMS</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
				
				if(validateReq()){
					//model.send("tn_lnk_1010_l");
				}
				]]>
				</script>
			</button>
			<caption id="caption13" class="list_cap01" style="left:450px; top:0px; width:114px; height:28px; "/>
			<input id="input5" ref="/root/reqData/searchDetail/search_nm" navindex="5" style="left:570px; top:5px; width:140px; height:18px; "/>
			<caption id="caption4" class="list_cap01" style="left:0px; top:0px; width:80px; height:28px; ">지원단위</caption>
			<select1 id="combo1" ref="/root/reqData/searchDetail/supp_clsf" class="req" navindex="4" appearance="minimal" style="left:86px; top:5px; width:119px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/supportlist/record">
						<label ref="cdnm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</select1>
			<caption id="caption8" class="list_cap01" style="left:220px; top:0px; width:80px; height:28px; ">처리결과</caption>
			<select1 id="combo3" ref="/root/reqData/searchDetail/result_stat" class="req" navindex="4" appearance="minimal" style="left:311px; top:5px; width:119px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/resultlist/record">
						<label ref="cdnm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</select1>
			<select1 id="combo4" ref="/root/reqData/searchDetail/search_clsf" class="req" navindex="4" appearance="minimal" style="left:455px; top:5px; width:105px; height:18px; ">
				<choices>
					<item>
						<label>납부자명</label>
						<value>01</value>
					</item>
					<item>
						<label>납부자번호</label>
						<value>02</value>
					</item>
					<item>
						<label>회원명</label>
						<value>03</value>
					</item>
					<item>
						<label>회원번호</label>
						<value>04</value>
					</item>
				</choices>
			</select1>
		</group>
		<group id="group2" style="left:10px; top:665px; width:1105px; height:70px; ">
			<caption id="caption1" class="list_cap02" style="left:132px; top:32px; width:939px; height:28px; "/>
			<caption id="caption2" class="list_cap02" style="left:142px; top:5px; width:537px; height:28px; "/>
			<caption id="caption5" class="list_cap01" style="left:132px; top:5px; width:135px; height:28px; ">청구건수</caption>
			<caption id="caption7" class="list_cap01" style="left:266px; top:5px; width:135px; height:28px; ">청구금액</caption>
			<caption id="caption15" class="list_cap01" style="left:400px; top:5px; width:135px; height:28px; ">출금건수</caption>
			<caption id="caption16" class="list_cap01" style="left:534px; top:5px; width:135px; height:28px; ">출금금액</caption>
			<caption id="caption20" class="list_cap01" style="left:668px; top:5px; width:135px; height:28px; ">수수료</caption>
			<caption id="caption22" class="list_cap01" style="left:802px; top:5px; width:135px; height:28px; ">오류건수</caption>
			<caption id="caption23" class="list_cap01" style="left:936px; top:5px; width:135px; height:28px; ">오류금액</caption>
			<output id="output1" ref="/root/resData/totData/totcount" format="#,###" style="left:135px; top:37px; width:129px; height:18px; text-align:right; vertical-align:middle; "/>
			<caption id="caption17" class="list_cap02" style="left:266px; top:32px; width:135px; height:28px; "/>
			<caption id="caption18" class="list_cap02" style="left:400px; top:32px; width:135px; height:28px; "/>
			<output id="output2" ref="/root/resData/totData/totprice" format="#,###" style="left:269px; top:37px; width:129px; height:18px; text-align:right; vertical-align:middle; "/>
			<output id="output3" ref="/root/resData/totData/okcount" format="#,###" style="left:403px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<output id="output4" ref="/root/resData/totData/okprice" format="#,###" style="left:537px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<caption id="caption19" class="list_cap02" style="left:668px; top:32px; width:135px; height:28px; "/>
			<caption id="caption21" class="list_cap02" style="left:802px; top:32px; width:135px; height:28px; "/>
			<output id="output5" ref="/root/resData/totData/fee" format="#,###" style="left:671px; top:37px; width:129px; height:18px; color:#008000; text-align:right; vertical-align:middle; "/>
			<output id="output6" ref="/root/resData/totData/errorcount" format="#,###" style="left:805px; top:37px; width:129px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<output id="output7" ref="/root/resData/totData/errorprice" format="#,###" style="left:939px; top:37px; width:129px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<caption id="caption29" class="list_cap01" style="left:0px; top:5px; width:133px; height:55px; font-size:11pt; font-weight:bold; line-spacing:3; ">합계자료</caption>
		</group>
		<caption id="caption9" class="list_cap01" style="left:10px; top:70px; width:80px; height:28px; ">출금월</caption>
		<caption id="caption10" class="list_cap01" style="left:205px; top:70px; width:80px; height:28px; ">출금일자</caption>
		<select1 id="combo5" ref="/root/reqData/searchData/pymt_day" navindex="4" appearance="minimal" style="left:291px; top:75px; width:74px; height:18px; ">
			<choices>
				<item>
					<label>전체</label>
					<value/>
				</item>
				<item>
					<label>10일</label>
					<value>10</value>
				</item>
				<item>
					<label>25일</label>
					<value>25</value>
				</item>
			</choices>
		</select1>
		<caption id="caption11" class="list_cap01" style="left:380px; top:70px; width:80px; height:28px; ">처리상태</caption>
		<select1 id="combo6" ref="/root/reqData/searchData/proc_clsf" navindex="4" appearance="minimal" style="left:466px; top:75px; width:74px; height:18px; ">
			<choices>
				<item>
					<label>전체</label>
					<value/>
				</item>
				<item>
					<label>준비</label>
					<value>0</value>
				</item>
				<item>
					<label>처리중</label>
					<value>1</value>
				</item>
				<item>
					<label>완료</label>
					<value>2</value>
				</item>
			</choices>
		</select1>
		<select1 id="combo2" ref="/root/reqData/searchData/pymt_yymm" navindex="4" appearance="minimal" style="left:95px; top:75px; width:99px; height:18px; ">
			<choices>
				<itemset nodeset="/root/initData/comboSet/dataSet/pymtmmlist/record">
					<label ref="cdnm"/>
					<value ref="cd"/>
				</itemset>
			</choices>
		</select1>
		<input id="input21" ref="/root/reqData/searchData/todt" navindex="5" inputtype="date" caption="게재일자" style="left:957px; top:75px; width:95px; height:18px; "/>
		<caption id="caption34" style="left:941px; top:76px; width:15px; height:17px; ">~</caption>
		<caption id="caption3" class="list_cap01" style="left:560px; top:70px; width:270px; height:28px; "/>
		<select1 id="radio1" ref="/root/reqData/searchData/dt_clsf" class="list_cap01" navindex="3" appearance="full" overflow="visible" style="left:640px; top:76px; width:90px; height:20px; border-style:none; ">
			<choices>
				<item>
					<label>출금의뢰일</label>
					<value>01</value>
				</item>
			</choices>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					input2.disabled = false;
					input21.disabled = false;
				]]>
			</script>
		</select1>
		<select1 id="radio2" ref="/root/reqData/searchData/dt_clsf" class="list_cap01" appearance="full" overflow="visible" style="left:735px; top:76px; width:90px; height:20px; border-style:none; ">
			<choices>
				<item>
					<label>결과처리일</label>
					<value>02</value>
				</item>
			</choices>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					input2.disabled = false;
					input21.disabled = false;
				]]>
			</script>
		</select1>
		<input id="input2" ref="/root/reqData/searchData/frdt" navindex="4" inputtype="date" caption="게재일자" style="left:840px; top:75px; width:95px; height:18px; "/>
		<datagrid id="send_filelist" nodeset="/root/resData/send_filelist_data/record" visibility="hidden" caption="cmsidx^deptidx^filename^filepath" colsep="##" colwidth="100,100,100,100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:350px; top:745px; width:305px; height:110px; ">
			<col ref="cmsidx"/>
			<col ref="deptidx"/>
			<col ref="filename"/>
			<col ref="filepath"/>
		</datagrid>
		<datagrid id="receive_filelist" nodeset="/root/resData/receive_filelist_data/record" visibility="hidden" caption="filename" colsep="##" colwidth="100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:665px; top:745px; width:305px; height:110px; ">
			<col ref="filename"/>
		</datagrid>
		<datagrid id="result_grid" nodeset="/root/resData/result_data/record" visibility="hidden" caption="record_clsf^seq^organcode^bankcode^bankaccount^payprice^bankaccountidentity^ret_clsf^ret_cd^desc^priceclsf^pymt_cd^usespace^paytype^telno^infodata" colsep="##" colwidth="80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:10px; top:745px; width:1270px; height:70px; ">
			<col ref="record_clsf"/>
			<col ref="seq"/>
			<col ref="organcode"/>
			<col ref="bankcode"/>
			<col ref="bankaccount"/>
			<col ref="payprice"/>
			<col ref="bankaccountidentity"/>
			<col ref="ret_clsf"/>
			<col ref="ret_cd"/>
			<col ref="desc"/>
			<col ref="priceclsf"/>
			<col ref="pymt_cd"/>
			<col ref="usespace"/>
			<col ref="paytype"/>
			<col ref="telno"/>
			<col ref="infodata"/>
		</datagrid>
		<caption id="caption24" class="list_cap01" style="left:10px; top:102px; width:820px; height:30px; "/>
		<button id="button1" class="btn07" crud="R" style="left:30px; top:106px; width:165px; height:21px; ">
			<caption>출금의뢰 대상조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					if( combo5.value == "" ) {
						alert("출금의뢰대상의 [ 출금일자 ]를 선택해 주세요");
						return;
					}
					
					//과거월분 대상조회는 일반 결과조회 이용
					var currentdt = getCurrentDate();
					if(currentdt.substring(0,6) > combo2.value) {
						alert("과거월은 일반조회 기능을 이용해주세요");
						return;
					}
					
					progressBarStart();
					model.setValue("/root/reqData/searchDetail/flag",  "1");	//상세조회 구분(0:일반, 1:출금의뢰대상)
					set_refvalue("/root/reqData/searchDetail/cmpy_cd",		getProperty("ss_cmpycd"));
					model.setValue("/root/reqData/searchDetail/cmsidx",     	"");	//cmsidx
					model.setValue("/root/reqData/searchDetail/pymtmm", 	combo2.value);	//출금월
					model.setValue("/root/reqData/searchDetail/pymtdd",    	combo5.value );	//출금일자
					model.setValue("/root/reqData/searchDetail/supp_clsf",    "");  		//지원단위
					model.setValue("/root/reqData/searchDetail/result_stat",    "");		//처리결과
					model.setValue("/root/reqData/searchDetail/search_clsf",  "");		//상세검색조건
					model.setValue("/root/reqData/searchDetail/search_nm",  "");		//상세검색어
					combo1.select(0);		//지원단위
					combo3.select(0);		//처리결과
					model.removenode("/root/resData/totData");
					datagrid2.clearStatus();
					//datagrid2.colHidden(1) = false;
					datagrid2.colHidden(1) = true;
					model.send("tn_lnk_3030_l");
					model.refresh();
					
					progressBarEnd();
					
					if( model.getValue("/root/resData/totData/tot_cnt") == "0" ) {
						datagrid2.colHidden(1) = true; //checkbox 안보이게함
						caption29.value = "합계자료";
						show_message("출금의뢰 대상이 존재하지 않습니다", "알림", MB_OK);						
						return;
					} else {
						if( check_submit_completed("조회가 완료 되었습니다.","") == true ) {
							combo3.disabled = true;	//처리결과조건 막음
							//datagrid2.valueMatrix( 0, 2 ) = "약정일자";
							model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
							var pymtdt = combo2.value + combo5.value;
							caption29.value = pymtdt.substring(0,4) + "." + pymtdt.substring(4,6) + "." + pymtdt.substring(6,8) + "\n합계자료";
						}
					}

				]]>
			</script>
		</button>
		<button id="button5" class="btn07" crud="R" style="left:453px; top:106px; width:165px; height:21px; ">
			<caption>EB21 생성</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				if( model.getValue("/root/reqData/searchDetail/flag") == "0" ) {
					alert("출금의뢰 파일 생성 대상이 아닙니다");
					datagrid2.clearStatus();
					return;
				}
				
				if( datagrid2.rows <=  1 ) {
					alert("출금의뢰 대상을 확인해 주세요");
					return;
				}
				
				if( datagrid2.rows >= 2 ) {
					if( datagrid2.valueMatrix( 2, 2 ) == "" ) {
						alert("출금의뢰 대상을 확인해 주세요");
						return;
					}
				}
				
				if( model.getValue("/root/resData/totData/tot_cnt") == "0" ) {
					show_message("출금의뢰 대상이 존재하지 않습니다", "알림", MB_OK);
					return;
				} 			
				
				if(validateReq()){
					makeFile();
				}
				]]>
			</script>
		</button>
		<button id="button9" class="btn07" navindex="9" crud="R" style="left:626px; top:106px; width:165px; height:21px; color:#ffcc99; ">
			<caption>EB21 생성취소</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[

				if( model.getValue("/root/reqData/cancelForm/cmsidx") == "" ) {
					alert("취소대상이 없습니다");
					return;
				}
				
				if( model.getValue("/root/reqData/searchDetail/status") != "0" ) {
					alert("취소대상이 아닙니다");
					return;
				}

				if( commConfirmBox("생성된 파일을 취소 하시겠습니까") ) {
					if(validateReq()){
						progressBarStart();
						set_refvalue("/root/reqData/cancelForm/cmpy_cd", getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/cancelForm/cmsidx",  model.getValue("/root/reqData/searchDetail/cmsidx") );
						model.send("tn_lnk_3040_a");
						progressBarEnd();
						
						if( check_submit_completed("정상처리 되었습니다.","") == true ) {
							model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
							model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
							model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
							model.refresh();							
							button4.dispatch("onclick");
						}
					}
				}
				]]>
			</script>
		</button>
		<caption id="caption25" class="list_cap01" visibility="hidden" style="left:1187px; top:102px; width:360px; height:30px; "/>
		<button id="button6" class="btn07" visibility="hidden" crud="R" style="left:1200px; top:106px; width:165px; height:21px; ">
			<caption>출금의뢰파일 송신</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				//CMSPro test				
				runCMSPro();
				return;
				
				if(validateReq()){
					var filename = "";
					var filepath   = "";
					var send_result = "";

					//1. 준비상태의 파일목록 가져옴 --> grid
					progressBarStart();
					model.removenode("/root/resData/send_filelist_data");
					model.setValue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
					model.send("tn_lnk_3051_l");
					model.refresh();
					progressBarEnd();
					
					if( send_filelist.valueMatrix( 1, 1 ) == "" ) {
						alert("송신 할 파일이 없습니다");
						return;
					}
					
					if( commConfirmBox("파일을 송신 하시겠습니까?") ) {
						
						showPromptBox("CMS 비밀번호를 입력해 주세요");
						if( model.getValue("/root/tempData/result") == "" ) return;

						//CMS초기화
						//var initresult = CP_CMSInit( model.getValue("/root/configData/reqForm/organcode"), model.getValue("/root/tempData/result"));
						var initresult = CP_CMSInit( "test", model.getValue("/root/tempData/result"));   // #####  TEST #####
					        if (initresult == 1)
					        {
							alert("CMS모듈 초기화 성공");
					        }  else {
					        	//alert("CMS모듈 초기화 실패 ( " + initresult + " )");
					        	return;
					        }
					        
					        //송신대상 파일 송신처리
						progressBarStart();
						for(var i = send_filelist.fixedRows; i < send_filelist.rows; i++ ) {
							filename = send_filelist.valueMatrix( i, 3 );
							filepath   = send_filelist.valueMatrix( i, 4 );
							
							if( filename != "" ) {
								//2-1.파일 송신 처리								
								//---------------------------
								//파일송신프로세스...
								//---------------------------
								send_result = "";
								send_result = CP_SendCMSFile(filename);			//파일전송
								//send_result = CP_GetResultSendFile(filename);		//파일전송결과

								if (send_result == "01" || send_result == "08" || send_result == "09") {
									//성공시
									send_filelist.addStatus(i, "update");
								} else {
									var message = "[ " + filename + " ] 파일 전송이 실패하였습니다.";
									message += "\n(실패코드: " + send_result + ")";
									alert( message );
									return;
								}										
							}	
						}
						progressBarEnd();
						
						//3. 송신된 파일정보 update call
						progressBarStart();
						model.setValue("/root/reqData/sendCompleteData/cmpy_cd", getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/sendCompleteData/multiUpdateData", send_filelist.getUpdateData("update"));
						model.send("tn_lnk_3052_a");
						progressBarEnd();
						
						if( check_submit_completed("정상처리 되었습니다.","") == true ) {
							model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
							model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
							model.refresh();
							button4.dispatch("onclick"); 
						}
					}
				}
				]]>
			</script>
		</button>
		<button id="button7" class="btn07" visibility="hidden" crud="R" style="left:1370px; top:106px; width:165px; height:21px; ">
			<caption>출금결과파일 수신</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				//CMSPro test				
				runCMSPro();
				return;
				
					if( commConfirmBox("파일을 수신 하시겠습니까?") ) {
						var filename = "";
						var data = "";
						var rows = 0;

						//파일수신할 패스설정
						var filePath   = get_refvalue("/root/reqData/configForm/payfile_path");
						if( filePath == "" ) {
							filePath = "C:\\CMS\\";
						} else {
							if( filePath.substring( filePath.length-1 , filePath.length) != "\\" ) {
								filePath += "\\";
							}
						}

						//----------------------------------------------
						//1. 파일수신 (수신한 파일명들을 grid에 담을 것임
						//----------------------------------------------
						while(receive_filelist.rows > 2 ) { receive_filelist.removeRow(); } //기존내용삭제


						showPromptBox("CMS 비밀번호를 입력해 주세요");
						if(  model.getValue("/root/tempData/result") == "" ) return;

						//CMS초기화
						//var initresult = CP_CMSInit( model.getValue("/root/configData/reqForm/organcode"), model.getValue("/root/tempData/result"));
						var initresult = CP_CMSInit( "test", model.getValue("/root/tempData/result") );   // #####  TEST #####
					        if (initresult == 1)
					        {
							alert("CMS모듈 초기화 성공");
					        }  else {
					        	//alert("CMS모듈 초기화 실패 ( " + initresult + " )");
					        	return;
					        }
					        return;

						//----------------------------------------------
						//수신건수만큼 loop {
							filename = "EB220810";
							rows = receive_filelist.rows;
							receive_filelist.valueMatrix( rows - 1, 1 ) = filename;
							receive_filelist.addRow();
							alert("파일수신완료: " + filename);
						//}
						//----------------------------------------------
						
						//----------------------------------------------
						//2. 수신파일 upload
						//----------------------------------------------
						progressBarStart();
						for(var i = receive_filelist.fixedRows; i < receive_filelist.rows; i++ ) {

							filename = receive_filelist.valueMatrix( i, 1 );

							if( filename != "" ) {
								//alert("2. 수신파일 upload ["+ i +"]  " + filePath + filename);
								while(result_grid.rows > 2 ) { result_grid.removeRow(); }
								result_grid.clearStatus();
								result_grid.refresh();

/*
								result_grid.loadText(filePath+filename); 
								result_grid.clearStatus();
*/					
								var	fso,	file;
								var	readSize = 150;
								var	data = "";
								var	size = 0, limit = 0, row = 0;
								var   head_clsf = "";
								var   data1 = "";
								var   data2 = "";
								var   data3 = "";
								
								fso	=	new ActiveXObject("Scripting.FileSystemObject");
								file	=	fso.OpenTextFile(filePath + filename, 1, -1);
								size =	fso.GetFile(filePath + filename);

								limit = ( size.Size / readSize );
								while(limit > 0) {
									head_clsf = file.Read(1);
									
									if( head_clsf == "H" || head_clsf == "T" ) {
										data = head_clsf + file.Read(readSize-1);
									} else {
										data1 = file.Read(72);		//data 앞부분
										data2 = file.Read(10);		//통장기재내역
										data3 = file.Read(59);		//data 뒷부분	
										data = head_clsf + data1 + data2 + data3;
									}

									row = result_grid.rows - 1;									
									result_grid.addStatus(row, "insert");
									//result_grid.valueMatrix( row, 1 ) = data + "]";	//filedata
									//result_grid.valueMatrix( row, 2 ) = head_clsf;	//레코드구분(1)
									result_grid.valueMatrix( row, 1 ) = head_clsf;	//레코드구분(1)
									
									if( head_clsf == "H" || head_clsf == "T" ) {
										result_grid.valueMatrix( row, 16 )  = data + "]";
								       } else {

										result_grid.valueMatrix( row, 2 ) = data1.substring( 1,  8 );
										result_grid.valueMatrix( row, 3 ) = data1.substring( 8,  18 );
										result_grid.valueMatrix( row, 4 ) = data1.substring( 18,  25 );
										result_grid.valueMatrix( row, 5 ) = data1.substring( 25,  41 );
										result_grid.valueMatrix( row, 6 ) = data1.substring( 41,  54 );
										result_grid.valueMatrix( row, 7 ) = data1.substring( 54,  67 );
										result_grid.valueMatrix( row, 8 ) = data1.substring( 67,  68 );
										result_grid.valueMatrix( row, 9 ) = data1.substring( 68,  72 );
										result_grid.valueMatrix( row, 10 ) = data2;	//data1.substring( 73,  81 );
										result_grid.valueMatrix( row, 11 ) = "  ";	//data1.substring( 81,  83 );
										result_grid.valueMatrix( row, 12 ) = data3.substring( 0,  20 );	//data1.substring( 83,  103 );
										result_grid.valueMatrix( row, 13 ) = data3.substring( 20,  25 );	//data1.substring( 103,  108 );
										result_grid.valueMatrix( row, 14 ) = data3.substring( 25,  26 );	//data1.substring( 108,  109 );
										result_grid.valueMatrix( row, 15 ) = data3.substring( 26,  38 );	//data1.substring( 109,  121 );										
										result_grid.valueMatrix( row, 16 ) = "";

										//result_grid.valueMatrix( row, 3 ) = data3.substring( 0, 19 );		//납부자번호(20)
										//result_grid.valueMatrix( row, 4 ) = data1.substring( 67, 68 );	//처리결과코드(1): N
										//result_grid.valueMatrix( row, 5 ) = data1.substring( 68, 72 );	//불능코드(4)									
										
										result_grid.valueMatrix( row, 16 ) = "";
									}
									
									/*
									1 <col ref="record_clsf"/>
									2 <col ref="seq"/>
									3 <col ref="organcode"/>
									4 <col ref="bankcode"/>
									5 <col ref="bankaccount"/>
									6 <col ref="payprice"/>
									7 <col ref="bankaccountidentity"/>
									8 <col ref="ret_clsf"/>
									9 <col ref="ret_cd"/>
									10 <col ref="desc"/>
									11 <col ref="priceclsf"/>
									12 <col ref="pymt_cd"/>
									13 <col ref="usespace"/>
									14 <col ref="paytype"/>
									15 <col ref="telno"/>
									16 <col ref="infodata"/>
									*/

									result_grid.addRow();
									limit--;
								}
								result_grid.removeRow();

								//upload
								model.setValue("/root/reqData/resultData/cmpy_cd", getProperty("ss_cmpycd"));
								model.setValue("/root/reqData/resultData/filenm",      filename);
								model.setValue("/root/reqData/resultData/multiUpdateData", result_grid.getUpdateData("insert"));
								model.send("tn_lnk_3065_a");

                                                            model.refresh();
							}
						
						}
						progressBarEnd();
						//----------------------------------------------
						
						show_message("수신이 작업이 완료 되었습니다");
						model.refresh();
					}
						
				]]>
			</script>
		</button>
		<caption id="caption26" class="list_cap01" style="left:1060px; top:102px; width:215px; height:30px; "/>
		<button id="button10" class="btn07" navindex="10" crud="R" style="left:1087px; top:106px; width:165px; height:21px; ">
			<caption>CMSPro 실행</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				//CMSPro test
				runCMSPro();
				return;

				]]>
			</script>
		</button>
		<caption id="caption27" class="list_cap01" style="left:840px; top:102px; width:215px; height:30px; "/>
		<button id="button8" class="btn07" navindex="10" crud="R" style="left:867px; top:106px; width:165px; height:21px; ">
			<caption>EB22 업로드</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					//progressBarStart();

					var fso	 =	new ActiveXObject("Scripting.FileSystemObject");
					var organcode  = get_refvalue("/root/reqData/configForm/organcode");
					var filePath   = get_refvalue("/root/reqData/configForm/payfile_path");
					if( filePath == "" ) {
						filePath = "C:\\CMS\\" + organcode + "\\EB22\\";
					} else {
						if( filePath.substring( filePath.length-1 , filePath.length) != "\\" ) {
							filePath += "\\";
						}

						if( filePath.indexOf("EB22") < 0 ) {
							filePath += "EB22\\";
						}
					}
				
					if( !fso.FolderExists(filePath) ) {
						fso.CreateFolder(filePath);
					}

					var filename = "";
					var files = window.fileDialog("open","",false, filePath, "", "All Files (*.*)|*.*");
					sFile_Name = files.TrimRight();
					if(sFile_Name != "" ) {

						if( !commConfirmBox("출금결과(EB22)처리를 진행 하시겠습니까?") ) {
							return;
						}
						
						if(sFile_Name.indexOf("EB22") < 0) {
							alert("EB22 (출금결과) 파일이 아닙니다");							
							return;
						}
						
						//출금결과 upload 및 결과처리 진행
						progressBarStart();
						
						filename = sFile_Name;
						datagrid3.clearStatus();
						datagrid3.refresh();
						datagrid3.loadText(sFile_Name);
						var row = datagrid3.rows - 1;									
						datagrid3.addStatus(1, "insert");

						//var	fso,	file;
						var file;
						var	readSize = 150;
						var	data = "";
						var	size = 0, limit = 0, row = 0;
						//fso	 =	new ActiveXObject("Scripting.FileSystemObject");
						file =	fso.OpenTextFile(sFile_Name, 1);
						size =	fso.GetFile(sFile_Name);
						filename = fso.GetFileName(sFile_Name);
						limit = ( size.Size / readSize );
						//alert(size.Size + " : " + limit );


/*=================================================================================						
						//alert(datagrid3.valueMatrix(1,1));
						//progressBarEnd();
						//return;

						model.copyNode("/root/resData/result_data", "/root/tempData/tempResult");
						result_grid.clearStatus();
						result_grid.refresh();

						var	fso,	file;
						var	readSize = 150;
						var	data = "";
						var	size = 0, limit = 0, row = 0;
						var   head_clsf = "";
						var   data1 = "";
						var   data2 = "";
						var   data3 = "";
						var   desc  = "";
						var	  desc_len = 0;
						
						
						
						fso	 =	new ActiveXObject("Scripting.FileSystemObject");
						file =	fso.OpenTextFile(sFile_Name, 1);
						size =	fso.GetFile(sFile_Name);
						filename = fso.GetFileName(sFile_Name);
						limit = ( size.Size / readSize );						

						desc = model.getValue("/root/reqData/configForm/description");
						desc_len = desc.length;
						desc_len = desc_len + (16-(desc_len*2)); //한글통장내역
						//alert(desc_len);
						//return;


						while(limit > 0) {
							head_clsf = file.Read(1);
										
							if( head_clsf == "H" || head_clsf == "T" ) {
								data = head_clsf + file.Read(readSize-1);
							} else {
								data1 = file.Read(72);		//data 앞부분
								data2 = file.Read(desc_len) ;		//통장기재내역
								data3 = file.Read(61);		//data 뒷부분	
								data = head_clsf + data1 + data2 + data3;
							}
							//alert("["+data+"]");
							
							
							row = result_grid.rows - 1;									
							result_grid.addStatus(row, "insert");
							//result_grid.valueMatrix( row, 1 ) = data + "]";	//filedata
							//result_grid.valueMatrix( row, 2 ) = head_clsf;	//레코드구분(1)
							
							result_grid.valueMatrix( row, 1 ) = head_clsf;	//레코드구분(1)
										
							if( head_clsf == "H" || head_clsf == "T" ) {
								result_grid.valueMatrix( row, 16 )  = data + "]";
							} else {
								result_grid.valueMatrix( row, 2 ) = data1.substring( 1,  8 );
								result_grid.valueMatrix( row, 3 ) = data1.substring( 8,  18 );
								result_grid.valueMatrix( row, 4 ) = data1.substring( 18,  25 );
								result_grid.valueMatrix( row, 5 ) = data1.substring( 25,  41 );
								result_grid.valueMatrix( row, 6 ) = data1.substring( 41,  54 );
								result_grid.valueMatrix( row, 7 ) = data1.substring( 54,  67 );
								result_grid.valueMatrix( row, 8 ) = data1.substring( 67,  68 );
								result_grid.valueMatrix( row, 9 ) = data1.substring( 68,  72 );
								result_grid.valueMatrix( row, 10 ) = data2;	//data1.substring( 73,  81 );
								result_grid.valueMatrix( row, 11 ) = "  ";	//data1.substring( 81,  83 );
								result_grid.valueMatrix( row, 12 ) = data3.substring( 0,  20 );		//data1.substring( 83,  103 );
								result_grid.valueMatrix( row, 13 ) = data3.substring( 20,  25 );	//data1.substring( 103,  108 );
								result_grid.valueMatrix( row, 14 ) = data3.substring( 25,  26 );	//data1.substring( 108,  109 );
								result_grid.valueMatrix( row, 15 ) = data3.substring( 26,  38 );	//data1.substring( 109,  121 );										
								result_grid.valueMatrix( row, 16 ) = "";

								//result_grid.valueMatrix( row, 3 ) = data3.substring( 0, 19 );		//납부자번호(20)
								//result_grid.valueMatrix( row, 4 ) = data1.substring( 67, 68 );	//처리결과코드(1): N
								//result_grid.valueMatrix( row, 5 ) = data1.substring( 68, 72 );	//불능코드(4)									
											
								result_grid.valueMatrix( row, 16 ) = "";
							}
							
							
							/ *
							1 <col ref="record_clsf"/>
							2 <col ref="seq"/>
							3 <col ref="organcode"/>
							4 <col ref="bankcode"/>
							5 <col ref="bankaccount"/>
							6 <col ref="payprice"/>
							7 <col ref="bankaccountidentity"/>
							8 <col ref="ret_clsf"/>
							9 <col ref="ret_cd"/>
							10 <col ref="desc"/>
							11 <col ref="priceclsf"/>
							12 <col ref="pymt_cd"/>
							13 <col ref="usespace"/>
							14 <col ref="paytype"/>
							15 <col ref="telno"/>
							16 <col ref="infodata"/>
							* /

							result_grid.addRow();
							limit--;
						}
						result_grid.removeRow();
=================================================================================*/
						//upload
						model.setValue("/root/reqData/resultData/cmpy_cd", getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/resultData/filenm",      filename);
						model.setValue("/root/reqData/resultData/multiUpdateData", datagrid3.getUpdateData("insert"));
						//model.setValue("/root/reqData/resultData/multiUpdateData", result_grid.getUpdateData("insert"));
						model.send("tn_lnk_3065_a");
						
						if( check_submit_completed("정상처리 되었습니다.","") == true ) {
							model.setValue("/root/reqData/cancelForm/cmsidx", "");	//취소용 cmsidx 초기화
							model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
							model.copyNode("/root/resData/totData","/root/tempData/tempTotData");
							model.refresh();
							button4.dispatch("onclick");
						}
						
						progressBarEnd();
					}

					//progressBarEnd();

				]]>
			</script>
		</button>
		<datagrid id="datagrid3" nodeset="/root/reqData/eb22File/record" visibility="hidden" caption="filedata^tmp_info" colsep="##" colwidth="100,100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:1175px; top:665px; width:305px; height:110px; ">
			<col ref="filedata"/>
			<col ref="tmp_info"/>
		</datagrid>
		<select1 id="radio3" ref="/root/reqData/searchData/dt_clsf" class="list_cap01" navindex="3" appearance="full" overflow="visible" style="left:570px; top:76px; width:70px; height:20px; border-style:none; ">
			<choices>
				<item>
					<label>출금월</label>
					<value>00</value>
				</item>
			</choices>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					input2.disabled = true;
					input21.disabled = true;
				]]>
			</script>
		</select1>
		<input id="input1" ref="/root/initData/makefiledt" navindex="5" inputtype="date" caption="출금일자지정" style="left:347px; top:108px; width:95px; height:18px; text-align:center; "/>
		<caption id="caption28" style="left:250px; top:108px; width:96px; height:20px; ">* 출금일자지정:</caption>
		<line id="line1" style="x1:206px; y1:106px; x2:206px; y2:129px; color:#000000; border-color:#c0c0c0; "/>
	</xhtml:body>
</xhtml:html>
