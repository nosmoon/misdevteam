<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="../../../css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>Untitle</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<session/>
						<comboSet>
							<!-- 선택계열(콤보박스,체크박스,리스트박스,라디오버튼)의 정보 -->
							<dataSet>
								<pymtmmlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</pymtmmlist>
								<supportlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</supportlist>
								<resultlist>
									<record>
										<cd/>
										<cdnm/>
									</record>
								</resultlist>
							</dataSet>
						</comboSet>
						<pageInfo/>
						<hndl_nm/>
						<connData/>
					</initData>
					<reqData>
						<fwdData/>
						<searchData>
							<cmpy_cd/>
							<pymt_yymm>201606</pymt_yymm>
							<pymt_day/>
							<frdt/>
							<todt/>
							<dt_clsf>01</dt_clsf>
							<proc_clsf/>
						</searchData>
						<reqForm>
						</reqForm>
						<searchDetail>
							<cmpy_cd/>
							<sdsiidx/>
							<deptidx/>
							<pymtmm/>
							<pymtdd/>
							<supp_clsf/>
							<result_stat>00</result_stat>
							<search_clsf/>
							<search_nm/>
							<cnclyn/>
							<delyn/>
							<flag/>
							<status/>
						</searchDetail>
						<searchResult>
							<cmpy_cd/>
							<sdsiidx/>
							<requestdate/>
							<fmsseq/>
						</searchResult>
						<fileData>
							<cmpy_cd/>
							<file_clsf/>
							<pymtmm/>
							<pymtdd/>
							<multiUpdateData/>
						</fileData>
						<cancelForm>
							<cmpy_cd/>
							<sdsiidx/>
						</cancelForm>
						<cancelSdsi>
							<cmpy_cd/>
							<cnclclsf/>
							<sdsiidx/>
							<multiUpdateData/>
						</cancelSdsi>
						<sendCompleteData>
							<cmpy_cd/>
							<multiUpdateData/>
						</sendCompleteData>
						<resultData>
							<cmpy_cd/>
							<filenm/>
							<multiUpdateData/>
						</resultData>
						<configForm/>
					</reqData>
					<resData>
						<resForm>
							<tot_cnt/>
						</resForm>
						<gridHeader>
							<record>
								<pymtmm/>
								<pymtdd/>
								<fmsseq_str/>
								<requestdate/>
								<acptdate/>
								<paydate/>
								<requestcount/>
								<requestprice/>
								<acptcount/>
								<acptprice/>
								<paycount/>
								<payprice/>
								<errorcount/>
								<errorpayprice/>
								<taxfee/>
								<fee/>
								<delcount/>
								<delprice/>
								<cnclcount/>
								<cnclprice/>
								<stat1/>
								<stat2/>
								<stat3/>
								<stat4/>
								<sdsiidx/>
								<deptidx/>
								<status/>
								<fmsseq/>
							</record>
						</gridHeader>
						<gridDetail>
							<record>
								<chk/>
								<pymtmm/>
								<pymtdd/>
								<support/>
								<memb_cd/>
								<memb_nm/>
								<memb_tel/>
								<memb_email/>
								<pymt_cd/>
								<cardowner/>
								<cardcmpy/>
								<cardno/>
								<payprice/>
								<result_stat/>
								<paymentidx/>
								<cnclokdate/>
								<cncldate/>
								<cncl_stat/>
								<memberidx/>
								<promiseidx/>
								<sdsipaymentidx/>
								<sdsiidx/>
							</record>
						</gridDetail>
						<totData>
							<requestcount/>
							<requestprice/>
							<acptcount/>
							<acptprice/>
							<paycount/>
							<payprice/>
							<errorcount/>
							<errorpayprice/>
							<taxfee/>
							<fee/>
							<delcount/>
							<delprice/>
							<cnclcount/>
							<cnclprice/>
						</totData>
						<makefile_data>
							<record>
								<file_data/>
							</record>
							<cmsidx/>
							<totalcnt/>
						</makefile_data>
						<send_filelist_data>
							<record>
								<cmsidx/>
								<deptidx/>
								<filename/>
								<filepath/>
							</record>
							<totalcnt/>
						</send_filelist_data>
						<result_data>
							<record>
								<record_clsf/>
								<seq/>
								<organcode/>
								<bankcode/>
								<bankaccount/>
								<payprice/>
								<bankaccountidentity/>
								<ret_clsf/>
								<ret_cd/>
								<desc/>
								<priceclsf/>
								<pymt_cd/>
								<usespace/>
								<paytype/>
								<telno/>
								<infodata/>
							</record>
							<totalcnt/>
						</result_data>
						<receive_filelist_data>
							<record>
								<filename/>
							</record>
							<totalcnt/>
						</receive_filelist_data>
					</resData>
					<tempData>
						<keyData/>
						<tempHeader>
							<record>
								<pymtmm/>
								<pymtdd/>
								<fmsseq_str/>
								<requestdate/>
								<acptdate/>
								<paydate/>
								<requestcount/>
								<requestprice/>
								<acptcount/>
								<acptprice/>
								<paycount/>
								<payprice/>
								<errorcount/>
								<errorpayprice/>
								<taxfee/>
								<fee/>
								<delcount/>
								<delprice/>
								<cnclcount/>
								<cnclprice/>
								<stat1/>
								<stat2/>
								<stat3/>
								<stat4/>
								<sdsiidx/>
								<deptidx/>
								<status/>
								<fmsseq/>
							</record>
						</tempHeader>
						<tempDetail>
							<record>
								<chk/>
								<pymtmm/>
								<pymtdd/>
								<support/>
								<memb_cd/>
								<memb_nm/>
								<memb_tel/>
								<memb_email/>
								<pymt_cd/>
								<cardowner/>
								<cardcmpy/>
								<cardno/>
								<payprice/>
								<result_stat/>
								<paymentidx/>
								<cnclokdate/>
								<cncldate/>
								<cncl_stat/>
								<memberidx/>
								<promiseidx/>
								<sdsipaymentidx/>
								<sdsiidx/>
							</record>
						</tempDetail>
						<tmpfile_data>
							<record>
								<file_data/>
							</record>
							<totalcnt/>
						</tmpfile_data>
					</tempData>
					<msgData/>
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
				
				var currentdt = getCurrentDate();	
				var dt = currentdt ;	//현재일자 
		
				model.setValue("/root/reqData/searchData/frdt", dt.substring(0,6)+"01"); //등록fr일자
				model.setValue("/root/reqData/searchData/todt", dt); //등록to일자


				//model.removenode("/root/configData/reqForm");
				set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
				model.send("tn_lnk_5000_m");

				combo1.select(0);	//지원단위
				combo2.select(1);	//출금월
				combo3.select(0);	//처리결과
				datagrid2.colHidden(1) = true;
				datagrid2.fixedcellcheckbox(0, datagrid2.colRef("chk"), false) = true;
				datagrid2.clearStatus();

				//searchConfig();
				//서버접속테스트
				model.send("tn_lnk_5005_m");
				
				if( model.getValue("root/initData/codeData/uid") == "9999" ) {
					button13.visible = true;
				}
				
				model.refresh();

				]]>
			</script>
			<submission id="tn_lnk_5000_m" action="/tn/lnk/5000" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/initData/comboSet"/>
			<submission id="tn_lnk_5005_m" action="/tn/lnk/5005" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData" resultref="/root/initData/connData"/>
			<submission id="tn_lnk_5010_l" action="/tn/lnk/5010" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridHeader"/>
			<submission id="tn_lnk_5020_l" action="/tn/lnk/5020" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/gridDetail"/>
			<submission id="tn_lnk_5030_l" action="/tn/lnk/5030" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/gridDetail"/>
			<submission id="tn_lnk_5035_a" action="/tn/lnk/5035" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/fileData" resultref="/root/resData/makefile_data"/>
			<submission id="tn_lnk_5040_a" action="/tn/lnk/5040" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/cancelForm" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_5050_a" action="/tn/lnk/5050" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_5060_a" action="/tn/lnk/5060" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchResult" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_5070_a" action="/tn/lnk/5070" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/cancelSdsi" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_5080_a" action="/tn/lnk/5080" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchDetail" resultref="/root/resData/gridDetail"/>
			<submission id="tn_lnk_5090_a" action="/tn/lnk/5090" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/cancelSdsi" resultref="/root/resData/resForm"/>
			<submission id="tn_lnk_3051_l" action="/tn/lnk/3051" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/"/>
			<submission id="tn_lnk_3052_a" action="/tn/lnk/3052" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/sendCompleteData" resultref="/root/resData/"/>
			<submission id="tn_lnk_3065_a" action="/tn/lnk/3065" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/resultData" resultref="/root/resData/"/>
		</model>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript" src="/js/CIISComm.js"/>
		<script type="javascript" src="/js/fcmc_common.js"/>
		<script type="javascript" src="/js/cms_util.js"/>
		<script type="javascript">
			<![CDATA[
				
				//execute CMSPro
				function runCMSPro() {
					window.exec( "CLOGIN_PRG.exe", "", "C:\\Program Files\\CMSProV2" );
					return;
				}
				

				function makeFile(){

					if (show_message("조회된 내용으로 [카드결재대상] 자료를 생성하시겠습니까?"," 파일 생성", MB_YESNO) != IDYES) {
						return false;
					}					

					if( combo5.value == "" ) {
						alert("생성할 대상의 출금일자를 선택해 주세요");
						return;
					}
					
					//파일자료초기화
					//model.copyNode("/root/resData/makefile_data/record","/root/tempData/tmpfile_data/record");
					//model.copyNode("/root/resData/makefile_data/totalcnt","/root/tempData/tmpfile_data/totalcnt");
					//model.refresh();

					progressBarStart();
					set_refvalue("/root/reqData/fileData/cmpy_cd", getProperty("ss_cmpycd"));
					model.setValue("/root/reqData/fileData/file_clsf", "1");
					model.setValue("/root/reqData/fileData/pymtmm", 	combo2.value);	//출금월
					model.setValue("/root/reqData/fileData/pymtdd", 	combo5.value);	//출금일자
					model.setValue("/root/reqData/fileData/multiUpdateData", datagrid2.getUpdateData("update"));
					model.send("tn_lnk_5035_a");
					progressBarEnd();
					
					if( check_submit_completed("생성이 완료 되었습니다.","") == true ) {
						button4.dispatch("onclick");
					}
				}
				

				function searchConfig() {
					/*
					model.removenode("/root/configData/reqForm");
					progressBarStart();
					set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
					model.send("tn_lnk_2100_l");
					model.copyNode("/root/reqData/configForm", "/root/configData/reqForm");	
					model.refresh();
					progressBarEnd();
					*/
					alert("searchConfig");
				}

				function chkCancelData() {
					for(var i = datagrid2.fixedRows; i < datagrid2.rows; i++) {
						var tmp1 = datagrid2.valueMatrix(i, datagrid2.colRef("cncl_stat"));
						
						datagrid2.valueMatrix( i, 1 ) = "";
						
						if( tmp1.indexOf("정상") >= 0 ){
							//datagrid2.rowStyle(i, "data","background-color")="#FF9999";
							datagrid2.cellAttribute("disabled", i, 0, i, 2 ) = "true";
						} else {
							//datagrid2.rowStyle(i, "data","background-color")="#FFFFFF";	
							datagrid2.cellAttribute("disabled", i, 1, i, 1 ) = "false";
						}
					}
				}

				function fnColHidden(clsf) {
						if(clsf == 1) {	//승인요청내용 조회
							datagrid2.valueMatrix( 0, datagrid2.colRef("payprice") ) = "의뢰금액";
							datagrid2.colHidden(datagrid2.colRef("paymentidx")) = true;
							datagrid2.colHidden(datagrid2.colRef("cnclokdate")) = true;
							datagrid2.colHidden(datagrid2.colRef("cncldate"))   = true;
							datagrid2.colHidden(datagrid2.colRef("cncl_stat"))  = true;
						} else {		//일반조회
							datagrid2.valueMatrix( 0, datagrid2.colRef("payprice") ) = "출금금액";
							datagrid2.colHidden(datagrid2.colRef("paymentidx")) = false;
							datagrid2.colHidden(datagrid2.colRef("cnclokdate")) = false;
							datagrid2.colHidden(datagrid2.colRef("cncldate"))   = false;
							datagrid2.colHidden(datagrid2.colRef("cncl_stat"))  = false;
						}
				}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="1600" pageheight="900" guideline="1,10;1,1577;2,58;2,69;1,1560;" style="font-family:굴림; ">
		<datagrid id="send_filelist" nodeset="/root/resData/send_filelist_data/record" visibility="hidden" caption="cmsidx^deptidx^filename^filepath" colsep="##" colwidth="100,100,100,100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:805px; top:720px; width:305px; height:110px; ">
			<col ref="cmsidx"/>
			<col ref="deptidx"/>
			<col ref="filename"/>
			<col ref="filepath"/>
		</datagrid>
		<datagrid id="result_grid" nodeset="/root/resData/result_data/record" visibility="hidden" caption="record_clsf^seq^organcode^bankcode^bankaccount^payprice^bankaccountidentity^ret_clsf^ret_cd^desc^priceclsf^pymt_cd^usespace^paytype^telno^infodata" colsep="##" colwidth="80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:490px; top:715px; width:315px; height:107px; ">
			<col ref="record_clsf"/>
			<col ref="seq"/>
			<col ref="organcode"/>
			<col ref="bankcode"/>
			<col ref="bankaccount"/>
			<col ref="payprice"/>
			<col ref="bankaccountidentity"/>
			<col ref="ret_clsf"/>
			<col ref="ret_cd"/>
			<col ref="desc"/>
			<col ref="priceclsf"/>
			<col ref="pymt_cd"/>
			<col ref="usespace"/>
			<col ref="paytype"/>
			<col ref="telno"/>
			<col ref="infodata"/>
		</datagrid>
		<datagrid id="receive_filelist" nodeset="/root/resData/receive_filelist_data/record" visibility="hidden" caption="filename" colsep="##" colwidth="100" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" navindex="21" style="left:1115px; top:715px; width:305px; height:110px; ">
			<col ref="filename"/>
		</datagrid>
		<caption id="caption35" class="list_cap02" visibility="hidden" style="left:125px; top:787px; width:101px; height:28px; "/>
		<caption id="caption33" class="list_cap02" visibility="hidden" style="left:33px; top:787px; width:93px; height:28px; "/>
		<caption id="caption12" class="list_cap02" style="left:10px; top:70px; width:1600px; height:28px; "/>
		<caption id="caption6" tyle="left:15px; top:180px; width:940px; height:0px;" style="left:0px; top:10px; width:0px; height:0px; ">caption6</caption>
		<import id="iv_Title" src="/common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:1550px; height:29px; "/>
		<button id="button4" class="btn02" disabled="false" crud="R" style="left:766px; top:40px; width:50px; height:21px; ">
			<caption>조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				if(validateReq()){
					progressBarStart();
					combo1.select(0);			//지원단위
					combo3.select(0);		    //처리결과
					combo3.disabled = false;	//처리결과조건 해제
					set_refvalue("/root/reqData/searchData/cmpy_cd", getProperty("ss_cmpycd"));
					model.send("tn_lnk_5010_l");
					
					//main 조회sdsiidx초기화
					model.setValue("/root/reqData/searchDetail/sdsiidx", "");
					//취소용 sdsiidx 초기화
					model.setValue("/root/reqData/cancelForm/sdsiidx", "");
					//결과처리용 조건 초기화
					set_refvalue("/root/reqData/searchResult/cmpy_cd",     "");
					set_refvalue("/root/reqData/searchResult/sdsiidx",     "");
					set_refvalue("/root/reqData/searchResult/requestdate", "");
					set_refvalue("/root/reqData/searchResult/fmsseq",      "");
						
					model.refresh();					
					progressBarEnd();
					
					//if( check_submit_completed("조회가 완료 되었습니다.","") == true ) {
						model.removeNode("/root/resData/gridDetail");					
						model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
						model.refresh();
					//}
				}
				]]>
			</script>
		</button>
		<datagrid id="datagrid2" nodeset="/root/resData/gridDetail/record" caption="취소^청구월^출금일자^지원단위^회원번호^회원명^전화번호^이메일^납부자번호^카드소유주^카드사^카드번호^출금금액^처리결과^납입번호^취소가능일^취소일자^취소상태^memberidx^promiseidx^sdsipaymentidx^sdsiidx" colsep="##" colwidth="69, 77, 68, 133, 100, 110, 110, 120, 113, 120, 80, 150, 109, 190, 110, 72, 90, 140, 14, 14, 16, 12" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" selectionmode="byrow" subtotalposition="below" style="left:10px; top:347px; width:1600px; height:301px; ">
			<col checkvalue="Y,N" ref="chk" type="checkbox"/>
			<col ref="pymtmm" format="yyyy-mm"/>
			<col ref="pymtdd"/>
			<col ref="support"/>
			<col ref="memb_cd"/>
			<col ref="memb_nm" style="text-align:center; word-wrap:none; "/>
			<col ref="memb_tel" style="text-align:center; word-wrap:none; "/>
			<col ref="memb_email" style="text-align:center; word-wrap:none; "/>
			<col ref="pymt_cd" style="text-align:center; word-wrap:none; "/>
			<col ref="cardowner"/>
			<col ref="cardcmpy"/>
			<col ref="cardno"/>
			<col ref="payprice" format="#,###" style="text-align:right; "/>
			<col ref="result_stat" style="text-align:left; padding-left:5px; "/>
			<col ref="paymentidx"/>
			<col ref="cnclokdate" format="yyyy-mm-dd"/>
			<col ref="cncldate" format="yyyy-mm-dd"/>
			<col ref="cncl_stat" style="text-align:left; padding-left:5px; "/>
			<col ref="memberidx" visibility="hidden"/>
			<col ref="promiseidx" visibility="hidden"/>
			<col ref="sdsipaymentidx" visibility="hidden"/>
			<col ref="sdsiidx" visibility="hidden"/>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					if( datagrid2.row < datagrid2.fixedRows )
					{
						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							datagrid2.addStatus(i, "update");
						}
					}
					else
					{
						datagrid2.addStatus(datagrid2.row, "update");
					}
					
					datagrid2.rowStyle( datagrid2.row, "data", "background-color") = "#FF9999";
					
				]]>
			</script>
			<script type="javascript" ev:event="xforms-deselect">
				<![CDATA[
					if( datagrid2.row < datagrid2.fixedRows )
					{
						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							datagrid2.removeStatus(i, "update");
						}
					}
					else
					{
						datagrid2.removeStatus(datagrid2.row, "update");		
					}
					
					datagrid2.rowStyle( datagrid2.row, "data", "background-color") = "#FFFFFF";
					
				]]>
			</script>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					var row = datagrid2.row;
					var col = datagrid2.col;
					
					if(row > 0){

						if(datagrid2.valueMatrix( row, datagrid2.colRef("memberidx")) != "" && datagrid2.valueMatrix( row, datagrid2.colRef("memb_nm") ) != "" ){
							var memb_idx  = datagrid2.valueMatrix(datagrid2.row,datagrid2.colRef("memberidx"));
							var memb_name = datagrid2.valueMatrix(datagrid2.row,datagrid2.colRef("memb_nm"));

				
							if(memb_idx != "" || memb_name != "" ) {
									model.property("TN_DNS_1000_memberidx")   = memb_idx;
									model.property("TN_DNS_1000_name")        = memb_name;
									model.property("TN_DNS_1000_popup_flag")  = "Y";
									viewer("mainFrame").window.javaScript.onLoadPopupPage("TN_DNS_1000");
							}else{
								alert("요청번호가 존재하지 않습니다.");
								return;
							}
						}					
					}
				]]>
			</script>
		</datagrid>
		<button id="btnClose" class="btn02" disabled="false" style="left:885px; top:40px; width:50px; height:21px; ">
			<caption>종료</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
				viewer("mainFrame").window.javaScript.closeMDIWindow(model.getValue("/root/initData/pageInfo/pageID"));
				
				]]>
			</script>
		</button>
		<button id="btn_exceldown" class="btn02" disabled="false" crud="R" style="left:826px; top:40px; width:50px; height:21px; ">
			<caption>EXCEL</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					if(datagrid2.rows <= 1 ) {
						alert("처리할 내역이 없습니다.");
						return;
					}

					if(datagrid2.valueMatrix( 2, 2 ) == "" ) {
						alert("처리할 내역이 없습니다.");
						return;
					}
					
					var filename = window.fileDialog("save", ",", false, "카드출금내역상세", "xls", "Excel File(*.xls)|*.xls");
					if(filename!=""){						
						datagrid2.saveExcel(filename, "sheetname: 카드출금내역상세");						
					}
				]]>
			</script>
		</button>
		<datagrid id="datagrid1" nodeset="/root/resData/gridHeader/record" caption="청구월분^청구일자^순번^의뢰일자^승인일자^출금일자^의뢰건수^의뢰금액^승인건수^승인금액^출금건수^출금금액^오류건수^오류금액^부가세^수수료^제외건수^제외금액^취소건수^취소금액^처리진행상태^처리진행상태^처리진행상태^처리진행상태^idx^d^s^f" colsep="^" colwidth="80, 64, 40, 90, 90, 90, 90, 100, 90, 100, 90, 100, 90, 100, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 56, 56, 56" mergecellsfixedrows="bycolrec" multitotal="true" rowheader="seq" rowsep="|" subtotalposition="below" style="left:10px; top:137px; width:1600px; height:133px; ">
			<col ref="pymtmm" format="yyyy-mm"/>
			<col ref="pymtdd"/>
			<col ref="fmsseq_str" format="999"/>
			<col ref="requestdate" format="yyyy-mm-dd"/>
			<col ref="acptdate" format="yyyy-mm-dd"/>
			<col ref="paydate" format="yyyy-mm-dd"/>
			<col ref="requestcount" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="requestprice" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="acptcount" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="acptprice" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="paycount" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="payprice" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="errorcount" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="errorpayprice" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="taxfee" visibility="hidden" format="#,###" style="color:#339966; text-align:right; "/>
			<col ref="fee" format="#,###" style="color:#339966; text-align:right; "/>
			<col ref="delcount" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="delprice" format="#,###" style="color:#0000ff; text-align:right; "/>
			<col ref="cnclcount" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="cnclprice" format="#,###" style="color:#ff0000; text-align:right; "/>
			<col ref="stat1"/>
			<col ref="stat2"/>
			<col ref="stat3"/>
			<col ref="stat4" visibility="hidden"/>
			<col ref="sdsiidx" visibility="hidden"/>
			<col ref="deptidx" visibility="hidden"/>
			<col ref="status" visibility="hidden"/>
			<col ref="fmsseq" visibility="hidden"/>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					var row = datagrid1.row

					if(row > 0 && datagrid1.valueMatrix( row, 25 ) != ""){
						
						//결과처리용정보 설정
						set_refvalue("/root/reqData/searchResult/cmpy_cd",     getProperty("ss_cmpycd"));
						set_refvalue("/root/reqData/searchResult/sdsiidx",     datagrid1.valueMatrix( row, 25 ));	//sdsiidx
						set_refvalue("/root/reqData/searchResult/requestdate", datagrid1.valueMatrix( row, 4  ));	//requestdate
						set_refvalue("/root/reqData/searchResult/fmsseq",      datagrid1.valueMatrix( row, 28 ));	//fmsseq


						//상세정보 설정
						model.setValue("/root/reqData/searchDetail/flag",  "0");	//상세조회 구분(0:일반, 1:출금의뢰대상)
						set_refvalue("/root/reqData/searchDetail/cmpy_cd",		getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/searchDetail/sdsiidx",  	datagrid1.valueMatrix( row, 25 ));	//sdsiidx
						model.setValue("/root/reqData/searchDetail/pymtmm", 	datagrid1.valueMatrix( row, 1 ));	//출금월
						model.setValue("/root/reqData/searchDetail/pymtdd",    	datagrid1.valueMatrix( row, 2 ));	//출금일자
						model.setValue("/root/reqData/searchDetail/supp_clsf",    "");  	//지원단위
						model.setValue("/root/reqData/searchDetail/result_stat",  "");		//처리결과
						model.setValue("/root/reqData/searchDetail/search_clsf",  "");		//상세검색조건
						model.setValue("/root/reqData/searchDetail/search_nm",    "");		//상세검색어
						model.setValue("/root/reqData/searchDetail/cnclyn",  "");		//취소여부
						model.setValue("/root/reqData/searchDetail/delyn",    "");		//제외여부
						model.setValue("/root/reqData/searchDetail/status", 	datagrid1.valueMatrix( row,27 ) );	//상태
						
						progressBarStart();
						combo1.select(0);	//지원단위
						combo3.select(0);	//처리결과
						combo3.disabled = false;	//처리결과조건 해제
						model.removenode("/root/resData/totData");
						datagrid2.clearStatus();
						//datagrid2.colHidden(1) = true;
						
						model.send("tn_lnk_5020_l");

						for(var i=1; i<datagrid2.rows; i++) {							
							if( datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ).indexOf("[D000]") < 0 && datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ) != "승인준비" ) {
								//datagrid2.rowStyle(i, "data", "color") = "#ff0000";
								datagrid2.cellStyle("color", i, 12, i, 12) = "#ff0000";
							} else {
								datagrid2.cellStyle("color", i, 12, i, 12) = "#000000";
							}
						}

						
						model.setValue("/root/reqData/cancelForm/sdsiidx", datagrid1.valueMatrix( row, 25));	//취소용 sdsiidx 설정						
						if(datagrid1.valueMatrix(row, datagrid1.colRef("stat3")) != "") {
							datagrid2.colHidden(1) = false; //승인의뢰 이후건인경우 선택박스 show							
						} else {
							datagrid2.colHidden(1) = true;	//승인준비건인 경우 선택박스 hide
						}
						
						chkCancelData();
						fnColHidden(0);
						progressBarEnd();
						
					} else {
						model.setValue("/root/reqData/cancelForm/sdsiidx", "");	//취소용 cmsidx 초기화
					}
				]]>
			</script>
		</datagrid>
		<group id="group1" style="left:10px; top:300px; width:1600px; height:35px; ">
			<caption id="caption14" class="list_cap02" style="left:0px; top:0px; width:1600px; height:28px; "/>
			<button id="button2" class="btn03" disabled="false" crud="R" style="left:750px; top:5px; width:65px; height:21px; ">
				<caption>상세조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var row = datagrid2.rows;

					if( model.getValue("/root/reqData/searchDetail/cmsidx") == "" && model.getValue("/root/reqData/searchDetail/flag") == ""  ) return;

					//if(row > 1 && datagrid2.valueMatrix( row-1, 2 ) != "" ){
						//model.setValue("/root/reqData/searchDetail/flag",  "0");	//상세조회 구분(0:일반, 1:출금의뢰대상)
						set_refvalue("/root/reqData/searchDetail/cmpy_cd",			getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/searchDetail/supp_clsf",    	combo1.value);  	//지원단위
						model.setValue("/root/reqData/searchDetail/result_stat",   	combo3.value);		//처리결과
						model.setValue("/root/reqData/searchDetail/search_clsf",	combo4.value);		//상세검색조건
						model.setValue("/root/reqData/searchDetail/search_nm",		input5.value);		//상세검색어
						model.setValue("/root/reqData/searchDetail/cnclyn",			"");		//취소여부
						model.setValue("/root/reqData/searchDetail/delyn",			"");		//제외여부
						model.removenode("/root/resData/totData");
						//datagrid2.clearStatus();
						//datagrid2.colHidden(1) = true;
						//model.send("tn_lnk_3020_l");	
						//model.removenode("/root/resData/totData");
						
						progressBarStart();
						
						//상세조회 구분(0:일반, 1:승인의뢰대상)
						if( model.getValue("/root/reqData/searchDetail/flag") == "0" ) {
							model.send("tn_lnk_5020_l");	//일반 상세조회
						} else {
							model.send("tn_lnk_5030_l");	//승인의뢰대상 상세조회
						}
						
						for(var i=1; i<datagrid2.rows; i++) {							
							if( datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ).indexOf("[D000]") < 0 && datagrid2.valueMatrix(i, datagrid2.colRef("result_stat") ) != "승인준비" ) {
								datagrid2.rowStyle(i, "data", "color") = "#ff0000";
							} else {
								datagrid2.rowStyle(i, "data", "color") = "#000000";
							}
						}
						
						chkCancelData();
						progressBarEnd();
					//}

				]]>
				</script>
			</button>
			<button id="button3" class="btn02" disabled="true" visibility="hidden" crud="R" style="left:849px; top:5px; width:50px; height:21px; ">
				<caption>UMS</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
				
				if(validateReq()){
					//model.send("tn_lnk_1010_l");
				}
				]]>
				</script>
			</button>
			<caption id="caption13" class="list_cap01" style="left:450px; top:0px; width:114px; height:28px; "/>
			<input id="input5" ref="/root/reqData/searchDetail/search_nm" disabled="false" navindex="5" style="left:570px; top:5px; width:165px; height:18px; "/>
			<caption id="caption4" class="list_cap01" style="left:0px; top:0px; width:80px; height:28px; ">지원단위</caption>
			<select1 id="combo1" ref="/root/reqData/searchDetail/supp_clsf" class="req" disabled="false" navindex="4" appearance="minimal" style="left:86px; top:5px; width:119px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/supportlist/record">
						<label ref="cdnm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</select1>
			<caption id="caption8" class="list_cap01" style="left:220px; top:0px; width:80px; height:28px; ">처리결과</caption>
			<select1 id="combo3" ref="/root/reqData/searchDetail/result_stat" class="req" disabled="false" navindex="4" appearance="minimal" style="left:311px; top:5px; width:119px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/resultlist/record">
						<label ref="cdnm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</select1>
			<select1 id="combo4" ref="/root/reqData/searchDetail/search_clsf" class="req" disabled="false" navindex="4" appearance="minimal" style="left:455px; top:5px; width:105px; height:18px; ">
				<choices>
					<item>
						<label>전체</label>
						<value/>
					</item>
					<item>
						<label>납부자명</label>
						<value>01</value>
					</item>
					<item>
						<label>납부자번호</label>
						<value>02</value>
					</item>
					<item>
						<label>회원명</label>
						<value>03</value>
					</item>
					<item>
						<label>회원번호</label>
						<value>04</value>
					</item>
				</choices>
			</select1>
		</group>
		<group id="group2" style="left:10px; top:665px; width:1610px; height:80px; ">
			<caption id="caption37" class="list_cap02" style="left:1342px; top:32px; width:120px; height:28px; "/>
			<caption id="caption29" class="list_cap02" style="left:1074px; top:32px; width:135px; height:28px; "/>
			<caption id="caption28" class="list_cap02" style="left:940px; top:32px; width:135px; height:28px; "/>
			<caption id="caption30" class="list_cap02" style="left:1208px; top:32px; width:135px; height:28px; "/>
			<caption id="caption1" class="list_cap02" style="left:2px; top:32px; width:939px; height:28px; "/>
			<caption id="caption2" class="list_cap02" style="left:12px; top:5px; width:1328px; height:28px; "/>
			<caption id="caption5" class="list_cap01" style="left:2px; top:5px; width:135px; height:28px; ">의뢰건수</caption>
			<caption id="caption7" class="list_cap01" style="left:136px; top:5px; width:135px; height:28px; ">의뢰금액</caption>
			<caption id="caption15" class="list_cap01" style="left:538px; top:5px; width:135px; height:28px; ">출금건수</caption>
			<caption id="caption16" class="list_cap01" style="left:672px; top:5px; width:135px; height:28px; ">출금금액</caption>
			<caption id="caption20" class="list_cap01" style="left:1208px; top:5px; width:135px; height:28px; ">수수료</caption>
			<caption id="caption22" class="list_cap01" style="left:806px; top:5px; width:135px; height:28px; ">오류건수</caption>
			<caption id="caption23" class="list_cap01" style="left:940px; top:5px; width:135px; height:28px; ">오류금액</caption>
			<output id="output1" ref="/root/resData/totData/requestcount" format="#,###" style="left:5px; top:37px; width:129px; height:18px; text-align:right; vertical-align:middle; "/>
			<caption id="caption17" class="list_cap02" style="left:136px; top:32px; width:135px; height:28px; "/>
			<caption id="caption18" class="list_cap02" style="left:270px; top:32px; width:135px; height:28px; "/>
			<output id="output2" ref="/root/resData/totData/requestprice" format="#,###" style="left:139px; top:37px; width:129px; height:18px; text-align:right; vertical-align:middle; "/>
			<output id="output3" ref="/root/resData/totData/acptcount" format="#,###" style="left:273px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<output id="output4" ref="/root/resData/totData/acptprice" format="#,###" style="left:407px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<caption id="caption19" class="list_cap02" style="left:538px; top:32px; width:135px; height:28px; "/>
			<caption id="caption21" class="list_cap02" style="left:672px; top:32px; width:135px; height:28px; "/>
			<output id="output5" ref="/root/resData/totData/fee" format="#,###" style="left:1211px; top:37px; width:129px; height:18px; color:#008000; text-align:right; vertical-align:middle; "/>
			<output id="output6" ref="/root/resData/totData/errorcount" format="#,###" style="left:810px; top:37px; width:129px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<output id="output7" ref="/root/resData/totData/errorpayprice" format="#,###" style="left:944px; top:37px; width:129px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<caption id="caption11" class="list_cap01" style="left:270px; top:5px; width:135px; height:28px; ">승인건수</caption>
			<caption id="caption26" class="list_cap01" style="left:404px; top:5px; width:135px; height:28px; ">승인금액</caption>
			<output id="output8" ref="/root/resData/totData/payprice" format="#,###" style="left:675px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<output id="output9" ref="/root/resData/totData/paycount" format="#,###" style="left:541px; top:37px; width:129px; height:18px; color:#0000ff; text-align:right; vertical-align:middle; "/>
			<caption id="caption27" class="list_cap01" style="left:1074px; top:5px; width:135px; height:28px; ">부가세</caption>
			<output id="output10" ref="/root/resData/totData/taxfee" format="#,###" style="left:1078px; top:37px; width:129px; height:18px; color:#008000; text-align:right; vertical-align:middle; "/>
			<caption id="caption40" class="list_cap02" style="left:1461px; top:32px; width:120px; height:28px; "/>
			<output id="output13" ref="/root/resData/totData/cnclcount" format="#,###" style="left:1345px; top:37px; width:112px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<output id="output14" ref="/root/resData/totData/cnclprice" format="#,###" style="left:1465px; top:37px; width:112px; height:18px; color:#ff0000; text-align:right; vertical-align:middle; "/>
			<caption id="caption38" class="list_cap01" style="left:1342px; top:5px; width:120px; height:28px; ">취소건수</caption>
			<caption id="caption39" class="list_cap01" style="left:1461px; top:5px; width:120px; height:28px; ">취소금액</caption>
		</group>
		<caption id="caption9" class="list_cap01" style="left:10px; top:70px; width:80px; height:28px; ">출금월</caption>
		<caption id="caption10" class="list_cap01" style="left:220px; top:70px; width:80px; height:28px; ">출금일자</caption>
		<select1 id="combo5" ref="/root/reqData/searchData/pymt_day" navindex="4" appearance="minimal" style="left:306px; top:75px; width:74px; height:18px; ">
			<choices>
				<item>
					<label>전체</label>
					<value/>
				</item>
				<item>
					<label>10일</label>
					<value>10</value>
				</item>
				<item>
					<label>25일</label>
					<value>25</value>
				</item>
			</choices>
		</select1>
		<select1 id="combo2" ref="/root/reqData/searchData/pymt_yymm" navindex="4" appearance="minimal" style="left:95px; top:75px; width:99px; height:18px; ">
			<choices>
				<itemset nodeset="/root/initData/comboSet/dataSet/pymtmmlist/record">
					<label ref="cdnm"/>
					<value ref="cd"/>
				</itemset>
			</choices>
		</select1>
		<input id="input21" ref="/root/reqData/searchData/todt" navindex="5" inputtype="date" caption="게재일자" style="left:637px; top:75px; width:95px; height:18px; "/>
		<caption id="caption34" style="left:621px; top:76px; width:15px; height:17px; ">~</caption>
		<caption id="caption3" class="list_cap01" style="left:410px; top:70px; width:100px; height:28px; ">승인의뢰일</caption>
		<input id="input2" ref="/root/reqData/searchData/frdt" navindex="4" inputtype="date" caption="게재일자" style="left:520px; top:75px; width:95px; height:18px; "/>
		<caption id="caption24" class="list_cap01" style="left:10px; top:102px; width:555px; height:30px; "/>
		<button id="button1" class="btn07" disabled="false" crud="R" style="left:25px; top:106px; width:165px; height:21px; ">
			<caption>카드결제 대상조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					if( combo5.value == "" ) {
						alert("출금의뢰대상의 [ 출금일자 ]를 선택해 주세요");
						return;
					}

					model.removeNode("/root/resData/gridHeader");
					model.removeNode("/root/resData/gridDetail");
					model.copyNode("/root/resData/gridHeader/record","/root/tempData/tempHeader/record");
					model.copyNode("/root/resData/gridDetail","/root/tempData/tempDetail");
					
					progressBarStart();
					model.setValue("/root/reqData/searchDetail/flag",  "1");	//상세조회 구분(0:일반, 1:출금의뢰대상)
					set_refvalue("/root/reqData/searchDetail/cmpy_cd",		getProperty("ss_cmpycd"));
					model.setValue("/root/reqData/searchDetail/sdsiidx",     	"");		//sdsiidx
					model.setValue("/root/reqData/searchDetail/pymtmm", 	combo2.value );	//출금월
					model.setValue("/root/reqData/searchDetail/pymtdd",    	combo5.value );	//출금일자
					model.setValue("/root/reqData/searchDetail/supp_clsf",    "");  		//지원단위
					model.setValue("/root/reqData/searchDetail/result_stat",    "");		//처리결과
					model.setValue("/root/reqData/searchDetail/search_clsf",  "");			//상세검색조건
					model.setValue("/root/reqData/searchDetail/search_nm",  "");			//상세검색어
					model.setValue("/root/reqData/searchDetail/cnclyn",  "");		//취소여부
					model.setValue("/root/reqData/searchDetail/delyn",    "");		//제외여부
					combo1.select(0);		//지원단위
					combo3.select(0);		//처리결과
					model.removenode("/root/resData/totData");
					datagrid2.clearStatus();
					//datagrid2.colHidden(1) = false;
					datagrid2.colHidden(1) = true;
					model.send("tn_lnk_5030_l");
					model.refresh();
					fnColHidden(0);
					progressBarEnd();
					
					if( model.getValue("/root/resData/totData/tot_cnt") == "0" ) {
						datagrid2.colHidden(1) = true; //checkbox 안보이게함
						show_message("출금의뢰 대상이 존재하지 않습니다", "알림", MB_OK);
						return;
					} else {
						if( check_submit_completed("조회가 완료 되었습니다.","") == true ) {
							combo3.disabled = true;	//처리결과조건 막음
							//datagrid2.valueMatrix( 0, 2 ) = "약정일자";
							model.setValue("/root/reqData/cancelForm/sdsiidx", "");	//취소용 cmsidx 초기화							
						}
					}

				]]>
			</script>
		</button>
		<button id="button5" class="btn07" disabled="false" visibility="visible" crud="R" style="left:220px; top:106px; width:165px; height:21px; ">
			<caption>카드결제 대상생성</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				if( model.getValue("/root/reqData/searchDetail/flag") == "0" ) {
					alert("출금의뢰생성 대상이 아닙니다");
					datagrid2.clearStatus();
					return;
				}
				
				if( datagrid2.rows <=  1 ) {
					alert("출금의뢰 대상을 확인해 주세요");
					return;
				}
				
				if( datagrid2.rows >= 2 ) {
					if( datagrid2.valueMatrix( 2, 2 ) == "" ) {
						alert("출금의뢰 대상을 확인해 주세요");
						return;
					}
				}
				
				if(validateReq()){
					makeFile();
				}
				]]>
			</script>
		</button>
		<button id="button9" class="btn07" disabled="false" navindex="9" visibility="visible" crud="R" style="left:390px; top:106px; width:165px; height:21px; color:#ffcc99; ">
			<caption>카드결제대상 생성취소</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[

				if( model.getValue("/root/reqData/cancelForm/sdsiidx") == "" ) {
					alert("취소대상이 없습니다");
					return;
				}

				if( model.getValue("/root/reqData/searchDetail/status") != "0" ) {
					alert("취소대상이 아닙니다");
					return;
				}

				if( commConfirmBox("생성된 파일을 취소 하시겠습니까") ) {
					if(validateReq()){
						progressBarStart();
						set_refvalue("/root/reqData/cancelForm/cmpy_cd", getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/cancelForm/sdsiidx",  model.getValue("/root/reqData/searchDetail/sdsiidx") );
						model.send("tn_lnk_5040_a");
						progressBarEnd();
						
						if( check_submit_completed("정상처리 되었습니다.","") == true ) {
							model.setValue("/root/reqData/cancelForm/sdsiidx", "");	//취소용 cmsidx 초기화
							//datagrid1.dispatch("ondblclick");
							button4.dispatch("onclick");
						}
					}
				}
				]]>
			</script>
		</button>
		<caption id="caption25" class="list_cap01" style="left:583px; top:102px; width:538px; height:30px; "/>
		<button id="button6" class="btn07" disabled="false" crud="R" style="left:597px; top:106px; width:165px; height:21px; ">
			<caption>카드승인요청</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
				
					if( model.getValue("/root/reqData/searchDetail/sdsiidx") == "") {
						alert("카드승인요청 대상을 선택해 주세요");
						return;
					}
										
					if( datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status") ) != 0 && datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status") ) != 4 ) {
						alert("이미 승인요청 처리된 자료입니다");
						return;
					}
					
					if( commConfirmBox("카드승인요청을 진행 하시겠습니까?") ) {
						if( model.getValue("/root/reqData/searchDetail/sdsiidx") == "") {
							alert("카드승인요청 대상을 선택해 주세요");
							return;
						}
						
						//요청날짜로 이미 승인요청된 건이 있을경우, fmsseq 증가 후 추가 요청
						model.removeNodeset("/root/resData/dataSet");
						model.refresh();
						progressBarStart()
						set_refvalue("/root/reqData/searchDetail/cmpy_cd", getProperty("ss_cmpycd"));
						model.send("tn_lnk_5050_a");
						progressBarEnd();

												
						if( model.getValue("/root/resData/dataSet/tailresult") == "T000" || model.getValue("/root/resData/dataSet/tailresult") == "E000" ) {
							alert("승인요청이 완료 되었습니다.");
						} else {
							var errcode = "";
							var errmsg  = "";

							if( model.getValue("/root/resData/dataSet/tailresult") == "" ) {
								errcode = model.getValue("/root/resData/errData/errcode");
								errmsg  = model.getValue("/root/resData/errData/errmsg");
							} else {
								errcode = model.getValue("/root/resData/dataSet/tailresult");
								errmsg  = model.getValue("/root/resData/dataSet/tailresultmsg");
							}
							
							alert("[" + errcode + "] " + errmsg + "\n승인의뢰신청 실패\n오류사항 점검 후 다시 진행해 주시기 바랍니다." );
						}
						
						button4.dispatch("onclick");

					}
				]]>
			</script>
		</button>
		<button id="button8" class="btn07" disabled="false" crud="R" style="left:945px; top:106px; width:165px; height:21px; ">
			<caption>승인결과수신</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var send_status = "";

					if( model.getValue("/root/reqData/searchResult/sdsiidx") == "") {
						alert("결과 수신 대상을 선택해 주세요");
						return;
					}
						
					send_status = datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status"));
					
					//if( datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status") ) < 1 || datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status") ) == 4 ) {
					if( send_status != 1 ) {
						alert("결과 수신 대상이 아닙니다");
						return;
					}
						
					if( commConfirmBox("카드결제 승인결과를 수신 하시겠습니까?") ) {
						if( model.getValue("/root/reqData/searchResult/sdsiidx") == "") {
							alert("결과 수신 대상을 선택해 주세요");
							return;
						}

						progressBarStart();
						model.send("tn_lnk_5060_a");
						progressBarEnd();

						if( check_submit_completed("결과수신이 완료 되었습니다.","") == true ) {
							button4.dispatch("onclick");
						}

					}
				]]>
			</script>
		</button>
		<caption id="caption36" class="list_cap01" style="left:1194px; top:102px; width:378px; height:30px; border-color:#ff0000; "/>
		<button id="button7" class="btn07" disabled="false" crud="R" style="left:1210px; top:106px; width:165px; height:21px; color:#ffcc99; ">
			<caption>건별 취소 요청</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var cnclCnt = 0;    //선택된 취소 건수
					var maxCnt  = 100;	//최대 건별 취소 건수
					var txt     = "";
					var chkmsg	= "";
					var cnclokdate = "";
					var currentdt = getCurrentDate();	
					

					if( model.getValue("/root/reqData/searchDetail/sdsiidx") == "") {
						alert("카드결제 [취소대상]을 선택해 주세요");
						return;
					}

					if( datagrid2.rows <  1 ) {
						alert("카드결제 [취소대상]을 선택해 주세요");
						return;
					}
					
					if( model.getValue("/root/reqData/searchDetail/status") != "2" ) {
						alert("취소요청 대상이 아닙니다");
						return;
					}
					
					if( datagrid2.rows >= 1 ) {

						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							if( datagrid2.valueMatrix( i, 1 ) == "Y" ) {
								
								cnclokdate = datagrid2.valueMatrix( i, datagrid2.colRef("cnclokdate") );
								
								//정상출금건아님, 취소가능일 벗어남
								if(cnclokdate == "" || currentdt > cnclokdate ) {
									//alert(cnclokdate + " : " + currentdt + " : " + ( currentdt > cnclokdate ? "1" : "2" ) );
									chkmsg += datagrid2.valueMatrix( i, 0 ) + ",";
								} else {								
									cnclCnt++;
								}
							}
						}
						
						if( chkmsg != "" ) {
							chkmsg = chkmsg.substring( 0, chkmsg.length - 1 );
							alert("선택 건 중 " + chkmsg + " 번은 취소불가건 입니다.\n(정상출금아님 또는 취소가능일자경과)");
							return;
						}
												
						if( cnclCnt <= 0 ) {
							alert("카드결제 [취소대상]을 선택해 주세요");
							return;
						} else if( cnclCnt > maxCnt ) {
							alert("건별 취소는 한번에 " + maxCnt + "건 이하만 가능합니다.");
							return;
						}					
					}
					
					if( commConfirmBox("[건별취소요청] 선택한 카드결제건의 취소요청을 진행 하시겠습니까?\n이미 취소된 건은 작업시 제외됩니다") ) {
						
						progressBarStart();						
						model.removeNode("/root/resData/dataSet");
						model.refresh();
						set_refvalue("/root/reqData/cancelSdsi/cmpy_cd",	getProperty("ss_cmpycd"));
						set_refvalue("/root/reqData/cancelSdsi/cnclclsf", 	"1");
						set_refvalue("/root/reqData/cancelSdsi/sdsiidx", 	model.getValue("/root/reqData/searchDetail/sdsiidx"));
						model.setValue("/root/reqData/cancelSdsi/multiUpdateData", datagrid2.getUpdateData("update"));
						model.send("tn_lnk_5070_a");
						progressBarEnd();

						show_message("취소작업이 완료 되었습니다");
						model.refresh();
						button4.dispatch("onclick");
					}
						
				]]>
			</script>
		</button>
		<button id="button10" class="btn07" disabled="false" crud="R" style="left:1385px; top:106px; width:165px; height:21px; color:#ffcc99; ">
			<caption>일괄 취소 요청</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var txt = "";
					
					if( model.getValue("/root/reqData/searchDetail/sdsiidx") == "") {
						alert("카드결제 [취소대상]을 선택해 주세요");
						return;
					}

					if( model.getValue("/root/reqData/searchDetail/status") != "2" ) {
						alert("취소요청 대상이 아닙니다");
						return;
					}
					

					if( commConfirmBox("[일괄취소요청] 카드결제 일괄취소요청을 진행 하시겠습니까?\n\n이미 취소된 건은 작업시 제외되며, 취소가능건(정상출금건/취소가능일자 이내건)만 취소처리 됩니다.") ) {
						
						progressBarStart();
						model.removeNode("/root/resData/dataSet");
						model.refresh();
						set_refvalue("/root/reqData/cancelSdsi/cmpy_cd",	getProperty("ss_cmpycd"));
						set_refvalue("/root/reqData/cancelSdsi/cnclclsf", 	"0");
						set_refvalue("/root/reqData/cancelSdsi/sdsiidx", 	model.getValue("/root/reqData/searchDetail/sdsiidx"));
						model.setValue("/root/reqData/cancelSdsi/multiUpdateData", datagrid2.getUpdateData("update"));
						model.send("tn_lnk_5070_a");
						progressBarEnd();

						show_message("취소작업이 완료 되었습니다");						
						model.refresh();
						button4.dispatch("onclick");
					}
						
				]]>
			</script>
		</button>
		<group id="group3" style="left:10px; top:745px; width:390px; height:80px; "/>
		<output id="output11" ref="/root/resData/totData/delcount" visibility="hidden" format="#,###" style="left:39px; top:792px; width:80px; height:18px; color:#008000; text-align:right; vertical-align:middle; "/>
		<output id="output12" ref="/root/resData/totData/delprice" visibility="hidden" format="#,###" style="left:130px; top:790px; width:90px; height:18px; color:#008000; text-align:right; vertical-align:middle; "/>
		<caption id="caption31" class="list_cap01" visibility="hidden" style="left:33px; top:760px; width:93px; height:28px; ">제외건수</caption>
		<caption id="caption32" class="list_cap01" visibility="hidden" style="left:125px; top:760px; width:101px; height:28px; ">제외금액</caption>
		<button id="button11" class="btn07" disabled="false" crud="R" style="left:770px; top:106px; width:165px; height:21px; ">
			<caption>승인요청내역조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var send_status = "";
					
					if( model.getValue("/root/reqData/searchResult/sdsiidx") == "") {
						alert("승인요청내용 조회대상을 선택해 주세요");
						return;
					}
					
					send_status = datagrid1.valueMatrix( datagrid1.row, datagrid1.colRef("status"));
					
					if( send_status != 1 ) {
						alert("승인요청내용 조회 대상이 아닙니다");
						return;
					}					

					if( commConfirmBox("승인요청내용 결과조회를 진행 하시겠습니까?") ) {
						progressBarStart();
						set_refvalue("/root/reqData/searchDetail/cmpy_cd", getProperty("ss_cmpycd"));
						model.removenode("/root/resData/totData");
						model.send("tn_lnk_5080_a");
						fnColHidden(1);
						progressBarEnd();

						if( check_submit_completed("승인요청내용 결과조회가 완료 되었습니다.","") == true ) {														
						}
					}

				]]>
			</script>
		</button>
		<button id="button12" class="btn07" disabled="false" visibility="hidden" crud="R" style="left:1385px; top:73px; width:165px; height:21px; color:#ffcc99; ">
			<caption>카드회원삭제</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					var delCnt  = 0;    //선택된 취소 건수
					var maxCnt  = 100;	//최대 건별 취소 건수
					var txt     = "";
					var chkmsg	= "";
					var currentdt = getCurrentDate();	
					

					if( model.getValue("/root/reqData/searchDetail/sdsiidx") == "") {
						alert("카드결제 [회원삭제대상]을 선택해 주세요");
						return;
					}

					if( datagrid2.rows <  1 ) {
						alert("카드결제 [회원삭제대상]을 선택해 주세요");
						return;
					}
					
					/*
					if( model.getValue("/root/reqData/searchDetail/status") != "3" ) {
						alert("회원삭제대상 대상이 아닙니다");
						return;
					}
					*/
					
					if( datagrid2.rows >= 1 ) {

						for( var i=datagrid2.fixedRows; i<datagrid2.rows; i++ )
						{
							if( datagrid2.valueMatrix( i, 1 ) == "Y" ) {	
								delCnt++;
							}
						}
												
						if( delCnt <= 0 ) {
							alert("카드결제 [회원삭제대상]을 선택해 주세요");
							return;
						} else if( delCnt > maxCnt ) {
							alert("건별 취소는 한번에 " + maxCnt + "건 이하만 가능합니다.");
							return;
						}					
					}
					
					if( commConfirmBox("[카드회원삭제] 선택한 카드결제건회원의 정보삭제요청을 진행 하시겠습니까?") ) {
						
						progressBarStart();						
						model.removeNode("/root/resData/dataSet");
						model.refresh();
						set_refvalue("/root/reqData/cancelSdsi/cmpy_cd",	getProperty("ss_cmpycd"));
						model.setValue("/root/reqData/cancelSdsi/multiUpdateData", datagrid2.getUpdateData("update"));
						model.send("tn_lnk_5090_a");
						progressBarEnd();

						show_message("회원삭제작업이 완료 되었습니다");
						model.refresh();
						button4.dispatch("onclick");
					}
						
				]]>
			</script>
		</button>
		<button id="button13" class="btn07" disabled="false" visibility="hidden" crud="R" style="left:770px; top:74px; width:165px; height:21px; ">
			<caption>서버접속테스트</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					model.removeNodeset("/root/initData/connData/conn_log");
					progressBarStart();
					model.send("tn_lnk_5005_m");
					progressBarEnd();
					
					alert(model.getValue("/root/initData/connData/conn_log"));
				]]>
			</script>
		</button>
	</xhtml:body>
</xhtml:html>
