<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="../../../css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>원가집계및전표처리(MC_COST_3010)</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<!-- 화면 로딩시의 초기 데이터 -->
						<session/>
						<!-- 서버의 세션 정보 -->
						<comboSet>
							<!-- 선택계열(콤보박스,체크박스,리스트박스,라디오버튼)의 정보 -->
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo/>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영시 사용(화면ID등) -->
					</initData>
					<reqData>
						<!-- 서버에 전달하고자 하는 데이터 (submit시 처리) -->
						<fwdData/>
						<!-- popup등의 페이지전환시 데이타 입출력에 사용 -->
						<searchData>
							<yymm/>
							<clos_clsf/>
							<slip_clsf/>
							<kind/>
						</searchData>
						<!-- 검색조건 처리 -->
						<reqForm>
							<yymm/>
							<incmg_pers1/>
							<incmg_pers_nm1/>
							<dept_cd1/>
							<tms/>
							<tms_yb1/>
							<tms1/>
							<tms_yb/>
							<incmg_dt/>
							<fist_dt/>
							<incmg_pers2/>
							<incmg_pers_nm2/>
							<clam_dept_cd/>
							<clam_dept_cd_nm/>
							<incmg_pers/>
							<dept_cd/>
							<gubun>1</gubun>
						</reqForm>
						<!-- 입력처리 formData 복수사용시 하위노드로 1,2,3으로 정의-->
						<multiUpDate>
						</multiUpDate>
						<!-- Grid의 MultiUpDate유형 사용시 처리 -->
					</reqData>
					<resData>
						<!-- 서버로부터 전달 받은 데이터 (submit의 결과) -->
						<resForm>
							<!-- (submit의 결과) formData 복수사용시 하위노드로 1,2,3으로 정의 -->
							<mc_cost_3010_a>
								<dataSet>
									<xx_clos_clsf_010/>
									<xx_clos_clsf_020/>
									<xx_clos_clsf_030/>
									<CURLIST_01>
										<record>
											<col1/>
										</record>
									</CURLIST_01>
									<CURLIST_02>
										<record>
											<col1/>
										</record>
									</CURLIST_02>
									<CURLIST_03>
										<record>
											<col1/>
										</record>
									</CURLIST_03>
									<CURLIST_04>
										<record>
											<budg_cdnm/>
										</record>
									</CURLIST_04>
									<CURLIST_05>
										<record>
											<ndstb_cd/>
										</record>
									</CURLIST_05>
									<CURLIST_06>
										<record>
											<dstb_nm/>
										</record>
									</CURLIST_06>
									<CURLIST_07>
										<record>
											<bscd_no_entry/>
											<bscd_err/>
										</record>
									</CURLIST_07>
									<CURLIST_08>
										<record>
											<bsbbcd_no_entry/>
											<bsbbcd_err/>
										</record>
									</CURLIST_08>
									<CURLIST_09>
										<record>
											<excp_dstb_cd/>
										</record>
									</CURLIST_09>
								</dataSet>
							</mc_cost_3010_a>
							<mc_cost_3017_m>
								<dataSet>
									<CURLIST>
										<record>
											<col1/>
										</record>
									</CURLIST>
								</dataSet>
							</mc_cost_3017_m>
							<mc_cost_3018_l>
								<dataSet>
									<CURLIST>
										<record>
											<slip_no/>
										</record>
									</CURLIST>
								</dataSet>
							</mc_cost_3018_l>
						</resForm>
						<gridData>
							<mc_cost_3015_l>
								<dataSet>
									<CURLIST>
										<record>
											<yymm/>
											<use_dept_cd/>
											<use_dept_cdnm/>
											<budg_cd/>
											<budg_cdnm/>
											<medi_cd/>
											<dtls_medi_cd/>
											<dtls_medi_cdnm/>
											<dstb_dept_cd1/>
											<dstb_dept_cdnm1/>
											<dstb_dept_cd2/>
											<dstb_dept_cdnm2/>
											<dstb_medi_cd/>
											<acct_cd/>
											<acct_cdnm/>
											<amt/>
										</record>
									</CURLIST>
								</dataSet>
							</mc_cost_3015_l>
							<mc_cost_3016_l>
								<dataSet>
									<CURLIST>
										<record>
											<yymm/>
											<use_dept_cd/>
											<budg_cd/>
											<budg_cdnm/>
											<medi_cd/>
											<dtls_medi_cd/>
											<dtls_medi_cdnm/>
											<dstb_dept_cd2/>
											<dstb_dept_cdnm2/>
											<dstb_medi_cd/>
											<acct_cd/>
											<acct_cdnm/>
											<amt/>
										</record>
									</CURLIST>
								</dataSet>
							</mc_cost_3016_l>
						</gridData>
						<!-- (submit의 결과) gridData 복수사용시 하위노드로 1,2,3으로 정의 -->
						<MsgData/>
						<!-- (submit의 결과) 전달 받은 MsgData -->
					</resData>
					<tempData>
						<!-- 데이터를 가공할 임시저장소 -->
						<keyData/>
						<!-- 해당화면의 키값등의 데이터의 저장소 -->
						<fc_co_1101_l>
							<dataSet>
								<CURLIST1>
									<record>
										<cmpy_cd/>
										<dept_cd/>
										<dept_team_clsf/>
										<abrv_nm/>
										<offi_nm/>
										<dept_team_nm/>
										<part_nm/>
										<part_dn_nm/>
									</record>
								</CURLIST1>
							</dataSet>
						</fc_co_1101_l>
					</tempData>
					<!-- 저장소 -->
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					S_AllDateCaption();
					set_refvalue("/root/reqData/searchData/kind","01");
					model.send("mc_cost_3010_a");					
					yymm.value = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_01/record/col1");
					S_AllDateCaption();
					
					ss_emp_no = getProperty("ss_emp_no");
					ss_emp_nm = getProperty("ss_emp_nm");
					ss_deptcd = getProperty("ss_deptcd");
					ss_deptnm = getProperty("ss_deptnm");					

					G_WorkSabeon = getProperty("ss_emp_no");
					
					set_refvalue("/root/reqData/reqForm/incmg_pers1", ss_emp_no);
					set_refvalue("/root/reqData/reqForm/incmg_pers_nm1", ss_emp_nm);					
					set_refvalue("/root/reqData/reqForm/dept_cd1", ss_deptcd + "    " + ss_deptnm);
					incmg_pers.refresh();
					incmg_pers_nm.refresh();
					dept_cd.refresh();
					G_Cym =  yymm.value
					
					// 등록정보창 설정
					incmg_dt.value = commCurDate();
					fist_dt.value = addDate("d", -1, yymm.value+"01", "");
					incmg_pers2.value = ss_emp_no;
					incmg_pers_nm2.value = ss_emp_nm;
					clam_dept_cd.value = ss_deptcd;
					clam_dept_cd_nm.value = ss_deptnm;
					/*
					alert(model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_010"));
					alert(model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));
					alert(model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_030"));
					*/
				]]>
			</script>
			<script type="javascript" src="/js/CIISComm.js"/>
			<script type="javascript" src="/js/TFCommon.js"/>
			<script type="javascript" src="/js/fcmc_common.js"/>
			<script type="javascript" ev:event="xforms-model-construct-done">
				<![CDATA[
					init_controls();									
				]]>
			</script>
			<submission id="mc_cost_3010_a" action="/mc/cost3000/3010" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/resForm/mc_cost_3010_a/dataSet"/>
			<submission id="mc_cost_3011_i" action="/mc/cost3000/3011" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="mc_cost_3012_d" action="/mc/cost3000/3012" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="mc_cost_3013_i" action="/mc/cost3000/3013" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="mc_cost_3014_d" action="/mc/cost3000/3014" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="mc_cost_3015_l" action="/mc/cost3000/3015" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/mc_cost_3015_l/dataSet"/>
			<submission id="mc_cost_3016_l" action="/mc/cost3000/3016" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/mc_cost_3016_l/dataSet"/>
			<submission id="mc_cost_3017_m" action="/mc/cost3000/3017" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/resData/resForm/mc_cost_3017_m/dataSet"/>
			<submission id="mc_cost_3018_l" action="/mc/cost3000/3018" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/resForm/mc_cost_3018_l/dataSet"/>
			<submission id="hd_com_1002" action="/hd/com/1002" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/fwdData" resultref="/root/tempData"/>
			<submission id="fc_co_1101" action="/fc/co1000/1101" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/fwdData" resultref="/root/tempData/fc_co_1101_l/dataSet"/>
		</model>
		<script type="javascript">
			<![CDATA[
				var ss_emp_no;
				var ss_emp_nm;
				var ss_deptcd;
				var ss_deptnm;
				var G_Cym;
				var G_WorkSabeon;
				var G_InBuseo;
				var G_InSabeon;
				var G_InCymd;
				var G_AcntCymd;
				var G_flag;
							
				function init_controls(){
					set_default(
						datagrid1
					,	yymm
					,	incmg_pers_nm
					,	dept_cd
					,	incmg_pers_nm2
					,	clam_dept_cd_nm
					);					//input
					set_default(
						incmg_pers
					,	incmg_pers2
					,	clam_dept_cd
					);					//input button
					set_default(
						incmg_dt
					,	fist_dt
					);					//input date
					set_format(
						"code"
					,	datagrid1, "1,3,5,6,8,10,12,13"
					,	incmg_pers
					,	incmg_pers2
					,	clam_dept_cd					
					);
					set_format(
						"string_l"
					,	datagrid1, "2,4,7,9,11,14"
					,	incmg_pers_nm
					,	dept_cd
					,	incmg_pers_nm2
					,	clam_dept_cd_nm
					);
					set_format(
						"month_1"
					,	datagrid1, "0"
					,	yymm
					,	yymm2	
					);
					set_format(
						"date_1"
					,	incmg_dt
					,	fist_dt
					);
					
					set_format(
						"number1"
					,	datagrid1, "15"
					);
				}
				function setEmp_no(emp_no, nm_korn){
					incmg_pers.value = emp_no;
					incmg_pers_nm.value = nm_korn;
				}
				function setEmp_no1(emp_no, nm_korn){
					incmg_pers2.value = emp_no;
					incmg_pers_nm2.value = nm_korn;
				}			
				function setDept_cd(iv_dept_cd, iv_dept_nm, iv_dept_team_clsf, iv_offi_nm, iv_dept_team_nm, iv_part_nm, iv_part_dn_nm){	
					model.setValue("/root/reqData/reqForm/clam_dept_cd", iv_dept_cd);
					model.setValue("/root/reqData/reqForm/clam_dept_cd_nm", iv_dept_nm);
					clam_dept_cd.refresh();
					clam_dept_cd_nm.refresh();
				}		
				function S_AllDateCaption(){
					//S_DateCaption("1", "WJ");		// lblWjibgye ="1"		원가배부결과집계처리
					//S_DateCaption("2", "JL");		// lblJl ="2"			제조/일반경비전표처리
					S_DateCaption("1", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_010"));		// lblWjibgye ="1"		원가배부결과집계처리
					S_DateCaption("2", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));		// lblJl ="2"			제조/일반경비전표처리
				}
				function S_DateCaption(cControl,sGbcd){
					var sMagamYb;
					var CYM;
					var JPGB; 
					var WJJPNO;

					set_refvalue("/root/reqData/searchData/yymm",yymm.value);
					set_refvalue("/root/reqData/searchData/kind","03");			//kind 03인 경우 마감여부 chk
					set_refvalue("/root/reqData/searchData/clos_clsf",sGbcd);
						
					model.send("mc_cost_3010_a");
						
					sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
												
					if(sMagamYb.substring(0,1) == "Y"){
						if(cControl == "1"){
							lblWjibgye.attribute("text") = "최종처리시간 : " + sMagamYb.substring(1,20);
						}
						else if(cControl == "2"){
							lblJl.attribute("text") = "최종처리시간 : " + sMagamYb.substring(1,20);
						}
					}
					else{
						if(cControl == "1"){
							lblWjibgye.attribute("text") = "최종처리시간 : 처리정보 없음";
						}
						else if(cControl == "2"){
							lblJl.attribute("text") = "최종처리시간 : 처리정보 없음";
						}
					}
					set_refvalue("/root/reqData/searchData/yymm",yymm.value);
					//if(sGbcd =="JL"){
					if(sGbcd ==model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020")){
						set_refvalue("/root/reqData/searchData/slip_clsf","1");
						model.send("mc_cost_3018_l");
						
						totalcnt = get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/totalcnt");
						
						if (totalcnt == 0) {
							lblJlJpNo.attribute("text") = "전표 생성 정보 없음";
						}
						else{
							lblJlJpNo.attribute("text") = "전표번호 : " + get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(0,8) + "-" + get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(8,10) + "-" + get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(10,13);
						}
					}
				}
				
				function tab2_search(){
					if(gubun.value == "1"){
						datagrid1.nodeset = "/root/resData/gridData/mc_cost_3015_l/dataSet/CURLIST/record";
						datagrid1.colHidden(2) = false;
						datagrid1.colHidden(8) = false;
						datagrid1.colHidden(9) = false;
						model.send("mc_cost_3015_l");
					}else{
						datagrid1.nodeset = "/root/resData/gridData/mc_cost_3016_l/dataSet/CURLIST/record";
						datagrid1.colHidden(2) = true;
						datagrid1.colHidden(8) = true;
						datagrid1.colHidden(9) = true;
						model.send("mc_cost_3016_l");
					}
					if(datagrid1.rows == 1){
						show_message("검색결과가 없습니다.");
					}
					
					datagrid1.refresh();
				}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="765" guideline="2,34;2,39;2,40;2,49;2,70;2,78;2,80;1,936;1,927;1,926;2,755;1,30;1,896;">
		<group id="group_line" class="gro_line" style="left:10px; top:83px; width:926px; height:5px; "/>
		<group id="grp_buttons" class="gro_sel" style="left:10px; top:50px; width:926px; height:21px; ">
			<button id="btn_select" class="btn02" crud="R" style="left:726px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if(switch1.selectedIndex == 0){
							G_Cym = yymm.value;
						}else{
							tab2_search();
						}
					]]>
				</script>
			</button>
			<button id="btnClose" class="btn02" style="left:871px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						formClose();
					]]>
				</script>
			</button>
			<button id="btn_select_slip" class="btn04" crud="R" style="left:781px; top:0px; width:87px; height:21px; ">
				<caption>전표건별조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if(get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no") !=""){
							model.property("FC_ACCT_2470_srch_slip_occr_dt")  = get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(0,8);
							model.property("FC_ACCT_2470_srch_slip_clsf_cd")  = get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(8,10);
							model.property("FC_ACCT_2470_srch_slip_seq")  = get_refvalue("/root/resData/resForm/mc_cost_3018_l/dataSet/CURLIST/record/slip_no").substring(10,13);
							model.property("FC_ACCT_2470_srch_slip_sub_seq")  = "0";
							model.property("FC_ACCT_2470_popup_flag")  = "Y";

							//viewer("mainFrame").window.javaScript.onLoadExPopupPage("FC_ACCT_2470");
							viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_ACCT_2470");	
						}else{
							show_message("등록된 전표번호가 없습니다.");
						}
					]]>
				</script>
			</button>
		</group>
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<switch id="switch1" style="left:9px; top:120px; width:917px; height:615px; ">
			<case id="case1" selected="true">
				<group id="group4" style="left:20px; top:160px; width:867px; height:60px; ">
					<button id="btn_insert_bb" class="btn07" crud="C" style="left:220px; top:30px; width:161px; height:21px; ">
						<caption>원가배부결과집계정보생성</caption>
						<script type="javascript" ev:event="onclick">
							<![CDATA[
						var iMsgVal;
						var sMagamYb;

						if(!commReqCheck(group_scr)) {
							return false;
						}
						
						set_refvalue("/root/reqData/searchData/yymm",G_Cym);
						set_refvalue("/root/reqData/searchData/kind","03");			//kind 03인 경우 마감여부 chk
						//set_refvalue("/root/reqData/searchData/clos_clsf","CB");
						set_refvalue("/root/reqData/searchData/clos_clsf",model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_030"));
						
						model.send("mc_cost_3010_a");
						
						sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
						
						if(sMagamYb.substring(0,1) == "N"){
							show_message("처리할 수 없는 자료입니다.(최종배부결과정보)");
					 	  	return false;
						}

						//set_refvalue("/root/reqData/searchData/clos_clsf","JL");
						set_refvalue("/root/reqData/searchData/clos_clsf",model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));
						
						model.send("mc_cost_3010_a");
						
						sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
						
						if(sMagamYb.substring(0,1) == "N"){
							show_message("제조/일반경비 전표가 생성되지 않아 처리할 수 없습니다.");
					 	  	return false;
						}

						//set_refvalue("/root/reqData/searchData/clos_clsf","WJ");
						set_refvalue("/root/reqData/searchData/clos_clsf",model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_010"));
						
						model.send("mc_cost_3010_a");
						
						sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
						
						if(sMagamYb.substring(0,1) == "Y"){
							if (show_message("이미 처리된 자료입니다.\n재 생성 하시겠습니까?","처리내용",MB_YESNO) != IDYES) {
						 	  	return false;
							}
							btn_delete_bb.dispatch("onclick");
						}

						set_refvalue("/root/reqData/reqForm/yymm",G_Cym);
												
						model.send("mc_cost_3013_i");												

						if(submit_completed()){						
							show_message("저장되었습니다.");	
							//S_DateCaption("1", "WJ");				// lblWjibgye =1"
							S_DateCaption("1", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_010"));				// lblWjibgye =1"
						}
					]]>
						</script>
					</button>
					<button id="btn_delete_bb" class="btn07" crud="D" style="left:384px; top:30px; width:161px; height:21px; ">
						<caption>원가배부결과집계정보삭제</caption>
						<script type="javascript" ev:event="onclick">
							<![CDATA[
						if (show_message("해당 자료를 삭제하시겠습니까?","삭제 확인",MB_YESNO) != IDYES) {
					 	  	return false;
						}
						
						if(!commReqCheck(group_scr)) {
							return false;
						}
							
						set_refvalue("/root/reqData/reqForm/yymm",G_Cym);

						model.send("mc_cost_3014_d");

						if(submit_completed()){
							show_message("삭제되었습니다.");
							//S_DateCaption("1", "WJ");				// lblWjibgye ="1"
							S_DateCaption("1", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_010"));				// lblWjibgye ="1"
						}					
					]]>
						</script>
					</button>
					<caption id="caption9" class="tit02" style="left:5px; top:5px; width:524px; height:20px; ">원가배부결과집계처리</caption>
					<caption id="lblWjibgye" style="left:20px; top:30px; width:235px; height:20px; ">최종생성시간 : 1998/01/01 13:20</caption>
				</group>
				<group id="group2" style="left:20px; top:60px; width:867px; height:75px; ">
					<button id="btn_insert_gj" class="btn07" crud="C" style="left:220px; top:30px; width:161px; height:21px; ">
						<caption>제조경비배분전표투입</caption>
						<script type="javascript" ev:event="onclick">
							<![CDATA[
						var iMsgVal;
						var sMagamYb;

						if(!commReqCheck(group_scr)) {
							return false;
						}

						set_refvalue("/root/reqData/searchData/yymm",yymm.value);
						set_refvalue("/root/reqData/searchData/kind","03");			//kind 03인 경우 마감여부 chk
						//set_refvalue("/root/reqData/searchData/clos_clsf","CB");
						set_refvalue("/root/reqData/searchData/clos_clsf",model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_030"));
						
						model.send("mc_cost_3010_a");
						
						sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
						
						if(sMagamYb.substring(0,1) == "N"){
							show_message("처리할 수 없는 자료입니다.(최종배부결과정보)");
					 	  	return false;
						}

						var DISPDATE;
						G_flag = "1";
						if(G_InBuseo == "" || G_InSabeon == "" || G_InCymd == ""){
							show_message("처리된 자료가 없습니다.");
							return false;
						} 

						if(G_flag =="1"){
//							set_refvalue("/root/reqData/reqForm/incmg_dt", commCurDate());
							set_refvalue("/root/reqData/reqForm/incmg_dt", model1.getValue("/root/reqData/reqForm/incmg_dt"));
							DISPDATE = yymm.value+"01";
//							set_refvalue("/root/reqData/reqForm/fist_dt",addDate("d", -1, DISPDATE, ""));
							set_refvalue("/root/reqData/reqForm/incmg_pers2", ss_emp_no);
							set_refvalue("/root/reqData/reqForm/incmg_pers", ss_emp_no);
							set_refvalue("/root/reqData/reqForm/incmg_pers_nm2", ss_emp_nm);					
							set_refvalue("/root/reqData/reqForm/clam_dept_cd", ss_deptcd);
							set_refvalue("/root/reqData/reqForm/dept_cd", ss_deptcd);
							set_refvalue("/root/reqData/reqForm/clam_dept_cd_nm", ss_deptnm);
						}											
						
						//set_refvalue("/root/reqData/searchData/clos_clsf","JL");
						set_refvalue("/root/reqData/searchData/clos_clsf",model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));
						
						model.send("mc_cost_3010_a");
						
						sMagamYb = get_refvalue("/root/resData/resForm/mc_cost_3010_a/dataSet/CURLIST_03/record/col1");
						
						if(sMagamYb.substring(0,1) == "Y"){
							if (show_message("이미 처리된 자료입니다.\n재 생성 하시겠습니까?","처리내용",MB_YESNO) != IDYES) {
						 	  	return false;
							}
							btn_delete_gj.dispatch("onclick");
						}

						set_refvalue("/root/reqData/reqForm/yymm",G_Cym);
												
						model.send("mc_cost_3011_i");

						if(submit_completed()){						
							show_message("저장되었습니다.");	
							//S_DateCaption("2", "JL");				// lblJl ="2"
							S_DateCaption("2", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));				// lblJl ="2"
						}
					]]>
						</script>
					</button>
					<button id="btn_delete_gj" class="btn07" crud="D" style="left:384px; top:30px; width:161px; height:21px; ">
						<caption>제조경비배분전표삭제</caption>
						<script type="javascript" ev:event="onclick">
							<![CDATA[
						if (show_message("해당 자료를 삭제하시겠습니까?","삭제 확인",MB_YESNO) != IDYES) {
					 	  	return false;
						}
						
						if(!commReqCheck(group_scr)) {
							return false;
						}
						
						set_refvalue("/root/reqData/reqForm/yymm",G_Cym);

						model.send("mc_cost_3012_d");

						if(submit_completed()){						
							show_message("삭제되었습니다.");
							//S_DateCaption("2", "JL");			// lblJl ="2"
							S_DateCaption("2", model1.getValue("/root/resData/resForm/mc_cost_3010_a/dataSet/xx_clos_clsf_020"));			// lblJl ="2"
						}
					]]>
						</script>
					</button>
					<caption id="caption12" class="tit02" style="left:5px; top:5px; width:524px; height:20px; ">제조/일반경비전표처리</caption>
					<caption id="lblJl" style="left:20px; top:30px; width:245px; height:20px; ">최종생성시간 : 1998/01/01 13:20</caption>
					<caption id="lblJlJpNo" style="left:20px; top:50px; width:240px; height:20px; ">최종생성시간 : 1998/01/01 13:20</caption>
				</group>
				<group id="group_scr" class="gro_sel" style="left:20px; top:15px; width:866px; height:26px; ">
					<caption id="caption16" class="list_cap03" style="left:0px; top:0px; width:110px; height:26px; text-align:center; ">년월</caption>
					<caption id="caption18" class="list_cap02" style="left:109px; top:0px; width:757px; height:26px; text-align:center; "/>
					<caption id="caption20" class="list_cap03" style="left:200px; top:0px; width:110px; height:26px; ">등록자</caption>
					<caption id="caption21" class="list_cap03" style="left:535px; top:0px; width:110px; height:26px; ">등록부서</caption>
					<input id="yymm" ref="/root/reqData/reqForm/yymm" class="req" navindex="1" caption="년월" style="left:115px; top:4px; width:80px; height:18px; ">
						<script type="javascript" ev:event="xforms-value-changed">
							<![CDATA[
						if(G_Cym !=  yymm.value){
							G_Cym =  yymm.value;
							S_AllDateCaption();
						}
					]]>
						</script>
					</input>
					<input id="incmg_pers" ref="/root/reqData/reqForm/incmg_pers1" class="req" navindex="2" inputtype="button" caption="등록자" style="left:315px; top:4px; width:80px; height:18px; ">
						<script type="javascript" ev:event="onbuttonclick">
							<![CDATA[
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");
						model.setValue("/root/reqData/fwdData/func_nm", "setEmp_no");
						window.load("/xrw/hd/com/HD_COM_1000.xrw","mdichild", "hd_com_1000", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
						</script>
						<script type="javascript" ev:event="xforms-value-changed">
							<![CDATA[
						if (incmg_pers.value.length == 6) {
							model.removeNodeset("/root/reqData/fwdData");  
							model.makeNode("/root/reqData/fwdData/emp_no");
							model.setValue("/root/reqData/fwdData/emp_no", incmg_pers.value);
							model.send("hd_com_1002");
							
							if (model.getValue("/root/tempData/record/emp_no") != "") {
								incmg_pers_nm.value = model.getValue("/root/tempData/record/nm_korn");
							}
							else {
								incmg_pers.value = "";
								incmg_pers_nm.value = "";
							}
						}		
						else {
							incmg_pers.value = "";
							incmg_pers_nm.value = "";
						}													
						
					]]>
						</script>
					</input>
					<input id="incmg_pers_nm" ref="/root/reqData/reqForm/incmg_pers_nm1" editable="false" style="left:400px; top:4px; width:130px; height:18px; "/>
					<input id="dept_cd" ref="/root/reqData/reqForm/dept_cd1" editable="false" style="left:650px; top:4px; width:210px; height:18px; "/>
				</group>
				<group id="group1" style="left:240px; top:235px; width:345px; height:130px; border-color:#c0c0c0; border-style:solid; ">
					<caption id="caption1" class="list_cap02" style="left:112px; top:50px; width:225px; height:26px; "/>
					<caption id="caption2" class="list_cap02" style="left:112px; top:25px; width:225px; height:26px; "/>
					<caption id="caption3" class="list_cap03" style="left:3px; top:25px; width:110px; height:26px; ">입력일자</caption>
					<caption id="caption8" class="list_cap03" style="left:3px; top:50px; width:110px; height:26px; ">회계일자</caption>
					<caption id="caption10" class="list_cap02" style="left:112px; top:75px; width:225px; height:26px; "/>
					<caption id="caption22" class="list_cap03" style="left:3px; top:75px; width:110px; height:26px; ">담당사번</caption>
					<caption id="caption29" class="list_cap03" style="left:3px; top:100px; width:110px; height:26px; ">청구부서</caption>
					<caption id="caption31" class="list_cap02" style="left:112px; top:100px; width:225px; height:26px; "/>
					<input id="incmg_dt" ref="/root/reqData/reqForm/incmg_dt" class="req" navindex="3" inputtype="date" format="yyyy-mm-dd" style="left:115px; top:29px; width:100px; height:18px; "/>
					<input id="fist_dt" ref="/root/reqData/reqForm/fist_dt" class="req" navindex="4" inputtype="date" format="yyyy-mm-dd" style="left:115px; top:54px; width:100px; height:18px; "/>
					<input id="clam_dept_cd_nm" ref="/root/reqData/reqForm/clam_dept_cd_nm" editable="false" style="left:200px; top:104px; width:130px; height:18px; "/>
					<input id="clam_dept_cd" ref="/root/reqData/reqForm/clam_dept_cd" class="req" navindex="6" inputtype="button" style="left:115px; top:104px; width:80px; height:18px; ">
						<script type="javascript" ev:event="onbuttonclick">
							<![CDATA[
						var var_con_date = "";

						if (incmg_dt.value == ""){ 
								var_con_date = commCurDate(); 
							}else { 
								var num_ch = incmg_dt.value.length;
								if(num_ch == 8){
									var_con_date = incmg_dt.value;
								}else if(num_ch == 6){
									var_con_date = incmg_dt.value + "01";
								}else if(num_ch == 4){
									var_con_date = incmg_dt.value + "0101";
								}else{
									var_con_date = commCurDate(); 
								}
							}
							
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");
						model.setValue("/root/reqData/fwdData/func_nm", "setDept_cd");
						model.makeNode("/root/reqData/fwdData/select_ch");
						model.setValue("/root/reqData/fwdData/select_ch", "S");
						model.makeNode("/root/reqData/fwdData/use_end_dt");
						model.setValue("/root/reqData/fwdData/use_end_dt", var_con_date);
						window.load("/xrw/fc/co/FC_CO_1100.xrw","mdichild", "fc_co_1100", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
						
					]]>
						</script>
						<script type="javascript" ev:event="xforms-value-changed">
							<![CDATA[
						
						var var_con_date = "";

						if (incmg_dt.value == ""){ 
								var_con_date = commCurDate(); 
							}else { 
								var num_ch = incmg_dt.value.length;
								if(num_ch == 8){
									var_con_date = incmg_dt.value;
								}else if(num_ch == 6){
									var_con_date = incmg_dt.value + "01";
								}else if(num_ch == 4){
									var_con_date = incmg_dt.value + "0101";
								}else{
									var_con_date = commCurDate(); 
								}
							}

						if (clam_dept_cd.value.length== 6) {
							
							model.removeNodeset("/root/reqData/fwdData");  
							model.makeNode("/root/reqData/fwdData/dept_cd");
							model.makeNode("/root/reqData/fwdData/select_ch");
							model.makeNode("/root/reqData/fwdData/use_end_dt");
							model.setValue("/root/reqData/fwdData/dept_cd", clam_dept_cd.value);
							model.setValue("/root/reqData/fwdData/select_ch", "S");
							model.setValue("/root/reqData/fwdData/use_end_dt", var_con_date);
							model.send("fc_co_1101");

							if (model.getValue("/root/tempData/fc_co_1101_l/dataSet/CURLIST1/record/dept_cd") != "") {
								clam_dept_cd_nm.value = model.getValue("/root/tempData/fc_co_1101_l/dataSet/CURLIST1/record/abrv_nm");
							}
							else {
								clam_dept_cd.value = "";
								clam_dept_cd_nm.value = "";
							}
						}
						else {
							clam_dept_cd.value = "";
							clam_dept_cd_nm.value = "";
						}	
																		
					]]>
						</script>
					</input>
					<caption id="caption33" class="tit02" style="left:4px; top:4px; width:334px; height:20px; ">등록정보</caption>
					<input id="incmg_pers2" ref="/root/reqData/reqForm/incmg_pers2" class="req" navindex="5" inputtype="button" caption="등록자" style="left:115px; top:79px; width:80px; height:18px; ">
						<script type="javascript" ev:event="onbuttonclick">
							<![CDATA[
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");
						model.setValue("/root/reqData/fwdData/func_nm", "setEmp_no1");
						window.load("/xrw/hd/com/HD_COM_1000.xrw","mdichild", "hd_com_1000", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
						</script>
						<script type="javascript" ev:event="xforms-value-changed">
							<![CDATA[
						if (incmg_pers.value.length == 6) {
							model.removeNodeset("/root/reqData/fwdData");  
							model.makeNode("/root/reqData/fwdData/emp_no");
							model.setValue("/root/reqData/fwdData/emp_no", incmg_pers2.value);
							model.send("hd_com_1002");
							
							if (model.getValue("/root/tempData/record/emp_no") != "") {
								incmg_pers_nm2.value = model.getValue("/root/tempData/record/nm_korn");
							}
							else {
								incmg_pers2.value = "";
								incmg_pers_nm2.value = "";
							}
						}		
						else {
							incmg_pers2.value = "";
							incmg_pers_nm2.value = "";
						}

					]]>
						</script>
					</input>
					<input id="incmg_pers_nm2" ref="/root/reqData/reqForm/incmg_pers_nm2" editable="false" style="left:200px; top:79px; width:130px; height:18px; "/>
				</group>
			</case>
			<case id="case2">
				<group id="group3" class="gro_sel" style="left:20px; top:15px; width:866px; height:26px; ">
					<caption id="caption5" class="list_cap02" style="left:109px; top:0px; width:757px; height:26px; text-align:center; "/>
					<caption id="caption4" class="list_cap03" style="left:0px; top:0px; width:110px; height:26px; text-align:center; ">년월</caption>
					<input id="yymm2" ref="/root/reqData/searchData/yymm" class="req" navindex="1" caption="년월" style="left:115px; top:4px; width:80px; height:18px; ">
						<script type="javascript" ev:event="xforms-value-changed">
							<![CDATA[
						if(G_Cym !=  yymm.value){
							G_Cym =  yymm.value;
							S_AllDateCaption();
						}
					]]>
						</script>
					</input>
					<select1 id="gubun" ref="/root/reqData/reqForm/gubun" navindex="2" appearance="full" cols="2" overflow="visible" style="left:220px; top:5px; width:250px; height:15px; border-style:none; ">
						<choices>
							<item>
								<label>원가배부 RAWDATA</label>
								<value>1</value>
							</item>
							<item>
								<label>원가배부 국별집계</label>
								<value>2</value>
							</item>
						</choices>
					</select1>
					<button id="btn_help" class="btn04" style="left:770px; top:2px; width:90px; height:21px; ">
						<caption>DownLoad</caption>
						<script type="javascript" ev:event="onclick">
							<![CDATA[
								var grid = null;
									
								grid = datagrid1;
								
								var filename = window.fileDialog("save", ",", false, "", "xls", "Excel File(*.xls)|*.xls");
								if(filename!=""){
									grid.saveExcel(filename, "sheetname: ");
								}
							]]>
						</script>
					</button>
				</group>
				<datagrid id="datagrid1" caption="년월^전표사용부서코드^전표사용부서명^예산코드^예산명^전표매체코드^상세매체코드^상세매체명^1차배부부서코드^1차배부부서명^2차배부부서코드^2차배부부서명^배부매체코드^계정코드^계정코드명^배부금액" colsep="^" colwidth="80, 110, 130, 110, 130, 110, 110, 130, 110, 130, 110, 130, 110, 110, 130, 110" mergecellsfixedrows="bycolrec" rowsep="|" style="left:20px; top:60px; width:866px; height:550px; ">
					<col ref="yymm"/>
					<col ref="use_dept_cd"/>
					<col ref="use_dept_cdnm"/>
					<col ref="budg_cd"/>
					<col ref="budg_cdnm"/>
					<col ref="medi_cd"/>
					<col ref="dtls_medi_cd"/>
					<col ref="dtls_medi_cdnm"/>
					<col ref="dstb_dept_cd1"/>
					<col ref="dstb_dept_cdnm1"/>
					<col ref="dstb_dept_cd2"/>
					<col ref="dstb_dept_cdnm2"/>
					<col ref="dstb_medi_cd"/>
					<col ref="acct_cd"/>
					<col ref="acct_cdnm"/>
					<col ref="amt"/>
				</datagrid>
			</case>
		</switch>
		<button id="tab1" class="tab05" group="group2" crud="R" style="left:10px; top:95px; width:90px; height:23px; ">
			<caption>원가배부처리</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
						model.toggle("case1");
					]]>
			</script>
		</button>
		<button id="tab2" class="tab05" group="group2" crud="R" style="left:102px; top:95px; width:92px; height:23px; ">
			<caption>배부결과조회</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
						model.toggle("case2");
						yymm2.value = yymm.value;
					]]>
			</script>
		</button>
	</xhtml:body>
</xhtml:html>
