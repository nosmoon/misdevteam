<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet type="text/css" href="../../../css/style_sheet.css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:my="http://www.comsquare.co.kr/example" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>Untitle</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<!-- 화면 로딩시의 초기 데이터를 담당 -->
						<session/>
						<!-- 서버의 세션 정보를 담당한다 -->
						<comboSet>
							<fac_clsf>
								<item>
									<label/>
									<value/>
								</item>
							</fac_clsf>
							<medi_cd>
								<item>
									<value/>
									<label/>
								</item>
							</medi_cd>
							<fac_clsf2>
								<item/>
							</fac_clsf2>
							<matr_ps>
								<item/>
							</matr_ps>
							<medi_cd>
								<item/>
							</medi_cd>
							<sect_cd_1>
								<item/>
							</sect_cd_1>
							<sect_cd_2>
								<item/>
							</sect_cd_2>
							<matr_film>
								<item/>
							</matr_film>
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo>
							<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
						</pageInfo>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
					</initData>
					<reqData>
						<!-- 전달하고자 하는 데이터를 담당 ( submit 함수에서 처리) -->
						<searchData>
							<owh_dt_fr/>
							<fac_clsf/>
							<dept_cd/>
							<owh_dt_to/>
						</searchData>
						<!-- 검색조건 처리 -->
						<reqForm>
							<dept_nm/>
						</reqForm>
						<!-- formData 팝업,화면전환시 data이동시 -->
						<multiUpDate/>
						<!-- MultiUpDate유형 사용시 처리 -->
						<fwdData>
							<func_name/>
						</fwdData>
						<owh_dt_key>
							<cmpy_cd/>
							<occr_dt/>
							<seq/>
							<magam/>
							<fac_clsf/>
						</owh_dt_key>
					</reqData>
					<resData>
						<!-- 전달 받은 데이터를 담당 ( submit의 결과가 담김) -->
						<resForm>
							<owh_dt/>
							<fac_clsf/>
							<dept_nm/>
							<dept_cd/>
							<owh_qunt/>
							<p_gubun/>
						</resForm>
						<!-- 전달 받은 formData를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 데이터를 가공할 임시저장소 ( submit의 결과가 담김) -->
						<!-- 전달 받은 errorCode를 담당 ( submit의 결과가 담김) -->
						<msg/>
						<!-- 전달 받은 errorMsg를 담당 ( submit의 결과가 담김) -->
						<gridData_sub_1>
							<!-- 전달 받은 grid데이터를 담당 ( submit의 결과가 담김) -->
							<record>
								<sub_seq/>
								<matr_cd/>
								<matr_nm/>
								<unit/>
								<yesday_cnt/>
								<hjg_cnt/>
								<owh_qunt/>
								<owh_uprc/>
								<owh_amt/>
								<owh_dept/>
								<bccgacctcd/>
								<medi_cd/>
								<medi_ser_no/>
								<remk/>
								<ewh_budg_cd/>
								<owh_budg_cd/>
								<ewh_dt/>
								<hjg_amt/>
								<dstb_rat_cd/>
								<ewh_seq/>
								<ewh_sub_seq/>
								<owh_unit/>
								<medi_ser_no_nm/>
								<!--owh_dt-->
								<!--fac_clsf-->
								<!--igacctcdnm-->
								<!--owh_unit-->
								<!--bcigaccntcd-->
								<!--bcigaccntcdnm-->
								<!--medi_cd_nm-->
								<!--owh_budg_cd_nm-->
							</record>
							<!-- datagrid2 -->
							<!-- datagrid3 -->
						</gridData_sub_1>
						<gridData3>
							<record>
							</record>
						</gridData3>
						<gridData_sub_2_1>
							<record>
								<sub_seq/>
								<matr_cd/>
								<matr_nm/>
								<unit/>
								<yesDayCnt/>
								<hjg_cnt/>
								<owh_qunt/>
								<owh_uprc/>
								<owh_amt/>
								<owh_dept/>
								<bccgacctcd/>
								<medi_cd/>
								<medi_ser_no/>
								<remk/>
								<ewh_budg_cd/>
								<owh_budg_cd/>
								<ewh_dt/>
								<hjg_amt/>
								<dstb_rat_cd/>
								<ewh_seq/>
								<ewh_sub_seq/>
								<owh_unit/>
								<medi_ser_no_nm/>
								<!--owh_dt-->
								<!--fac_clsf-->
								<!--igacctcdnm-->
								<!--owh_unit-->
								<!--bcigaccntcd-->
								<!--bcigaccntcdnm-->
								<!--medi_cd_nm-->
								<!--owh_budg_cd_nm-->
							</record>
						</gridData_sub_2_1>
						<gridData_sub_2_2>
							<record>
								<sub_seq/>
								<matr_cd/>
								<matr_nm/>
								<medi_cd/>
								<medi_nm/>
								<owh_num_shet/>
							</record>
						</gridData_sub_2_2>
						<gridData_main>
							<record>
								<cmpy_cd/>
								<occr_dt/>
								<seq/>
								<owh_dt/>
								<fac_clsf/>
								<clos_clsf/>
							</record>
						</gridData_main>
						<logininfo>
							<fac_clsf/>
							<dept_cd/>
							<uprc_yn/>
						</logininfo>
						<gridData5>
							<record/>
						</gridData5>
						<gridData6>
							<record/>
						</gridData6>
						<gridData7>
							<record/>
						</gridData7>
					</resData>
					<tempData/>
				</root>
			</instance>
			<script type="javascript">
				<![CDATA[
				var gValue;
				
				function makeValue (fRow, fCol, fVal){
					this.row = fRow;
					this.col = fCol;
					this.val = fVal;
				}
					function makeGridData(){
						var nodeList_x = instance1.selectNodes("/root/resData/gridData/divData/x_data/record");
						var nodeList_y = instance1.selectNodes("/root/resData/gridData/divData/y_data/record");
						var nodeList_d = instance1.selectNodes("/root/resData/gridData/divData/a_data/record");
						var rowCount = 0;
						var colCount = 0;
						
						for(var i=0; i<nodeList_x.length; i++){	
							var subNode = nodeList_x.item(i).getElementsByTagName("fac_clsf").item(0).value;
							var subNode_nm = nodeList_x.item(i).getElementsByTagName("fac_clsf_nm").item(0).value;
							var covName = subNode_nm + " ";
							
							var refNode = "d_" + (i + 1);
							datagrid1.addColumn("ref:" + refNode + ";");
							
							datagrid1.caption += "^" + covName;
							if (i == 0){
								datagrid1.colWidth(i) = 70;
							} else {
								datagrid1.colWidth(i) = 62;
							}
						}
						datagrid1.colAttribute ( 0, "format" ) = "yyyy-mm-dd";

						for(i=0; i<nodeList_d.length;i++){
							var fac_clsf = nodeList_d.item(i).getElementsByTagName("fac_clsf").item(0).value;
							var issu_dt = nodeList_d.item(i).getElementsByTagName("issu_dt").item(0).value;
							var end_clsf = nodeList_d.item(i).getElementsByTagName("end_clsf").item(0).value;
							fac_arr[i] = new fac_status(fac_clsf, issu_dt, end_clsf);
						}
						model.copyNode("/root/resData/gridData2", "/root/resData/gridData/divData/d_data");
						datagrid1.refresh();
					}
					
					function setDeptGd1(dept_cd, dept_nm){
						var cell			= datagrid1.selectedCells;
						if(cell.length < 1){
								alert("select a Cell");
								return;
						}
						var col			= cell.item(0).col;
						var row			= cell.item(0).row;
						
						datagrid1.valueMatrix( row, col) = 	dept_cd ;
					}
					function setSectCd(sect_cd){
						var row = datagrid1.row;
						
						datagrid1.valueMatrix( row, 13 ) = 	sect_cd ;
					}
					function  setDeptGr2(dept_cd, dept_nm){
						model1.setValue("/root/reqData/searchData/dept_cd", dept_cd);
						model1.setValue("/root/reqData/reqForm/dept_nm", dept_nm);
						input3.refresh();
						output1.refresh();
					}
						
					function  setDeptGr3(dept_cd, dept_nm){
						model1.setValue("/root/resData/resForm/dept_cd", dept_cd);
						model1.setValue("/root/resData/resForm/dept_nm", dept_nm);
						input5.refresh();
						output2.refresh();
					}
					
					function InitPage(){
						model1.copyNode("/root/initData/pageInfo",parent.root.initData.pageInfo);
						var strDate = "";
						strDate = date();
						
						model.removenode("/root/resData/gridData_sub_2_2/record");
						model.removenode("/root/resData/gridData6/record");
						model.removenode("/root/resData/gridData7/record");
						
						model1.setValue("/root/reqData/searchData/owh_dt_fr", strDate);
						model1.setValue("/root/reqData/searchData/owh_dt_to", strDate);
						model1.setValue("/root/resData/resForm/owh_dt", strDate);
						if( group3.disabled == true )  group3.disabled = false;
								 	
						model1.send("mt_submatrout_1101");

						model1.copyNode("/root/initData/comboSet/fac_clsf", "/root/tempData/fac_clsf");  //공장 코드 셋팅
						model1.copyNode("/root/initData/comboSet/fac_clsf2", "/root/tempData/fac_clsf");
						model1.copyNode("/root/initData/comboSet/medi_cd" , "/root/tempData/medi_cd");
						model1.setValue("/root/resData/logininfo/uprc_yn", model1.getValue("/root/tempData/login_uprc_yn"));
						model1.setValue("/root/resData/logininfo/fac_clsf", model1.getValue("/root/tempData/login_fac_clsf"));
						model1.setValue("/root/resData/logininfo/dept_cd", model1.getValue("/root/tempData/login_dept_cd"));
						combo3.refresh();
						combo1.refresh();
						
						if( model1.getValue("/root/resData/logininfo/uprc_yn") == 'N' ){
							model1.setValue("/root/reqData/searchData/fac_clsf", model1.getValue("/root/resData/logininfo/fac_clsf"));
							model1.setValue("/root/reqData/searchData/dept_cd", model1.getValue("/root/resData/logininfo/dept_cd"));
							model1.setValue("/root/resData/resForm/fac_clsf", model1.getValue("/root/resData/logininfo/fac_clsf"));
							model1.setValue("/root/resData/resForm/dept_cd", model1.getValue("/root/resData/logininfo/dept_cd"));
								
							combo3.refresh();
							combo3.disabled = true;
								
							combo1.refresh();
							combo1.disabled = true;
								
							input3.refresh();
							input3.dispatch("onmaxlength");
								
							if( model1.getValue("/root/tempData/login_fac_clsf") == '10') {
								input3.disabled = false;
							}else {
								input3.disabled = true;
							}
							input5.refresh();
							input5.dispatch("onmaxlength");
							
							if( model1.getValue("/root/tempData/login_fac_clsf") == '10') {
								input5.disabled = false;
							}else {
								input5.disabled = true;
							}
							datagrid1.colHidden(8) = true;
							datagrid1.colHidden(9)  = true;
							datagrid1.colHidden(15)  = true;
							//button9.text  = "공장마감";
							//button10.text = "공장마감취소";
								
						}  else {
							model.removenode("/root/initData/comboSet/fac_clsf2/item[1]");
							combo1.refresh();
							//button9.text  = "자재마감";
							//button10.text = "자재마감취소";
						} 

						combo3.refresh();
						combo1.refresh();
						  	
						for (i = 1 ; i < datagrid1.cols ; i++){
							datagrid1.colDisabled(i) = true;
							datagrid1.rowStatus(i) = 0;
						}
						for (i = 1 ; i < datagrid2.cols ; i++){
							datagrid2.colDisabled(i) = true;
							datagrid2.rowStatus(i) = 0;
						}	  	
					}  	
					
					function date(){
						var d = new Date();
						var rec = "";
						var dd = "";
					     	    
						rec = "" + d.getYear();
						dd = (d.getDate() < 10 ? "0" + d.getDate() : d.getDate());

						if( d.getMonth() + 1 < 10 )  rec = rec + "0" + (d.getMonth() + 1 )  + dd;
						else if ( d.getMonth() > 10 )  rec = rec  + (d.getMonth() + 1)      + dd;
					     	    
						return (rec);
					}
					
					function datagrid2_init(){
						while (  datagrid2.cols  > 1 ){
							datagrid2.removeColumn();
						} 
						datagrid2.removeColumn();
 						model1.removenode("/root/resData/gridData5");
						model1.makeNode("/root/resData/gridData5");
						model1.makeNode("/root/resData/gridData5/record");
						
						datagrid2.caption = "";
						datagrid2.refresh();
					}
				     
				     function datagridInit(){
						while (  datagrid2.cols  > 1 ){
								datagrid2.removeColumn();
						 } 
						 datagrid2.removeColumn();
 						 model1.removenode("/root/resData/gridData5");
 						 model1.makeNode("/root/resData/gridData5");
 						 model1.makeNode("/root/resData/gridData5/record");
 						 //model1.removenode("/root/resData/gridData_sub_2_2");
						 //model1.makeNode("/root/resData/gridData_sub_2_2");
						 //model1.makeNode("/root/resData/gridData_sub_2_2/record");
					
						 datagrid2.caption = "";
						 datagrid2.refresh();
				      }
				      
					function datagridCreate(){
						var x_nodeList = instance1.selectNodes("/root/tempData/gridData4/record");
						var x_size	= x_nodeList.length;
						var subNode = "";
						var defWidth	= 80;
						
						datagridInit();
						
						//alert(x_size);
						if( x_size == 0 ){
					 		commMsgBox("PS 판 내역은 출고 일자에 등록된 \n전체 발행내역이 존재 하지 않아  화면에 표시 할 수 없습니다.\n전체 발행내역을 먼저 등록 하세요");
					 		return ;
					 	}
					 	if (x_size == 2){
					 		defWidth = 130;
					 	} else if (x_size == 3){
					 		defWidth = 100;
					 	}
					 	datagrid2.addColumn("ref:d_0; visibility:hidden;");
					 	datagrid2.caption = "자재코드";
					 	datagrid2.addColumn("ref:d_1");
					 	datagrid2.caption += "^자재코드";
					 	datagrid1.colWidth(1) = 100;
					 	//datagrid2.colHidden(0) = true;
					 	for (var i=0 ; i< eval(x_size); i++){
					 		var styleStr = "";
					 		datagrid2.caption += "^" + x_nodeList.item(i).getElementsByTagName("medi_nm").item(0).value + "/" + x_nodeList.item(i).getElementsByTagName("sect_nm").item(0).value;
					 		datagrid2.caption += "^" + x_nodeList.item(i).getElementsByTagName("medi_nm").item(0).value + "/" + x_nodeList.item(i).getElementsByTagName("sect_nm").item(0).value;
					 		datagrid2.caption += "^" + x_nodeList.item(i).getElementsByTagName("medi_nm").item(0).value + "/" + x_nodeList.item(i).getElementsByTagName("sect_nm").item(0).value;
					 		//subNode = subNode + "^" + x_nodeList.item(i).getElementsByTagName("medi_nm").item(0).value + "/" + x_nodeList.item(i).getElementsByTagName("sect_nm").item(0).value;
					 		
					 		if( i == 0 ) styleStr = ";type:input; format:#,###;";
					 		else         styleStr = ";type:input;"; 
					 		
					 		datagrid2.addColumn("ref:d_" + ((i *3) + 2) + "; type:input; format:#,###; ");
					 		//datagrid2.addColumn("ref:d_" + ((i *3) + 3) + "; ");
					 		//datagrid2.addColumn("ref:d_" + ((i *3) + 4) + "; ");
					 		datagrid2.addColumn("ref:d_" + ((i *3) + 3) + "; visibility:hidden;");
					 		datagrid2.addColumn("ref:d_" + ((i *3) + 4) + "; visibility:hidden;");
					 		if (i!=0){
					 			datagrid2.colWidth(i) = defWidth;
					 		}
					 			
					 		//datagrid2.colHidden((i *3) + 3) = true;
					 		//datagrid2.colHidden((i *3) + 4) = true;
					 	}
					 	//alert(datagrid2.caption);
					 	//datagrid2.caption += "^" + ;
					 	model.copyNode("/root/resData/gridData5", "/root/tempData/gridData5");
					 	datagrid2.refresh();
					}
					
					function datagrid2Creat(){
					        var x_size = model1.getValue("/root/tempData/caption_size");	
					 	 
					 	datagrid2_init();
					 	
					 	if( Number(x_size) == 0 ){
					 		commMsgBox("PS 판 내역은 출고 일자에 등록된 \n전체 발행내역이 존재 하지 않아  화면에 표시 할 수 없습니다.\n전체 발행내역을 먼저 등록 하세요");
					 		return ;
					 	} 
					 	
					 	datagrid2.nodeset = "/root/resData/gridData_sub_2_2/record";
					 	
					 	for (var i = 0 ; i < Number(x_size) ; i++){
					 		 var styleStr = "";
					 		 
					 		 if( i == 0 ) styleStr = ";type:output;";
					 		 else         styleStr = ";type:input;"; 
					 		 
					 		 datagrid2.addColumn("ref:row_" + i + styleStr );
					 		 
					 	}
					 	
					 	datagrid2.caption = model1.getValue("/root/tempData/caption_x");
					 	datagrid2.refresh();
					 	
					 	model1.copyNode("/root/resData/gridData_sub_2_2" , "/root/tempData/data_y");
					 	
						for ( var i = 0 ; i < datagrid2.cols; i++){
	   				               	datagrid2.colWidth(i) = 840 / ( datagrid2.cols) ;
					 	}
					 	
					 	datagrid2.refresh();
					}    
					
					
					function datagrid2_init(){
						while (  datagrid2.cols  > 1 ){
								datagrid2.removeColumn();
						 } 
						 datagrid2.removeColumn();
 						 model1.removenode("/root/resData/gridData_sub_2_2");
						 model1.makeNode("/root/resData/gridData_sub_2_2");
						 model1.makeNode("/root/resData/gridData_sub_2_2/record");
					
						 datagrid2.caption = "";
						 datagrid2.refresh();
				      }
					    
					    function deleteData(strGubun)
					    {
					    	    var gubun = strGubun;
					    	    
					    	    if( gubun == 'ALL')
					    	    {
					    	    	    if( window.alert("삭제 하시겠습니까?" ,"조선일보 MIS" ,1 ) != 1)
					    	    	    {
					    	    	    	 return ;
					    	    	    }
					    	    }
					    	    model1.makeNode("/root/resData/resForm/cmpy_cd");
					           model1.makeNode("/root/resData/resForm/occr_dt");
					           model1.makeNode("/root/resData/resForm/seq");
									           
					    	    model1.setValue("/root/resData/resForm/cmpy_cd", model1.getValue("/root/reqData/owh_dt_key/cmpy_cd"));
					           model1.setValue("/root/resData/resForm/occr_dt", model1.getValue("/root/reqData/owh_dt_key/occr_dt"));
					           model1.setValue("/root/resData/resForm/seq", model1.getValue("/root/reqData/owh_dt_key/seq"));
					    	    switch( gubun )
					    	    {
					    	    	  case 'ROW' :    
					    	    	                         
					    	    	  	        	   var mulidataStr = datagrid1.getUpdateData();
									          
									           model1.makeNode("/root/resData/resForm/multiUpdateData");
									           model1.makeNode("/root/resData/resForm/delGubun");
									           
									           model1.setValue("/root/resData/resForm/multiUpdateData",  mulidataStr);
									           model1.setValue("/root/resData/resForm/delGubun"         ,  gubun);
									           
					    	    	                          break;
					    	    	  case 'ALL'   :    
					    	    	  			    model1.makeNode("/root/resData/resForm/delGubun");
									           
									           model1.setValue("/root/resData/resForm/delGubun"         ,  gubun);
					    	    	                          break;
					    	    }
					    	 
					    	 
					    	 model1.send("mt_submatrout_1111");
					    	 model1.destroy("/root/resData/resForm/multiUpdateData");
					    	 model1.destroy("/root/resData/resForm/delGubun");
					    	 model1.destroy("/root/resData/resForm/cmpy_cd");
					    	 model1.destroy("/root/resData/resForm/occr_dt");
					    	 model1.destroy("/root/resData/resForm/seq");
					    	 
					    	
					        button3.dispatch("onclick");
									        
					    }
				
				//	콤보 필터링
				function cellchanged() {
					var gridID = datagrid5;
					var nodeSet =  "/root/resData/gridData6/record";
					var nodeName = "medi_cd";
					var comboNodeSet_1 = "/root/initData/comboSet/sect_cd_1";
					var comboNodeSet_2 = "/root/initData/comboSet/sect_cd_2";
					var nodeSetName = "item";
					var srcColIdx = 2;
					var targetColIdx = 3;
					
					if ( gridID.col == srcColIdx && gridID.row >= gridID.fixedRows ){
						var row = gridID.row - gridID.fixedRows+1;
						var idx = model.getValue(nodeSet+"["+row+"]/"+nodeName);

						//alert(idx);
						if ( idx == "621" )	{//첫번째 콤보에 선택한 아이템이 있을 때만 두번째 콤보 데이터 필터링
							gridID.cellComboNodeset(datagrid5.row, targetColIdx) =  comboNodeSet_2 + "/"+nodeSetName;
						} else {
							gridID.cellComboNodeset(datagrid5.row, targetColIdx) =  comboNodeSet_1 + "/"+nodeSetName;
						}
					}
				}
				]]>
			</script>
			<submission id="mt_submatrout_1100" action="/mt/submatrout/1100" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/resForm" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1101" action="/mt/submatrout/1101" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1102" action="/mt/submatrout/1102" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/resForm" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1103" action="/mt/submatrout/1103" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1104" action="/mt/submatrout/1104" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/owh_dt_key" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1109" action="/mt/submatrout/1109" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/resForm" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1111" action="/mt/submatrout/1111" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/resForm" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1112" action="/mt/submatrout/1112" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/owh_dt_key" resultref="/root/tempData"/>
			<submission id="mt_submatrout_1115" action="/mt/submatrout/1115" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/resData/resForm" resultref="/root/resData/gridData5/record"/>
			<submission id="mt_submatrout_1116" action="/mt/submatrout/1116" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/owh_dt_key" resultref="/root/resData/gridData5/record"/>
			<submission id="mt_submatrout_1117" action="/mt/submatrout/1117" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/owh_dt_key" resultref="/root/tempData"/>
			<submission id="mt_common_0001" action="/mt/common/0001" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/dept_cd" resultref="/root/tempData"/>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
				model.removenode("/root/resData/gridData_main/record");
				]]>
			</script>
			<script type="javascript" src="/js/CIISComm.js"/>
			<script type="javascript" src="/js/TFCommon.js"/>
		</model>
	</xhtml:head>
	<xhtml:body pagewidth="910" pageheight="630" guideline="2,234;">
		<group id="group2" class="gro_sel" style="left:10px; top:35px; width:890px; height:24px; ">
			<caption id="caption4" class="list_cap01" style="left:0px; top:0px; width:80px; height:24px; text-align:center; ">출고일자</caption>
			<caption id="caption5" class="list_cap02" style="left:79px; top:0px; width:811px; height:24px; text-align:center; "/>
			<caption id="caption6" class="list_cap01" style="left:541px; top:0px; width:95px; height:24px; text-align:center; ">소모부서</caption>
			<caption id="caption33" class="list_cap01" style="left:316px; top:0px; width:89px; height:24px; text-align:center; ">소모처</caption>
			<input id="input1" ref="/root/reqData/searchData/owh_dt_fr" class="req" inputtype="date" caption="소모일자(시작)" appearance="input" style="left:86px; top:3px; width:100px; height:18px; background-color:#ffffcc; border-color:#999999; "/>
			<select1 id="combo3" ref="/root/reqData/searchData/fac_clsf" class="req" appearance="minimal" caption="소모처" style="left:410px; top:3px; width:100px; height:18px; background-color:#ffffcc; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/fac_clsf/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
			</select1>
			<input id="input3" ref="/root/reqData/searchData/dept_cd" inputtype="button" maxlength="6" style="left:644px; top:4px; width:93px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
							var funcName = "setDeptGr2";
						
					    		model.setValue("/root/reqData/fwdData/func_name", funcName );
					    
					    		window.load("../../hd/com/HD_COM_1100.xrw"
					 	     		, "modal"
					 		        , ""
					 		        ,"left:100px; top:100px; width:650px; height:520; align:center; caption:hidden;"
					 			  , "/root/reqData/fwdData/func_name", "/root/reqData/fwdData/func_nm");
					]]>
				</script>
				<script type="javascript" ev:event="onmaxlength">
					<![CDATA[
								 
							       model1.makeNode("/root/reqData/dept_cd");
								model1.setValue("/root/reqData/dept_cd", input3.currentText);
								
								model1.send("mt_common_0001");
								
								model1.setValue("/root/reqData/searchData/dept_cd", model1.getValue("/root/tempData/cd"));
								model1.setValue("/root/reqData/reqForm/dept_nm",model1.getValue("/root/tempData/cd_nm"));
								
								input3.refresh();
								output1.refresh();
								
								model1.destroy("/root/reqData/dept_cd");
					]]>
				</script>
			</input>
			<output id="output1" ref="/root/reqData/reqForm/dept_nm" style="left:745px; top:4px; width:94px; height:18px; border-color:#999999; "/>
			<input id="input2" ref="/root/reqData/searchData/owh_dt_to" class="req" inputtype="date" caption="소모일자(종료)" appearance="input" style="left:210px; top:3px; width:100px; height:18px; background-color:#ffffcc; border-color:#999999; "/>
			<caption id="caption3" style="left:190px; top:5px; width:15px; height:15px; ">~</caption>
		</group>
		<group id="group1" class="gro_btn" style="left:180px; top:10px; width:720px; height:21px; ">
			<button id="button1" class="btn02" style="left:62px; top:0px; width:52px; height:21px; ">
				<caption>초기화</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					model1.reset();
					InitPage();
					input1.refresh();
					//datagrid2.rows= 1;
					]]>
				</script>
			</button>
			<button id="button3" class="btn02" CRUD="R" style="left:117px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
							if(  commReqCheck(group2) == false ) return;
							var owh_dt_fr = model1.getValue("/root/reqData/searchData/owh_dt_fr");
							var owh_dt_to = model1.getValue("/root/reqData/searchData/owh_dt_to");
							var dept_cd    = model1.getValue("/root/reqData/searchData/dept_cd");
							var fac_clsf  = model1.getValue("/root/reqData/searchData/fac_clsf");
							
							button1.dispatch("onclick");
							
							model1.setValue("/root/reqData/searchData/owh_dt_fr", owh_dt_fr);
							model1.setValue("/root/reqData/searchData/owh_dt_to", owh_dt_to);
							model1.setValue("/root/reqData/searchData/dept_cd", dept_cd);
							model1.setValue("/root/reqData/searchData/fac_clsf",fac_clsf);
							
							group2.refresh();
							input3.dispatch("onmaxlength");
							output1.refresh();
							
							model1.send("mt_submatrout_1103");
							
							model1.copyNode("/root/resData/gridData_main", "/root/tempData/gridData");
							datagrid3.refresh();
							
							//datagrid2.rows = 1;
							
					]]>
				</script>
			</button>
			<button id="button4" class="btn04" style="left:575px; top:0px; width:88px; height:21px; ">
				<caption>자재일보</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					alert("장표 미구현");
					]]>
				</script>
			</button>
			<button id="button6" class="btn02" CRUD="C" style="left:172px; top:0px; width:52px; height:21px; ">
				<caption>저장</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var cnt = 0;
					var i = 0;
					var getState;
					var mulidataStr_1 = "";
					var mulidataStr_2 = "";
					var mulidataStr_3 = "";
					
					if( window.alert("저장 하시겠습니까?" ,"조선일보MIS", 1) != 1){
						return;
					}
					
					//	소모처가 정동인 경우에는 소모부서를 필수 입력 // 20090728 조동환과장 요청
					if (model.getValue("/root/resData/resForm/fac_clsf") == "10"){
						if (model.getValue("/root/resData/resForm/dept_cd") == ""){
							alert("소모처가 정동인 경우에는 소모부서를 반드시 입력해주셔야 합니다.");
							return;
						}
					}
					
					if( model1.getValue("/root/reqData/owh_dt_key/cmpy_cd") == ''){	// 신규입력
						for(i = 1; i < datagrid1.rows; i++){
							getState = datagrid1.rowstatus(i);
							
							if( getState == 2 ) { // update --> INSERT 
								if( Number(datagrid1.valueMatrix(i , 7)) == 0){
									alert( i + "번째 소모량이 0 입니다. 확인해주세요 ");
									datagrid1.rowstatus(i) = 0;
									return;
								}
								else cnt = cnt + 1;
							}
						}
						               
						if ( cnt == 0 ) {
							alert("입력할  데이터가 없습니다.");
							return;
						}
						for(i = 1; i < datagrid1.rows; i++){
							if (datagrid1.valueMatrix(i, datagrid1.colRef("curdd_ewh_qunt")) != "" && eval(datagrid1.valueMatrix(i, datagrid1.colRef("curdd_ewh_qunt"))) > 0){
								if (datagrid1.valueMatrix(i, datagrid1.colRef("plan_dt")) == ""){
									alert(i + "번째에서 금일 입고를 입력하시려면 예정일자를 같이 입력하셔야 합니다.");
									return;
								}
							}
							getState = datagrid1.rowstatus(i);
							if( getState == 2 ) { // update --> INSERT
								datagrid1.rowstatus(i) = 1;
							}
						}
						for(i = 1; i < datagrid4.rows; i++){
							getState = datagrid4.rowstatus(i);
							if( getState == 2 ){ // update --> INSERT 
								datagrid4.rowstatus(i) = 1;
							}
						}
						if (model.getValue("/root/resData/resForm/p_gubun") == "1") {
							mulidataStr_1 = datagrid1.getUpdateData();
							mulidataStr_2 = datagrid4.getUpdateData();
							mulidataStr_3 = datagrid6.getUpdateData();
						} else {
							mulidataStr_1 = datagrid1.getUpdateData();
							mulidataStr_2 = datagrid5.getUpdateData();
							mulidataStr_3 = datagrid7.getUpdateData();
						}
						
						model1.makeNode("/root/resData/resForm/multiUpdateData_1");
						model1.makeNode("/root/resData/resForm/multiUpdateData_2");
						model1.makeNode("/root/resData/resForm/multiUpdateData_3");
									        
						model1.setValue("/root/resData/resForm/multiUpdateData_1", mulidataStr_1);
						model1.setValue("/root/resData/resForm/multiUpdateData_2", mulidataStr_2);
						model1.setValue("/root/resData/resForm/multiUpdateData_3", mulidataStr_3);
						model1.send("mt_submatrout_1109");
									        
						model1.setValue("/root/reqData/searchData/owh_dt_fr", model.getValue("/root/resData/resForm/owh_dt"));
						model1.setValue("/root/reqData/searchData/fac_clsf", model.getValue("/root/resData/resForm/fac_clsf"));
									        
						button3.dispatch("onclick");
									        
						model1.destroy("/root/resData/resForm/multiUpdateData_1");
						model1.destroy("/root/resData/resForm/multiUpdateData_2");
						model1.destroy("/root/resData/resForm/multiUpdateData_3");
					} else {
						for( var i = 1 ;  i < datagrid1.rows; i++){
							if( datagrid1.rowStatus(i) == 4 ) cnt = cnt + 1;
						}
						
						if ( cnt == 0 ) {
							alert("수정된 데이터가 없습니다.");
							return;
						}
						deleteData('ROW');
					}	        
					]]>
				</script>
			</button>
			<button id="button7" class="btn02" style="left:228px; top:0px; width:52px; height:21px; ">
				<caption>삭제</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var i = 0 ;
					
					if( model1.getValue("/root/reqData/owh_dt_key/seq") == '')
					{
						 commMsgBox( "삭제할 데이터를 선택하세요");
					 	 return ;
					}
					
				 	if(   model1.getValue("/root/reqData/owh_dt_key/magam") != '00' )
				 	{
				 		commMsgBox("해당 문서의 마감 구분이 (" + model1.getValue("/root/reqData/owh_dt_key/magam") + ") 경우 삭제 하실 수 없습니다.)" );
			 			return ;
				 	}
					
					for (  i = 1; i < datagrid1.rows ; i++)
					{
						 if( datagrid1.valueMatrix(i, datagrid1.colRef("ewh_dt")) != '' )
					 	{
					 	   	commMsgBox( "동시입출고 품목이므로 입고등록화면에서 삭제하시오");
					 	   	return ;
					 	 }
					}
					/*
					for(  i = 1; i < datagrid4.rows; i++)
					{
						 if( datagrid4.valueMatrix(i, 18) != '' )
					 	{
					 	   	commMsgBox( "동시입출고 품목이므로 입고등록화면에서 삭제하시오");
					 	   	return ;
					 	 }
					}
					*/
					deleteData('ALL');
					]]>
				</script>
			</button>
			<button id="button9" class="btn02" style="left:429px; top:0px; width:52px; height:21px; ">
				<caption>자재마감</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var caption = button9.text;
					model1.makeNode("/root/reqData/owh_dt_key/state");
					      
					if( model1.getValue("/root/reqData/owh_dt_key/seq")  == '' ){
						commMsgBox("마감 처리할 데이터를 선택하세요");
						return;
					}
					      
					if( window.alert(caption + " 처리 하시겠습니까?",  "조선일보 MIS" , 1) != 1){
						model1.destroy("/root/reqData/owh_dt_key/state");
						return;
					}	
					var magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					    
					if( magam != '01'){
						commMsgBox("마감 구분 값을 확인 하세요.");
						return ;
					} else if ( magam == '01'){
						model1.setValue("/root/reqData/owh_dt_key/state" , '02');
					} 
					    
					model1.send("mt_submatrout_1112");
					model1.destroy("/root/reqData/owh_dt_key/state");
					button3.dispatch("onclick");
					]]>
				</script>
			</button>
			<button id="button10" class="btn04" style="left:484px; top:0px; width:88px; height:21px; ">
				<caption>자재마감취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var caption = button10.text;
					model1.makeNode("/root/reqData/owh_dt_key/state");
					      
					if( model1.getValue("/root/reqData/owh_dt_key/seq")  == '' ){
						commMsgBox("마감 처리할 데이터를 선택하세요");
						return;
					}
					      
					var magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					if( window.alert(caption + " 처리 하시겠습니까?",  "조선일보 MIS" , 1) != 1){
						model1.destroy("/root/reqData/owh_dt_key/state");
						return;
					}	
					if( magam != '02'){
						commMsgBox("마감 구분 값을 확인 하세요.");
						return ;
					} else if ( magam == '02'){
						model1.setValue("/root/reqData/owh_dt_key/state" , '01');
					} 
					    
					model1.send("mt_submatrout_1112");
					model1.destroy("/root/reqData/owh_dt_key/state");
					button3.dispatch("onclick");
					]]>
				</script>
			</button>
			<button id="button11" class="btn02" style="left:665px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					viewer("mainFrame").window.javaScript.closeMDIWindow(model.getValue("/root/initData/pageInfo/pageID"));
					]]>
				</script>
			</button>
			<button id="button8" class="btn02" style="left:283px; top:0px; width:52px; height:21px; ">
				<caption>공장마감</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var caption = button9.text;
					model1.makeNode("/root/reqData/owh_dt_key/state");
					      
					if( model1.getValue("/root/reqData/owh_dt_key/seq")  == '' ){
						commMsgBox("마감 처리할 데이터를 선택하세요");
						return;
					}
					      
					if( window.alert(caption + " 처리 하시겠습니까?",  "조선일보 MIS" , 1) != 1){
						model1.destroy("/root/reqData/owh_dt_key/state");
						return;
					}	
					
					var magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					    
					if( magam != '00'){
						commMsgBox("마감 구분 값을 확인 하세요.");
						return;
					} else if ( magam == '00'){
						model1.setValue("/root/reqData/owh_dt_key/state" , '01');
					}
					    
					model1.send("mt_submatrout_1112");
					model1.destroy("/root/reqData/owh_dt_key/state");
					button3.dispatch("onclick");
					]]>
				</script>
			</button>
			<button id="button12" class="btn04" style="left:338px; top:0px; width:88px; height:21px; ">
				<caption>공장마감취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var caption = button10.text;
					model1.makeNode("/root/reqData/owh_dt_key/state");
					      
					if( model1.getValue("/root/reqData/owh_dt_key/seq")  == '' ){
						commMsgBox("마감 처리할 데이터를 선택하세요");
						return;
					}
					      
					var magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					if( window.alert(caption + " 처리 하시겠습니까?",  "조선일보 MIS" , 1) != 1){
						model1.destroy("/root/reqData/owh_dt_key/state");
						return;
					}
					//alert(magam);
					if( magam != '01'){
						commMsgBox("마감 구분 값을 확인 하세요.");
						return;
					}else if ( magam == '01'){
						model1.setValue("/root/reqData/owh_dt_key/state" , '00');
					}
					
					model1.send("mt_submatrout_1117");
					
					if(submit_completed()) {
						model1.destroy("/root/reqData/owh_dt_key/state");
						button3.dispatch("onclick");
					}
					]]>
				</script>
			</button>
		</group>
		<group id="group4" style="left:10px; top:203px; width:890px; height:202px; ">
			<datagrid id="datagrid1" nodeset="/root/resData/gridData_sub_1/record" caption="SEQ^자재코드^자재명^단위^전일재고^현재고^소모량^소모단가^소모금액^소모부서^소모계정^소모매체^상세매체^참고사항^재고금액^금일입고^예정일^전일입고^구분^입고예산코드^출고예산코드^입고일자^배부비코드" colsep="#" colwidth="49, 70, 134, 58, 86, 84, 65, 100, 100, 143, 100, 135, 87, 157, 100, 100, 100, 100, 100, 0, 0, 0, 0" frozencols="3" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="free" style="left:0px; top:20px; width:890px; height:180px; ">
				<col ref="sub_seq" visibility="hidden"/>
				<col ref="matr_cd"/>
				<col ref="matr_nm"/>
				<col ref="unit"/>
				<col ref="yesday_cnt" format="#,###" style="text-align:right; "/>
				<col ref="hjg_cnt" type="input" format="#,###" style="text-align:right; "/>
				<col ref="owh_qunt" format="#,###" style="text-align:right; "/>
				<col ref="owh_uprc" format="#,#.###" style="text-align:right; "/>
				<col ref="owh_amt" type="input" format="#,#.###" style="text-align:right; "/>
				<col ref="owh_dept" type="inputbutton" maxlength="6" style="left:87px; top:20px; width:76px; height:20px; ">
					<script type="javascript" ev:event="onbuttonclick">
						<![CDATA[
					    var funcName = "setDeptGd1";
						
			    		   model1.setValue("/root/reqData/fwdData/func_name", funcName );
			    
			    		   window.load("../../hd/com/HD_COM_1100.xrw"
			 	     		, "mdichild"
			 		        , ""
			 			    , "left:100; top:100; width:650; height:520; sysmenu:visible; min:visible; max:true; resize:true; caption:visible;"
			 			  , "/root/reqData/fwdData/func_name", "/root/reqData/fwdData/func_nm");
				          
					]]>
					</script>
				</col>
				<col ref="bccgacctcd"/>
				<col ref="medi_cd" type="combo" visibility="hidden" style="text-align:left; ">
					<choices>
						<itemset nodeset="/root/initData/comboSet/medi_cd/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="medi_ser_no" type="inputbutton" visibility="hidden" style="left:87px; top:20px; width:76px; height:20px; ">
					<script type="javascript" ev:event="onbuttonclick">
						<![CDATA[
							var cell			= datagrid1.selectedCells;
							if(cell.length < 1){
								alert("select a Cell");
								return;
							}
							var col			= cell.item(0).col;
							var row			= cell.item(0).row;
								//alert(row);
					 		var medi_cd = datagrid1.valueMatrix(row, 12);
					    			
							if( medi_cd == ''){
								alert("소모 매체를 먼저 선택해주세요");
								return;
							}
							var funcName     = "setSectCd";
								 
							model1.makeNode("/root/reqData/fwdData/medi_cd");
							model1.setValue("/root/reqData/fwdData/func_name",  funcName );
							model1.setValue("/root/reqData/fwdData/medi_cd", medi_cd );
						    
							window.load("MT_SUBMATROUT_1101.xrw"
								, "mdichild"
								, ""
								, "left:100; top:100; width:450; height:400; sysmenu:visible; min:visible; max:true; resize:true; caption:visible;"
								, "/root/reqData/fwdData", "/root/reqData/fwdData"
							);
					       ]]>
					</script>
				</col>
				<col ref="remk" type="input"/>
				<col ref="hjg_amt" format="#,###.###"/>
				<col ref="curdd_ewh_qunt" type="input" format="#,###.###"/>
				<col ref="plan_dt" type="inputdate" format="yyyy-mm-dd"/>
				<col ref="prv_cnt" format="#,###.###"/>
				<col ref="owh_type" visibility="hidden"/>
				<col ref="ewh_budg_cd" visibility="hidden"/>
				<col ref="owh_budg_cd" visibility="hidden"/>
				<col ref="ewh_dt" visibility="hidden"/>
				<col ref="dstb_rat_cd" visibility="hidden"/>
				<script type="javascript" ev:event="onendedit">
					<![CDATA[
					var cell = datagrid1.selectedCells;
					var codeVal;
					if(cell.length < 1)
					{
						alert("select a Cell");
						return;
					}
				
					var col = cell.item(0).col;
					var row = cell.item(0).row;
					var matr_cd		= "";
					var yesDayCnt       = 0;
					var hjg_cnt;
					var owh_qunt        = 0;
					var owh_uprc        = 0;
					var owh_amt         = 0;
					var prv_cnt		= 0;
					var owh_type		= 0;
					
					var selectValue = datagrid1.valueMatrix(row, col);
					if (selectValue.indexOf(' ') > -1){
						codeVal = selectValue.substring(0, selectValue.indexOf(' '));
					} else {
						codeVal = selectValue;
					}
					
					switch (col){
					case 6 :
						//alert(Number(datagrid1.valueMatrix(row, 16)));
						yesDayCnt	= Number(datagrid1.valueMatrix(row, datagrid1.colRef("yesday_cnt")));  	//전일재고
						curCnt	= Number(datagrid1.valueMatrix(row, datagrid1.colRef("curdd_ewh_qunt")));  //금일입고
						hjg_cnt	= datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")); 				//현재고
						owh_uprc	= Number(datagrid1.valueMatrix(row, datagrid1.colRef("owh_uprc"))); 		//소모단가
						prv_cnt	= Number(datagrid1.valueMatrix(row, datagrid1.colRef("prv_cnt")));		//전일입고
						owh_type	= datagrid1.valueMatrix(row, datagrid1.colRef("owh_type"));				//출고구분
						matr_cd	= datagrid1.valueMatrix(row, datagrid1.colRef("matr_cd"));				//자재코드
						
						if (owh_type == "1"){
							if (model1.getValue("/root/resData/resForm/p_gubun") == "1"){
								var qunt = 0;
								for (var i=1; i<datagrid2.rows -2; i++){
									if (datagrid2.valueMatrix(i, 0) == matr_cd){
										qunt = eval(datagrid2.valueMatrix(i, datagrid2.cols-1));
									}
								}
								//alert(yesDayCnt + "\n" + hjg_cnt + "\n" + qunt);
								if ((yesDayCnt - eval(hjg_cnt)) != qunt){
									alert("개별등록에서 입력한 매체별 PS판 사용량과 현재고를 입력해서 얻은 소모량이 다릅니다.");
									datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = "";
									datagrid1.rowStatus(row) = 0;
									datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = 0;
									datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = 0;
									return;
								}
							} else {
								var qunt = 0;
								for (var i=1; i<datagrid5.rows; i++){
									if (datagrid5.valueMatrix(i, 1) == matr_cd){
										qunt = qunt + eval(datagrid5.valueMatrix(i, 4));
									}
								}
								alert(yesDayCnt + "\n" + hjg_cnt + "\n" + qunt);
								if ((yesDayCnt - eval(hjg_cnt)) != qunt){
									alert("개별등록에서 입력한 매체별 PS판 사용량과 현재고를 입력해서 얻은 소모량이 다릅니다.");
									datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = "";
									datagrid1.rowStatus(row) = 0;
									datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = 0;
									datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = 0;
									return;
								}
							}
						}
						if( hjg_cnt == '' || Number(hjg_cnt) < 1 ){
							if( window.alert("현재고가 0 이면 소모량을 전일재고량과 동일하게 하시겠습니까?" ,"조선일보MIS", 1) == 1){
								datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = yesDayCnt;
								datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = owh_uprc * yesDayCnt;
								datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = 0;
								datagrid1.rowStatus(row) = 2;
								return;
								//datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = 0;
								//datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = 0;
							} else {
								datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = "";
								datagrid1.rowStatus(row) = 0;
								datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = 0;
								datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = 0;
								return;
							}
							
						}
						//alert();
						//owh_qunt = (yesDayCnt + curCnt) - Number(hjg_cnt);
						owh_qunt = yesDayCnt - Number(hjg_cnt);
						
						if( owh_qunt == 0 ) {
							if( window.alert("소모량이 0입니다. 계속 하시겠습니까?" ,"조선일보MIS", 1) != 1) {
								datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = 0;
								datagrid1.rowstatus(row) = 0;
								return;
							}
						}
						if( owh_qunt < 0 ) {
							commMsgBox("[출고수량이 재고수량을 초과했습니다]");
							datagrid1.valueMatrix(row, datagrid1.colRef("hjg_cnt")) = 0;
							datagrid1.rowstatus(row) = 0;
							return;
						}
						datagrid1.valueMatrix(row, datagrid1.colRef("owh_qunt")) = owh_qunt ;
						
						//계사된 소모량과 재고수량이 같으면 재고금액을 모두 떨군다
						if( (yesDayCnt)  == owh_qunt) {
							datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) =  datagrid1.valueMatrix(row, datagrid1.colRef("hjg_amt"));
						} else {
							datagrid1.valueMatrix(row, datagrid1.colRef("owh_amt")) = owh_uprc * owh_qunt ;
						}
						break;
					}
				]]>
				</script>
			</datagrid>
			<caption id="caption1" style="left:10px; top:5px; width:190px; height:15px; ">
				<![CDATA[>> 일반 부재료 출고 상세]]>
			</caption>
			<!--
			<group id="group6" class="gro_btn" style="left:720px; top:225px; width:150px; height:21px; ">
				<button id="button13" class="btn_grid04" style="left:85px; top:2px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
					<caption>행삭제</caption>
					<script type="javascript" ev:event="onclick">
						<![CDATA[
					 			// STEP 1. 조회된 데이터인지 신규 데이터인지의 여부 
					 			var seq = model1.getValue("/root/reqData/owh_dt_key/seq");
					 			var magam = "";
					 			var cell = datagrid1.selectedCells;
					 			
					 			if(cell.length < 1)
								{
									alert("select a Cell");
									return;
								}
								
					 			var row = cell.item(0).row;
					 			var col = cell.item(0).col;
					 			
					 			if( seq != "" )            //조회된 데이터
					 			{
					 				   magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					 				   
					 				   if( magam != '0') {
					 				   	commMsgBox("해당 문서의 마감 구분이 (" + magam + ") 경우 수정 하실 수 없습니다.)");
					 				   	return ;
					 				   }
					 				  
					 				   if( datagrid1.valueMatrix(row, 18) != '' )
					 				   {
					 				   	commMsgBox( "동시입출고 품목이므로 입고등록화면에서 삭제하시오");
					 				   	return ;
					 				   }
					 				   
					 				   datagrid1.rowStatus (row) = 4;
					 			}
					 			else if (seq == "")       //신규데이터
					 			{
					 				   datagrid1.deleteItem(row);  //신규 데이터이면 ROW 삭제
					 			}
					]]>
					</script>
				</button>
				<button id="button14" class="btn_grid04" style="left:20px; top:2px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
					<caption>행추가</caption>
					<script type="javascript" ev:event="onclick">
						<![CDATA[
						datagrid2.rows = 1;
						if( commReqCheck(group3) == false ) return;
						
						model1.send("mt_submatrout_1102");
						model1.copyNode("/root/resData/gridData_sub_1","/root/tempData/gridData_sub_1");
						datagrid1.refresh();
						
						for (var i=1; i<datagrid1.rows; i++){
							if (datagrid1.valueMatrix(i, datagrid1.colRef("ewh_budg_cd")) == "140002" && datagrid1.valueMatrix(i, datagrid1.colRef("dstb_rat_cd")) == "904600"){
								alert(datagrid1.valueMatrix(i, datagrid1.colRef("ewh_budg_cd")));
								datagrid1.isReadOnly(i, 1, i, datagrid1.cols -1) = true;
							} else {
								datagrid1.isReadOnly(i, 1, i, datagrid1.cols -1) = false;
							}
							datagrid1.valueMatrix(i, datagrid1.colRef("owh_type")) = "1";
						}
						
						model1.copyNode("/root/resData/gridData_sub_2_1","/root/tempData/gridData_sub_2_1");
						datagrid4.refresh();
						
						for (var i=1; i<datagrid4.rows; i++){
							datagrid4.valueMatrix(i, datagrid4.colRef("owh_type")) = "2";
						}
						
						model1.copyNode("/root/resData/gridData_sub_2_2","/root/tempData/gridData_sub_2_2");
						datagrid5.refresh();
								
						model1.send("mt_submatrout_1115");		// 동적 그리드 데이터 생성 
						
						for (i = 1 ; i < datagrid2.rows ; i++){
							for (var ii=4; ii<datagrid2.cols; ii++){
								if (ii % 3 == 1){
									datagrid2.valueMatrix(i, ii) = "0";
								}
							}
						}
						datagrid2.refresh();
						
						model1.setValue("/root/reqData/owh_dt_key/cmpy_cd","");
						model1.setValue("/root/reqData/owh_dt_key/occr_dt","");
						model1.setValue("/root/reqData/owh_dt_key/seq","");
                    	     /*
						for (i = 1 ; i < datagrid1.cols ; i++){
							datagrid1.colDisabled(i) = false;
							datagrid1.rowStatus(i) = 0;
						}
						*/
						]]>
					</script>
				</button>
			</group>
			-->
		</group>
		<datagrid id="datagrid3" nodeset="/root/resData/gridData_main/record" caption="회사구분^작성일자^No^출고일자^공장구분^마감구분" colsep="^" colwidth="100, 100, 100, 224, 224, 100" mergecellsfixedrows="bycolrec" rowsep="|" selectionmode="free" style="left:10px; top:65px; width:890px; height:105px; ">
			<col ref="cmpy_cd" visibility="hidden"/>
			<col ref="occr_dt" visibility="hidden"/>
			<col ref="seq"/>
			<col ref="owh_dt" format="yyyy-mm-dd"/>
			<col ref="fac_clsf"/>
			<col ref="clos_clsf"/>
			<script type="javascript" ev:event="ondblclick">
				<![CDATA[
					var Cell = datagrid3.selectedCells;
					var i = 0;
					var row = Cell.item(0).row;
					var col  = Cell.item(0).col;
					if(datagrid3.row == 0) {
						return;
					}
					
					//alert(datagrid3.valueMatrix(row, 4));
					model1.setValue("/root/reqData/owh_dt_key/cmpy_cd",	datagrid3.valueMatrix(row, 0));
					model1.setValue("/root/reqData/owh_dt_key/occr_dt", 	datagrid3.valueMatrix(row, 1));
					model1.setValue("/root/reqData/owh_dt_key/seq",      	datagrid3.valueMatrix(row, 2));
					model1.setValue("/root/reqData/owh_dt_key/fac_clsf",   datagrid3.valueMatrix(row, 4).substr(0,2));
					model1.setValue("/root/reqData/owh_dt_key/magam",      datagrid3.valueMatrix(row, 5).substr(0,2));
					model1.setValue("/root/resData/resForm/fac_clsf"   ,       datagrid3.valueMatrix(row, 4).substr(0,2)); 
					model1.setValue("/root/resData/resForm/owh_dt"   ,       datagrid3.valueMatrix(row, 3));
					group3.refresh();
					group3.disabled = true;
					//datagrid2_init();
					
					button14.disabled = true;
					model1.send("mt_submatrout_1104");
					
					model1.copyNode("/root/resData/gridData_sub_1","/root/tempData/gridData_sub_1");
					var nodeList = instance1.selectNodes("/root/resData/gridData_sub_1/record");
					for (var i=0; i< nodeList.length; i++){
						nodeList.item(i).getElementsByTagName("hjg_cnt").item(0).value = eval(nodeList.item(i).getElementsByTagName("hjg_cnt").item(0).value) + eval(nodeList.item(i).getElementsByTagName("prv_cnt").item(0).value);
					}
     				datagrid1.refresh();
 
					// 동적 그리드 데이터 생성 
					// datagrid2Creat();
					model1.send("mt_submatrout_1116");
					
					model1.copyNode("/root/resData/gridData_sub_2_1","/root/tempData/gridData_sub_2_1");
					datagrid4.refresh();
					
					model1.copyNode("/root/resData/gridData_sub_2_2","/root/tempData/gridData_sub_2_2");
					datagrid6.refresh();
					
					//datagridCreate();
					
					
					for (i = 1 ; i < datagrid1.cols ; i++){
						datagrid1.colDisabled(i) = true;
						datagrid1.rowStatus(i) = 0;
					}
					
					for (i = 1 ; i < datagrid2.cols ; i++){
						datagrid2.colDisabled(i) = true;
						//datagrid2.rowStatus(i) = 0;
					}
				]]>
			</script>
		</datagrid>
		<group id="group3" class="gro_sel" style="left:10px; top:175px; width:890px; height:24px; ">
			<caption id="caption8" class="list_cap01" style="left:0px; top:0px; width:80px; height:24px; text-align:center; ">출고일자</caption>
			<caption id="caption9" class="list_cap02" style="left:79px; top:0px; width:811px; height:24px; text-align:center; "/>
			<caption id="caption12" class="list_cap01" style="left:206px; top:0px; width:89px; height:24px; text-align:center; ">소모처</caption>
			<input id="input4" ref="/root/resData/resForm/owh_dt" class="req" inputtype="date" caption="소모일자" appearance="input" style="left:86px; top:3px; width:109px; height:18px; background-color:#ffffcc; border-color:#999999; "/>
			<select1 id="combo1" ref="/root/resData/resForm/fac_clsf" class="req" appearance="minimal" caption="소모처" style="left:300px; top:3px; width:100px; height:18px; background-color:#ffffcc; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/fac_clsf2/item">
						<label ref="label"/>
						<value ref="value"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					var nodeList = instance1.selectNodes("/root/initData/comboSet/fac_clsf2/item");
					
					if (model.getValue("/root/resData/resForm/fac_clsf") == "10"){
						input5.disabled = false;
						model.setValue("/root/resData/resForm/dept_cd", "");
					} else {
						input5.disabled = true;
						model.setValue("/root/resData/resForm/dept_cd", "");
						
						for (var i=0; i<nodeList.length; i++){
							if (model.getValue("/root/resData/resForm/fac_clsf") == nodeList.item(i).getElementsByTagName("value").item(0).value){
								model.setValue("/root/resData/resForm/dept_cd", nodeList.item(i).getElementsByTagName("dept").item(0).value);
							}
						}
					}
					
					]]>
				</script>
			</select1>
			<caption id="caption10" class="list_cap01" style="left:416px; top:0px; width:95px; height:24px; text-align:center; ">소모부서</caption>
			<input id="input5" ref="/root/resData/resForm/dept_cd" inputtype="button" maxlength="6" style="left:514px; top:4px; width:93px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						var funcName = "setDeptGr3";
						
						model.setValue("/root/reqData/fwdData/func_name", funcName );
					    
						window.load("../../hd/com/HD_COM_1100.xrw"
								, "modal"
								, ""
								,"left:100px; top:100px; width:650px; height:520; align:center; caption:hidden;"
								, "/root/reqData/fwdData/func_name", "/root/reqData/fwdData/func_nm");
					]]>
				</script>
				<script type="javascript" ev:event="onmaxlength">
					<![CDATA[
					model1.makeNode("/root/reqData/dept_cd");
					model1.setValue("/root/reqData/dept_cd", input5.currentText);
							     
					model1.send("mt_common_0001");
								
					model1.setValue("/root/resData/resForm/dept_cd", model1.getValue("/root/tempData/cd"));
					model1.setValue("/root/resData/resForm/dept_nm",model1.getValue("/root/tempData/cd_nm"));
								
					input5.refresh();
					output2.refresh();
								
					model1.destroy("/root/reqData/dept_cd");			
					]]>
				</script>
			</input>
			<output id="output2" ref="/root/resData/resForm/dept_nm" style="left:610px; top:4px; width:94px; height:18px; border-color:#999999; "/>
			<button id="button5" class="btn_grid04" style="left:825px; top:5px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
				<caption>행삭제</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					 			// STEP 1. 조회된 데이터인지 신규 데이터인지의 여부 
					 			var seq = model1.getValue("/root/reqData/owh_dt_key/seq");
					 			var magam = "";
					 			var cell = datagrid1.selectedCells;
					 			
					 			if(cell.length < 1)
								{
									alert("select a Cell");
									return;
								}
								
					 			var row = cell.item(0).row;
					 			var col = cell.item(0).col;
					 			
					 			if( seq != "" )            //조회된 데이터
					 			{
					 				   magam = model1.getValue("/root/reqData/owh_dt_key/magam");
					 				   
					 				   if( magam != '0') {
					 				   	commMsgBox("해당 문서의 마감 구분이 (" + magam + ") 경우 수정 하실 수 없습니다.)");
					 				   	return ;
					 				   }
					 				  
					 				   if( datagrid1.valueMatrix(row, 18) != '' )
					 				   {
					 				   	commMsgBox( "동시입출고 품목이므로 입고등록화면에서 삭제하시오");
					 				   	return ;
					 				   }
					 				   
					 				   datagrid1.rowStatus (row) = 4;
					 			}
					 			else if (seq == "")       //신규데이터
					 			{
					 				   datagrid1.deleteItem(row);  //신규 데이터이면 ROW 삭제
					 			}
					]]>
				</script>
			</button>
			<button id="button2" class="btn_grid08" style="left:710px; top:5px; width:111px; height:17px; background-image:../../../images/btn_s_8.gif; ">
				<caption>현재고가져오기</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						datagrid2.rows = 1;
						if( commReqCheck(group3) == false ) return;
						
						if (model.getValue("/root/resData/resForm/dept_cd") == ""){
							alert("소모부서를 입력해주십시오.");
							return;
						}
						
						model.setValue("/root/resData/resForm/p_gubun", "1");
						group6.visible = true;
						group7.visible = false;
						
						model1.send("mt_submatrout_1102");
						model1.copyNode("/root/resData/gridData_sub_1","/root/tempData/gridData_sub_1");
						datagrid1.refresh();
						
						button14.disabled = false;
						
						
						for (var i=1; i<datagrid1.rows; i++){
							//if (datagrid1.valueMatrix(i, datagrid1.colRef("owh_type")) == "1"){
								//alert(datagrid1.valueMatrix(i, datagrid1.colRef("ewh_budg_cd")));
								//datagrid1.isReadOnly(i, 1, i, datagrid1.cols -1) = true;
							//} else {
							datagrid1.isReadOnly(i, 1, i, datagrid1.cols -1) = false;
							//}
							//datagrid1.valueMatrix(i, datagrid1.colRef("owh_type")) = "1";
						}
						
						//model1.copyNode("/root/initData/comboSet/ps_matr","/root/tempData/ps_matr");
						//model1.copyNode("/root/initData/comboSet/film_matr","/root/tempData/film_matr");
						//model1.copyNode("/root/initData/comboSet/medi_cd","/root/tempData/medi_cd");
						//model1.copyNode("/root/initData/comboSet/sect_cd_1","/root/tempData/sect_cd_1");
						//model1.copyNode("/root/initData/comboSet/sect_cd_2","/root/tempData/sect_cd_2");
						//datagrid5.refresh();
						//datagrid7.refresh();
						
						model1.copyNode("/root/resData/gridData_sub_2_1","/root/tempData/gridData_sub_2_1");
						datagrid4.refresh();
						
						for (var i=1; i<datagrid4.rows; i++){
							datagrid4.rowStatus(i) = 1;
							//datagrid4.valueMatrix(i, datagrid4.colRef("owh_type")) = "2";
						}
						
						model1.copyNode("/root/resData/gridData_sub_2_2","/root/tempData/gridData_sub_2_2");
						datagrid6.refresh();
						
						//datagridCreate();
						
						model1.send("mt_submatrout_1115");		// 동적 그리드 데이터 생성 
						datagrid2.isReadOnly(datagrid2.rows -2, 0, datagrid2.rows -1 , datagrid2.cols -1) = true;
						//datagrid2.isReadOnly(datagrid2.rows -2, 0, datagrid2.rows -2 , datagrid2.cols -1) = true;
						//datagrid2.removeRow();
						//datagrid2.valueMatrix(datagrid2.rows- 1, 1) = "합계";
						/*
						for (i = 1 ; i < datagrid2.rows ; i++){
							for (var ii=4; ii<datagrid2.cols; ii++){
								if (ii % 3 == 1){
									datagrid2.valueMatrix(i, ii) = "0";
								}
							}
						}
						datagrid2.refresh();
						*/
						
						model1.setValue("/root/reqData/owh_dt_key/cmpy_cd","");
						model1.setValue("/root/reqData/owh_dt_key/occr_dt","");
						model1.setValue("/root/reqData/owh_dt_key/seq","");
                    	     /*
						for (i = 1 ; i < datagrid1.cols ; i++){
							datagrid1.colDisabled(i) = false;
							datagrid1.rowStatus(i) = 0;
						}
						*/
						]]>
				</script>
			</button>
		</group>
		<group id="group_btnT" class="gro_tab" style="left:10px; top:410px; width:890px; height:24px; ">
			<caption id="caption11" class="tabline" style="left:0px; top:23px; width:890px; height:1px; "/>
			<button id="button13" class="tab14" group="tab" selected="true" style="left:0px; top:0px; width:209px; height:23px; ">
				<caption>개별등록</caption>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
						group6.visible = true;
						group7.visible = false;
						model1.setValue("/root/resData/resForm/p_gubun", "1");
					]]>
				</script>
			</button>
			<button id="button14" class="tab14" disabled="true" group="tab" style="left:210px; top:0px; width:209px; height:23px; ">
				<caption>일괄등록</caption>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
						if( commReqCheck(group3) == false ) return;
						
						var nodeList = instance1.selectNodes("/root/initData/comboSet/ps_matr/item");
						
						group6.visible = false;
						group7.visible = true;
						model1.setValue("/root/resData/resForm/p_gubun", "2");
						
						if (nodeList.length == 0){
							model.send("mt_submatrout_1100");
							model1.copyNode("/root/initData/comboSet/matr_ps","/root/tempData/matr_ps");
							model1.copyNode("/root/initData/comboSet/matr_film","/root/tempData/matr_film");
							model1.copyNode("/root/initData/comboSet/medi_cd","/root/tempData/medi_cd");
							model1.copyNode("/root/initData/comboSet/sect_cd_1","/root/tempData/sect_cd_1");
							model1.copyNode("/root/initData/comboSet/sect_cd_2","/root/tempData/sect_cd_2");
							datagrid5.refresh();
							datagrid7.refresh();
						}
					]]>
				</script>
			</button>
		</group>
		<group id="group6" style="left:10px; top:433px; width:890px; height:187px; ">
			<datagrid id="datagrid2" nodeset="/root/resData/gridData5/record" caption="자재코드^caption1^caption2^caption3^caption5^caption6^caption7^caption8^caption9^caption10^caption4" colsep="#" colwidth="100, 100, 100, 100, 100, 100, 100, 100, 100, 100" datatype="delimeter" rowsep="|" selectionmode="free" style="left:0px; top:25px; width:475px; height:135px; ">
				<col ref="d_0"/>
				<col ref="d_1"/>
				<col ref="d_2"/>
				<col ref="d_4"/>
				<col ref="d_5"/>
				<col ref="d_6"/>
				<col ref="d_7"/>
				<col ref="d_8"/>
				<col ref="d_9"/>
				<col ref="d_10"/>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					var col =	datagrid2.col;
					var row = datagrid2.row;
					
					gValue = new makeValue (row, col, datagrid2.valueMatrix(row, col));
					datagrid2.isReadOnly(row, col) = true;
					
					var yesDayCnt      =   0;
					var hjg_cnt        =   0;
					var owh_uprc        =   0;
					var owh_amt         =   0;
					
					var medi_cd = datagrid2.valueMatrix(row, col + 1);
					var sect_cd  = datagrid2.valueMatrix(row, col + 2);
					var matr_cd  = datagrid2.valueMatrix(row, 0); 
					var matr_clsf  = datagrid2.valueMatrix(row, 2);
					var owh_qunt  =  datagrid2.valueMatrix(row, col);    // 소모량
					
					//model.setValue("/root/resData/resForm/owh_qunt", owh_qunt);
					
					//alert("owh_qunt=" + owh_qunt + "\nmedi_cd=" + medi_cd + "\nrow=" + row + "\ncol=" + col);
					
					if(  owh_qunt == '' || Number(owh_qunt) < 1) {
						//datagrid2.valueMatrix(row, col) = 0;
						return;
					}
					//alert("matr_cd=" + matr_cd + "\nmedi_cd=" + medi_cd + "\nsect_cd=" + sect_cd);
					for(var i = 1;  i < datagrid4.rows; i++){
						if( matr_cd == datagrid4.valueMatrix(i, 2) && medi_cd == datagrid4.valueMatrix(i, 4) && sect_cd == datagrid4.valueMatrix(i, 5) ){
							//yesDayCnt = Number( datagrid4.valueMatrix(i, 6));   //전일재고
							//hjg_cnt     = yesDayCnt - Number(owh_qunt);
								
							//if( hjg_cnt < 0 ) {
							//	alert("전일재고 : " + yesDayCnt + "입니다 . 소모량을 확인해주세요");
							//	datagrid2.valueMatrix(row, col) = 0;
							//	return;
							//}
							datagrid4.valueMatrix(i, 6) = owh_qunt;
							datagrid4.valueMatrix(i, 7) = row;
							datagrid4.valueMatrix(i, 8) = col;
							/*
							owh_uprc =  Number( datagrid4.valueMatrix(i,  8));   //소모단가
							owh_amt  = owh_qunt * Number(owh_uprc);
							datagrid4.valueMatrix(i, 6)  = hjg_cnt ;  //현재고
							datagrid4.valueMatrix(i, 7)  = owh_qunt; //소모량
							datagrid4.valueMatrix(i, 9)  = owh_amt; //소모금액
							datagrid4.addStatus(i, "update");
							//break;
							*/
						}
					}
					var qunt = 0;
					for(var i = 1;  i < datagrid2.rows-2; i++){
						if (datagrid2.valueMatrix(i, col) != ""){
							qunt = qunt + eval(datagrid2.valueMatrix(i, col));
						}
						//alert(datagrid2.valueMatrix(row, i) + "\n" + i);
					}
					datagrid2.valueMatrix(datagrid2.rows -2, col) = qunt;
					
					qunt = 0;
					for(var i = 2;  i < datagrid2.cols -1; i=i+3){
						if (datagrid2.valueMatrix(row, i) != ""){
							qunt = qunt + eval(datagrid2.valueMatrix(row, i));
						}
						//alert(datagrid2.valueMatrix(row, i) + "\n" + i);
					}
					datagrid2.valueMatrix(row, datagrid2.cols -1) = qunt;
					//alert(matr_cd + "\n" + qunt);
					/*
					for (var i=1; i<datagrid1.rows; i++){
						if (datagrid1.valueMatrix(i, datagrid1.colRef("matr_cd")) == matr_cd){
							datagrid1.valueMatrix(i, datagrid1.colRef("owh_qunt")) = qunt;
							datagrid1.valueMatrix(i, datagrid1.colRef("hjg_cnt")) = eval(datagrid1.valueMatrix(i, datagrid1.colRef("yesday_cnt"))) - qunt;
							datagrid1.valueMatrix(i, datagrid1.colRef("owh_amt")) = qunt * eval(datagrid1.valueMatrix(i, datagrid1.colRef("owh_uprc")));
							datagrid1.addStatus(i, "update");
						}
					}
					*/
					//alert(datagrid2.valueMatrix(row, col));
					//datagrid4.refresh();
					
					]]>
				</script>
				<script type="javascript" ev:event="ondblclick">
					<![CDATA[
					var col =	datagrid2.col;
					var row = datagrid2.row;
					
					if (row != datagrid2.rows - 2) {
						datagrid2.isReadOnly(row, col) = false;
					}
					]]>
				</script>
				<script type="javascript" ev:event="onendedit">
					<![CDATA[
					var col =	datagrid2.col;
					var row = datagrid2.row;
					
					datagrid2.isReadOnly(row, col) = true;
					
					for (var i=1; i<datagrid4.rows; i++){
						if (row == datagrid4.valueMatrix(i, 7) && col == datagrid4.valueMatrix(i, 8) ){
							datagrid2.valueMatrix(row, col) = datagrid4.valueMatrix(i, 6);
						}
					}
					/*
					if () {
						
					}
					if (gValue.row == row && gValue.col == col){
						if (gValue.val != "") {
							datagrid2.valueMatrix(row, col) = gValue.val;
						}
					}
					*/
					]]>
				</script>
			</datagrid>
			<datagrid id="datagrid6" nodeset="/root/resData/gridData_sub_2_2/record" caption="seq^자재코드^자재코드^외간 매체^외간 매체^외간 매체^매수" colsep="#" colwidth="27, 26, 100, 100, 100, 100" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="free" style="left:525px; top:25px; width:365px; height:135px; ">
				<col ref="sub_seq" visibility="hidden"/>
				<col ref="matr_cd" visibility="hidden"/>
				<col ref="matr_nm"/>
				<col ref="medi_cd" visibility="hidden"/>
				<col ref="sect_nm"/>
				<col ref="sect_cd" visibility="hidden"/>
				<col ref="owh_num_shet" type="input" format="#,###"/>
			</datagrid>
			<caption id="caption13" style="left:5px; top:5px; width:190px; height:15px; ">
				<![CDATA[>> PS 판 출고 상세]]>
			</caption>
			<caption id="caption14" style="left:525px; top:5px; width:190px; height:15px; ">
				<![CDATA[>> 필름 외간 매수]]>
			</caption>
			<datagrid id="datagrid4" nodeset="/root/resData/gridData_sub_2_1/record" visibility="hidden" caption="SEQ^자재코드^자재명^매체^섹션^소모량^caption1^caption2" colsep="#" colwidth="50, 80, 90, 80, 77, 80, 100, 100" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" nodese="/root/resData/gridData_sub_2_1/record" style="left:495px; top:95px; width:360px; height:90px; ">
				<col ref="sub_seq"/>
				<col ref="matr_cd"/>
				<col ref="matr_nm"/>
				<col ref="medi_cd"/>
				<col ref="sect_cd"/>
				<col ref="owh_qunt" format="#,###" style="text-align:right; "/>
				<col ref="row"/>
				<col ref="col"/>
			</datagrid>
		</group>
		<group id="group7" visibility="hidden" style="left:10px; top:443px; width:890px; height:162px; ">
			<datagrid id="datagrid5" nodeset="/root/resData/gridData6/record" caption="자재코드^매체코드^섹션코드^사용량^SEQ^caption1^caption2" colsep="#" colwidth="120, 110, 120, 81, 100, 100, 100" rowheader="update" rowsep="|" selectionmode="free" style="left:0px; top:25px; width:475px; height:135px; ">
				<col ref="matr_cd" type="combo">
					<choices>
						<itemset nodeset="/root/initData/comboSet/matr_ps/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="medi_cd" type="combo">
					<choices>
						<itemset nodeset="/root/initData/comboSet/medi_cd/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="sect_cd" type="combo">
					<choices>
						<itemset nodeset="/root/initData/comboSet/sect_cd_1/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="owh_qunt" type="input"/>
				<col ref="sub_seq"/>
				<col ref="a" visibility="hidden"/>
				<col ref="b" visibility="hidden"/>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					var col = datagrid5.col;
					var row = datagrid5.row;
					 
					var yesDayCnt      =   0;
					var hjg_cnt        =   0;
					var owh_uprc        =   0;
					var owh_amt         =   0;
					
					if (col == 2){
						cellchanged();
					} else if (col == 4){
/*
						var medi_cd = datagrid5.valueMatrix(row, datagrid5.colRef("medi_cd"));
						var sect_cd  = datagrid5.valueMatrix(row, datagrid5.colRef("sect_cd"));
						var matr_cd  = datagrid5.valueMatrix(row, datagrid5.colRef("matr_cd")); 
						var owh_qunt  =  datagrid5.valueMatrix(row, datagrid5.colRef("owh_qunt"));    // 소모량 
						var qunt = 0;
						for(var i = 1;  i < datagrid5.rows; i++){
							if (datagrid5.valueMatrix(i, datagrid5.colRef("matr_cd")) == matr_cd){
								if (datagrid5.valueMatrix(i, datagrid5.colRef("owh_qunt")) != ""){
									qunt = qunt + eval(datagrid5.valueMatrix(i, datagrid5.colRef("owh_qunt")));
								}
							}
						}
						
						for (var i=1; i<datagrid1.rows; i++){
							if (datagrid1.valueMatrix(i, datagrid1.colRef("matr_cd")) == matr_cd){
								datagrid1.valueMatrix(i, datagrid1.colRef("owh_qunt")) = qunt;
								datagrid1.valueMatrix(i, datagrid1.colRef("hjg_cnt")) = eval(datagrid1.valueMatrix(i, datagrid1.colRef("yesday_cnt"))) - qunt;
								datagrid1.valueMatrix(i, datagrid1.colRef("owh_amt")) = qunt * eval(datagrid1.valueMatrix(i, datagrid1.colRef("owh_uprc")));
								datagrid1.addStatus(i, "update");
							}
						}
						*/
					}
					]]>
				</script>
			</datagrid>
			<button id="button15" class="btn_grid04" style="left:410px; top:5px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
				<caption>행삭제</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
		 			var cell = datagrid5.selectedCells;
					 			
		 			if(cell.length < 1){
						alert("select a Cell");
						return;
					}
								
		 			var row = cell.item(0).row;
		 			var col = cell.item(0).col;
					 			
					datagrid5.rowStatus (row) = 4;
 					//datagrid5.deleteItem(row);  //신규 데이터이면 ROW 삭제
					]]>
				</script>
			</button>
			<button id="button16" class="btn_grid04" style="left:340px; top:5px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
				<caption>행추가</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					 	datagrid5.addRow(true, true);
					]]>
				</script>
			</button>
			<datagrid id="datagrid7" nodeset="/root/resData/gridData7/record" caption="seq^자재코드^외간 매체^외간 매체^매수^caption1" colsep="#" colwidth="27, 126, 36, 130, 100, 100" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" selectionmode="free" style="left:525px; top:25px; width:365px; height:135px; ">
				<col ref="sub_seq" visibility="hidden"/>
				<col ref="matr_cd" type="combo">
					<choices>
						<itemset nodeset="/root/initData/comboSet/matr_film/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="medi_cd" visibility="hidden"/>
				<col ref="sect_cd" type="combo">
					<choices>
						<itemset nodeset="/root/initData/comboSet/sect_cd_2/item">
							<label ref="label"/>
							<value ref="value"/>
						</itemset>
					</choices>
				</col>
				<col ref="owh_num_shet" type="input" format="#,###"/>
				<col ref="a" visibility="hidden"/>
			</datagrid>
			<button id="button17" class="btn_grid04" style="left:825px; top:5px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
				<caption>행삭제</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
		 			var cell = datagrid7.selectedCells;
					 			
		 			if(cell.length < 1){
						alert("select a Cell");
						return;
					}
								
		 			var row = cell.item(0).row;
		 			var col = cell.item(0).col;
					 			
					datagrid7.rowStatus (row) = 4;
 					//datagrid5.deleteItem(row);  //신규 데이터이면 ROW 삭제
					]]>
				</script>
			</button>
			<button id="button18" class="btn_grid04" style="left:755px; top:5px; width:65px; height:17px; background-image:../../../images/btn_s_4.gif; ">
				<caption>행추가</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					 	datagrid7.addRow(true, true);
					 	datagrid7.valueMatrix(datagrid7.rows -1, datagrid7.colRef("medi_cd")) = "621";
					]]>
				</script>
			</button>
			<caption id="caption2" style="left:5px; top:5px; width:190px; height:15px; ">
				<![CDATA[>> PS 판 출고 상세]]>
			</caption>
			<caption id="caption7" style="left:525px; top:5px; width:190px; height:15px; ">
				<![CDATA[>> 필름 외간 매수]]>
			</caption>
		</group>
	</xhtml:body>
</xhtml:html>
