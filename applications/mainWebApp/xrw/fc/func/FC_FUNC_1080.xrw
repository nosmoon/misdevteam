<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet type="text/css" href="../../../css/style_sheet.css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>받을어음교환(FC_FUNC_1080)</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<!-- 화면 로딩시의 초기 데이터를 담당 -->
						<!-- 서버의 세션 정보를 담당한다 -->
						<session>
							<!--<cmpy_cd>100</cmpy_cd> 세션에서 처리하므로 주석함-->
							<cmpy_cd></cmpy_cd>
						</session>
						<comboSet>
							<!-- 선택계열의 정보를 담당 -->
							<dataSet>
								<xx_dlco_clsf_cd/>
								<xx_now_note_stat_cd_020/>
								<XX_CD>
									<record>
										<cd_nm/>
										<cd/>
									</record>
								</XX_CD>
								<DLCOCLSFCDLIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</DLCOCLSFCDLIST>
								<DEPSCLSFLIST>
									<record>
										<cd/>
										<cdnm/>
										<cd_abrv_nm/>
										<cdnm_cd/>
										<cdabrvnm_cd/>
									</record>
								</DEPSCLSFLIST>
							</dataSet>
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo>
							<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
						</pageInfo>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영 할 수 있다 -->
					</initData>
					<reqData>
						<!-- 전달하고자 하는 데이터를 담당 ( submit 함수에서 처리) -->
						<!-- 검색조건 처리 -->
						<fwdData/>
						<reqform>
							<multiUpdateData/>
							<stat_cd/>
							<stat_dt/>
							<!--<dlco_clsf_cd>95</dlco_clsf_cd>-->
							<dlco_clsf_cd/>
							<dlco_cd/>
							<deps_clsf_cd/>
							<rmks1/>
							<slip_no/>
							<dlco_cdnm/>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<slip_seq/>
							<place/>
							<tran_amt/>
							<biz_reg_no/>
							<bank_id/>
							<acct_num/>
							<tran_date/>
							<save_tran_amt/>
							<tran_date_seq/>
							<current_clsf/>
							<frex_cd/>
							<hjphwamt/>
						</reqform>
						<!-- formData 팝업,화면전환시 data이동시 -->
						<!-- MultiUpDate유형 사용시 처리 -->
						<searchData>
							<cmpy_cd/>
							<chkpjee/>
							<mtry_dt/>
							<chkplace/>
							<place/>
							<note_no/>
							<note_seq/>
						</searchData>
					</reqData>
					<resData>
						<!-- 전달 받은 데이터를 담당 ( submit의 결과가 담김) -->
						<resform>
							<acct_mang_no/>
							<biz_reg_no/>
							<bank_id/>
							<acct_num/>
							<tran_date_seq/>
							<current_clsf/>
							<tran_amt1/>
							<tran_date/>
							<selectAll/>
							<total_note_amt/>
							<total_corp_tax/>
							<total_rcpay_amt/>
							<total_etc_prft/>
							<fc_func_1083_i>
								<dataSet>
									<CURLIST>
										<record>
											<slip_occr_dt/>
											<slip_clsf_cd/>
											<slip_seq/>
											<slip_no/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_func_1083_i>
						</resform>
						<!-- 전달 받은 formData를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 데이터를 가공할 임시저장소 ( submit의 결과가 담김) -->
						<!-- 전달 받은 errorCode를 담당 ( submit의 결과가 담김) -->
						<!-- 전달 받은 errorMsg를 담당 ( submit의 결과가 담김) -->
						<resform1>
							<tran_date/>
							<tran_amt/>
						</resform1>
						<gridData>
							<!-- 전달 받은 grid데이터를 담당 ( submit의 결과가 담김) -->
							<!-- datagrid2 -->
							<!-- datagrid3 -->
							<fc_func_1082_l>
								<dataSet>
									<CURLIST>
										<record>
											<note_clsf_cdnm/>
											<note_no/>
											<note_amt/>
											<sale_dscn_amt/>
											<rcpay_amt/>
											<corp_tax/>
											<etc_prft/>
											<slip_no/>
											<mtry_dt/>
											<issu_pers_nm/>
											<dlco_cdnm/>
											<pay_plac_cdnm/>
											<now_note_stat_cdnm/>
											<dlco_cdnm2/>
											<comp_dt/>
											<slip_occr_dt/>
											<slip_clsf_cd/>
											<slip_seq/>
											<biz_reg_no/>
											<bank_id/>
											<acct_num/>
											<tran_date_seq/>
											<current_clsf/>
											<note_no1/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_func_1082_l>
							<fc_func_1085_l>
								<dataSet>
									<CURLIST>
										<record>
											<note_clsf_cdnm/>
											<note_no/>
											<note_amt/>
											<sale_dscn_amt/>
											<rcpay_amt/>
											<corp_tax/>
											<etc_prft/>
											<slip_no/>
											<mtry_dt/>
											<issu_pers_nm/>
											<dlco_cdnm/>
											<pay_plac_cdnm/>
											<now_note_stat_cdnm/>
											<dlco_cdnm2/>
											<comp_dt/>
											<slip_occr_dt/>
											<slip_clsf_cd/>
											<slip_seq/>
											<biz_reg_no/>
											<bank_id/>
											<acct_num/>
											<tran_date_seq/>
											<current_clsf/>
											<note_no1/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_func_1085_l>
						</gridData>
						<MsgData/>
					</resData>
					<tempData>
						<errcode/>
						<errmsg/>
					</tempData>
					<tempData2>
						<total_note_amt/>
						<total_corp_tax/>
						<total_rcpay_amt/>
						<total_etc_prft/>
					</tempData2>
				</root>
			</instance>
			<script type="javascript" src="../../../js/CIISComm.js"/>
			<script type="javascript" src="../../../js/TFCommon.js"/>
			<script type="javascript" src="../../../js/fcmc_common.js"/>
			<submission id="fc_func_1080_m" action="/fc/func1000/1080" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData" resultref="/root/initData/comboSet/dataSet"/>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					var cmpy_cd = model1.getValue("/root/initData/session/cmpy_cd");
					model1.setValue("/root/reqData/searchData/cmpy_cd",cmpy_cd);
					model1.setValue("/root/reqData/reqform/stat_dt", commCurDate());
					model1.setValue("/root/reqData/searchData/mtry_dt", commCurDate());
					model1.send("fc_func_1080_m");
					makeComboGubun("", "/root/initData/comboSet/dataSet/DLCOCLSFCDLIST", "record", "cdabrvnm_cd", "cd");
					makeComboGubun("", "/root/initData/comboSet/dataSet/DEPSCLSFLIST", "record", "cdabrvnm_cd", "cd");
					makeComboGubun("", "/root/initData/comboSet/dataSet/XX_CD", "record", "cd_nm", "cd");
					if(get_refvalue("/root/initData/comboSet/dataSet/mtry_cnt") > 0){
						show_message("만기도래된 구매카드가 존재합니다.");
					}
					//alert(model1.getValue("/root/initData/comboSet/dataSet/xx_dlco_clsf_cd"));
					//alert(model1.getValue("/root/initData/comboSet/dataSet/xx_now_note_stat_cd_020"));
					//loadRcpmDtlsPop_fc("H1"
					
					//alert(model1.getValue("/root/initData/comboSet/dataSet/xx_mang_cd_4"));
						
					model1.setValue("/root/reqData/reqform/dlco_clsf_cd",model1.getValue("/root/initData/comboSet/dataSet/xx_dlco_clsf_cd"));
					//alert(model1.getValue("/root/reqData/reqform/dlco_clsf_cd"));
					model1.refresh();
				]]>
			</script>
			<submission id="fc_func_1081_l" action="/fc/func1000/1081" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/fc_func_1082_l/dataSet"/>
			<submission id="fc_func_1082_l" action="/fc/func1000/1082" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData/reqform" resultref="/root/resData/gridData/fc_func_1082_l/dataSet"/>
			<submission id="fc_func_1083_i" action="/fc/func1000/1083" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData/reqform" resultref="/root/resData/resform/fc_func_1083_i/dataSet"/>
			<submission id="fc_func_1084_d" action="/fc/func1000/1084" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData/reqform" resultref="/root/resData/MsgData"/>
			<submission id="fc_func_1085_l" action="/fc/func1000/1085" mediatype="application/x-www-form-urlencoded" method="urlencoded-post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/fc_func_1085_l/dataSet"/>
			<script type="javascript" ev:event="xforms-model-construct-done">
				<![CDATA[
					set_default(datagrid1);
				]]>
			</script>
		</model>
		<script type="javascript">
			<![CDATA[
				var	_oth_clsf = "1";
				
				function open_fc_acct_1180(p_where,p_mode,p_title,p_readonly) {
				var need_popup = true;
				
				//검색조건이 모두 충족하지 않으면 종료한다.
				if (p_where == "FOCUS" && (dlco_clsf_cd.value.Trim() == "" || dlco_cd.value.Trim() == "")) {
					dlco_nm.value	= "";
					return;
				}
				
				p_where = p_where.toUpperCase();
				
				var popid = "fc_acct_1180";
				var subid = "fc_acct_1181_l";

				set_popup_send_data(popid		,"mode"			,p_mode			);
				set_popup_send_data(popid		,"title"			,p_title			);
				set_popup_send_data(popid		,"readonly"		,p_readonly		);
				set_popup_send_data(popid		,"clsf_cd"			,dlco_clsf_cd.value	);
				set_popup_send_data(popid		,"cd_f"			,dlco_cd.value		);
				set_popup_send_data(popid		,"cd_t"			,dlco_cd.value		);
				set_popup_send_data(popid		,"cd_abrv_nm"		,dlco_cd.value		);

				//포커스에서 호출 한 경우 직접 서블릿을 실행시켜서 데이터를 확인한다.
				if (p_where == "FOCUS") {
					//포커스로 검색이 시작되는 경우 무조껀 검색 결과에 해당하는 노드를 삭제하고 시작한다.
					//버튼의 경우는 검색결과가 "" 이면 지우도록 설정되어있음
					model.removenode(get_popup_rcvs_ref(popid));
					//인스턴스 구조가 없으면 copynode 동작이 되지 않으므로 기본 구조는 만들어준다.
					model.makeNode(get_popup_rcvs_ref(popid));
					
					//받는위치 분리를 위해서 receive 위치를 popid가 아닌 subid 기준으로 설정
					send_submission(
							"auto_" + subid
						,	get_popup_send_ref(popid)
						,	get_popup_rcvs_ref(subid) + "/dataSet"
						,	"/fc/acct1000/1181"
						,	"urlencoded-post"
						,	"application/x-www-form-urlencoded"
					);
					
					totalcnt = model.getValue(get_popup_rcvs_ref(subid) + "/dataSet" + "/CURLIST1/totalcnt");
			
					if (totalcnt == 1) {
						//데이터가 1건이고 focus out에서 호출한 경우
						//데이터를 설정하고 나간다.

//						model.duplicate(get_popup_rcvs_ref(popid) , get_popup_rcvs_ref(subid) + "/dataSet/CURLIST1/record");
						model.copyNode(get_popup_rcvs_ref(popid) , get_popup_rcvs_ref(subid) + "/dataSet/CURLIST1/record");
//						return;
						need_popup = false;
					}
					else if (totalcnt == 0) {
						show_message("[거래처코드]의 검색결과가 없습니다.");
//						return;
						need_popup = false;						
					}
					else {
						//포커스에서 호출 한 경우 1건이 아니면 무조건 종료
						//만약 1건 이상인 경우 popup을 호출해 달라고 하면
						//return을 지우면 됨
						//show_message("[거래처코드]의 검색결과가 2건 이상입니다.");
						//return;
						need_popup = true;
					}
				}
				
				//그외 버튼인 경우는 계속 진행
				if (need_popup) {
					open_popup(popid,"640");
				}

				//반드시 입력되어야 하는 필수 항목의 경우 검색결과가 공백이 아닌 경우만 반영해서
				//다시 조회 하기 쉽도록 하고
				if (get_popup_rcvs_data(popid,"clsf_cd") != "")			dlco_clsf_cd.value		=	get_popup_rcvs_data(popid,"clsf_cd");
				if (get_popup_rcvs_data(popid,"cd") != "")				dlco_cd.value			=	get_popup_rcvs_data(popid,"cd");
				//그외의 값은 지워지도록 한다.
				dlco_cdnm.value			=	get_popup_rcvs_data(popid,"cd_abrv_nm");
			}	
			
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="765" guideline="2,34;2,39;2,40;2,49;2,69;2,78;2,80;2,105;2,105;2,112;2,113;2,117;2,118;2,132;2,133;2,157;2,158;1,936;1,927;1,926;2,755;">
		<datagrid id="datagrid1" nodeset="/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record" autoresize="false" caption="어음구분^어음번호^어음금액^매출할인금액^수입금액^법인세^잡이익^전표번호^만기일^발행자^거래처^지급지^어음상태^교환은행^기산일^어음번호" colsep="#" colwidth="103, 150, 99, 100, 88, 84, 84, 126, 79, 136, 187, 100, 100, 100, 100, 100, 100, 100, 100, 100" extendlastcol="scroll" frozencols="3" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:10px; top:218px; width:926px; height:475px; ">
			<col ref="note_clsf_cdnm"/>
			<col ref="note_no" format="99999999-999999-9"/>
			<col ref="note_amt" format="(-)#,###" style="text-align:right; "/>
			<col ref="sale_dscn_amt" format="(-)#,###" style="left:330px; top:20px; width:100px; height:20px; text-align:right; "/>
			<col ref="rcpay_amt" type="input" format="(-)#,###" style="text-align:right; "/>
			<col ref="corp_tax" type="input" format="(-)#,###" style="text-align:right; "/>
			<col ref="etc_prft" type="input" format="(-)#,###" style="text-align:right; "/>
			<col ref="slip_no" format="99999999-99-999"/>
			<col ref="mtry_dt" format="yyyy-mm-dd"/>
			<col ref="issu_pers_nm"/>
			<col ref="dlco_cdnm" style="left:757px; top:20px; width:188px; height:20px; "/>
			<col ref="pay_plac_cdnm"/>
			<col ref="now_note_stat_cdnm"/>
			<col ref="dlco_cdnm2"/>
			<col ref="comp_dt" format="yyyy-mm-dd" style="left:1514px; top:20px; width:100px; height:20px; "/>
			<col ref="note_no1" type="input"/>
			<col ref="slip_clsf_cd" visibility="hidden"/>
			<col ref="slip_seq" visibility="hidden"/>
			<col ref="biz_reg_no" visibility="hidden"/>
			<col ref="bank_id" visibility="hidden"/>
			<script type="javascript" ev:event="onmouseup">
				<![CDATA[
//					if(datagrid1.valueMatrix(1,1) == ""){
//						return;
//					}
//					for(var i=0; i<datagrid1.selectedRows; i++)
//					{
//						var row = datagrid1.selectedRow(i);
//						if(datagrid1.rowStatus(row)==0){
//							datagrid1.addStatus(row,"update");
//						}else{
//							datagrid1.removeStatus(row,"update");
//						}
//						//datagrid2.addStatus(row, "update");
//						//datagrid2.rowHidden(row) = true;
//					}			
//					if(datagrid1.row > 0){
//						var slip_occr_dt = get_refvalue("/root/                      ta/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_occr_dt");
//						var slip_clsf_cd = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_clsf_cd");
//						var slip_seq = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_seq");
//						if(slip_occr_dt != ""){
//							set_refvalue("/root/reqData/reqform/slip_no",slip_occr_dt+"-"+ slip_clsf_cd+"-"+slip_seq);
//						}
//					}
//					
//					var scount = 0;
//					for(i=0;i<datagrid1.rows;i++){
//						if(datagrid1.rowStatus(i)!=0){
//							scount++;
//						}
//					}
//					
//					if (scount > 0) {
//						rmks1.value = "받을어음 " + scount + "건 교환입금";
//					}else{
//						rmks1.value = "";
//					}
				]]>
			</script>
			<script type="javascript" ev:event="oncopy">
				<![CDATA[
				// datagrid 에 선택된 셀을 얻어온다							
//				var selected = datagrid1.selectedCells;
//				var excelData = "";
//				var miniCol = selected.item(0).col;
//				var miniRow = selected.item(0).row;
//				var maxCol = selected.item(0).col;
//				var maxRow = selected.item(0).row;
//				
//				var cell;
//				// col의 최대 최소 값을 구한다				
//				for(var i=0; i<selected.length; i++)
//				{
//					cell = selected.item(i);
//					
//					// 최대 col 겁색
//					if( cell.col > maxCol )
//						maxCol = cell.col;
//					
//					// 최소 col 겁색
//					if (cell.col < miniCol )
//						miniCol = cell.col;
//					
//					// 최대 row 검색
//					if( cell.row > maxRow )
//						maxRow = cell.row;
//					
//					// 최소 row 검색
//					if (cell.row < miniRow )
//						miniRow = cell.row;
//				}
//						
//				// cell Data 를 클립보드에 excel 형태로 집어넣음
//				for(var k=miniRow; k<=maxRow; k++)
//				{
//					for(var j=miniCol; j<=maxCol; j++)
//					{
//						var data = datagrid1.valueMatrix(k,j);
//						excelData += data;
//						if( j != maxCol)
//							excelData += "\t";
//					}
//	
//					if( k != maxRow)
//						excelData += "\n";
//				}
//				
//				//  클립보드 데이터 변경
//				window.clipBoardData = excelData;

				]]>
			</script>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					_oth_clsf = "1";
					
//					alert("onclick"+datagrid1.valueMatrix(1,1) );
					if(datagrid1.valueMatrix(1,1) == ""){
						return;
					}
//					for(var i=0; i<datagrid1.selectedRows; i++)
//					{
//						var row = datagrid1.selectedRow(i);
//						if(datagrid1.rowStatus(row)==0){
					if(datagrid1.col == "0"){					
						if(datagrid1.rowStatus(datagrid1.row) == "0"){
							datagrid1.addStatus(datagrid1.row,"update");
						}else{
							datagrid1.removeStatus(datagrid1.row,"update");
						}
					}
						//datagrid2.addStatus(row, "update");
						//datagrid2.rowHidden(row) = true;
//					}			
					if(datagrid1.row > 0){
//						var slip_occr_dt = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_occr_dt");
//						var slip_clsf_cd = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_clsf_cd");
//						var slip_seq = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+datagrid1.row+"]/slip_seq");
//						if(slip_occr_dt != ""){
//							set_refvalue("/root/reqData/reqform/slip_no",slip_occr_dt+"-"+ slip_clsf_cd+"-"+slip_seq);
//						}
						var var_slip_no  = get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+datagrid1.row+"]/slip_no");
						if(var_slip_no != ""){
							set_refvalue("/root/reqData/reqform/slip_no",var_slip_no);
						}
					}
					
					var scount = 0;
					var rv_total_rcpay_amt=0;
					var rv_total_corp_tax=0;
					var rv_total_etc_prft=0;
					var rv_total_note_amt=0;
											
					for(var i=0;i<datagrid1.rows;i++){
						if(datagrid1.rowStatus(i)!="0"){
							if(datagrid1.valueMatrix(i,1) !=""){
								scount++;
								rv_total_note_amt = Number(rv_total_note_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt")); 
								rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt"));
								rv_total_corp_tax = Number(rv_total_corp_tax) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax"));
								rv_total_etc_prft = Number(rv_total_etc_prft) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft"));
							}
						}
					}
					if(scount == datagrid1.rows-1){
						selectAll.value = "1";
					}else{
						selectAll.value = "";
					}					
					if (scount > 0) {
						rmks1.value = "받을어음 " + scount + "건 교환입금";
						set_refvalue("/root/resData/resform/total_note_amt",rv_total_note_amt);
						set_refvalue("/root/resData/resform/total_rcpay_amt",rv_total_rcpay_amt);
						set_refvalue("/root/resData/resform/total_corp_tax",rv_total_corp_tax);
						set_refvalue("/root/resData/resform/total_etc_prft",rv_total_etc_prft);
						group2.refresh();

					}else{
						set_refvalue("/root/reqData/reqform/rmks1","");
						set_refvalue("/root/resData/resform/total_note_amt","");
						set_refvalue("/root/resData/resform/total_rcpay_amt","");
						set_refvalue("/root/resData/resform/total_corp_tax","");
						set_refvalue("/root/resData/resform/total_etc_prft","");
						group2.refresh();
					}
				]]>
			</script>
			<script type="javascript" ev:event="xforms-value-changed">
				<![CDATA[
					var i = datagrid1.row;
					var note_no1 = datagrid1.valueMatrix(i,16);					
					if(datagrid1.col == 16){
						if(note_no1.length == 9){
							set_refvalue("/root/reqData/searchData/note_no",note_no1.substring(0,8));
							set_refvalue("/root/reqData/searchData/note_seq",note_no1.substring(8,9));
							
							model.send("fc_func_1085_l");
							
							var totalcnt = get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/totalcnt");

							if (totalcnt == 0) {
							}							
							else{
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_clsf_cdnm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/note_clsf_cdnm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_clsf_cdnm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/note_clsf_cdnm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_no",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/note_no"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/note_amt"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/sale_dscn_amt",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/sale_dscn_amt"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/rcpay_amt"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/corp_tax"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/etc_prft"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/slip_no",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/slip_no"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/mtry_dt",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/mtry_dt"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/issu_pers_nm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/issu_pers_nm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/dlco_cdnm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/dlco_cdnm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/pay_plac_cdnm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/pay_plac_cdnm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/now_note_stat_cdnm",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/now_note_stat_cdnm"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/dlco_cdnm2",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/dlco_cdnm2"));
								set_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/comp_dt",get_refvalue("/root/resData/gridData/fc_func_1085_l/dataSet/CURLIST/record[1]/comp_dt"));
								
								datagrid1.addRow(false);
							}
							datagrid1.refresh();
						}					
					}
					else if(datagrid1.col == 5 || datagrid1.col == 6 || datagrid1.col == 7){
						var scount = 0;
						var rv_total_rcpay_amt=0;
						var rv_total_corp_tax=0;
						var rv_total_etc_prft=0;
						var rv_total_note_amt=0;
												
						for(var i=0;i<datagrid1.rows;i++){
							if(datagrid1.rowStatus(i)!="0"){
								if(datagrid1.valueMatrix(i,1) !=""){
									scount++;
									rv_total_note_amt = Number(rv_total_note_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt")); 
									rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt"));
									rv_total_corp_tax = Number(rv_total_corp_tax) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax"));
									rv_total_etc_prft = Number(rv_total_etc_prft) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft"));
								}
							}
						}
						if(scount == datagrid1.rows-1){
							selectAll.value = "1";
						}else{
							selectAll.value = "";
						}					
						if (scount > 0) {
							rmks1.value = "받을어음 " + scount + "건 교환입금";
							set_refvalue("/root/resData/resform/total_note_amt",rv_total_note_amt);
							set_refvalue("/root/resData/resform/total_rcpay_amt",rv_total_rcpay_amt);
							set_refvalue("/root/resData/resform/total_corp_tax",rv_total_corp_tax);
							set_refvalue("/root/resData/resform/total_etc_prft",rv_total_etc_prft);
							group2.refresh();
	
						}else{
							set_refvalue("/root/reqData/reqform/rmks1","");
							set_refvalue("/root/resData/resform/total_note_amt","");
							set_refvalue("/root/resData/resform/total_rcpay_amt","");
							set_refvalue("/root/resData/resform/total_corp_tax","");
							set_refvalue("/root/resData/resform/total_etc_prft","");
							group2.refresh();
						}							
					}					
				]]>
			</script>
		</datagrid>
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<group id="group_scr" class="gro_sel" visibility="visible" style="left:10px; top:51px; width:926px; height:67px; ">
			<caption id="caption5" class="list_cap02" style="left:0px; top:0px; width:926px; height:26px; text-align:center; "/>
			<caption id="caption32" class="list_cap03" style="left:376px; top:0px; width:120px; height:26px; text-align:center; ">전표번호</caption>
			<input id="slip_no" ref="/root/reqData/reqform/slip_no" editable="false" format="99999999-99-999" appearance="input" style="left:501px; top:4px; width:120px; height:18px; text-align:center; "/>
			<caption id="caption1" class="list_cap02" style="left:0px; top:33px; width:926px; height:26px; text-align:center; "/>
			<select1 id="dlco_clsf_cd" ref="/root/reqData/reqform/dlco_clsf_cd" class="req" disabled="true" navindex="5" appearance="minimal" caption="은행구분" style="left:499px; top:37px; width:100px; height:18px; ">
				<choices>
					<!--
					<item>
						<label>95 은행</label>
						<value>95</value>
					</item>
					-->
					<itemset nodeset="/root/initData/comboSet/dataSet/XX_CD/record">
						<label ref="cd_nm"/>
						<value ref="cd"/>
					</itemset>
				</choices>
			</select1>
			<caption id="caption2" class="list_cap03" style="left:376px; top:33px; width:120px; height:26px; text-align:center; ">교환은행</caption>
			<input id="dlco_cd" ref="/root/reqData/reqform/dlco_cd" class="req" navindex="6" inputtype="button" style="left:604px; top:37px; width:120px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						open_fc_acct_1180("button","s","","1");				
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						open_fc_acct_1180("focus","s","","1");
					]]>
				</script>
			</input>
			<input id="dlco_cdnm" ref="/root/reqData/reqform/dlco_cdnm" editable="false" appearance="input" style="left:728px; top:37px; width:175px; height:18px; "/>
			<caption id="caption3" class="list_cap03" style="left:0px; top:0px; width:120px; height:26px; text-align:center; ">교환일</caption>
			<input id="stat_dt" ref="/root/reqData/reqform/stat_dt" class="req" navindex="4" inputtype="date" style="left:123px; top:4px; width:100px; height:18px; "/>
			<select id="checkbox2" ref="/root/reqData/searchData/chkpjee" navindex="2" overflow="visible" appearance="full" style="left:228px; top:38px; width:82px; height:18px; color:#0000ff; border-style:none; ">
				<choices>
					<item>
						<label>표지어음만</label>
						<value>1</value>
					</item>
				</choices>
			</select>
			<select id="srch_place" ref="/root/reqData/searchData/chkplace" navindex="3" overflow="visible" appearance="full" style="left:315px; top:38px; width:45px; height:18px; color:#0000ff; border-style:none; ">
				<choices>
					<item>
						<label>지방</label>
						<value>2</value>
					</item>
				</choices>
			</select>
			<caption id="caption6" class="list_cap03" style="left:0px; top:33px; width:120px; height:26px; text-align:center; ">만기일</caption>
			<input id="mtry_dt" ref="/root/reqData/searchData/mtry_dt" class="req" navindex="1" inputtype="date" style="left:123px; top:37px; width:100px; height:18px; "/>
		</group>
		<group id="group_line" class="gro_line" style="left:10px; top:122px; width:923px; height:5px; "/>
		<group id="group2" class="gro_sel" style="left:10px; top:136px; width:926px; height:51px; ">
			<caption id="caption25" class="list_cap02" style="left:0px; top:25px; width:926px; height:26px; text-align:center; "/>
			<input id="rmks1" ref="/root/reqData/reqform/rmks1" navindex="8" style="left:123px; top:30px; width:315px; height:18px; "/>
			<caption id="caption18" class="list_cap02" style="left:0px; top:0px; width:926px; height:26px; text-align:center; "/>
			<caption id="caption7" class="list_cap03" style="left:0px; top:25px; width:120px; height:26px; text-align:center; ">적요</caption>
			<caption id="caption17" class="list_cap03" style="left:0px; top:0px; width:120px; height:26px; text-align:center; ">예금구분</caption>
			<input id="total_note_amt" ref="/root/resData/resform/total_note_amt" editable="false" format="(-)#,###" appearance="input" style="left:537px; top:4px; width:140px; height:18px; text-align:right; "/>
			<input id="total_rcpay_amt" ref="/root/resData/resform/total_rcpay_amt" editable="false" format="(-)#,###" appearance="input" style="left:537px; top:29px; width:140px; height:18px; text-align:right; "/>
			<caption id="caption20" class="list_cap03" style="left:444px; top:0px; width:90px; height:26px; text-align:center; ">교환액</caption>
			<caption id="caption28" class="list_cap03" style="left:444px; top:25px; width:90px; height:26px; text-align:center; ">수입금액</caption>
			<input id="total_corp_tax" ref="/root/resData/resform/total_corp_tax" editable="false" format="(-)#,###" appearance="input" style="left:777px; top:4px; width:140px; height:18px; text-align:right; "/>
			<input id="total_etc_prft" ref="/root/resData/resform/total_etc_prft" editable="false" format="(-)#,###" appearance="input" style="left:777px; top:29px; width:140px; height:18px; text-align:right; "/>
			<caption id="caption31" class="list_cap03" style="left:684px; top:25px; width:90px; height:26px; text-align:center; ">잡이익</caption>
			<caption id="caption8" class="list_cap03" style="left:684px; top:0px; width:90px; height:26px; text-align:center; ">법인세</caption>
			<select1 id="deps_clsf_cd" ref="/root/reqData/reqform/deps_clsf_cd" class="req" navindex="7" appearance="minimal" editmode="inputsearch" itemcount="8" style="left:123px; top:4px; width:200px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/dataSet/DEPSCLSFLIST/record">
						<label ref="cdabrvnm_cd"/>
						<value ref="cd"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
					if(combo_data_contains(deps_clsf_cd, deps_clsf_cd.value) == -1){
						show_message("정확한 값을 선택해 주세요.");
						set_refvalue(deps_clsf_cd,"");
						return;
					}
					]]>
				</script>
			</select1>
		</group>
		<group id="grp_buttons" class="gro_sel" style="left:10px; top:705px; width:740px; height:21px; text-align:left; ">
			<button id="btn_print_slip" class="btn02" crud="P" style="left:340px; top:0px; width:52px; height:21px; ">
				<caption>전표출력</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var ch_no = get_refvalue(slip_no);
					if(ch_no == ""){
						show_message("전표번호가 없습니다.");
						return false;
					}
					// 글로벌변수 셋팅
					if(ch_no.length == 13){
						model.property("FC_ACCT_2260_slip_occr_dt")  = ch_no.substring(0, 8);			// 발생일자
						model.property("FC_ACCT_2260_slip_clsf_cd")  = ch_no.substring(8, 10);			// 전표구분
						model.property("FC_ACCT_2260_slip_seqfr") = ch_no.substring(10, 13);			// 일련번호 from
						model.property("FC_ACCT_2260_slip_seqto") = ch_no.substring(10, 13);			// 일련번호 to
						model.property("FC_ACCT_2260_slip_radio1") = "";			// 출력구분
						model.property("FC_ACCT_2260_popup_flag")  = "Y";
					}else{
						model.property("FC_ACCT_2260_slip_occr_dt")  = ch_no.substring(0, 8);			// 발생일자
						model.property("FC_ACCT_2260_slip_clsf_cd")  = ch_no.substring(9, 11);			// 전표구분
						model.property("FC_ACCT_2260_slip_seqfr") = ch_no.substring(12, 15);			// 일련번호 from
						model.property("FC_ACCT_2260_slip_seqto") = ch_no.substring(12, 15);			// 일련번호 to
						model.property("FC_ACCT_2260_slip_radio1") = "";			// 출력구분
						model.property("FC_ACCT_2260_popup_flag")  = "Y";
					}
					
					// 화면호출
					//viewer("mainFrame").window.javaScript.onLoadPopupPageEx("FC_ACCT_2260", "modal", "align:center; caption:hidden; width:650px; height:480px;");
					viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_ACCT_2260");	
					]]>
				</script>
			</button>
			<button id="btn_cancle" class="btn02" crud="D" style="left:175px; top:0px; width:52px; height:21px; ">
				<caption>취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					
							if(model1.getValue("/root/reqData/reqform/slip_no") == ""){
								show_message("삭제할 대상이 없습니다.");
								return;
							}
							if (show_message("삭제하시겠습니까?","삭제 확인",MB_YESNO) != IDYES) {
								return false;
							}							
							set_refvalue("/root/reqData/reqform/slip_occr_dt",slip_no.value.substring(0,8));
							set_refvalue("/root/reqData/reqform/slip_clsf_cd",slip_no.value.substring(8,10));
							set_refvalue("/root/reqData/reqform/slip_seq",slip_no.value.substring(10,13));							

							model1.send("fc_func_1084_d");							

							if(submit_completed()){							
								show_message("삭제되었습니다.");

								btn_select_ptcr.dispatch("onclick");
								if(datagrid1.rows == 1){
									model1.reset();
								}								
							}
							
							model1.refresh();
							
							/*
							if(model1.getValue("/root/tempData/errcode") != ""){
								model1.setValue("/root/pageInfo/statusMsg", model1.getValue("/root/tempData/errmsg"));
								model1.refresh();
								showErrorMsgBox(model1.getValue("/root/tempData/errcode"), model1.getValue("/root/tempData/errmsg"));
								return;
							}else{
								alert("삭제 되었습니다.");
							}	
							*/				
					]]>
				</script>
			</button>
			<button id="btnReset" class="btn02" style="left:230px; top:0px; width:52px; height:21px; ">
				<caption>초기화</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						model1.reset();	
					]]>
				</script>
			</button>
			<button id="btn_print" class="btn02" crud="P" style="left:285px; top:0px; width:52px; height:21px; ">
				<caption>출력</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var ch_no = get_refvalue(slip_no);
					
					// 글로벌변수 셋팅
					model.property("FC_FUNC_1220_radio1")  				= 		"15";									// 구분
					model.property("FC_FUNC_1220_stat_dt_15")  			= 		get_refvalue(stat_dt);					// 요청일	
					if(ch_no.length == 13){
						model.property("FC_FUNC_1220_slip_occr_dt_15")  		= 		ch_no.substring(0, 8);					// 발생일자
						model.property("FC_FUNC_1220_slip_clsf_cd_15")  		= 		ch_no.substring(8, 10);					// 전표구분
						model.property("FC_FUNC_1220_slip_seq_15") 			= 		ch_no.substring(10, 13);					// 일련번호
					}else{
						model.property("FC_FUNC_1220_slip_occr_dt_15")  		= 		ch_no.substring(0, 8);					// 발생일자
						model.property("FC_FUNC_1220_slip_clsf_cd_15")  		= 		ch_no.substring(9, 11);					// 전표구분
						model.property("FC_FUNC_1220_slip_seq_15") 			= 		ch_no.substring(12, 15);					// 일련번호
					}
					model.property("FC_FUNC_1220_pay_plac_cd_15") 		= 		"1";					// 라디오 구분
					model.property("FC_FUNC_1220_popup_flag")  			= 		"Y";
					
					// 화면호출
					viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_FUNC_1220");	
					]]>
				</script>
			</button>
			<button id="btn_help" class="btn02" crud="R" style="left:395px; top:0px; width:52px; height:21px; ">
				<caption>엑셀</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var grid = null;
					
					if(_oth_clsf == "1"){			
						grid = datagrid1;
					}
					
					var filename = window.fileDialog("save", ",", false, "", "xls", "Excel File(*.xls)|*.xls");
					if(filename!=""){
						grid.saveExcel(filename, "sheetname: ");
					}
					]]>
				</script>
			</button>
			<button id="btnClose" class="btn02" style="left:450px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						formClose();
					]]>
				</script>
			</button>
			<button id="btn_select_obj" class="btn02" crud="R" style="left:10px; top:0px; width:52px; height:21px; ">
				<caption>대상조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						button1.disabled = false;
						//var cmpy_cd = model1.getValue("/root/initData/session/cmpy_cd");
						//model1.setValue("/root/reqData/searchData/cmpy_cd",cmpy_cd);
						//model1.setValue("/root/reqData/searchData/stat_dt",input5.value);
						//alert(model1.getValue("/root/reqData/searchData/stat_dt"));
						if (model1.getValue("/root/reqData/searchData/mtry_dt") == "") {
							show_message(" 만기일은  필수 입력 항목입니다.");
							return false;
							model1.setFocus("mtry_dt");
						}
						if(srch_place.value == "2"){
							set_refvalue("/root/reqData/searchData/place","2");
						}
						else{
							set_refvalue("/root/reqData/searchData/place","1");
						}
						
						//showProgressbar = "false";
						model1.send( "fc_func_1081_l");
						var totalcnt = get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/totalcnt");
//						alert(totalcnt);
						if (totalcnt == 0) {
	//						model.reset();
							show_message("검색결과가 없습니다.");
							reset_refnode("/root/resData/gridData/fc_func_1082_l/dataSet");
							datagrid1.refresh();							
							return false;
						}else{
//							for(var i=1; i<datagrid1.rows; i++){
//								if((datagrid1.valueMatrix(i,15)=="1010")||(datagrid1.valueMatrix(i,15)=="1015")){
//								   datagrid1.isReadOnly(i, 4,i,6) = false;
//								   datagrid1.valueMatrix(i,5) = 0
//  								   datagrid1.valueMatrix(i,6) = 0
//								}else{
//								   datagrid1.valueMatrix(i,5) = 0
//  								   datagrid1.valueMatrix(i,6) = 0									
//								   datagrid1.isReadOnly(i, 4,i,6) = true;
//								}
//							}
						}							

						selectAll.dispatch("xforms-select");
						selectAll.value = "1";
						selectAll.visible = true;
//						slip_no.value = "";
						
						var scount = 0;
						var rv_total_rcpay_amt=0;
						var rv_total_corp_tax=0;
						var rv_total_etc_prft=0;
						var rv_total_note_amt=0;
												
						for(var i=1;i<datagrid1.rows;i++){
							if(datagrid1.rowStatus(i)!=0){
								if(datagrid1.valueMatrix(i,1) !=""){
									scount++;
									rv_total_note_amt = Number(rv_total_note_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt")); 
									rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt"));
									rv_total_corp_tax = Number(rv_total_corp_tax) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax"));
									rv_total_etc_prft = Number(rv_total_etc_prft) + Number(get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft"));
								}
							}
						}
	
						if (scount > 0) {
							rmks1.value = "받을어음 " + scount + "건 교환입금";
							set_refvalue("/root/resData/resform/total_note_amt",rv_total_note_amt);
							set_refvalue("/root/resData/resform/total_rcpay_amt",rv_total_rcpay_amt);
							set_refvalue("/root/resData/resform/total_corp_tax",rv_total_corp_tax);
							set_refvalue("/root/resData/resform/total_etc_prft",rv_total_etc_prft);
							group2.refresh();
						}else{
							set_refvalue("/root/reqData/reqform/rmks1","");
							set_refvalue("/root/resData/resform/total_note_amt","");
							set_refvalue("/root/resData/resform/total_rcpay_amt","");
							set_refvalue("/root/resData/resform/total_corp_tax","");
							set_refvalue("/root/resData/resform/total_etc_prft","");
							group2.refresh();
						}																		
												
						for(var i=0; i<10; i++){
							datagrid1.addRow(false);
						}
						datagrid1.isReadOnly(1,16,datagrid1.rows-1,16) = false;
						
						for(var i=1;i<datagrid1.rows;i++){
							//if(get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/now_note_stat_cdnm").substring(0,2) =="08"){
							if(get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/now_note_stat_cdnm").substring(0,2) == model1.getValue("/root/initData/comboSet/dataSet/xx_now_note_stat_cd_020")){
								show_message("배서준비된 어음이 있습니다.");
								break;
							}
						}						
						model1.refresh();					
					]]>
				</script>
			</button>
			<button id="btn_select_ptcr" class="btn02" crud="R" style="left:65px; top:0px; width:52px; height:21px; ">
				<caption>내역조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						button1.disabled = true;
						//var cmpy_cd = model1.getValue("/root/initData/session/cmpy_cd");
						//model1.setValue("/root/reqData/searchData/cmpy_cd",cmpy_cd);
						//model1.setValue("/root/reqData/searchData/stat_dt",input5.value);
						//alert(model1.getValue("/root/reqData/searchData/stat_dt"));
						if (model1.getValue("/root/reqData/reqform/stat_dt") == "") {
							show_message("교환일은  필수 입력 항목입니다.");
							return false;
							model1.setFocus("stat_dt");
						}
						//debugger;
						model1.send("fc_func_1082_l");
						totalcnt = model.getValue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/totalcnt");
						if (totalcnt == 0) {
	//						model.reset();
							show_message("검색결과가 없습니다.");
							reset_refnode("/root/resData/gridData/fc_func_1082_l/dataSet");
							datagrid1.refresh();
							return false;
						}else{
							for(var i=1; i<datagrid1.rows; i++){
							     datagrid1.isReadOnly(i, 4,i,6) = true;
							}
//							var slip_occr_dt = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+ eval(i-1) +"]/slip_occr_dt");
//							var slip_clsf_cd = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+ eval(i-1) +"]/slip_clsf_cd");
//							var slip_seq = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+ eval(i-1) +"]/slip_seq");
//							set_refvalue("/root/reqData/reqform/slip_no",slip_occr_dt+"-"+ slip_clsf_cd+"-"+slip_seq);
							var var_slip_no = get_refvalue("/root/resData/gridData/dataSet/CURLIST/record["+ eval(i-1) +"]/slip_no");
							set_refvalue("/root/reqData/reqform/slip_no",var_slip_no);
						}
						
						set_refvalue("/root/resData/resform/biz_reg_no",get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record[1]/biz_reg_no"));
						set_refvalue("/root/resData/resform/bank_id",get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record[1]/bank_id"));
						set_refvalue("/root/resData/resform/acct_num",get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record[1]/acct_num"));
						set_refvalue("/root/resData/resform/tran_date_seq",get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record[1]/tran_date_seq"));
						set_refvalue("/root/resData/resform/current_clsf",get_refvalue("/root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record[1]/current_clsf"));						
						group4.refresh();

						selectAll.dispatch("xforms-deselect");
						selectAll.value ="";
						selectAll.visible = false;
						
						datagrid1.isReadOnly(1,16,datagrid1.rows-1,16) = true;
						model1.refresh();
					]]>
				</script>
			</button>
			<button id="btn_insert" class="btn02" crud="C" style="left:120px; top:0px; width:52px; height:21px; ">
				<caption>입력</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						//total_note_amt.value = "0";
						//total_coms.value = "0";
											
						if(datagrid1.rows == 0){
							show_message("입력할 대상이 없습니다.");
							return false;
						}

						if (biz_reg_no.value.Trim() != "") {
							if(tran_amt1.value != total_rcpay_amt.value){
								show_message("입력할 수 없는 자료입니다.(예금액과 수입금액 상이)");
								return false;
							}
						}
						
						var rv_total_rcpay_amt=0;
						var rv_total_corp_tax=0;
						var rv_total_etc_prft=0;
						var rv_total_note_amt=0;

						var cnt = 0;
						
						for(var i=0; i<datagrid1.rows; i++)
						{

							if(datagrid1.rowStatus(i)==1){
								if (datagrid1.valueMatrix(i,1) == ""){
									datagrid1.rowStatus(i) = "0";
								}
							}
							
							if(datagrid1.rowStatus(i) == "3" || datagrid1.rowStatus(i) == "2" || datagrid1.rowStatus(i) == "1"){
								cnt = cnt+1;
							}							
														
//							if(datagrid1.rowStatus(i)!=0){
//								if (datagrid1.valueMatrix(i,3) != ""){
//									rv_total_note_amt = Number(rv_total_note_amt) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt"); 
//								}
//								if (datagrid1.valueMatrix(i,3) != ""){								
////									rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + Number(datagrid1.valueMatrix(i,4));
//									rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt");									
//								}
//								if (datagrid1.valueMatrix(i,3) != ""){
////									rv_total_corp_tax = Number(rv_total_corp_tax) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt");
//									rv_total_corp_tax = Number(rv_total_corp_tax) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax");									
//								}
//								if (datagrid1.valueMatrix(i,3) != ""){								
////									rv_total_etc_prft = Number(rv_total_etc_prft) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax");
//									rv_total_etc_prft = Number(rv_total_etc_prft) + get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft");
//								}
//							}
							//datagrid2.addStatus(row, "update");
							//datagrid2.rowHidden(row) = true;
						}

						if(cnt == 0){
							show_message("입력할 대상이 없습니다.");
							for(var i=1; i<datagrid1.rows; i++){
								if (datagrid1.valueMatrix(i,1) == ""){
									datagrid1.rowStatus(i) = "1";
								}							
							}
							return false;
						}

						if (model.getValue("/root/reqData/reqform/stat_dt") == "") {
							show_message("교환일은  필수 입력 항목입니다.");
							return false;
							model.setFocus("stat_dt");
						}else if(model.getValue("/root/reqData/reqform/dlco_clsf_cd") == "") {
							show_message("거래처구분은 필수 입력 항목입니다.");
							return false;
							model.setFocus("dlco_clsf_cd");
						}else if(model.getValue("/root/reqData/reqform/dlco_cd") == "") {
							show_message("거래처코드는 필수 입력 항목입니다.");
							return false;
							model.setFocus("dlco_cd");
						}else if(model.getValue("/root/reqData/reqform/deps_clsf_cd") == "") {
							show_message("예금구분은 필수 입력 항목입니다.");
							return false;
							model.setFocus("deps_clsf_cd");
						}
						
//						total_note_amt.value = rv_total_note_amt;
//						total_rcpay_amt.value = rv_total_rcpay_amt;
//						total_corp_tax.value = rv_total_corp_tax;
//						total_etc_prft.value = rv_total_etc_prft;
				
						//model1.setValue("/root/tempData/total_note_amt",totalAmt);
						//model1.setValue("/root/tempData/total_coms",totalComs);
						//model1.setValue("/root/tempData/totalrecp",totalrecp);


							/*   
							    ESSTCYMD$ = Replace(mskESSTCYMD2, "-", "") 	할인일
							    ESCOMPGBCD$ = Mid(cboESCOMPGBCD.Text, 1, 2) 	할인은행
							    ESCOMPCD$ = Trim(txtESCOMPCD.Text) 			할인은행코드
							    PCH_COMPNM$ = txtCompnm.Text 				할인은행명
							    ESYGGBCD$ = Left(cboESYGGBCD.Text, 4) 			예금구분코드
							    ESJEOG1$ = txtESJEOG1.Text 					적요
							    ESUPSABEON$ = Cmndll.W_Sabeon
							    ESIPADDRESS$ = Cmndll.W_IPAddr
							    HJPUSEBUSEOCD$ = Cmndll.W_BuseoCd
							*/
														    						
							//alert(datagrid1.getUpdateData());					
							//alert("bbb");
							//model1.copyNode("/root/reqData/reqform","/root/reqData/searchData");
							
						model1.setValue("/root/reqData/reqform/biz_reg_no",biz_reg_no.value);
						model1.setValue("/root/reqData/reqform/bank_id",bank_id.value);
						model1.setValue("/root/reqData/reqform/acct_num",acct_num.value);
						model1.setValue("/root/reqData/reqform/tran_date",tran_date.value);						
						model1.setValue("/root/reqData/reqform/tran_date_seq",tran_date_seq.value);
						model1.setValue("/root/reqData/reqform/current_clsf","D");

						model1.setValue("/root/reqData/reqform/multiUpdateData", datagrid1.getUpdateData());																								
						
						if(srch_place.value == "2"){
							set_refvalue("/root/reqData/reqform/place","2");
						}
						else{
							set_refvalue("/root/reqData/reqform/place","1");
						}							
						
						if (show_message("저장하시겠습니까?","저장 확인",MB_YESNO) != IDYES) {
							return false;
						}

						model1.send("fc_func_1083_i");
						//alert(datagrid1.getUpdateData());

						if(submit_completed()){							
							show_message("저장되었습니다.");
							var var_slip_no = get_refvalue("/root/resData/resform/fc_func_1083_i/dataSet/CURLIST/record/slip_no");
							if(var_slip_no != ""){
								set_refvalue("/root/reqData/reqform/slip_no",var_slip_no);
								slip_no.refresh();
							}							
							btn_select_ptcr.dispatch("onclick");
						}
	
//							model1.refresh();
					]]>
				</script>
			</button>
		</group>
		<button id="button1" class="btn04" navindex="9" crud="R" style="left:101px; top:193px; width:90px; height:21px; ">
			<caption>통장입금내역</caption>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
						var acct_mang_no = model.getValue("/root/reqData/reqform/deps_clsf_cd");

						model.makeNode("/root/reqData/fwdData/acct_mang_no_ref");	
						model.setValue("/root/reqData/fwdData/acct_mang_no_ref", "/root/reqData/reqform/deps_clsf_cd");

	  					model.makeNode("/root/reqData/fwdData/tran_amt_ref1");		  					
	  					model.setValue("/root/reqData/fwdData/tran_amt_ref1", "/root/resData/resform/tran_amt1");

	  					model.makeNode("/root/reqData/fwdData/tran_amt_ref");	
	  					model.setValue("/root/reqData/fwdData/tran_amt_ref", "/root/reqData/reqform/tran_amt");
	  						  					
	  					model.makeNode("/root/reqData/fwdData/acct_tonghwa_ref");	
	  					model.setValue("/root/reqData/fwdData/acct_tonghwa_ref", "/root/reqData/reqform/frex_cd");
	  					
	  					model.makeNode("/root/reqData/fwdData/frex_amt_ref");	
	  					model.setValue("/root/reqData/fwdData/frex_amt_ref", "/root/reqData/reqform/hjphwamt");
	  					
	  					model.property("FC_FUNC_1050_deps_clsf_cd") = deps_clsf_cd.value;
	  					
						//loadRcpmDtlsPop_fc("H1"
						loadRcpmDtlsPop_fc(model1.getValue("/root/initData/comboSet/dataSet/xx_mang_cd_4")
						                , deps_clsf_cd.value
						                ,"/root/resData/resform/biz_reg_no"
						                ,"/root/resData/resform/bank_id"
						                ,"/root/resData/resform/acct_num"
						                ,"/root/resData/resform/tran_date"
						                ,"/root/resData/resform/tran_date_seq"
						                ,"/root/resData/resform/current_clsf"
									   ,"/root/reqData/fwdData");
						tran_amt1.refresh();
						
						group2.refresh();
						group4.refresh();
						set_refvalue("/root/resData/resform1/tran_date", tran_date.value.ReplaceString("#", " "));
						set_refvalue("/root/resData/resform1/tran_amt",  tran_amt.value.ReplaceString("#", " "));

						group1.refresh();
					]]>
			</script>
		</button>
		<group id="group4" visibility="visible" style="left:240px; top:194px; width:440px; height:20px; ">
			<input id="acct_num" ref="/root/resData/resform/acct_num" editable="false" style="left:115px; top:2px; width:50px; height:18px; "/>
			<input id="tran_date_seq" ref="/root/resData/resform/tran_date_seq" editable="false" style="left:170px; top:2px; width:50px; height:18px; "/>
			<input id="current_clsf" ref="/root/resData/resform/current_clsf" editable="false" style="left:225px; top:2px; width:50px; height:18px; "/>
			<input id="biz_reg_no" ref="/root/resData/resform/biz_reg_no" editable="false" style="left:5px; top:2px; width:50px; height:18px; "/>
			<input id="bank_id" ref="/root/resData/resform/bank_id" editable="false" style="left:60px; top:2px; width:50px; height:18px; "/>
			<input id="tran_date" ref="/root/resData/resform/tran_date" editable="false" style="left:334px; top:2px; width:50px; height:18px; "/>
			<input id="tran_amt" ref="/root/reqData/reqform/tran_amt" editable="false" style="left:279px; top:2px; width:50px; height:18px; "/>
		</group>
		<select id="selectAll" ref="/root/resData/resform/selectAll" overflow="visible" appearance="full" style="left:13px; top:197px; width:77px; height:18px; border-style:none; ">
			<choices>
				<item>
					<label>전체선택</label>
					<value>1</value>
				</item>
			</choices>
			<script type="javascript" ev:event="xforms-select">
				<![CDATA[
					var cnt = 0;
					var rv_total_note_amt =0;
					var rv_total_rcpay_amt =0;
					var rv_total_corp_tax =0;
					var rv_total_etc_prft =0;
					
					for(var i=0;i<datagrid1.rows;i++){
						if(datagrid1.valueMatrix(i,1) != ""){
							datagrid1.addStatus(i, "update");
							if (datagrid1.valueMatrix(i,3) != ""){							
								rv_total_note_amt = Number(rv_total_note_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/note_amt"));    
								rv_total_rcpay_amt = Number(rv_total_rcpay_amt) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/rcpay_amt"));
								rv_total_corp_tax = Number(rv_total_corp_tax) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/corp_tax"));
								rv_total_etc_prft = Number(rv_total_etc_prft) + Number(get_refvalue(" /root/resData/gridData/fc_func_1082_l/dataSet/CURLIST/record["+i+"]/etc_prft"));
							}
							cnt = cnt + 1;
						}
					}
					if(datagrid1.rows > 1){
						rmks1.value = "받을어음 " + (cnt-1)+ "건 교환입금";					
						set_refvalue("/root/resData/resform/total_note_amt",rv_total_note_amt);
						set_refvalue("/root/resData/resform/total_rcpay_amt",rv_total_rcpay_amt);
						set_refvalue("/root/resData/resform/total_corp_tax",rv_total_corp_tax);
						set_refvalue("/root/resData/resform/total_etc_prft",rv_total_etc_prft);
						group2.refresh();						
					}
					
					slip_no.value = "";												
				]]>
			</script>
			<script type="javascript" ev:event="xforms-deselect">
				<![CDATA[
					for(i=0;i<datagrid1.rows;i++){
						if(datagrid1.valueMatrix(i,1) != ""){
							datagrid1.rowStatus(i) = "0";
						}
					}					
					set_refvalue("/root/reqData/reqform/rmks1","");
					set_refvalue("/root/resData/resform/total_note_amt","");
					set_refvalue("/root/resData/resform/total_rcpay_amt","");
					set_refvalue("/root/resData/resform/total_corp_tax","");
					set_refvalue("/root/resData/resform/total_etc_prft","");
					group2.refresh();
				]]>
			</script>
		</select>
		<group id="group1" style="left:211px; top:190px; width:725px; height:26px; ">
			<caption id="caption23" class="list_cap02" style="left:0px; top:0px; width:725px; height:26px; text-align:center; "/>
			<caption id="caption9" class="list_cap03" style="left:0px; top:0px; width:90px; height:26px; text-align:center; ">선택 거래일자</caption>
			<input id="tran_amt1" ref="/root/resData/resform/tran_amt1" navindex="-1" editable="false" format="(-)#,###" style="left:576px; top:5px; width:140px; height:18px; text-align:right; "/>
			<caption id="caption10" class="list_cap03" style="left:243px; top:0px; width:90px; height:26px; text-align:center; ">선택 입금액</caption>
			<input id="select_tran_date" ref="/root/resData/resform1/tran_date" editable="false" style="left:93px; top:5px; width:145px; height:18px; "/>
			<caption id="caption4" class="list_cap03" style="left:483px; top:0px; width:90px; height:26px; text-align:center; ">예금액</caption>
			<input id="select_tran_amt" ref="/root/resData/resform1/tran_amt" editable="false" style="left:336px; top:5px; width:140px; height:18px; "/>
		</group>
	</xhtml:body>
</xhtml:html>
