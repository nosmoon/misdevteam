<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet href="../../../css/style_sheet.css" type="text/css" ?>
<xhtml:html xmlns:ex="http://www.comsquare.co.kr/xforms/excel" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ms="urn:schemas-microsoft-com:xslt" xmlns:my="http://www.comsquare.co.kr/example" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:cs="http://www.comsquare.co.kr/xforms">
	<xhtml:head>
		<xhtml:title>타시스시템일괄승인처리(FC_ACCT_2350)</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData>
						<!-- 화면 로딩시의 초기 데이터 -->
						<session/>
						<!-- 서버의 세션 정보 -->
						<comboSet>
							<!-- 선택계열(콤보박스,체크박스,리스트박스,라디오버튼)의 정보 -->
							<fc_acct_2350_m>
								<dataSet>
									<CURLIST>
										<record>
											<cd/>
											<cdnm/>
											<cd_abrv_nm/>
											<cdnm_cd/>
											<cdabrvnm_cd/>
										</record>
									</CURLIST>
									<xx_srch_slip_clsf_cd/>
									<xx_ss_deptcd/>
									<xx_acct_cd_1/>
									<xx_acct_cd_2/>
									<xx_acct_cd_3/>
									<xx_srch_slip_clsf_cd_40/>
									<xx_srch_slip_clsf_cd_41/>
									<xx_srch_slip_clsf_cd_42/>
									<xx_srch_slip_clsf_cd_63/>
								</dataSet>
							</fc_acct_2350_m>
						</comboSet>
						<!-- 콤보리스트와 같은 선택게열의 데이터는 <item>을 반복함으로써 list를 구성한다. -->
						<pageInfo/>
						<!-- 해당 화면의 필요한 기타 정보들을 추가운영시 사용(화면ID등) -->
					</initData>
					<reqData>
						<!-- 서버에 전달하고자 하는 데이터 (submit시 처리) -->
						<fwdData>
						</fwdData>
						<!-- popup등의 페이지전환시 데이타 입출력에 사용 -->
						<searchData>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<frslip_seq/>
							<toslip_seq/>
						</searchData>
						<!-- 검색조건 처리 -->
						<reqForm>
							<incmg_dt/>
							<fisc_dt/>
							<incmg_emp_no/>
							<incmg_emp_nm/>
							<draft_doc_no/>
							<draft_doc_dept_cd/>
							<draft_expn_amt/>
							<draft_impt_amt/>
							<slip_occr_dt/>
							<slip_clsf_cd/>
							<slip_seq/>
							<slip_sub_seq/>
						</reqForm>
						<!-- 입력처리 formData 복수사용시 하위노드로 1,2,3으로 정의-->
						<multiUpDate>
							<slip_occr_dt/>
							<slip_slcf_cd/>
							<incmg_emp_no/>
							<incmg_dt/>
							<fisc_dt/>
							<sicsgb/>
							<fr_fisc_dt/>
							<multiUpdateData/>
						</multiUpDate>
						<!-- Grid의 MultiUpDate유형 사용시 처리 -->
					</reqData>
					<resData>
						<!-- 서버로부터 전달 받은 데이터 (submit의 결과) -->
						<resForm>
							<!-- (submit의 결과) formData 복수사용시 하위노드로 1,2,3으로 정의 -->
							<draft_doc_no/>
							<draft_dept_cd/>
							<tot_dr_amt/>
							<tot_crdt_amt/>
							<fc_acct_2351_l>
								<dataSet>
									<CURLIST>
										<record>
											<slip_seq/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_acct_2351_l>
							<fc_acct_2352_l>
								<dataSet>
									<CURLIST>
										<record>
											<busn_dd_clsf_cd/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_acct_2352_l>
							<fc_acct_2013_s>
								<dataSet>
									<CURLIST>
										<record>
											<clsf_yn/>
											<draft_expn_amt/>
											<draft_impt_amt/>
											<dr_amt/>
											<crdt_amt/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_acct_2013_s>
						</resForm>
						<gridData>
							<fc_acct_2354_l>
								<dataSet>
									<CURLIST>
										<record>
											<slip_seq/>
											<slip_sub_seq/>
											<acct_cd/>
											<acctynm/>
											<incmg_dt/>
											<fisc_dt/>
											<incmg_emp_no/>
											<igbhannm/>
											<slip_aprv_yn/>
											<dr_amt/>
											<crdt_amt/>
											<seq/>
											<draft_doc_no/>
											<draft_expn_amt/>
											<draft_impt_amt/>
											<draft_dept_cd/>
										</record>
									</CURLIST>
								</dataSet>
							</fc_acct_2354_l>
						</gridData>
						<!-- (submit의 결과) gridData 복수사용시 하위노드로 1,2,3으로 정의 -->
						<MsgData/>
						<!-- (submit의 결과) 전달 받은 MsgData -->
					</resData>
					<tempData>
						<!-- 데이터를 가공할 임시저장소 -->
						<keyData/>
						<!-- 해당화면의 키값등의 데이터의 저장소 -->
					</tempData>
					<!-- 저장소 -->
				</root>
			</instance>
			<script type="javascript" ev:event="xforms-model-construct">
				<![CDATA[
										
				]]>
			</script>
			<submission id="fc_acct_2350_m" action="/fc/acct2000/2350" mediatype="application/x-www-form-urlencoded" method="post" resultref="/root/initData/comboSet/fc_acct_2350_m/dataSet"/>
			<submission id="fc_acct_2351_l" action="/fc/acct2000/2351" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/resForm/fc_acct_2351_l/dataSet"/>
			<submission id="fc_acct_2352_l" action="/fc/acct2000/2352" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/resForm/fc_acct_2352_l/dataSet"/>
			<submission id="fc_acct_2353_i" action="/fc/acct2000/2353" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/multiUpDate" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="fc_acct_2354_l" action="/fc/acct2000/2354" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/fc_acct_2354_l/dataSet"/>
			<submission id="fc_acct_2355_l" action="/fc/acct2000/2355" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/searchData" resultref="/root/resData/gridData/fc_acct_2354_l/dataSet"/>
			<submission id="fc_acct_2013_s" action="/fc/acct2000/2013" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/resForm/fc_acct_2013_s/dataSet"/>
			<submission id="fc_co_8050_a" action="/fc/co8000/8050" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/reqForm" resultref="/root/resData/MsgData/dataSet"/>
			<submission id="hd_com_1002" action="/hd/com/1002" mediatype="application/x-www-form-urlencoded" method="post" ref="/root/reqData/fwdData" resultref="/root/tempData"/>
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
					send_fc_acct_2350_m();
					
					set_refvalue("/root/reqData/searchData/slip_occr_dt",commCurDate());
					set_refvalue("/root/reqData/reqForm/incmg_dt",commCurDate());
					set_refvalue("/root/reqData/reqForm/fisc_dt",commCurDate());
					srch_slip_occr_dt.refresh();				
					incmg_dt.refresh();
					fisc_dt.refresh();
					
					if (model.property("FC_ACCT_2350_popup_flag") == "Y" ) {

						srch_slip_occr_dt.value = model.property("FC_ACCT_2350_srch_slip_occr_dt");
						srch_slip_clsf_cd.value = model.property("FC_ACCT_2350_srch_slip_clsf_cd");
						srch_frslip_seq.value = model.property("FC_ACCT_2350_srch_slip_seq");
						
						model.property("FC_ACCT_2350_srch_slip_occr_dt")  = "";
						model.property("FC_ACCT_2350_srch_slip_clsf_cd") = "";
						model.property("FC_ACCT_2350_srch_slip_seq") = "";
						model.property("FC_ACCT_2350_popup_flag") = "";
						
						srch_frslip_seq.dispatch("DOMFocusOut");
						btn_select.dispatch("onclick");
					}					
//					 If Cmndll.W_Etc2 <> "00" Then
//					        mskHJPBSCYMD.Text = Format(Left(Cmndll.W_Etc2, 8), "####-##-##")
//					        hCmndll.GF_FillCombotext cboHJPGBCD, Mid(Cmndll.W_Etc2, 9, 2), "2"
//					        txtHJPSEQ.Text = Mid(Cmndll.W_Etc2, 11, 3)
//					        
//					        IN_HJPBSCYMD$ = Left(Cmndll.W_Etc2, 8)
//					        IN_HJPGBCD$ = Mid(Cmndll.W_Etc2, 9, 2)
//					        rv = CHAS_HEJP_SEL12_1&(IN_HJPBSCYMD$, IN_HJPGBCD$, HJPSEQ$())
//					        rc = Cmndll.GF_RPCResultMessage(G_Control, "2", "S", rv, "", "CHAS_HEJP_SEL12_1")
//					        If rc <> True Then
//					            Screen.MousePointer = vbArrow
//					            Exit Sub
//					        End If
//					        txtTOHJPSEQ.Text = HJPSEQ$(0)
//					        sscmdSelect_Click
//					    End If					
				]]>
			</script>
			<script type="javascript" ev:event="xforms-close">
				<![CDATA[
//					alert("xforms-close");
				]]>
			</script>
			<script type="javascript" ev:event="xforms-model-construct-done">
				<![CDATA[
					init_controls();	
					set_column_visibility();					
				]]>
			</script>
			<script type="javascript" ev:event="xforms-model-destruct">
				<![CDATA[
//					alert("xforms-model-destruct");
				]]>
			</script>
			<script type="javascript" ev:event="xforms-recalculate">
				<![CDATA[
//					alert("xforms-recalculate");				
				]]>
			</script>
			<script type="javascript" ev:event="xforms-refresh">
				<![CDATA[
//					alert("xforms-refresh");					
				]]>
			</script>
			<script type="javascript" ev:event="xforms-reset">
				<![CDATA[
//					alert("xforms-reset");						
				]]>
			</script>
			<script type="javascript" ev:event="xforms-revalidate">
				<![CDATA[
//					alert("xforms-revalidate");								
				]]>
			</script>
		</model>
		<script type="javascript" src="/js/CIISComm.js"/>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript" src="/js/fcmc_common.js"/>
		<script type="javascript">
			<![CDATA[
				var	_oth_clsf = "1";
								
				function set_column_visibility() {
					//모든 컬럼을 감춘다.
					hide_all_columns(datagrid1);
					//특정 컬럼을 보여준다.
					show_columns(datagrid1,"0,1,2,3,4,5");
				}
				function init_controls(){
					set_default(
						datagrid1
					);					//datagrid
					set_default(
						srch_frslip_seq
					,	srch_toslip_seq
					,	incmg_emp_nm
					,	tot_dr_amt
					,	tot_crdt_amt
					,	draft_dept_cd
					,	draft_expn_amt
					,	draft_impt_amt
					);			//input
					set_default(
						srch_slip_occr_dt
					,	incmg_dt						
					,	fisc_dt
					);			//input date
					set_default(
						incmg_emp_no
					,	draft_doc_no
					);			//input button
					set_default(
						srch_slip_clsf_cd
					);			//combo	
					set_format(
						"code"
					,	datagrid1			,"2"
					);
					set_format(
						"string_l"
					,	datagrid1			,"3"
					,	srch_slip_clsf_cd					
					,	incmg_emp_nm
					,	draft_doc_no
					);
					set_format(
						"string_c"
					,	datagrid1			,"1"					
					, 	srch_frslip_seq
					, 	srch_toslip_seq
					,	incmg_emp_no
					,	draft_dept_cd
					);
					set_format(
						"number4"
					,	datagrid1			,"4,5"
					,	tot_dr_amt
					,	tot_crdt_amt
					,	draft_expn_amt
					,	draft_impt_amt
					);
					set_format(
						"date_1"
					,	srch_slip_occr_dt
					,	incmg_dt					
					,	fisc_dt
					);
				}		
				function send_fc_acct_2350_m(){
					model.send("fc_acct_2350_m");
					makeComboGubun("","/root/initData/comboSet/fc_acct_2350_m/dataSet/CURLIST","record","cdabrvnm_cd", "cd");
				}	
				function send_fc_acct_2354_l(){
					if (!prepare_fc_acct_2354_l()) {
						return false;
					}
					reset_refnodeset("/root/resData/gridData/fc_acct_2354_l/dataSet");
					
					//if(srch_slip_clsf_cd.value == "63"){ //2012.01.12
					var orgStr = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd");
					if(instr_yn(orgStr, srch_slip_clsf_cd.value)){
						model.send("fc_acct_2355_l");
					}					
					else{
						model.send("fc_acct_2354_l");
					}
					
					var tot_dr_amt = 0;
					var tot_crdt_amt = 0;

					var totalcnt = get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/totalcnt");
					if (totalcnt == 0) {
						reset_refnodeset("/root/resData/gridData/fc_acct_2354_l/dataSet");
						reset_refnodeset("/root/resData/resForm/tot_dr_amt");
						reset_refnodeset("/root/resData/resForm/tot_crdt_amt");
						show_message("검색결과가 없습니다.");
						return;
					}
					
					for(i=1; i<=datagrid1.rows;i++){
						tot_dr_amt = Number(tot_dr_amt) + Number(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/dr_amt"));
						tot_crdt_amt = Number(tot_crdt_amt) + Number(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/crdt_amt"));
					}
					set_refvalue("/root/reqData/reqForm/incmg_dt",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record[1]/incmg_dt"));
					set_refvalue("/root/reqData/reqForm/fisc_dt",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record[1]/fisc_dt"));
					set_refvalue("/root/reqData/reqForm/incmg_emp_no",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record[1]/incmg_emp_no"));
					set_refvalue("/root/reqData/reqForm/incmg_emp_nm",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record[1]/igbhannm"));
					
					set_refvalue("/root/resData/resForm/tot_dr_amt",tot_dr_amt);
					set_refvalue("/root/resData/resForm/tot_crdt_amt",tot_crdt_amt);
					
					if(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record[1]/slip_aprv_yn") == "1"){
						btn_insert.disabled = false;
						btn_delete.disabled = true;
						btn_slip_print.disabled = true;
					}
					else{
						btn_insert.disabled = true;
						btn_delete.disabled = false;						
						btn_slip_print.disabled = false;
					}
					model.refresh();										

				}					
				function prepare_fc_acct_2354_l(){
					if(!check_search_values("s")) {
						return false;
					}
					return true;
				}
				function send_fc_acct_2353_i(){
					if (!prepare_fc_acct_2353_i()) {
						return false;
					}
					var fr_fisc_dt;
					var ss_deptcd;
					ss_deptcd = getProperty("ss_deptcd");
					
					var orgStr1 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_ss_deptcd");
					//if(ss_deptcd == model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_ss_deptcd")
					if(instr_yn(orgStr1, ss_deptcd)
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_40") 
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_41") 
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_42")){
						show_message("자재부에서는 승인할 수 없는 전표입니다.('40', '41', '42')"+orgStr1+":"+ss_deptcd);
						return false;
					}
					if(tot_dr_amt.value != tot_crdt_amt.value){
						show_message("차대변 합계금액이 다르므로 승인할 수 없습니다.");
						return false;
					}
					
					var orgStr1 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_63");
					var orgStr2 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_acct_cd_1");
					var orgStr3 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_acct_cd_3");	
					var orgStr4 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_acct_cd_2")
					for(i=1; i<=datagrid1.rows; i++){
						//if(srch_slip_clsf_cd.value == model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_63") //2012.01.12
						//&& get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd") == model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_acct_cd_1")){  //2011.01.12
						if(instr_yn(orgStr1, srch_slip_clsf_cd.value) && instr_yn(orgStr2, get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd"))){
							//if(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd") == "4045" ||
							//   get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd") == "4723"){
							
													
							if(instr_yn(orgStr3, get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd"))){						
								fr_fisc_dt = "MIJIGEUB";
							}
						}
						//if(srch_slip_clsf_cd.value == model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_63")  //2012.01.12
						 //&& get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd") == model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_acct_cd_2")){ //2012.01.12
						 if(instr_yn(orgStr1, srch_slip_clsf_cd.value) && instr_yn(orgStr4, get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd"))){
							//if(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd") == "4045" ||
							//   get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd") == "4723"){
							if(instr_yn(orgStr3, get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+(i+1)+"]/acct_cd"))){							   	
								fr_fisc_dt = "MIJIGEUB";
							}
						}						
					}
					
					set_refvalue("/root/reqData/multiUpDate/slip_occr_dt",srch_slip_occr_dt.value);
					set_refvalue("/root/reqData/multiUpDate/slip_clsf_cd",srch_slip_clsf_cd.value);
					set_refvalue("/root/reqData/multiUpDate/incmg_emp_no",incmg_emp_no.value);
					set_refvalue("/root/reqData/multiUpDate/incmg_dt",incmg_dt.value);
					set_refvalue("/root/reqData/multiUpDate/fisc_dt",fisc_dt.value);
					set_refvalue("/root/reqData/multiUpDate/sicsgb","S");
					set_refvalue("/root/reqData/multiUpDate/fr_fisc_dt",fr_fisc_dt);
					
					/*20120725 김주호 추가*/
					if (model1.getValue("/root/reqData/reqForm/incmg_dt").substr(0,4) !=
					    model1.getValue("/root/reqData/reqForm/fisc_dt").substr(0,4) ) {
						if (show_message("회계일자를 다시 한번 확인하여 주십시요. 계속 진행하시겠습니까?","저장 확인",MB_YESNO) != IDYES) {
							return false;
						}
					}
					
					/*20180409 어음계정알림추가*/
					if(getProperty("ss_cmpycd") == "100"){
						for(var i=1; i<=datagrid1.rows-1; i++){
							if(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd") == "0501" || 
							get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+i+"]/acct_cd") == "0180") {									
								if (show_message("금액과 만기일자를 담당자에게 확인하세요. 계속 진행하시겠습니까?","저장 확인",MB_YESNO) != IDYES) {
									return false;
								}
							}
						}
					}
					
					if (show_message("저장하시겠습니까?","저장 확인",MB_YESNO) != IDYES) {
						for(i=1; i<datagrid1.rows;i++){
							datagrid1.rowStatus(i) = "0";
						}												
						return false;
					}
					
					for(i=1; i<datagrid1.rows;i++){
						datagrid1.addStatus(i,"insert");
					}
					
					set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
					
					model.send("fc_acct_2353_i");
					
					if(submit_completed()){
						show_message("저장되었습니다.");
					}
					//eturn check_submit_completed("저장되었습니다.","");
				}
				function prepare_fc_acct_2353_i(){
					if(!check_search_values("i")) {
						return false;
					}
					return true;					
				}
				function prepare_fc_acct_2353_i_1(){
					if(!check_search_values("d")) {
						return false;
					}
					return true;					
				}				
				function send_fc_acct_2353_i_1(){
					if (!prepare_fc_acct_2353_i_1()) {
						return false;
					}					
					var fr_fisc_dt;
					var ss_deptcd;
					ss_deptcd = getProperty("ss_deptcd");

					//if(ss_deptcd == "360400" && srch_slip_clsf_cd.value != "40" && srch_slip_clsf_cd.value != "41" && srch_slip_clsf_cd.value != "42"){ /2011.01.11
					var orgStr1 = model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_ss_deptcd");
					if(instr_yn(orgStr1, ss_deptcd)
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_40") 
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_41") 
					 && srch_slip_clsf_cd.value != model.getValue("/root/initData/comboSet/fc_acct_2350_m/dataSet/xx_srch_slip_clsf_cd_42")){	
						show_message("자재부에서는 승인취소 할 수 없는 전표입니다.('40', '41', '42')");
						return false;
					}
					
					set_refvalue("/root/reqData/multiUpDate/slip_occr_dt",srch_slip_occr_dt.value);
					set_refvalue("/root/reqData/multiUpDate/slip_clsf_cd",srch_slip_clsf_cd.value);
					set_refvalue("/root/reqData/multiUpDate/incmg_emp_no",incmg_emp_no.value);
					set_refvalue("/root/reqData/multiUpDate/incmg_dt",incmg_dt.value);
					set_refvalue("/root/reqData/multiUpDate/fisc_dt",fisc_dt.value);
					set_refvalue("/root/reqData/multiUpDate/sicsgb","C");
					set_refvalue("/root/reqData/multiUpDate/fr_fisc_dt","");
					
					
					if (show_message("삭제하시겠습니까?","삭제 확인",MB_YESNO) != IDYES) {
						for(i=1; i<datagrid1.rows;i++){
							datagrid1.rowStatus(i) = "0";
						}												
						return false;
					}
					
					for(i=1; i<datagrid1.rows;i++){
						datagrid1.addStatus(i,"delete");
					}
					
					set_refvalue("/root/reqData/multiUpDate/multiUpdateData",datagrid1.getUpdateData());
					
					model.send("fc_acct_2353_i");
					
					if(submit_completed()){
						show_message("삭제되었습니다.");
					}
					//return check_submit_completed("삭제되었습니다.","");					
				}
				function check_search_values(p_siud) {
					//필수항목체크(검색)
					if(!commReqCheck(group_scr)) {
						return false;
					}
					
					switch (p_siud.toUpperCase()) {
						case "S":
							//조회시
							break;
						case "I":
							//입력시
							if(!commReqCheck(group1)) {
								return false;
							}
							break;
						case "U":
							//수정시
							break;
						case "D":
							//삭제시
							if(!commReqCheck(group1)) {
								return false;
							}							
							break;
						default:
							show_message("key 값 확인을 위한 구분자가 지정되지 않았습니다.");
							break;
					}
				
					return true;
				}	

				function setEmp_no(emp_no, nm_korn){

					incmg_emp_no.value = emp_no;
					incmg_emp_nm.value = nm_korn;
				}
				function rcvs_from_fc_co_9010() {
					draft_doc_no.value = arguments[0][0];
				}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body class="main" pagewidth="946" pageheight="765" guideline="2,49;" style="font-family:굴림; ">
		<group id="group_scr" class="gro_sel" style="left:10px; top:50px; width:926px; height:51px; ">
			<caption id="caption2" class="list_cap02" style="left:109px; top:25px; width:817px; height:26px; "/>
			<caption id="caption1" class="list_cap03" style="left:0px; top:25px; width:110px; height:26px; ">전표번호</caption>
			<input id="srch_slip_occr_dt" ref="/root/reqData/searchData/slip_occr_dt" class="req" navindex="1" inputtype="date" format="yyyy-mm-dd" caption="발생일자" style="left:115px; top:29px; width:100px; height:18px; "/>
			<select1 id="srch_slip_clsf_cd" ref="/root/reqData/searchData/slip_clsf_cd" class="req" navindex="2" appearance="minimal" editmode="inputsearch" caption="전표구분" style="left:220px; top:29px; width:130px; height:18px; ">
				<choices>
					<itemset nodeset="/root/initData/comboSet/fc_acct_2350_m/dataSet/CURLIST/record">
						<label ref="cdabrvnm_cd"/>
						<value ref="cd"/>
					</itemset>
				</choices>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						if(combo_data_contains(srch_slip_clsf_cd, srch_slip_clsf_cd.value) == -1){
							show_message("정확한 값을 선택해 주세요.");
							set_refvalue(srch_slip_clsf_cd,"");
							return;
						}
					]]>
				</script>
			</select1>
			<caption id="subtitle" class="tit02" style="left:0px; top:5px; width:926px; height:20px; ">조회조건</caption>
			<caption id="caption6" style="left:400px; top:29px; width:15px; height:18px; ">~</caption>
			<input id="srch_toslip_seq" ref="/root/reqData/searchData/toslip_seq" class="req" navindex="4" caption="일련번호" style="left:415px; top:29px; width:40px; height:18px; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						if(srch_toslip_seq.value.length == 3){
							btn_select.dispatch("onclick");
						}						
					]]>
				</script>
			</input>
			<input id="srch_frslip_seq" ref="/root/reqData/searchData/frslip_seq" class="req" navindex="3" caption="일련번호" style="left:356px; top:29px; width:40px; height:18px; ">
				<script type="javascript" ev:event="DOMFocusOut">
					<![CDATA[
						model.send("fc_acct_2351_l");
						
						var totalcnt = get_refvalue("/root/resData/resForm/fc_acct_2351_l/dataSet/CURLIST/totalcnt");

						if (totalcnt == 0) {
							return;
						}
						srch_toslip_seq.value = get_refvalue("/root/resData/resForm/fc_acct_2351_l/dataSet/CURLIST/record/slip_seq");
						
						if(srch_toslip_seq.value != ""){
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</input>
		</group>
		<group id="group_line" class="gro_line" style="left:10px; top:158px; width:926px; height:5px; "/>
		<group id="group_tit" class="gro_tit2" style="left:10px; top:208px; width:926px; height:25px; "/>
		<datagrid id="datagrid1" nodeset="/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record" caption="일련번호^계정코드^계정코드명^차변금액^대변금액^slip_seq^slip_sub_seq^draft_doc_no^draft_expn_amt^draft_impt_amt^draft_dept_cd" colsep="#" colwidth="100, 100, 200, 120, 120, 100, 100, 100, 100, 100, 100" extendlastcol="scroll" mergecellsfixedrows="bycolrec" rowheader="update" rowsep="|" style="left:10px; top:176px; width:926px; height:474px; ">
			<col ref="seq" type="output"/>
			<col ref="acct_cd" type="output"/>
			<col ref="acctynm"/>
			<col ref="dr_amt" type="output"/>
			<col ref="crdt_amt" type="output"/>
			<col ref="slip_seq" visibility="hidden"/>
			<col ref="slip_sub_seq" visibility="hidden"/>
			<col ref="draft_doc_no" visibility="hidden"/>
			<col ref="draft_expn_amt" visibility="hidden"/>
			<col ref="draft_impt_amt" visibility="hidden"/>
			<col ref="draft_dept_cd" visibility="hidden"/>
			<script type="javascript" ev:event="onclick">
				<![CDATA[
					//그리드 스크롤바 클릭, 더블클릭 방지 소스				
					if (-1 != event.target.lastIndexOf("scroll.thumb")) {
						return;
					}     
					
					var grid = eval(event.currentTarget);
					var rowid = grid.row;
					var colid = grid.col;
				     
					if (rowid < grid.fixedRows || colid < grid.fixedCols) {
						return;
					}
									
					var ch_var = datagrid1.valueMatrix(datagrid1.row,datagrid1.colRef("draft_doc_no"));
					if(ch_var != ""){
						set_refvalue(draft_doc_no, ch_var);
						set_refvalue(draft_dept_cd, datagrid1.valueMatrix(datagrid1.row, datagrid1.colRef("draft_dept_cd")));
						set_refvalue(draft_expn_amt, datagrid1.valueMatrix(datagrid1.row, datagrid1.colRef("draft_expn_amt")));
						set_refvalue(draft_impt_amt, datagrid1.valueMatrix(datagrid1.row, datagrid1.colRef("draft_impt_amt")));
					}
					else{
						set_refvalue(draft_doc_no, "");
						set_refvalue(draft_dept_cd, "");
						set_refvalue(draft_expn_amt, "");
						set_refvalue(draft_impt_amt, "");
					}
				]]>
			</script>
		</datagrid>
		<group id="group_tab" class="gro_tab1" style="left:10px; top:670px; width:926px; height:26px; ">
			<caption id="caption26" class="list_cap02" style="left:0px; top:0px; width:925px; height:26px; "/>
			<caption id="caption10" class="list_cap03" style="left:520px; top:0px; width:110px; height:26px; ">차/대변 합계</caption>
			<input id="tot_dr_amt" ref="/root/resData/resForm/tot_dr_amt" editable="false" style="left:634px; top:4px; width:100px; height:18px; "/>
			<input id="tot_crdt_amt" ref="/root/resData/resForm/tot_crdt_amt" editable="false" style="left:737px; top:4px; width:100px; height:18px; "/>
			<input id="draft_dept_cd" ref="/root/resData/resForm/draft_dept_cd" visibility="hidden" editable="false" style="left:373px; top:4px; width:140px; height:18px; "/>
		</group>
		<group id="grp_buttons" class="gro_sel" style="left:10px; top:734px; width:926px; height:21px; ">
			<button id="btn_select" class="btn02" crud="R" style="left:0px; top:0px; width:52px; height:21px; ">
				<caption>조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						send_fc_acct_2354_l();
					]]>
				</script>
			</button>
			<button id="btn_insert" class="btn02" crud="C" style="left:55px; top:0px; width:52px; height:21px; ">
				<caption>승인</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if (send_fc_acct_2353_i()){
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btn_delete" class="btn02" crud="D" style="left:110px; top:0px; width:52px; height:21px; ">
				<caption>승인취소</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if (send_fc_acct_2353_i_1()){
							btn_select.dispatch("onclick");
						}
					]]>
				</script>
			</button>
			<button id="btnReset" class="btn02" style="left:219px; top:0px; width:52px; height:21px; ">
				<caption>초기화</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						model.reset();
					]]>
				</script>
			</button>
			<button id="btn_help" class="btn02" crud="R" style="left:453px; top:0px; width:52px; height:21px; ">
				<caption>엑셀</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
					var grid = null;
					
					if(_oth_clsf == "1"){			
						grid = datagrid1;
					}
					
					var filename = window.fileDialog("save", ",", false, "", "xls", "Excel File(*.xls)|*.xls");
					if(filename!=""){
						grid.saveExcel(filename, "sheetname: ");
					}
					]]>
				</script>
			</button>
			<button id="btnClose" class="btn02" style="left:508px; top:0px; width:52px; height:21px; ">
				<caption>종료</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						formClose();
					]]>
				</script>
			</button>
			<button id="btn_slip_print" class="btn02" navindex="41" crud="P" style="left:165px; top:0px; width:51px; height:21px; ">
				<caption>전표발행</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
//						//그리드 값체크
//						if(datagrid1.rows == datagrid1.fixedRows){
//							show_message("검색결과가 없습니다.");
//							return false;
//						}
//						if(datagrid1.row < datagrid1.fixedRows){
//							show_message("대상이 없습니다.");
//							return false;
//						}
//						var seq_var = datagrid1.valueMatrix(datagrid1.row,datagrid1.colRef("seq")).substring(0,3);
						// 글로벌변수 셋팅
						model.property("FC_ACCT_2260_slip_occr_dt")  = srch_slip_occr_dt.value;			// 발생일자
						model.property("FC_ACCT_2260_slip_clsf_cd")  = srch_slip_clsf_cd.value;			// 전표구분
						model.property("FC_ACCT_2260_slip_seqfr") = srch_frslip_seq.value;				// 일련번호 from
						model.property("FC_ACCT_2260_slip_seqto") = srch_toslip_seq.value;			// 일련번호 to
						model.property("FC_ACCT_2260_slip_radio1") = "";			// 출력구분
						model.property("FC_ACCT_2260_popup_flag") ="Y";
						
						// 화면호출
//						viewer("mainFrame").window.javaScript.onLoadPopupPageEx("FC_ACCT_2260", "modal", "align:center; caption:hidden; width:650px; height:480px;");
						viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_ACCT_2260");	
					]]>
				</script>
			</button>
			<button id="btn_select_draft_doc" class="btn04" crud="R" style="left:273px; top:0px; width:90px; height:21px; ">
				<caption>기안문서조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						if (draft_doc_no.value.Trim() != "") {
							htmlwindow.open(XFORMS_EP_WEB_ADDRESS + "/nanum/flow/ihtml/sanc/xfopendoc_chosun.jsp?dept_id=" + model.getValue("/root/reqData/reqForm/draft_dept_cd") + "&doc_num="+draft_doc_no.value,"draft_doc","height=768,width=1024,scrollbars=no,resizable=no");
						}
						else {
							show_message("기안문서번호는 필수입력사항입니다.");				
							return;
						}
					]]>
				</script>
			</button>
			<button id="btn_select_draft_bal" class="btn04" crud="R" style="left:363px; top:0px; width:90px; height:21px; ">
				<caption>기안잔액조회</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[					
						if (draft_doc_no.value.Trim() != "") {
							model.property("FC_ACCT_2100_draft_doc_no")  = draft_doc_no.value;
							model.property("FC_ACCT_2100_draft_dept_cd") =  draft_dept_cd.value;
//							viewer("mainFrame").window.javaScript.onLoadExPopupPage("FC_ACCT_2100");
							viewer("mainFrame").window.javaScript.onLoadExMDIPage("FC_ACCT_2100");
						}	
						else {
							show_message("기안문서번호는 필수입력사항입니다.");				
							return;
						}
					]]>
				</script>
			</button>
		</group>
		<import id="iv_Title" src="../../../common/xrw/iv_TitleBar.xrw" style="left:10px; top:5px; width:926px; height:29px; "/>
		<group id="group1" class="gro_sel" style="left:10px; top:102px; width:926px; height:51px; ">
			<caption id="caption9" class="list_cap02" style="left:109px; top:25px; width:817px; height:26px; "/>
			<caption id="caption12" class="list_cap03" style="left:616px; top:25px; width:110px; height:26px; ">입력사번</caption>
			<caption id="caption13" class="list_cap03" style="left:0px; top:25px; width:110px; height:26px; ">입력일자</caption>
			<caption id="caption16" class="tit02" style="left:0px; top:5px; width:926px; height:20px; ">승인시 필수항목</caption>
			<caption id="caption17" class="list_cap03" style="left:305px; top:25px; width:110px; height:26px; ">회계일자</caption>
			<input id="incmg_dt" ref="/root/reqData/reqForm/incmg_dt" class="req" navindex="5" inputtype="date" format="yyyy-mm-dd" caption="입력일자" style="left:115px; top:29px; width:100px; height:18px; ">
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						var busn_dd_clsf_cd;
						if(incmg_dt.value.length == 8){
							model.send("fc_acct_2352_l");							
							busn_dd_clsf_cd = get_refvalue("/root/resData/resForm/fc_acct_2352_l/dataSet/CURLIST/record/busn_dd_clsf_cd");
							if(busn_dd_clsf_cd == "1" || busn_dd_clsf_cd == "2"){
								show_message("입력일자를 확인하십시오.");
							}
						}
					]]>
				</script>
			</input>
			<input id="fisc_dt" ref="/root/reqData/reqForm/fisc_dt" class="req" navindex="6" inputtype="date" format="yyyy-mm-dd" caption="회계일자" style="left:420px; top:29px; width:100px; height:18px; "/>
			<input id="incmg_emp_no" ref="/root/reqData/reqForm/incmg_emp_no" class="req" navindex="7" inputtype="button" maxlength="6" caption="입력사번" style="left:731px; top:28px; width:80px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						model.removeNodeset("/root/reqData/fwdData");  
						model.makeNode("/root/reqData/fwdData/func_nm");
						model.setValue("/root/reqData/fwdData/func_nm", "setEmp_no");
						window.load("/xrw/hd/com/HD_COM_1000.xrw","mdichild", "hd_com_1000", "align:center; caption:hidden;", "/root/reqData/fwdData", "/root/reqData/fwdData");
					]]>
				</script>
				<script type="javascript" ev:event="xforms-value-changed">
					<![CDATA[
						if (incmg_emp_no.value.length == 6) {
							model.removeNodeset("/root/reqData/fwdData");  
							model.makeNode("/root/reqData/fwdData/emp_no");
							model.setValue("/root/reqData/fwdData/emp_no", incmg_emp_no.value);
							model.send("hd_com_1002");
							
							if (model.getValue("/root/tempData/record/emp_no") != "") {
								incmg_emp_nm.value = model.getValue("/root/tempData/record/nm_korn");
							}
							else {
								incmg_emp_no.value = "";
								incmg_emp_nm.value = "";
							}
						}		
						else {
							incmg_emp_no.value = "";
							incmg_emp_nm.value = "";
						}																	
					]]>
				</script>
			</input>
			<input id="incmg_emp_nm" ref="/root/reqData/reqForm/incmg_emp_nm" editable="false" style="left:816px; top:28px; width:80px; height:18px; "/>
		</group>
		<group id="group2" class="gro_tab1" style="left:10px; top:695px; width:926px; height:26px; ">
			<caption id="caption3" class="list_cap02" style="left:0px; top:0px; width:925px; height:26px; "/>
			<caption id="caption4" class="list_cap03" style="left:0px; top:0px; width:110px; height:26px; ">기안번호</caption>
			<caption id="caption5" class="list_cap03" style="left:260px; top:0px; width:110px; height:26px; ">기안지출금액</caption>
			<caption id="caption7" class="list_cap03" style="left:520px; top:0px; width:110px; height:26px; ">기안수입금액</caption>
			<button id="btn_update_draft" class="btn02" crud="U" style="left:777px; top:2px; width:52px; height:21px; ">
				<caption>수정</caption>
				<script type="javascript" ev:event="onclick">
					<![CDATA[
						//필수항목체크(검색)
						if(srch_slip_occr_dt.value ==""){
							show_message("발생일자는 필수입력항목입니다.");
							model.setFocus("srch_slip_occr_dt");
							return false;
						}						
						if(srch_slip_clsf_cd.value == ""){
							show_message("전표구분은 필수입력항목입니다.");
							model.setFocus("srch_slip_clsf_cd");
							return false;							
						}
						if(get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+datagrid1.row+"]/seq") ==""){
							show_message("일련번호가 없습니다.");
							return false;
						}
						
						if(draft_doc_no.value ==""){
							show_message("기안번호는 필수입력항목입니다.");
							model.setFocus("dragt_doc_no");
							return false;
						}
//						if(Number(draft_expn_amt.value) ==0 && Number(draft_impt_amt.value) ==0){
//							show_message("기안금액은 필수입력항목입니다.");
//							return false;
//						}

						if (show_message("수정하시겠습니까?","수정 확인",MB_YESNO) != IDYES) {
							return false;
						}
						
						if(Number(draft_expn_amt.value) ==0 && Number(draft_impt_amt.value) ==0){
							if (show_message("기안지출금액, 기안수입금액이 모두 0입니다.\n그래도 수정하시겠습니까?","저장 확인",MB_YESNO) != IDYES) {
								return false;
							}
						}
												
						set_refvalue("/root/reqData/reqForm/slip_occr_dt",srch_slip_occr_dt.value);
						set_refvalue("/root/reqData/reqForm/slip_clsf_cd",srch_slip_clsf_cd.value);
						set_refvalue("/root/reqData/reqForm/slip_seq",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+datagrid1.row+"]/slip_seq"));
						set_refvalue("/root/reqData/reqForm/slip_sub_seq",get_refvalue("/root/resData/gridData/fc_acct_2354_l/dataSet/CURLIST/record["+datagrid1.row+"]/slip_sub_seq"));
						set_refvalue("/root/reqData/reqForm/draft_doc_no",draft_doc_no.value);
						set_refvalue("/root/reqData/reqForm/draft_doc_dept_cd",draft_dept_cd.value);

						model.send("fc_co_8050_a");

						return check_submit_completed("수정되었습니다.","");

					]]>
				</script>
			</button>
			<input id="draft_doc_no" ref="/root/resData/resForm/draft_doc_no" editable="false" inputtype="button" style="left:113px; top:4px; width:140px; height:18px; ">
				<script type="javascript" ev:event="onbuttonclick">
					<![CDATA[
						if (draft_doc_no.value != "") { return; }
						set_refvalue(draft_doc_no,"");
//						set_refvalue("/root/reqData/resForm/draft_dept_cd","");
						set_refvalue(draft_dept_cd,"");
						set_refvalue("/root/reqData/fwdData/url", XFORMS_EP_WEB_ADDRESS + "/nanum/flow/ihtml/ecab/ecab_list_chosun_f.jsp?deptid=" + ((getProperty("ss_cmpycd") == "100") ? getProperty("ss_deptcd") : getProperty("ss_cmpycd") + "_" + getProperty("ss_deptcd")));
						window.load("/xrw/fc/co/FC_CO_9010.xrw","modal","FC_CO_9010","width:790; height:728; sysmenu:visible; min:hidden; max:hidden; resize:false; caption:visible; align:center;","/root/reqData/fwdData","/root/reqData/fwdData");
												
						if (draft_doc_no.value != "") {
							var var_draft_doc_no = draft_doc_no.value.split("^");							
							draft_doc_no.value = var_draft_doc_no[0];

							model.setValue("/root/resData/resForm/draft_dept_cd", var_draft_doc_no[1]);
							
//							model.setValue("/root/resData/resForm/draft_doc_no", var_draft_doc_no[0]);
							
							model.send("fc_acct_2013_s");
							
							if(get_refvalue("/root/resData/resForm/fc_acct_2013_s/dataSet/CURLIST/record/clsf_yn") == "Y"){
								draft_expn_amt.value = get_refvalue("/root/resData/resForm/fc_acct_2013_s/dataSet/CURLIST/record/draft_expn_amt");
								draft_impt_amt.value = get_refvalue("/root/resData/resForm/fc_acct_2013_s/dataSet/CURLIST/record/draft_impt_amt");
							}
							else{
								draft_expn_amt.value = "";
								draft_impt_amt.value = "";
							}					
						}					
					]]>
				</script>
			</input>
			<input id="draft_expn_amt" ref="/root/reqData/reqForm/draft_expn_amt" style="left:373px; top:4px; width:140px; height:18px; "/>
			<input id="draft_impt_amt" ref="/root/reqData/reqForm/draft_impt_amt" style="left:633px; top:4px; width:140px; height:18px; "/>
		</group>
	</xhtml:body>
</xhtml:html>
