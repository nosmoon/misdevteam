<?xml version="1.0" encoding="EUC-KR"?>
<?xml-stylesheet type="text/css" href="/css/style_sheet.css" ?>
<xhtml:html xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/2002/01/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
	<xhtml:head>
		<xhtml:title>조선일보통합정보지원시스템</xhtml:title>
		<model id="model1">
			<instance id="instance1">
				<root xmlns="">
					<initData/>
					<reqData>
						<mainID/>
					</reqData>
					<resData/>
					<tempData>
						<treevalue/>
						<treemenu>
							<label>C I I S</label>
							<value/>
							<img/>
							<simg/>
							<crud/>
							<url/>
						</treemenu>
					</tempData>
					<temp_copy>
						<blank>
							<treemenu>
								<label/>
								<value/>
								<img/>
								<simg/>
								<crud/>
								<url/>
							</treemenu>
						</blank>
						<temp>
							<treemenu>
								<label/>
								<value/>
								<img/>
								<simg/>
								<crud/>
								<url/>
							</treemenu>
						</temp>
						<treemenu>
							<label/>
							<value/>
							<img/>
							<simg/>
							<crud/>
							<url/>
						</treemenu>
						<temp2>
							<treemenu>
								<label/>
								<value/>
								<img/>
								<simg/>
								<crud/>
								<url/>
							</treemenu>
						</temp2>
						<temp3>
							<treemenu>
								<label/>
								<value/>
								<img/>
								<simg/>
								<crud/>
								<url/>
							</treemenu>
						</temp3>
						<crudNode>
							<crud/>
						</crudNode>
						<urlNode>
							<url/>
						</urlNode>
					</temp_copy>
				</root>
			</instance>
			<instance id="instance2">
				<root/>
			</instance>
			<instance id="instance3">
				<root/>
			</instance>
			<instance id="instance4">
				<root>
					<reqData>
						<page_id/>
					</reqData>
					<resData>
						<crud/>
						<pageUrl/>
						<pageTitle/>
					</resData>
				</root>
			</instance>
			<submission id="submission1" action="/co/mng/1000" mediatype="application/x-www-form-urlencoded" method="post" resultref="instance(&quot;instance2&quot;)/Menu"/>
			<submission id="submission2" action="/co/mng/1010" mediatype="application/x-www-form-urlencoded" method="post" resultref="instance(&quot;instance3&quot;)/Sub"/>
			<submission id="co_mng_1020_s" action="/co/mng/1020" mediatype="application/x-www-form-urlencoded" method="post" ref="instance(&quot;instance4&quot;)/reqData" resultref="instance(&quot;instance4&quot;)/resData"/>
			<!--
			<submission id="submission1" action="/jsp/menu.jsp" mediatype="application/x-www-form-urlencoded" method="post" resultref="instance(&quot;instance2&quot;)/Menu"/>
			<submission id="submission2" action="/jsp/leftmenu.jsp" mediatype="application/x-www-form-urlencoded" method="post" resultref="instance(&quot;instance3&quot;)/Sub"/>
			-->
			<script type="javascript" ev:event="xforms-ready">
				<![CDATA[
				model.send("submission1");
				]]>
			</script>
			<script type="javascript" ev:event="xforms-submit-done">
				<![CDATA[
				setSessionInfo();
				setFrameworkInfo();
				loadMenuXml();
				]]>
			</script>
		</model>
		<script type="javascript" src="/js/TFCommon.js"/>
		<script type="javascript">
			<![CDATA[
/*******************************************************************************************************************************************************
// 글로벌 변수 관련 설정
*******************************************************************************************************************************************************/
var g_TaskBtnWidth = 130;			// Task Button의 길이
var g_TaskBtnHeight = 25;			// Task Button의 높이
var g_MDIWindowWidth = 982;		// MDI Window 창 크기
var g_MDIWindowHeight = 770;	// MDI Window 창 크기


/*******************************************************************************************************************************************************
// Framework 관련 함수
*******************************************************************************************************************************************************/

/***************************************************
// 함 수 명 : setSessionInfo
// 내     용  : Session Information를 얻어와서 property로 저장
// 작 성 자 : 양정녕
// 작 성 일 : 2008-10-29
***************************************************/
function setSessionInfo()
{
	var obj = htmldocument.SessionInfo;
	
	setProperty("ss_uid"       	  , obj.uid.value);       
	setProperty("ss_emp_no"       , obj.emp_no.value);    
	setProperty("ss_emp_nm"       , obj.emp_nm.value);    
	setProperty("ss_cmpycd"       , obj.cmpycd.value);    
	setProperty("ss_deptcd"       , obj.deptcd.value);    
	setProperty("ss_deptnm"       , obj.deptnm.value);    
	setProperty("ss_selldeptcd"   , obj.selldeptcd.value);
	setProperty("ss_selldeptnm"   , obj.selldeptnm.value);
	setProperty("ss_areacd"       , obj.areacd.value);    
	setProperty("ss_areanm"       , obj.areanm.value);    
	setProperty("ss_deptplacyn"   , obj.deptplacyn.value);
    	setProperty("ss_jobcd"        , obj.jobcd.value);     
    	setProperty("ss_jobnm"        , obj.jobnm.value);     
    	setProperty("ss_posicd"       , obj.posicd.value);    
   	setProperty("ss_posinm"       , obj.posinm.value);    
    	setProperty("ss_usertypecd"   , obj.usertypecd.value);
    	setProperty("ss_usertypenm"   , obj.usertypenm.value);
    	setProperty("ss_email"        , obj.email.value);     
    	setProperty("ss_dealdeptcd"   , obj.dealdeptcd.value);
    	setProperty("ss_dealdeptnm"   , obj.dealdeptnm.value);
    	setProperty("ss_hdqtcd"       , obj.hdqtcd.value);    
    	setProperty("ss_hdqtnm"       , obj.hdqtnm.value);    
    	setProperty("ss_partcd"       , obj.partcd.value);    
    	setProperty("ss_partnm"       , obj.partnm.value);    
    	setProperty("ss_hdqtplacyn"   , obj.hdqtplacyn.value);
    	setProperty("ss_partplacyn"   , obj.partplacyn.value);
    	setProperty("ss_dealmedicd"   , obj.dealmedicd.value);
    	setProperty("ss_domainnm"   , obj.domainnm.value);
	
/*	
	ss_id.text = getProperty("ss_id");
	ss_nm.text = getProperty("ss_nm");
	ss_dept_nm.text = getProperty("ss_dept_nm");
	ss_comp_nm.text = getProperty("ss_comp_nm");
*/	
}

/***************************************************
// 함 수 명 : setFrameworkInfo
// 내     용 : Framework Information를  property로 저장
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function setFrameworkInfo()
{
		var strLocation = document.location;
		
		setProperty("frameworkType"		, "MDI1");
		setProperty("workwindowCount"	, "1");
		setProperty("mdiCount"				, "10");
		setProperty("windowFlag"			, "POPUP");
		setProperty("execMode"				, "REAL");
		//setProperty("domainName"			, "http://localhost:8000");	
		setProperty("domainName"			, strLocation);
		setProperty("leftFlag"					, "YES");
		setProperty("topFlag"					, "NO");	
		setProperty("taskFlag"				, "YES");
		setProperty("menuUrl"				, "/common/jsp/menu.jsp");
		setProperty("leftmenuUrl"			, "/common/jsp/leftmenu.jsp");
}

/***************************************************
// 함 수 명 : loadMenuXml
// 내     용 : Menu XML File을 Memory에 Load
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function loadMenuXml()
{	
	// menu 데이터 로딩
	//var menuPath = getProperty("menuUrl");
	//model.instances(1).load(menuPath);
	
	var ins = model.instances(1);
	var main_cnt = ins.selectSingleNode("Main").length;
	var selectNode = model.instances(0).selectSingleNode("root/tempData/treemenu");
	var main_label;
	var main_value;
	
	for (var i = 0; i < main_cnt; i++) {
		nodeList = ins.getElementsByTagName("Main["+(i+1)+"]").nextNode();
		main_label = nodeList.getAttribute("name");
		main_value = nodeList.getAttribute("itemID");
		
		model.setValue("/root/temp_copy/treemenu/label",main_label);
		model.setValue("/root/temp_copy/treemenu/value",main_value);
		
		src = model.instances(0).selectSingleNode("/root/temp_copy/treemenu");
		newNode = src.cloneNode(true);
		selectNode.appendChild(newNode);
	}
	
	treeMenu.item(0).attribute("color") = "white";
	treeMenu.item(0).attribute("font-weight") = "bold";
	treeMenu.item(0).attribute("font-size") = "15";
	treeMenu.item(0).attribute("width") = "100%";
	treeMenu.item(0).attribute("text-align") = "center";
	treeMenu.item(0).attribute("background-image") = "/images/le_top_bg.gif";
	treeMenu.item(0).attribute("background-stretch") = "stretch";
	//treeMenu.item(0).attribute("indent") = "50";
}

/***************************************************
// 함 수 명 : loadLeftMenuXml
// 내     용 : Menu XML File을 Memory에 Load
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function loadLeftMenuXml(mainID)
{	
	//Node create and value setting
	//model.makeNode("/root/reqData/mainID");
	//model.makeValue("/root/reqData/mainID",mainID);
	
	model.setValue("/root/reqData/mainID", mainID);
	document.all("submission2").attribute("ref") ="/root/reqData/mainID";
	model.send("submission2");
	//var menuPath = getProperty("leftmenuUrl");
	//model.instances(2).load(menuPath);
	
	model.destroy("root/tempData");
	
	var main_cnt = model.instances(1).getElementsByTagName("Main").length;
	var menuName;
	var menuImg ="/images/le_top_bg.gif";
	
	for (var i = 0; i < main_cnt; i++) {
		nodeList = model.instances(1).getElementsByTagName("Main["+(i+1)+"]").nextNode();
		if (mainID== nodeList.getAttribute("itemID")){
			menuName = nodeList.getAttribute("name");
		}
	}
	
	model.makeNode("root/tempData/treemenu");
	model.makeNode("root/tempData/treemenu/label");
	model.makeNode("root/tempData/treemenu/value");
	model.makeNode("root/tempData/treemenu/img");
	model.makeNode("root/tempData/treemenu/simg");
	model.makeNode("root/tempData/treemenu/crud");
	model.makeNode("root/tempData/treemenu/url");
	model.makeNode("root/tempData/crudNode");
	model.makeNode("root/tempData/urlNode");
	
	//model.makeNode("root/tempData/treemenu/treemenu");
	model.setValue("/root/tempData/treemenu/label",menuName);
	model.setValue("/root/tempData/treemenu/img",menuImg);
	
	treeMenu.item(0).attribute("font-weight") = "bold";
	treeMenu.item(0).attribute("font-size") = "15";
	treeMenu.item(0).attribute("width") = "100%";
	treeMenu.item(0).attribute("text-align") = "center";
	treeMenu.item(0).attribute("padding-right") = "40";
	treeMenu.item(0).attribute("background-image") = "/images/le_top_bg.gif";
	treeMenu.item(0).attribute("background-stretch") = "stretch";
	//treeMenu.item(0).attribute("indent") = "50";
	
	var child_cnt = model.instances(2).getElementsByTagName("Sub").length; 
	var selectNode = model.instances(0).selectSingleNode("root/tempData/treemenu");
	var crudNode   = "/root/tempData/crudNode";
	var crudTempNode = "/root/temp_copy/crudNode/crud";
	var urlNode		= "/root/tempData/urlNode";
	var urlTempNode = "/root/temp_copy/urlNode/url";
	
	var child_label, child_value, child_img, child_crud;
	var detailList, detail_label, detail_value, detail_img, detail_crud, detail_url;
	var subdetailList, subdetail_label, subdetail_value, subdetail_img, subdetail_crud, subdetail_url;
	var enddetailList, enddetail_label, enddetail_value, enddetail_img, enddetail_crud, enddetail_url;
	var pNode, bNode, cNode, dNode, eNode, fNode, gNode, hNode, iNode, jNode, kNode;
	
	for (var i = 0; i < child_cnt; i++) {
		nodeList = model.instances(2).getElementsByTagName("Sub["+(i+1)+"]").nextNode();
		//alert(nodeList.xml);
		child_label = nodeList.getAttribute("name");
		child_value = nodeList.getAttribute("itemID");
		
		model.setValue("/root/temp_copy/treemenu/label",child_label);
		model.setValue("/root/temp_copy/treemenu/value",child_value);
		model.setValue("/root/temp_copy/treemenu/img","/images/icon_10.gif");

		appendNode(crudNode, crudTempNode, "");
		appendNode(urlNode, urlTempNode, "");
		
		var detail_cnt = 0;
		try {
			//detail_cnt = nodeList.selectSingleNode("detail").length;
			detail_cnt = nodeList.getElementsByTagName("detail").length;
		} catch ( e ) {
			detail_cnt = 0;
		}
		
		if (detail_cnt > 0) {
			for (var j=0; j < detail_cnt; j++) {
				//nodeList = model.instances(2).getElementsByTagName("detail").item(j);
				//detailList = nodeList.getElementsByTagName("detail[" + (j + 1 ) + "]").nextNode();
				detailList = nodeList.childNodes.item(j);
				//alert(nodeList.xml);
				detail_label = detailList.getAttribute("name");
				detail_value = detailList.getAttribute("itemID");
				detail_crud 	= detailList.getAttribute("crud");
				detail_url	= detailList.getAttribute("url");
				
				var subdetail_cnt = 0;
				try {
					//subdetail_cnt = detailList.selectSingleNode("Subdetail").length;
					subdetail_cnt = detailList.getElementsByTagName("Subdetail").length;
				} catch ( e ) {
					subdetail_cnt = 0;
				}
				
				if ( subdetail_cnt > 0 ) {
					detail_value = "";
				}
				appendNode(crudNode, crudTempNode, detail_crud);
				appendNode(urlNode, urlTempNode, detail_url);
				
				model.setValue("/root/temp_copy/temp/treemenu/label",detail_label);
				model.setValue("/root/temp_copy/temp/treemenu/value",detail_value);
				model.setValue("/root/temp_copy/temp/treemenu/img","/images/icon_03.gif");
				model.setValue("/root/temp_copy/temp/treemenu/simg","/images/icon_04.gif");
				model.setValue("/root/temp_copy/temp/treemenu/crud",detail_crud);
				model.setValue("/root/temp_copy/temp/treemenu/url",detail_url);
				
				pNode = model.instances(0).selectSingleNode("/root/temp_copy/treemenu");
				dNode = model.instances(0).selectSingleNode("/root/temp_copy/temp/treemenu");
				pNode.appendChild(dNode);
				//alert(pNode.xml);
					
				if (subdetail_cnt > 0) {
					for (var k=0; k < subdetail_cnt; k++) {
						//nodeList = model.instances(2).getElementsByTagName("detail").item(j);
						subdetailList = detailList.childNodes.item(k);
						
						//alert(subdetailList.xml);
						subdetail_label 	= subdetailList.getAttribute("name");
						subdetail_value	= subdetailList.getAttribute("itemID");
						subdetail_crud 	= subdetailList.getAttribute("crud");
						subdetail_url	= subdetailList.getAttribute("url");
						
						appendNode(crudNode, crudTempNode, subdetail_crud);
						appendNode(urlNode, urlTempNode, subdetail_url);
						
						var enddetail_cnt = 0;
						try {
							enddetail_cnt = subdetailList.selectSingleNode("enddetail").length;
						} catch ( e ) {
							enddetail_cnt = 0;
						}
						
						if ( enddetail_cnt > 0 ) {
							subdetail_value = "";
						}
						
						model.setValue("/root/temp_copy/temp2/treemenu/label",subdetail_label);
						model.setValue("/root/temp_copy/temp2/treemenu/value",subdetail_value);
						model.setValue("/root/temp_copy/temp2/treemenu/img","/images/icon_03.gif");
						model.setValue("/root/temp_copy/temp2/treemenu/simg","/images/icon_04.gif");
						model.setValue("/root/temp_copy/temp2/treemenu/crud",subdetail_crud);
						model.setValue("/root/temp_copy/temp2/treemenu/url",subdetail_url);
						
						eNode = pNode.lastChild;
						hNode = model.instances(0).selectSingleNode("/root/temp_copy/temp2/treemenu");
						eNode.appendChild(hNode);
						//alert(pNode.xml);
						
						for (var l=0; l < enddetail_cnt; l++) {
							enddetailList = subdetailList.childNodes.item(l);
							
							//alert(enddetailList.xml);
							enddetail_label 	= enddetailList.getAttribute("name");
							enddetail_value 	= enddetailList.getAttribute("itemID");
							enddetail_crud 	= enddetailList.getAttribute("crud");
							enddetail_url 	= enddetailList.getAttribute("url");
							
							appendNode(crudNode, crudTempNode, enddetail_crud);
							appendNode(urlNode, urlTempNode, enddetail_url);
							
							model.setValue("/root/temp_copy/temp3/treemenu/label",enddetail_label);
							model.setValue("/root/temp_copy/temp3/treemenu/value",enddetail_value);
							model.setValue("/root/temp_copy/temp3/treemenu/img","/images/icon_03.gif");
							model.setValue("/root/temp_copy/temp3/treemenu/simg","/images/icon_04.gif");
							model.setValue("/root/temp_copy/temp3/treemenu/crud",enddetail_crud);
							model.setValue("/root/temp_copy/temp3/treemenu/url",enddetail_url);
							
							iNode = eNode.lastChild;
							jNode = model.instances(0).selectSingleNode("/root/temp_copy/temp3/treemenu");
							iNode.appendChild(jNode);
						}
					}
				}	

			}
		}

		src = model.instances(0).selectSingleNode("/root/temp_copy/treemenu");
		newNode = src.cloneNode(true);
		selectNode.appendChild(newNode);
		
		//alert(model.instances(0).xml);
		
		pNode = model.instances(0).selectSingleNode("/root/temp_copy");
		bNode = model.instances(0).selectSingleNode("/root/temp_copy/blank/treemenu");
		dNode = model.instances(0).selectSingleNode("/root/temp_copy/treemenu");
		cNode = bNode.cloneNode(true);
		pNode.replaceChild(cNode,dNode);

	}
	// Tree Menu Open & ref Mapping
	treeMenu.refresh();
	for (var i=0; i<treeMenu.length; i++){
		if (treeMenu.item(i).depth == 1){
			treeMenu.item(i).attribute("font-weight") = "bold";
			treeMenu.item(i).attribute("background-image") = "/images/le_menu_01.gif";
			treeMenu.item(i).attribute("background-stretch") = "stretch";	
			treeMenu.item(i).attribute("width") = "100%";
			treeMenu.item(i).attribute("text-align") = "left";
			treeMenu.item(i).attribute("left-padding") = "-100";
		}else if(treeMenu.item(i).depth == 2){
			treeMenu.item(i).attribute("background-image") = "/images/le_menu_02.gif";
			treeMenu.item(i).attribute("background-stretch") = "stretch";
		}else if(treeMenu.item(i).depth == 3){
			treeMenu.item(i).attribute("background-image") = "/images/le_menu_03.gif";
			treeMenu.item(i).attribute("background-stretch") = "stretch";
		}else if(treeMenu.item(i).depth == 4){
			treeMenu.item(i).attribute("background-image") = "/images/le_menu_04.gif";
			treeMenu.item(i).attribute("background-stretch") = "stretch";
		}
	}
	treeMenu.select(0);
}
/***************************************************
// 함 수 명 :  appendCrud
// 내     용 : 트리의 crud값을 하나의 노드로 생성
// Param
// pageID : page ID
// attribute : attribute name
// Return : attribute value
// 작 성 자 : 
// 작 성 일 : 
***************************************************/
function appendNode(strNode, appendNode, val){
	var strNodeVar  		= model.instances(0).selectSingleNode(strNode);
	var strTempNodeVar 	= model.instances(0).selectSingleNode(appendNode);
	model.setValue(appendNode, val);
	strNodeVar.appendChild(strTempNodeVar);
}
/***************************************************
// 함 수 명 : getMenuXmlInfo
// 내     용 : Memory에 Load 된 Menu XML에서 attribute 값 얻기
// Param
//		pageID : page ID
//		attribute : attribute name
// Return : attribute value
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function getMenuXmlInfo(pageID, attribute)
{
	if (pageID == "separator")
		return "";	
			
	//var nodeList = model.instances(1).getElementsByTagName("Sub[@itemID='"+pageID+"']").nextNode();
	var nodeList = model.instances(2).getElementsByTagName("detail[@itemID='"+pageID+"']").nextNode();
	
	if (nodeList == null) {
		nodeList = model.instances(2).getElementsByTagName("Subdetail[@itemID='"+pageID+"']").nextNode();
		if ( nodeList == null ){
			nodeList = model.instances(2).getElementsByTagName("enddetail[@itemID='"+pageID+"']").nextNode();
			   if ( nodeList == null ){
			    return "";
			   }
		}
	}
	
	return nodeList.attributes.getNamedItem(attribute).value;
}

/***************************************************
// 함 수 명 : onLoadPopupPage
// 내     용 : pageID로 메뉴에 등록된 업무화면으로 팝업으로 열기
// Param
//		pageID : page ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/

function onLoadPopupPage(pageID){
	
	var crud = "";
	
	for (var i=0; i<treeMenu.length; i++){
		if(treeMenu.item(i).value == pageID){
			crud = model.getValue("/root/tempData/crudNode/crud[" + i + "]");
			break;
		}
	}
	
	var pageURL   = getPageURL(pageID);
	var pageTitle = getPageTitle(pageID);
	
	var workWin = getWorkWindow().window;
	
	setPageInfo(workWin, pageID, pageURL, pageTitle, crud);
	
	var property = "caption:hidden; align:center; width:950px; height:756px; ";
	workWin.load(pageURL, "modal" , pageID, property);

}

    function onLoadExPopupPage(pageID){
        
        
        var crud = "";
        var pageURL = "";
        var pageTitle = "";

        model.setValue("/instance('instance4')/reqData/page_id", pageID)
        model.send("co_mng_1020_s");
        
        if(submit_completed()){
        
            crud    	= model.getValue("/instance('instance4')/resData/crud");		
            pageURL = model.getValue("/instance('instance4')/resData/pageUrl");		
            pageTitle = model.getValue("/instance('instance4')/resData/pageTitle");	
            
            var workWin = getWorkWindow().window;
            
            setPageInfo(workWin, pageID, pageURL, pageTitle, crud);
            
            var property = "caption:hidden; align:center; width:950px; height:756px; ";
            workWin.load(pageURL, "modal" , pageID, property);		
        }

    }

//==================================================================================================
//작성
//	배상용
//--------------------------------------------------------------------------------------------------
//기능
//	해당 pageID를 팝업창(모달) 형태로 IE 화면의 중간에 띄운다.
//	640*480 폼을 위한 크기
//	화면이 현재 사이즈보다 큰 경우 스크롤이 생길 수 있으므로 정확하게 개발해야함
//--------------------------------------------------------------------------------------------------
//입력
//	
//--------------------------------------------------------------------------------------------------
//출력
//	
//--------------------------------------------------------------------------------------------------
//설명
//	프로퍼티를 임의 적용 할 수 있도록 추가한 함수 다양한 크기의 팝업 창이 나올 수 있으므로
//	필요에 의해서 추가 한 함수
//	공통적으로 타이틀 감추기와 화면의 중간에 오도록 기본 설정함
//--------------------------------------------------------------------------------------------------
//예제
//	
//==================================================================================================
function onLoadPopupPageEx(pageID,openMode,propertyOption){
	
	var crud = "";
	
	for (var i=0; i<treeMenu.length; i++){
		if(treeMenu.item(i).value == pageID){
			crud = model.getValue("/root/tempData/crudNode/crud[" + i + "]");
			break;
		}
	}
	
	var pageURL   = getPageURL(pageID);
	var pageTitle = getPageTitle(pageID);
	
	var workWin = getWorkWindow().window;
	
	setPageInfo(workWin, pageID, pageURL, pageTitle, crud);

	workWin.load(pageURL, openMode , pageID, propertyOption);	
}
/***************************************************
// 함 수 명 : onLoadPopupPage
// 내     용 : pageID로 메뉴에 등록된 업무화면으로 MDIChild으로 열기
// Param
//		pageID : page ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/ 
function onLoadPage2(pageID)
{
	var crud = "";
	
	for (var i=0; i<treeMenu.length; i++){
		if(treeMenu.item(i).value == pageID){
			crud = model.getValue("/root/tempData/crudNode/crud[" + i + "]");
			break;
		}
	}

	var pageURL = getPageURL(pageID);
	var pageTitle = getPageTitle(pageID);
	
	if (existMDIWindow(pageID) == false) {
			
		var mdiWindows = getWorkWindow().window.mdichildren;
		var mdiCount = mdiWindows.length;
		if(mdiCount > 8){
			showMsgBox("더이상 새로운 메뉴창을 띄울수 없습니다.");
			return;
		}else{
			createMDIWindow(pageID, pageURL, pageTitle, crud);	// 활성화 된 Work Window에 MDI Window에 화면 열기
		}
	}
	else {
		//showMsgBox("[" + pageTitle + "] window는 이미 열려 있습니다.");
		onTaskButtonDOMActivate(pageID);
	}
}
/***************************************************
// 함 수 명 : onLoadPage
// 내     용 : pageID 화면 열기
// Param
//		pageID : page ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
var cnt = 0;
function onLoadPage(pageID,strCrud, strUrl)
{
//	if (pageID.length<3){
//		alert("Main Menu Click..!!");
//		return false;
//	}

	//var pageURL = getPageURL(pageID);
	var pageURL = strUrl;
	var pageTitle = getPageTitle(pageID);
	
	if (existMDIWindow(pageID) == false) {
			
		var mdiWindows = getWorkWindow().window.mdichildren;
		var mdiCount = mdiWindows.length;
		if(mdiCount > 8){
			showMsgBox("더이상 새로운 메뉴창을 띄울수 없습니다.");
			return;
		}else{
			createMDIWindow(pageID, pageURL, pageTitle, strCrud);	// 활성화 된 Work Window에 MDI Window에 화면 열기
		}
	}
	else {
		//showMsgBox("[" + pageTitle + "] window는 이미 열려 있습니다.");
		//onTaskButtonDOMActivate(pageID);
		onLoadPage(pageID + "*" + cnt, strCrud, strUrl);
		cnt++;
	}
}

function getPageURL(pageID)
{
	var i = pageID.indexOf("_",3);
	
	return "/xrw/" + pageID.substring(0,2).toLowerCase() + "/" + pageID.substring(3,i).toLowerCase() + "/" + pageID + ".xrw";
	//return "../../xrw/" + pageID.substring(0,2).toLowerCase() + "/" + pageID.substring(3,i).toLowerCase() + "/" + pageID + ".xrw";
}

function getPageTitle(pageID)
{
	if (pageID.indexOf("*", 0) > 0) {
		pageID = pageID.substring(0, pageID.indexOf("*", 0));
	}
	return getMenuXmlInfo(pageID, "name");
}

function setPageInfo(win, pageID, pageURL, pageTitle, strCrud)
{

	if (pageURL != null) {
		win.model.setValue("/root/initData/pageInfo/pageID", pageID);
		win.model.setValue("/root/initData/pageInfo/pageTitle", pageTitle );
		win.model.setValue("/root/initData/pageInfo/pageUrl", pageURL);
		win.model.setValue("/root/initData/pageInfo/strCrud", strCrud);
		win.model.setValue("/root/initData/pageInfo/statusMsg", "화면이 정상적으로 로딩 되었습니다.");
	}
	else if (pageID != null) {
		
		pageURL = getPageURL(pageID);
		pageTitle = getPageTitle(pageID);
		
		win.model.setValue("/root/initData/pageInfo/pageID", pageID);
		win.model.setValue("/root/initData/pageInfo/pageTitle", pageTitle );
		win.model.setValue("/root/initData/pageInfo/pageUrl", pageURL);
		win.model.setValue("/root/initData/pageInfo/strCrud", strCrud);
		win.model.setValue("/root/initData/pageInfo/statusMsg", "화면이 정상적으로 로딩 되었습니다.");
	}
	else {
		
		pageID = win.attribute("id");
		pageURL = getPageURL(pageID);
		pageTitle = getPageTitle(pageID);
		
		win.model.setValue("/root/initData/pageInfo/pageID", pageID);
		win.model.setValue("/root/initData/pageInfo/pageTitle", pageTitle );
		win.model.setValue("/root/initData/pageInfo/pageUrl", pageURL);
		win.model.setValue("/root/initData/pageInfo/strCrud", strCrud);
		win.model.setValue("/root/initData/pageInfo/statusMsg", "화면이 정상적으로 로딩 되었습니다.");
	}
}

/*******************************************************************************************************************************************************
// Task Frame 기능 관련 함수
*******************************************************************************************************************************************************/

/***************************************************
// 함 수 명 : onBtnTree
// 내     용 : Left Frame Toggle Button 이벤트 함수
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function onBtnTree(gb)
{
	if(gb=="top"){		// ???
		
		if (treeMenu.attribute("_treeVisibilityFlag") == "hidden") {
			
			grpLeft.attribute("visibility") = "visible";
			workWindow0.attribute("left") = grpLeft.attribute("width");
			
			treeMenu.attribute("_treeVisibilityFlag") = "show";
		}
	}
	else if (gb == "show") {		// 무조건 Left 메뉴를 보여준다
		
		grpLeft.attribute("visibility") = "visible";
		workWindow0.attribute("left") = grpLeft.attribute("width");
		
		treeMenu.attribute("_treeVisibilityFlag") = "show";
	}
	else if (gb == "hidden") {		// 무조건 Left 메뉴를 숨긴다
	
		grpLeft.attribute("visibility") = "hidden";
		workWindow0.attribute("left") = "0px";
		
		treeMenu.attribute("_treeVisibilityFlag") = "hidden";
	}
	else {
		
		if (treeMenu.attribute("_treeVisibilityFlag") == "hidden") {
			
			grpLeft.attribute("visibility") = "visible";
			workWindow0.attribute("left") = grpLeft.attribute("width");
			
			treeMenu.attribute("_treeVisibilityFlag") = "show";
		}
		else {
			
			grpLeft.attribute("visibility") = "hidden";
			workWindow0.attribute("left") = "0px";
			
			treeMenu.attribute("_treeVisibilityFlag") = "hidden";
		}
	}		
}

/***************************************************
// 함 수 명 : onBtnCascade
// 내     용 : MDI Window 계단식 정렬 Button 이벤트 함수
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function onBtnCascade()
{
	getWorkWindow().window.mdi("status") = "cascade";
}

/***************************************************
// 함 수 명 : onBtnTile
// 내     용 : MDI Window 바둑판식 정렬 Button 이벤트 함수
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function onBtnTile()
{
	getWorkWindow().window.mdi("status") = "tile";
}

/***************************************************
// 함 수 명 : onBtnCascade
// 내     용 : MDI Window 전체 닫기 Button 이벤트 함수
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function onBtnCloseall()
{
	getWorkWindow().window.mdi("status") = "closeall";
	
	removeAllTaskButton();	// Task Button 모두 삭제
}


/*******************************************************************************************************************************************************
// Work Window 기능 관련 함수
*******************************************************************************************************************************************************/

/***************************************************
// 함 수 명 : getWorkWindow
// 내     용 : 활성화 된 Work Window의 객체 얻기
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function getWorkWindow()
{
	return document.all("workWindow0");
}


/*******************************************************************************************************************************************************
// MDI Window 기능 관련 함수
*******************************************************************************************************************************************************/

/***************************************************
// 함 수 명 : createMDIWindow
// 내     용 : MDI Window 생성 함수
// Param
//		pageID : 화면 ID
//		pageURL : 화면 URL
//		pageTitle : 화면 title
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/

var exception_windows = new Array;
exception_windows[0] = new Array("AD_RES_1400", "1165", "840"); //광고-게재예정표

function createMDIWindow(pageID, pageURL, pageTitle, strCrud)
{
	var workWin = getWorkWindow().window;
	
	setPageInfo(workWin, pageID, pageURL, pageTitle, strCrud);
	
	var width  		= g_MDIWindowWidth;
	var height 		= g_MDIWindowHeight;
	var window_type = "mdichild";
	var align		= "";
	var showTaskButton = true;
	
	for(var i=0; i<exception_windows.length; i++){
		if(exception_windows[i][0] == pageID){
			width  = exception_windows[i][1];
			height = exception_windows[i][2];	
			window_type = "modeless";		
			align  = "center";
			showTaskButton	= false;
			break;
		}
	}
	
	//var property = "caption:hidden; left:10px; top:0px; width:" + width + "px; height:" + height + "px; align:"+align+";";
	var property = "caption:hidden; left:10px; top:0px; width:" + width + "px; height:" + (window.height - 30)+ "px; align:"+align+";";
	workWin.load(pageURL, window_type , pageID, property);
	
	if(showTaskButton){
		createTaskButton(pageID, pageTitle);
		
	}
}

/***************************************************
// 함 수 명 : closeMDIWindow
// 내     용 : MDI Window 닫기 함수
// Param
//		pageID : 화면 ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function closeMDIWindow(pageID)
{	
	var prePageID = removeTaskButton(pageID);
	
	// 이전 MDI Window로 포커스 이동
	if (prePageID != "") {
		document.all("taskBtn" + prePageID).selected = true;
		onTaskButtonDOMActivate(prePageID);
	}
	if(getWorkWindow().window.mdichildren.item(pageID) != null){
		getWorkWindow().window.mdichildren.item(pageID).window.close();
	}
}

/***************************************************
// 함 수 명 : existMDIWindow
// 내     용 : MDI Window가 존재하는지 여부를 반환
// PARAM :
//		pageID : 화면 ID
// RETURN : MDI Window의 존재 여부(true/false)
// 작 성 자 : 컴스퀘어 이 재 훈
// 작 성 일 : 2006-03-08
***************************************************/
function existMDIWindow(pageID)
{
	var mdiWin = getWorkWindow().window.mdichildren.item(pageID);
	
	return (mdiWin == null ) ? false : true;
}
function getMDIWindow(pageID)
{
	return getWorkWindow().window.mdichildren.item(pageID);
}

/*******************************************************************************************************************************************************
// Task Button 기능 관련 함수
*******************************************************************************************************************************************************/

/***************************************************
// 함 수 명 : createTaskButton
// 내     용 : Task Button 생성 함수
// Param
//		pageID : 화면 ID
//		pageTitle : 화면 title
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function createTaskButton(pageID, pageTitle)
{
	var mainObj = getWorkWindow().window;
	var curBtn = mainTask.children.item(pageID);		// 생성하려는 Button
	var mdiCnt = mainObj.mdichildren.length;	// MDI 창의 갯수

	var btnLeft = 0;		// 생성될 Button의 위치
		
	if ( curBtn == null ) {	// 생성하려는 Button이 없을때
		btnLeft = g_TaskBtnWidth * (mdiCnt);

		var btnObj = mainTask.createChild("xforms:button", "id:taskBtn"+ pageID +"; group:taskBtn; groupalign:user; selected:true; class:task; left:"+ btnLeft +"px; top:1px; width:" + g_TaskBtnWidth + "px; height:" + g_TaskBtnHeight + "px;");
		
		btnObj.attribute("text") = pageTitle;										// 생성된 Task Button의 text
		btnObj.attribute("DOMActivate") = "onTaskButtonDOMActivate('"+ pageID +"')";		// 생성된 Task Button의 DOMActivate 이벤트
		btnObj.createChild("xforms:hint", "id:hint"+ pageID +"; text:"+ pageTitle +"; ");		// 생성된 Task Button의 hint
	}
	else 	{
		onTaskButtonDOMActivate(pageID) ;
	}
	
	if (window.width < 1025)
		onBtnTree("hidden");
}

/***************************************************
// 함 수 명 : removeTaskButton
// 내     용 : Task Button 삭제 함수
// Param
//		pageID : 화면 ID
//Return : 삭제 후 활성화 시킬 MDI Window pageID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function removeTaskButton(pageID)
{
	var btnLeft = 0;					// 생성될 Button의 위치
	var removeFlag = false;			// Button 삭제 여부
	var cnt = mainTask.children.length;	// 그룹컨트롤 갯수
	var btnCnt = 0;
	var ret = "";
	
	for (var i = 7; i < cnt; i++) {
		
		var ctrl = mainTask.children.item(i);
		
		if (ctrl.elementName == "xforms:button") {
			if (ctrl.attribute("id") == "taskBtn" + pageID) {
				btnLeft = eval(ctrl.attribute("left").replace(/px/, ""));
				mainTask.removeChild(ctrl.attribute("id"));
				removeFlag = true ;
				cnt--;
				i--;
			}
			else if (removeFlag == true) {
				ctrl.attribute("left") = btnLeft;
				btnLeft += g_TaskBtnWidth;
			}
			else {
				ret = ctrl.attribute("id").replace(/taskBtn/g, "");	// 삭제하전 Task Button에서 Seq 추출
			}
		}
	}
	
	//if (window.width < 1025
		onBtnTree("show");
	
	return ret;
}

/***************************************************
// 함 수 명 : removeAllTaskButton
// 내     용 : 모든 Task Button 삭제 함수
// Param
//		pageID : 화면 ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function removeAllTaskButton()
{
	var cnt = mainTask.children.length;	// 그룹컨트롤 갯수
	
	for(i = cnt - 1; i > 6; i--) {
		
		var ctrl = mainTask.children.item(i);
		
		if (ctrl.elementName == "xforms:button" && ctrl.attribute("id").substring(0,7) == "taskBtn") {
			mainTask.removeChild(ctrl.attribute("id"));
		}
	}
	
	//if (window.width < 1000)
		onBtnTree("show");
}

/***************************************************
// 함 수 명 : onTaskButtonDOMActivate
// 내     용 : Task Button 삭제 함수
// Param
//		pageID : 화면 ID
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2007-10-01
***************************************************/
function onTaskButtonDOMActivate(pageID)
{
	var mdiWin = getWorkWindow().window.mdichildren.item(pageID);
	
	if ( mdiWin != null ) {
		mdiWin.visible = true;
		mdiWin.restore();
		mdiWin.mdiActivate();
	}
	else {
		// MDI 창이 존재 안하는 경우 어떻게 할까? 그냥 Button을 삭제해주자
		// Button은 있고 MDI 창은 없고 이런 경우는 나오면 안됨!
		//removeTaskButton(pageID);
	}
}

/***************************************************
// 함 수 명 : winMin
// 내     용 : MDI Window의 축소화 최대화 Button 이벤트
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2006-03-27
***************************************************/
function winMin()
{	
	window.minimize();
	window.visible = false;
}
/***************************************************
// 함 수 명 : winMax
// 내     용 : MDI Window의 축소화 최대화 Button 이벤트
// 작 성 자 : 컴스퀘어 이재훈
// 작 성 일 : 2006-03-27
***************************************************/
function winMax()
{	
	var child = btnMax.children;
	
	if (btnMax.attribute("_maxFlag") == "MAX") {	// 전체창 Button
		window.maximize();
		btnMax.attribute("hover.background-image") = "/images/mainFrame/mdi_win_ov.gif";
		btnMax.attribute("background-image") = "/images/mainFrame/mdi_win.gif";
		
		for ( i = 0; i < child.length; i++) {
			if ( child.item(i).elementName == "xforms:hint" ) {
				child.item(i).attribute("text") = "화면 복원";
			}
		}
		
		btnMax.attribute("_maxFlag") = "MIN";
	}
	else {	// 화면 복원 Button
		window.restore();
		btnMax.attribute("hover.background-image") = "/images/mainFrame/mdi_max_ov.gif";
		btnMax.attribute("background-image") = "/images/mainFrame/mdi_max.gif";
		
		for ( i = 0; i < child.length; i++) {
			if ( child.item(i).elementName == "xforms:hint" ) {
				child.item(i).attribute("text") = "최대화";
			}
		}
		
		btnMax.attribute("_maxFlag") = "MAX";
	}
}
			]]>
		</script>
	</xhtml:head>
	<xhtml:body overflow="hidden" pagewidth="1260" pageheight="800" style="font-family:굴림; font-size:11pt; focus-rect:hidden; ">
		<iviewer id="workWindow0" src="blank.xrw" style="left:0px; top:0px; width:100%; height:100%; margin-bottom:30px; "/>
		<group id="grpLeft" visibility="hidden" style="left:0px; top:0px; width:256px; height:100%; margin-bottom:30px; ">
			<button id="button1" style="left:0px; top:0px; width:125px; height:20px; ">
				<caption>전체</caption>
				<toggle case="case1" ev:event="DOMActivate"/>
			</button>
			<button id="button2" style="left:125px; top:0px; width:130px; height:20px; ">
				<caption>개별</caption>
				<toggle case="case2" ev:event="DOMActivate"/>
			</button>
			<switch id="switch1" style="left:0px; top:20px; width:100%; height:100%; margin-bottom:20px; ">
				<case id="case1" selected="true">
					<treeview id="treeMenu" ref="/root/tempData/treemenu" cellspacing="1" expanddepth="1" fullrowselect="true" hasbuttons="false" hasimages="true" haslines="false" indent="10" itemheight="25" oneclickexpand="true" _treeVisibilityFlag="hidden" style="left:0px; top:0px; width:100%; height:100%; padding-left:-10; background-image:/images/le_bg.gif; background-stretch:stretch; border-color:#aec9e9; ">
						<itemset nodeset="/root/tempData/treemenu">
							<label ref="label"/>
							<value ref="value"/>
							<image ref="img"/>
							<crud ref="crud"/>
							<selectedimage ref="simg"/>
						</itemset>
						<script type="javascript" ev:event="xforms-select">
							<![CDATA[
								var treeItem = treeMenu.item(treeMenu.focusIndex);
								var strCrud;
								
								if (treeItem == null || treeItem.depth < 2) return false;
								//alert(treeItem);
								if ( treeItem.depth == 2 && treeItem.value == "" ){
									return;
								}
								if ( treeItem.depth == 3 && treeItem.value == "" ){
									return;
								}
								if ( treeItem.depth == 4 && treeItem.value == "" ){
									return;
								}
								
								strCrud = model.getValue("/root/tempData/crudNode/crud[" + treeMenu.focusIndex + "]");
								strUrl  = model.getValue("/root/tempData/urlNode/url[" + treeMenu.focusIndex + "]");
								/*
								if (treeItem.depth == 4){
									strCrud = model.getValue("/root/tempData/treemenu/treemenu/treemenu/treemenu/treemenu[" + (treeMenu.focusIndex + 1) + "]/crud");
								} else if (treeItem.depth == 3){
									strCrud = model.getValue("/root/tempData/treemenu/treemenu/treemenu/treemenu[" + (treeMenu.focusIndex + 1) + "]/crud");
								} else if (treeItem.depth == 2){
									strCrud = model.getValue("/root/tempData/treemenu/treemenu/treemenu[" + (treeMenu.focusIndex + 1) + "]/crud");
								}
								*/
								onLoadPage(treeItem.value,strCrud, strUrl);
							]]>
						</script>
					</treeview>
				</case>
				<case id="case2">
					<treeview id="myTreeMenu" ref="/root/tempData/myTreeMenu" cellspacing="1" expanddepth="1" fullrowselect="true" hasbuttons="false" hasimages="true" haslines="false" indent="10" itemheight="25" oneclickexpand="true" _treeVisibilityFlag="hidden" style="left:0px; top:0px; width:100%; height:100%; padding-left:-10; background-image:/images/le_bg.gif; background-stretch:stretch; border-color:#aec9e9; ">
						<itemset nodeset="/root/tempData/myTreeMenu">
							<label ref="label"/>
							<value ref="value"/>
							<image ref="img"/>
							<crud ref="crud"/>
							<selectedimage ref="simg"/>
						</itemset>
					</treeview>
				</case>
			</switch>
		</group>
		<group id="mainTask" overflow="hidden" bottom="100%" style="left:0px; width:100%; height:30px; background-image:/images/task_back.gif; background-repeat:repeat-x; ">
			<button id="btnTree" hover.background-image="/images/brow01_ov.gif" style="left:10px; top:4px; width:15px; height:15px; background-image:/images/brow01.gif; border-style:none; focus-rect:hidden; ">
				<caption/>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
					onBtnTree();
					]]>
				</script>
				<hint>
					<![CDATA[트리메뉴]]>
				</hint>
			</button>
			<button id="btnCascade" hover.background-image="/images/brow03_ov.gif" style="left:35px; top:5px; width:15px; height:15px; background-image:/images/brow03.gif; border-style:none; focus-rect:hidden; ">
				<caption/>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
					onBtnCascade();
					]]>
				</script>
				<hint>
					<![CDATA[계단식]]>
				</hint>
			</button>
			<button id="btnTile" hover.background-image="/images/brow04_ov.gif" style="left:60px; top:5px; width:15px; height:15px; background-image:/images/brow04.gif; border-style:none; focus-rect:hidden; ">
				<caption/>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
					onBtnTile();
					]]>
				</script>
				<hint>
					<![CDATA[바둑판식 ]]>
				</hint>
			</button>
			<button id="btnCloseall" hover.background-image="/images/brow05_ov.gif" style="left:85px; top:5px; width:15px; height:15px; background-image:/images/brow05.gif; border-style:none; focus-rect:hidden; ">
				<caption/>
				<script type="javascript" ev:event="DOMActivate">
					<![CDATA[
					onBtnCloseall();
					]]>
				</script>
				<hint>
					<![CDATA[모두닫기]]>
				</hint>
			</button>
		</group>
	</xhtml:body>
</xhtml:html>
